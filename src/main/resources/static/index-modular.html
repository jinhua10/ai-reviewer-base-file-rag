<!DOCTYPE html>
<html lang="zh-CN" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ–‡æ¡£å®¡æŸ¥ç³»ç»Ÿ - æ¨¡å—åŒ–ç‰ˆæœ¬</title>

    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="assets/css/github.min.css">
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/datepicker.css">

    <!-- React åº“ (ä½¿ç”¨ CDN æˆ–æœ¬åœ°æ–‡ä»¶) -->
    <script crossorigin src="js/lib/react.production.min.js"></script>
    <script crossorigin src="js/lib/react-dom.production.min.js"></script>

    <!-- Axios åº“ (ç”¨äº API è°ƒç”¨) -->
    <script src="js/lib/axios.min.js"></script>

    <!-- Marked.js (ç”¨äº Markdown æ¸²æŸ“) -->
    <script src="js/lib/marked.min.js"></script>

    <!-- Highlight.js (ç”¨äºä»£ç é«˜äº®) -->
    <link rel="stylesheet" href="assets/css/github.min.css">
    <script src="js/lib/highlight.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <!-- åŠ è½½é¡ºåºï¼šä¾èµ– -> å·¥å…· -> ç»„ä»¶ -> ä¸»åº”ç”¨ -->

    <!-- 1. ç¿»è¯‘å­—å…¸ -->
    <script src="js/lang/lang.js"></script>

    <!-- 2. API æ¥å£ -->
    <script src="js/api/api.js"></script>

    <!-- 3. æ ·å¼å¸¸é‡ -->
    <script src="js/styles/constants.js"></script>

    <!-- 4. å…¬å…±ç»„ä»¶ -->
    <script src="js/components/common/LanguageContext.js"></script>
    <script src="js/components/common/DatePicker.js"></script>

    <!-- 5. UIç»„ä»¶åº“ -->
    <script src="js/components/tabs/DocumentsTabComponents.js"></script>

    <!-- 6. æ ‡ç­¾é¡µç»„ä»¶ -->
    <script src="js/components/tabs/QATab.js"></script>
    <script src="js/components/tabs/SearchTab.js"></script>
    <script src="js/components/tabs/DocumentsTab.js"></script>
    <script src="js/components/tabs/StatisticsTab.js"></script>

    <!-- 7. ä¸»åº”ç”¨ - ç®€åŒ–ç‰ˆ -->
    <script>
        (function() {
            console.log('ğŸš€ Starting application initialization...');
            console.log('Checking dependencies:', {
                React: !!window.React,
                ReactDOM: !!window.ReactDOM,
                axios: !!window.axios,
                marked: !!window.marked,
                hljs: !!window.hljs,
                translations: !!window.translations,
                api: !!window.api,
                StyleConstants: !!window.StyleConstants,
                LanguageModule: !!window.LanguageModule,
                QATab: !!window.QATab,
                SearchTab: !!window.SearchTab,
                DocumentsTab: !!window.DocumentsTab,
                StatisticsTab: !!window.StatisticsTab,
                DocumentsTabComponents: !!window.DocumentsTabComponents
            });

            // ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²åŠ è½½
            if (!window.LanguageModule || !window.api || !window.StyleConstants || !window.translations) {
                console.error('âŒ Required modules not loaded:', {
                    LanguageModule: !!window.LanguageModule,
                    api: !!window.api,
                    StyleConstants: !!window.StyleConstants,
                    translations: !!window.translations
                });
                document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">âŒ æ¨¡å—åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•<br/>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</div>';
                return;
            }

            console.log('âœ… All dependencies loaded successfully');

            // ä»å…¨å±€å¯¹è±¡ä¸­è§£æ„éœ€è¦çš„æ¨¡å—
            const { LanguageProvider, useTranslation } = window.LanguageModule;
            const { useState, useEffect } = React;

            // ä¸»åº”ç”¨ç»„ä»¶
            function App() {
                const { t, toggleLanguage, language } = useTranslation();
                const [activeTab, setActiveTab] = useState('qa');
                const [health, setHealth] = useState(null);

                useEffect(() => {
                    console.log('ğŸ“¡ App mounted, checking health...');
                    checkHealth();
                }, []);

                const checkHealth = async () => {
                    try {
                        console.log('ğŸ” Calling health API...');
                        const result = await window.api.health();
                        console.log('âœ… Health check result:', result);
                        setHealth(result);
                    } catch (err) {
                        console.error('âŒ Health check error:', err);
                        setHealth({ status: 'DOWN', message: 'Service connection failed' });
                    }
                };

            return React.createElement('div', { className: 'app-container' },
                // è¯­è¨€åˆ‡æ¢æŒ‰é’®
                React.createElement('div', { className: 'language-toggle' },
                    React.createElement('button', {
                        onClick: toggleLanguage
                    }, t('langToggle'))
                ),

                // å¤´éƒ¨
                React.createElement('header', { className: 'header' },
                    React.createElement('h1', null, t('title')),
                    React.createElement('p', null, t('subtitle')),
                    health && React.createElement('div', {
                        style: { marginTop: '10px', fontSize: '14px' }
                    }, `${t('status')}: ${health.status === 'UP' ? t('statusOnline') : t('statusOffline')}`)
                ),

                // ä¸»å†…å®¹åŒºåŸŸ
                React.createElement('main', { className: 'main-content' },
                    // æ ‡ç­¾é¡µå¯¼èˆª
                    React.createElement('div', { className: 'tabs' },
                    React.createElement('button', {
                        className: `tab ${activeTab === 'qa' ? 'active' : ''}`,
                        onClick: () => setActiveTab('qa')
                    }, t('tabQA')),
                    React.createElement('button', {
                        className: `tab ${activeTab === 'search' ? 'active' : ''}`,
                        onClick: () => setActiveTab('search')
                    }, t('tabSearch')),
                    React.createElement('button', {
                        className: `tab ${activeTab === 'documents' ? 'active' : ''}`,
                        onClick: () => setActiveTab('documents')
                    }, t('tabDocuments')),
                    React.createElement('button', {
                        className: `tab ${activeTab === 'stats' ? 'active' : ''}`,
                        onClick: () => setActiveTab('stats')
                    }, t('tabStats'))
                ),

                // æ ‡ç­¾é¡µå†…å®¹
                React.createElement('div', { className: 'tab-content' },
                    activeTab === 'qa' && React.createElement(window.QATab),
                    activeTab === 'search' && React.createElement(window.SearchTab),
                    activeTab === 'documents' && React.createElement(window.DocumentsTab),
                    activeTab === 'stats' && React.createElement(window.StatisticsTab)
                    )
                ), // å…³é—­ main.main-content

                // é¡µè„š
                React.createElement('footer', { className: 'footer' },
                    React.createElement('p', null, t('footerText'))
                )
            );
        }

            // æ¸²æŸ“åº”ç”¨
            console.log('ğŸ¨ Rendering application...');
            try {
                ReactDOM.render(
                    React.createElement(LanguageProvider, null,
                        React.createElement(App)
                    ),
                    document.getElementById('root')
                );
                console.log('âœ… Application rendered successfully');
            } catch (error) {
                console.error('âŒ Rendering error:', error);
                document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">âŒ æ¸²æŸ“å¤±è´¥: ' + error.message + '<br/>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</div>';
            }
        })(); // ç»“æŸç«‹å³æ‰§è¡Œå‡½æ•°
    </script>
</body>
</html>

