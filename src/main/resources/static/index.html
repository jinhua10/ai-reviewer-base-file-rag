<!DOCTYPE html>
<html lang="zh-CN" id="html-root">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿ - Knowledge Base QA System</title>
    <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">

    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="assets/css/github.min.css">
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/datepicker.css">
    <link rel="stylesheet" href="assets/css/qa-tab.css">
    <link rel="stylesheet" href="assets/css/documents-tab.css">
    <link rel="stylesheet" href="assets/css/statistics-tab.css">
    <link rel="stylesheet" href="assets/css/ai-analysis.css">
    <link rel="stylesheet" href="assets/css/llm-results-tab.css">
    <link rel="stylesheet" href="assets/css/ai-panel-float.css">
    <link rel="stylesheet" href="assets/css/hope-dashboard.css">
    <link rel="stylesheet" href="assets/css/prompt-recommendation.css">
    <link rel="stylesheet" href="assets/css/hierarchical-feedback.css">
    <link rel="stylesheet" href="assets/css/active-learning.css">

    <!-- React åº“ (ä½¿ç”¨ CDN æˆ–æœ¬åœ°æ–‡ä»¶) -->
    <script crossorigin src="js/lib/react.production.min.js"></script>
    <script crossorigin src="js/lib/react-dom.production.min.js"></script>

    <!-- Babel Standalone (ç”¨äºè½¬è¯‘ JSX) -->
    <script src="js/lib/babel.min.js"></script>

    <!-- Axios åº“ (ç”¨äº API è°ƒç”¨) -->
    <script src="js/lib/axios.min.js"></script>

    <!-- Marked.js (ç”¨äº Markdown æ¸²æŸ“) -->
    <script src="js/lib/marked.min.js"></script>

    <!-- Highlight.js (ç”¨äºä»£ç é«˜äº®) -->
    <link rel="stylesheet" href="assets/css/github.min.css">
    <script src="js/lib/highlight.min.js"></script>

    <!-- html2pdf.js (ç”¨äºå‰ç«¯ PDF ç”Ÿæˆ) -->
    <script src="js/lib/html2pdf.bundle.min.js"></script>
</head>

<body>
    <div id="root"></div>

    <!-- åŠ è½½é¡ºåºï¼šä¾èµ– -> å·¥å…· -> ç»„ä»¶ -> ä¸»åº”ç”¨ -->

    <!-- 1. ç¿»è¯‘å­—å…¸ -->
    <script src="js/lang/lang.js"></script>

    <!-- 2. API æ¥å£ -->
    <script src="js/api/api.js"></script>

    <!-- 3. æ ·å¼å¸¸é‡ -->
    <script src="js/styles/constants.js"></script>

    <!-- 4. å…¬å…±ç»„ä»¶ -->
    <script src="js/components/common/LanguageContext.js"></script>
    <script type="text/babel" src="js/components/common/DatePicker.jsx"></script>
    <script type="text/babel" src="js/components/AIFloatingButton.jsx"></script>
    <script type="text/babel" src="js/components/PromptRecommendationPanel.jsx"></script>
    <script type="text/babel" src="js/components/EmbeddedAIAnalysisPanel.jsx"></script>

    <!-- 4.1 åˆ†å±‚åé¦ˆå’Œä¸»åŠ¨å­¦ä¹ ç»„ä»¶ -->
    <script type="text/babel" src="js/components/HierarchicalFeedbackPanel.jsx"></script>
    <script type="text/babel" src="js/components/ActiveLearningPanel.jsx"></script>

    <!-- 4.2 HOPE ä¸‰å±‚è®°å¿†æ¶æ„ç»„ä»¶ -->
    <script type="text/babel" src="js/components/HOPEDashboardPanel.jsx"></script>

    <!-- 5. UIç»„ä»¶åº“ -->
    <script type="text/babel" src="js/components/tabs/DocumentsTabComponents.jsx"></script>

    <!-- 6. æ ‡ç­¾é¡µç»„ä»¶ (JSXç‰ˆæœ¬) -->
    <script type="text/babel" src="js/components/tabs/QATab.jsx"></script>
    <script type="text/babel" src="js/components/tabs/DocumentsTab.jsx"></script>
    <script type="text/babel" src="js/components/tabs/StatisticsTab.jsx"></script>
    <script type="text/babel" src="js/components/tabs/LLMResultsTab.jsx"></script>

    <!-- 7. ä¸»åº”ç”¨ç»„ä»¶ -->
    <script type="text/babel" src="js/components/App.jsx"></script>

    <!-- 8. åº”ç”¨å¯åŠ¨å™¨ -->
    <!-- ä½¿ç”¨ type="text/babel" ç¡®ä¿åœ¨æ‰€æœ‰JSXè½¬è¯‘å®Œæˆåæ‰§è¡Œ -->
    <script type="text/babel">
        (function () {
            console.log('ğŸš€ Starting application initialization...');

            // ç­‰å¾…æ‰€æœ‰ç»„ä»¶åŠ è½½å®Œæˆ
            const checkComponentsLoaded = () => {
                const deps = {
                    React: !!window.React,
                    ReactDOM: !!window.ReactDOM,
                    axios: !!window.axios,
                    marked: !!window.marked,
                    hljs: !!window.hljs,
                    translations: !!window.translations,
                    api: !!window.api,
                    StyleConstants: !!window.StyleConstants,
                    LanguageModule: !!window.LanguageModule,
                    App: !!window.App,
                    AIFloatingButton: !!window.AIFloatingButton,
                    QATab: !!window.QATab,
                    DocumentsTab: !!window.DocumentsTab,
                    StatisticsTab: !!window.StatisticsTab,
                    LLMResultsTab: !!window.LLMResultsTab,
                    DocumentsTabComponents: !!window.DocumentsTabComponents
                };

                console.log('Checking dependencies:', deps);

                // æ£€æŸ¥å…³é”®ä¾èµ–
                if (!window.LanguageModule || !window.api || !window.StyleConstants || !window.translations) {
                    console.error('âŒ Required modules not loaded:', {
                        LanguageModule: !!window.LanguageModule,
                        api: !!window.api,
                        StyleConstants: !!window.StyleConstants,
                        translations: !!window.translations
                    });
                    return false;
                }

                // æ£€æŸ¥Tabç»„ä»¶
                if (!window.QATab || !window.DocumentsTab || !window.StatisticsTab) {
                    console.warn('âš ï¸ Tab components not ready yet:', {
                        QATab: !!window.QATab,
                        DocumentsTab: !!window.DocumentsTab,
                        StatisticsTab: !!window.StatisticsTab
                    });
                    return false;
                }

                return true;
            };

            // å°è¯•åŠ è½½ï¼Œå¦‚æœç»„ä»¶æœªå°±ç»ªåˆ™ç­‰å¾…
            let attempts = 0;
            const maxAttempts = 20;

            const tryInitialize = () => {
                attempts++;

                if (checkComponentsLoaded()) {
                    console.log('âœ… All dependencies loaded successfully');
                    initializeApp();
                } else if (attempts < maxAttempts) {
                    console.log(`â³ Waiting for components... (attempt ${attempts}/${maxAttempts})`);
                    setTimeout(tryInitialize, 100);
                } else {
                    console.error('âŒ Failed to load all components after', maxAttempts, 'attempts');
                    document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">âŒ ç»„ä»¶åŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•<br/>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</div>';
                }
            };

            const initializeApp = () => {
                const { LanguageProvider } = window.LanguageModule;

                // æ¸²æŸ“åº”ç”¨
                console.log('ğŸ¨ Rendering application...');
                try {
                    ReactDOM.render(
                        <LanguageProvider>
                            <App />
                        </LanguageProvider>,
                        document.getElementById('root')
                    );
                    console.log('âœ… Application rendered successfully');
                } catch (error) {
                    console.error('âŒ Rendering error:', error);
                    document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">âŒ æ¸²æŸ“å¤±è´¥: ' + error.message + '<br/>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</div>';
                }
            };

            // å¼€å§‹å°è¯•åˆå§‹åŒ–
            tryInitialize();
        })(); // ç»“æŸç«‹å³æ‰§è¡Œå‡½æ•°
    </script>
</body>

</html>

