<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿ</title>

    <!-- React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Axios for API calls -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Ant Design CSS -->
    <link rel="stylesheet" href="https://unpkg.com/antd@5/dist/reset.css" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        #root {
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .qa-section {
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .answer-card {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .answer-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .answer-text {
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
        }

        .sources {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .sources h4 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .source-item {
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .source-text {
            flex: 1;
            margin-right: 10px;
        }

        .source-actions {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            background: #667eea;
            color: white;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        .btn-batch-download {
            margin-top: 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-batch-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .search-results {
            display: grid;
            gap: 15px;
        }

        .document-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }

        .document-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .document-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .document-excerpt {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fff3f3;
            border-left: 4px solid #ff4d4f;
            padding: 15px;
            border-radius: 8px;
            color: #ff4d4f;
            margin-top: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .response-time {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
        }

        .footer {
            text-align: center;
            color: white;
            padding: 20px;
            opacity: 0.8;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .main-content {
                padding: 20px;
            }

            .tabs {
                overflow-x: auto;
            }

            .tab {
                white-space: nowrap;
            }

            .input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API é…ç½®
        const API_BASE_URL = 'http://localhost:8080/api/qa';

        // API è°ƒç”¨å‡½æ•°
        const API_DOCS_URL = 'http://localhost:8080/api/documents';

        const api = {
            ask: async (question) => {
                const response = await axios.post(`${API_BASE_URL}/ask`, { question });
                return response.data;
            },
            search: async (query, limit = 10) => {
                const response = await axios.get(`${API_BASE_URL}/search`, {
                    params: { query, limit }
                });
                return response.data;
            },
            getStatistics: async () => {
                const response = await axios.get(`${API_BASE_URL}/statistics`);
                return response.data;
            },
            health: async () => {
                const response = await axios.get(`${API_BASE_URL}/health`);
                return response.data;
            },
            rebuild: async () => {
                const response = await axios.post(`${API_BASE_URL}/rebuild`);
                return response.data;
            },
            incrementalIndex: async () => {
                const response = await axios.post(`${API_BASE_URL}/incremental-index`);
                return response.data;
            },
            // æ–‡æ¡£ç®¡ç† API
            uploadDocument: async (file) => {
                const formData = new FormData();
                formData.append('file', file);
                const response = await axios.post(`${API_DOCS_URL}/upload`, formData, {
                    headers: { 'Content-Type': 'multipart/form-data' }
                });
                return response.data;
            },
            listDocuments: async () => {
                const response = await axios.get(`${API_DOCS_URL}/list`);
                return response.data;
            },
            deleteDocument: async (fileName) => {
                const response = await axios.delete(`${API_DOCS_URL}/${encodeURIComponent(fileName)}`);
                return response.data;
            },
            downloadDocument: async (fileName) => {
                const response = await axios.get(`${API_DOCS_URL}/download/${encodeURIComponent(fileName)}`, {
                    responseType: 'blob'
                });
                return response.data;
            },
            downloadBatch: async (fileNames) => {
                const response = await axios.post(`${API_DOCS_URL}/download-batch`, fileNames, {
                    responseType: 'blob'
                });
                return response.data;
            }
        };

        // é—®ç­”ç»„ä»¶
        function QATab() {
            const [question, setQuestion] = useState('');
            const [answer, setAnswer] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleAsk = async () => {
                if (!question.trim()) {
                    alert('è¯·è¾“å…¥é—®é¢˜');
                    return;
                }

                setLoading(true);
                setError(null);
                setAnswer(null);

                try {
                    const result = await api.ask(question);
                    setAnswer(result);
                } catch (err) {
                    setError(err.message || 'è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ');
                } finally {
                    setLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleAsk();
                }
            };

            // ä¸‹è½½å•ä¸ªæ–‡ä»¶
            const handleDownload = async (fileName) => {
                try {
                    const blob = await api.downloadDocument(fileName);
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);
                } catch (err) {
                    alert('ä¸‹è½½å¤±è´¥: ' + err.message);
                }
            };

            // æ‰¹é‡ä¸‹è½½æ‰€æœ‰å‚è€ƒæ–‡ä»¶
            const handleBatchDownload = async () => {
                if (!answer || !answer.sources || answer.sources.length === 0) {
                    return;
                }

                try {
                    const blob = await api.downloadBatch(answer.sources);
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `å‚è€ƒæ–‡æ¡£_${new Date().getTime()}.zip`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);
                } catch (err) {
                    alert('æ‰¹é‡ä¸‹è½½å¤±è´¥: ' + err.message);
                }
            };

            return (
                <div className="qa-section">
                    <div className="input-group">
                        <input
                            type="text"
                            className="input-field"
                            placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
                            value={question}
                            onChange={(e) => setQuestion(e.target.value)}
                            onKeyPress={handleKeyPress}
                            disabled={loading}
                        />
                        <button
                            className="btn btn-primary"
                            onClick={handleAsk}
                            disabled={loading}
                        >
                            {loading ? 'æ€è€ƒä¸­...' : 'ğŸ¤” æé—®'}
                        </button>
                    </div>

                    {loading && (
                        <div className="loading">
                            <div className="spinner"></div>
                            <p>AI æ­£åœ¨æ€è€ƒ...</p>
                        </div>
                    )}

                    {error && (
                        <div className="error">
                            âŒ {error}
                        </div>
                    )}

                    {answer && !loading && (
                        <div className="answer-card">
                            <h3>ğŸ’¡ å›ç­”</h3>
                            <div className="answer-text">{answer.answer}</div>

                            {answer.sources && answer.sources.length > 0 && (
                                <div className="sources">
                                    <h4>ğŸ“š å‚è€ƒæ¥æº</h4>
                                    {answer.sources.map((source, index) => (
                                        <div key={index} className="source-item">
                                            <span className="source-text">
                                                {index + 1}. {source}
                                            </span>
                                            <div className="source-actions">
                                                <button
                                                    className="btn-icon"
                                                    onClick={() => handleDownload(source)}
                                                    title="ä¸‹è½½æ­¤æ–‡ä»¶"
                                                >
                                                    ğŸ’¾ ä¸‹è½½
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                    {answer.sources.length > 1 && (
                                        <button
                                            className="btn-batch-download"
                                            onClick={handleBatchDownload}
                                        >
                                            ğŸ“¦ æ‰¹é‡ä¸‹è½½å…¨éƒ¨ ({answer.sources.length} ä¸ªæ–‡ä»¶)
                                        </button>
                                    )}
                                </div>
                            )}

                            <div className="response-time">
                                â±ï¸ å“åº”æ—¶é—´: {answer.responseTimeMs}ms
                            </div>
                        </div>
                    )}

                    {!answer && !loading && !error && (
                        <div className="empty-state">
                            <div className="empty-state-icon">ğŸ’­</div>
                            <p>åœ¨ä¸Šæ–¹è¾“å…¥æ¡†æå‡ºæ‚¨çš„é—®é¢˜</p>
                            <p style={{fontSize: '14px', marginTop: '10px', color: '#ccc'}}>
                                ç¤ºä¾‹: "æ–‡æ¡£çš„ä¸»è¦å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ"
                            </p>
                        </div>
                    )}
                </div>
            );
        }

        // æœç´¢ç»„ä»¶
        function SearchTab() {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [limit, setLimit] = useState(10);

            const handleSearch = async () => {
                if (!query.trim()) {
                    alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                    return;
                }

                setLoading(true);
                setError(null);
                setResults(null);

                try {
                    const result = await api.search(query, limit);
                    setResults(result);
                } catch (err) {
                    setError(err.message || 'æœç´¢å¤±è´¥');
                } finally {
                    setLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleSearch();
                }
            };

            return (
                <div className="search-section">
                    <div className="input-group">
                        <input
                            type="text"
                            className="input-field"
                            placeholder="æœç´¢å…³é”®è¯..."
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onKeyPress={handleKeyPress}
                            disabled={loading}
                        />
                        <select
                            className="input-field"
                            style={{flex: '0 0 120px'}}
                            value={limit}
                            onChange={(e) => setLimit(Number(e.target.value))}
                        >
                            <option value={5}>5 æ¡</option>
                            <option value={10}>10 æ¡</option>
                            <option value={20}>20 æ¡</option>
                            <option value={50}>50 æ¡</option>
                        </select>
                        <button
                            className="btn btn-primary"
                            onClick={handleSearch}
                            disabled={loading}
                        >
                            {loading ? 'æœç´¢ä¸­...' : 'ğŸ” æœç´¢'}
                        </button>
                    </div>

                    {loading && (
                        <div className="loading">
                            <div className="spinner"></div>
                            <p>æœç´¢ä¸­...</p>
                        </div>
                    )}

                    {error && (
                        <div className="error">
                            âŒ {error}
                        </div>
                    )}

                    {results && !loading && (
                        <div>
                            <div style={{marginBottom: '15px', color: '#666'}}>
                                æ‰¾åˆ° <strong>{results.total}</strong> ä¸ªç›¸å…³æ–‡æ¡£
                            </div>

                            <div className="search-results">
                                {results.documents.map((doc, index) => (
                                    <div key={doc.id} className="document-card">
                                        <div className="document-title">
                                            ğŸ“„ {doc.title || `æ–‡æ¡£ ${index + 1}`}
                                        </div>
                                        <div className="document-excerpt">
                                            {doc.excerpt}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {!results && !loading && !error && (
                        <div className="empty-state">
                            <div className="empty-state-icon">ğŸ”</div>
                            <p>è¾“å…¥å…³é”®è¯æœç´¢ç›¸å…³æ–‡æ¡£</p>
                        </div>
                    )}
                </div>
            );
        }

        // æ–‡æ¡£ç®¡ç†ç»„ä»¶
        function DocumentsTab() {
            const [documents, setDocuments] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [uploading, setUploading] = useState(false);
            const [uploadProgress, setUploadProgress] = useState(null);
            const [filterText, setFilterText] = useState('');

            useEffect(() => {
                loadDocuments();
            }, []);

            const loadDocuments = async () => {
                setLoading(true);
                setError(null);

                try {
                    console.log('å¼€å§‹åŠ è½½æ–‡æ¡£åˆ—è¡¨...');
                    const result = await api.listDocuments();
                    console.log('æ–‡æ¡£åˆ—è¡¨å“åº”:', result);

                    if (result.success) {
                        setDocuments(result.documents || []);
                        console.log('åŠ è½½åˆ°', result.documents?.length || 0, 'ä¸ªæ–‡æ¡£');
                    } else {
                        const errorMsg = result.message || 'è·å–æ–‡æ¡£åˆ—è¡¨å¤±è´¥';
                        console.error('åŠ è½½å¤±è´¥:', errorMsg);
                        setError(errorMsg);
                    }
                } catch (err) {
                    console.error('åŠ è½½æ–‡æ¡£åˆ—è¡¨å¼‚å¸¸:', err);
                    const errorMsg = err.response?.data?.message || err.message || 'åŠ è½½æ–‡æ¡£åˆ—è¡¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ';
                    setError(errorMsg);
                } finally {
                    setLoading(false);
                }
            };

            const handleFileSelect = async (event) => {
                const files = event.target.files;
                if (!files || files.length === 0) return;

                setUploading(true);
                setUploadProgress({ total: files.length, current: 0, success: 0, failed: 0 });

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    try {
                        await api.uploadDocument(file);
                        setUploadProgress(prev => ({ ...prev, current: i + 1, success: prev.success + 1 }));
                    } catch (err) {
                        setUploadProgress(prev => ({ ...prev, current: i + 1, failed: prev.failed + 1 }));
                    }
                }

                setUploading(false);
                setTimeout(() => setUploadProgress(null), 3000);
                loadDocuments();

                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
                event.target.value = '';
            };

            const handleDelete = async (fileName) => {
                if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡æ¡£ "${fileName}" å—ï¼Ÿ\n\nåˆ é™¤åéœ€è¦é‡å»ºç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆã€‚`)) {
                    return;
                }

                try {
                    const result = await api.deleteDocument(fileName);
                    if (result.success) {
                        alert('æ–‡æ¡£åˆ é™¤æˆåŠŸï¼\nå»ºè®®é‡å»ºç´¢å¼•ä»¥æ›´æ–°æœç´¢ç»“æœã€‚');
                        loadDocuments();
                    } else {
                        alert('åˆ é™¤å¤±è´¥: ' + result.message);
                    }
                } catch (err) {
                    alert('åˆ é™¤å¤±è´¥: ' + err.message);
                }
            };

            const formatFileSize = (bytes) => {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
                return (bytes / 1024 / 1024).toFixed(2) + ' MB';
            };

            // è¿‡æ»¤æ–‡æ¡£åˆ—è¡¨
            const filteredDocuments = documents.filter(doc =>
                doc.fileName.toLowerCase().includes(filterText.toLowerCase())
            );

            return (
                <div>
                    {/* ä¸Šä¼ åŒºåŸŸ */}
                    <div style={{marginBottom: '30px', padding: '20px', background: '#f8f9ff', borderRadius: '8px'}}>
                        <h3 style={{marginBottom: '15px'}}>ğŸ“¤ ä¸Šä¼ æ–‡æ¡£</h3>
                        <input
                            type="file"
                            id="fileInput"
                            multiple
                            accept=".xlsx,.xls,.docx,.doc,.pptx,.ppt,.pdf,.txt,.md,.html,.xml"
                            onChange={handleFileSelect}
                            disabled={uploading}
                            style={{display: 'none'}}
                        />
                        <label htmlFor="fileInput" className="btn btn-primary" style={{display: 'inline-block', cursor: uploading ? 'not-allowed' : 'pointer', opacity: uploading ? 0.5 : 1}}>
                            {uploading ? 'â³ ä¸Šä¼ ä¸­...' : 'ğŸ“ é€‰æ‹©æ–‡ä»¶'}
                        </label>
                        <p style={{marginTop: '10px', fontSize: '14px', color: '#666'}}>
                            æ”¯æŒæ ¼å¼: Excel, Word, PowerPoint, PDF, TXT, MD, HTML, XML
                        </p>

                        {uploadProgress && (
                            <div style={{marginTop: '15px', padding: '10px', background: 'white', borderRadius: '4px'}}>
                                <div>ğŸ“Š ä¸Šä¼ è¿›åº¦: {uploadProgress.current}/{uploadProgress.total}</div>
                                <div style={{fontSize: '14px', color: '#666', marginTop: '5px'}}>
                                    âœ… æˆåŠŸ: {uploadProgress.success} | âŒ å¤±è´¥: {uploadProgress.failed}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* æ–‡æ¡£åˆ—è¡¨åŒºåŸŸ */}
                    <div>
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px'}}>
                            <h3>ğŸ“š æ–‡æ¡£åˆ—è¡¨ {!loading && `(${filteredDocuments.length}/${documents.length})`}</h3>
                            <button
                                className="btn btn-secondary"
                                onClick={loadDocuments}
                                disabled={loading}
                            >
                                {loading ? 'â³ åŠ è½½ä¸­...' : 'ğŸ”„ åˆ·æ–°'}
                            </button>
                        </div>

                        {/* æ–‡ä»¶åè¿‡æ»¤è¾“å…¥æ¡† */}
                        {!loading && documents.length > 0 && (
                            <div style={{marginBottom: '15px'}}>
                                <input
                                    type="text"
                                    className="input-field"
                                    placeholder="ğŸ” è¾“å…¥æ–‡ä»¶åè¿›è¡Œè¿‡æ»¤..."
                                    value={filterText}
                                    onChange={(e) => setFilterText(e.target.value)}
                                    style={{width: '100%'}}
                                />
                                {filterText && (
                                    <div style={{fontSize: '13px', color: '#666', marginTop: '5px'}}>
                                        è¿‡æ»¤ç»“æœ: {filteredDocuments.length} / {documents.length} ä¸ªæ–‡æ¡£
                                        <button
                                            onClick={() => setFilterText('')}
                                            style={{
                                                marginLeft: '10px',
                                                background: 'none',
                                                border: 'none',
                                                color: '#667eea',
                                                cursor: 'pointer',
                                                textDecoration: 'underline',
                                                fontSize: '13px'
                                            }}
                                        >
                                            æ¸…é™¤è¿‡æ»¤
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* åŠ è½½çŠ¶æ€ */}
                        {loading && (
                            <div className="loading">
                                <div className="spinner"></div>
                                <p>åŠ è½½æ–‡æ¡£åˆ—è¡¨...</p>
                            </div>
                        )}

                        {/* é”™è¯¯çŠ¶æ€ */}
                        {error && !loading && (
                            <div className="error">
                                âŒ {error}
                                <button
                                    className="btn btn-secondary"
                                    onClick={loadDocuments}
                                    style={{marginTop: '10px', display: 'block'}}
                                >
                                    é‡è¯•
                                </button>
                            </div>
                        )}

                        {/* ç©ºçŠ¶æ€ */}
                        {!error && !loading && documents.length === 0 && (
                            <div className="empty-state">
                                <div className="empty-state-icon">ğŸ“</div>
                                <p>æš‚æ— æ–‡æ¡£</p>
                                <p style={{fontSize: '14px', marginTop: '10px', color: '#ccc'}}>
                                    ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ä¸Šä¼ æ–‡æ¡£
                                </p>
                            </div>
                        )}

                        {/* æ–‡æ¡£åˆ—è¡¨ */}
                        {!error && !loading && documents.length > 0 && (
                            <>
                            {filteredDocuments.length > 0 ? (
                            <div style={{display: 'grid', gap: '10px'}}>
                                {filteredDocuments.map((doc, index) => (
                                    <div key={index} className="document-card" style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                        <div style={{flex: 1}}>
                                            <div className="document-title">
                                                ğŸ“„ {doc.fileName}
                                            </div>
                                            <div style={{fontSize: '13px', color: '#999', marginTop: '5px'}}>
                                                ğŸ“¦ {formatFileSize(doc.fileSize)} |
                                                ğŸ“… {doc.uploadTime} |
                                                ğŸ·ï¸ {doc.fileType.toUpperCase()}
                                                {doc.indexed && <span style={{marginLeft: '5px'}}>| âœ… å·²ç´¢å¼•</span>}
                                            </div>
                                        </div>
                                        <button
                                            className="btn btn-secondary"
                                            onClick={() => handleDelete(doc.fileName)}
                                            style={{
                                                padding: '8px 16px',
                                                background: '#ff4d4f',
                                                color: 'white',
                                                marginLeft: '10px'
                                            }}
                                        >
                                            ğŸ—‘ï¸ åˆ é™¤
                                        </button>
                                    </div>
                                ))}
                            </div>
                            ) : (
                                <div className="empty-state">
                                    <div className="empty-state-icon">ğŸ”</div>
                                    <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é… "{filterText}" çš„æ–‡æ¡£</p>
                                    <button
                                        className="btn btn-secondary"
                                        onClick={() => setFilterText('')}
                                        style={{marginTop: '15px'}}
                                    >
                                        æ¸…é™¤è¿‡æ»¤
                                    </button>
                                </div>
                            )}
                            </>
                        )}

                        {/* æç¤ºä¿¡æ¯ */}
                        {!error && !loading && documents.length > 0 && (
                            <div style={{marginTop: '20px', padding: '15px', background: '#fff3cd', borderRadius: '8px', fontSize: '14px'}}>
                                ğŸ’¡ <strong>æç¤ºï¼š</strong>ä¸Šä¼ æˆ–åˆ é™¤æ–‡æ¡£åï¼Œå»ºè®®å‰å¾€"ç»Ÿè®¡ä¿¡æ¯"é¡µé¢<strong>é‡å»ºç´¢å¼•</strong>ï¼Œä»¥ä¾¿æœç´¢åˆ°æœ€æ–°å†…å®¹ã€‚
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ç»Ÿè®¡ä¿¡æ¯ç»„ä»¶
        function StatisticsTab() {
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [rebuilding, setRebuilding] = useState(false);
            const [incrementalIndexing, setIncrementalIndexing] = useState(false);
            const [rebuildResult, setRebuildResult] = useState(null);

            useEffect(() => {
                loadStatistics();
            }, []);

            const loadStatistics = async () => {
                setLoading(true);
                setError(null);

                try {
                    const result = await api.getStatistics();
                    setStats(result);
                } catch (err) {
                    setError(err.message || 'åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥');
                } finally {
                    setLoading(false);
                }
            };

            const handleRebuild = async () => {
                if (!confirm('ç¡®å®šè¦é‡å»ºçŸ¥è¯†åº“ç´¢å¼•å—ï¼Ÿ\n\nè¿™å°†é‡æ–°å¤„ç†æ‰€æœ‰æ–‡æ¡£ï¼Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚')) {
                    return;
                }

                setRebuilding(true);
                setError(null);
                setRebuildResult(null);

                try {
                    const result = await api.rebuild();
                    setRebuildResult(result);

                    if (result.success) {
                        // é‡å»ºæˆåŠŸååˆ·æ–°ç»Ÿè®¡ä¿¡æ¯
                        setTimeout(() => {
                            loadStatistics();
                        }, 1000);
                    }
                } catch (err) {
                    setError(err.message || 'é‡å»ºå¤±è´¥');
                } finally {
                    setRebuilding(false);
                }
            };

            const handleIncrementalIndex = async () => {
                if (!confirm('ç¡®å®šè¦æ‰§è¡Œå¢é‡ç´¢å¼•å—ï¼Ÿ\n\nåªä¼šå¤„ç†æ–°å¢å’Œä¿®æ”¹çš„æ–‡æ¡£ï¼Œé€Ÿåº¦æ›´å¿«ã€‚')) {
                    return;
                }

                setIncrementalIndexing(true);
                setError(null);
                setRebuildResult(null);

                try {
                    const result = await api.incrementalIndex();
                    setRebuildResult(result);

                    if (result.success) {
                        // å¢é‡ç´¢å¼•æˆåŠŸååˆ·æ–°ç»Ÿè®¡ä¿¡æ¯
                        setTimeout(() => {
                            loadStatistics();
                        }, 1000);
                    }
                } catch (err) {
                    setError(err.message || 'å¢é‡ç´¢å¼•å¤±è´¥');
                } finally {
                    setIncrementalIndexing(false);
                }
            };

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>åŠ è½½ç»Ÿè®¡ä¿¡æ¯...</p>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="error">
                        âŒ {error}
                        <button
                            className="btn btn-secondary"
                            onClick={loadStatistics}
                            style={{marginTop: '10px'}}
                        >
                            é‡è¯•
                        </button>
                    </div>
                );
            }

            return (
                <div>
                    <div className="statistics-grid">
                        <div className="stat-card">
                            <div className="stat-value">{stats.documentCount}</div>
                            <div className="stat-label">ğŸ“š æ–‡æ¡£æ€»æ•°</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{stats.indexedDocumentCount}</div>
                            <div className="stat-label">ğŸ” å·²ç´¢å¼•æ–‡æ¡£</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">
                                {stats.documentCount > 0
                                    ? Math.round((stats.indexedDocumentCount / stats.documentCount) * 100)
                                    : 0}%
                            </div>
                            <div className="stat-label">âœ… ç´¢å¼•å®Œæˆåº¦</div>
                        </div>
                    </div>

                    {(rebuilding || incrementalIndexing) && (
                        <div className="loading" style={{marginTop: '30px'}}>
                            <div className="spinner"></div>
                            <p>{rebuilding ? 'æ­£åœ¨é‡å»ºçŸ¥è¯†åº“ç´¢å¼•...' : 'æ­£åœ¨æ‰§è¡Œå¢é‡ç´¢å¼•...'}</p>
                            <p style={{fontSize: '14px', color: '#999', marginTop: '10px'}}>
                                {rebuilding ? 'è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…' : 'åªå¤„ç†æ–°å¢å’Œä¿®æ”¹çš„æ–‡æ¡£ï¼Œé€Ÿåº¦è¾ƒå¿«'}
                            </p>
                        </div>
                    )}

                    {rebuildResult && !rebuilding && !incrementalIndexing && (
                        <div className={rebuildResult.success ? 'answer-card' : 'error'} style={{marginTop: '30px'}}>
                            <h3>{rebuildResult.success ? 'âœ… æ“ä½œæˆåŠŸ' : 'âŒ æ“ä½œå¤±è´¥'}</h3>
                            <div style={{marginTop: '10px'}}>
                                <p>{rebuildResult.message}</p>
                                {rebuildResult.success && rebuildResult.processedFiles > 0 && (
                                    <div style={{marginTop: '15px', fontSize: '14px'}}>
                                        <p>ğŸ“„ å¤„ç†æ–‡ä»¶: {rebuildResult.processedFiles} ä¸ª</p>
                                        <p>ğŸ“š æ€»æ–‡æ¡£æ•°: {rebuildResult.totalDocuments} ä¸ª</p>
                                        <p>â±ï¸ è€—æ—¶: {(rebuildResult.durationMs / 1000).toFixed(2)} ç§’</p>
                                    </div>
                                )}
                                {rebuildResult.suggestion && (
                                    <p style={{marginTop: '10px', fontSize: '14px', color: '#666'}}>
                                        ğŸ’¡ {rebuildResult.suggestion}
                                    </p>
                                )}
                            </div>
                        </div>
                    )}

                    <div style={{marginTop: '30px'}}>
                        <div style={{padding: '20px', background: '#f8f9ff', borderRadius: '8px', marginBottom: '20px'}}>
                            <h4 style={{marginBottom: '10px', color: '#667eea'}}>ğŸ“– ç´¢å¼•è¯´æ˜</h4>
                            <div style={{fontSize: '14px', lineHeight: '1.8', color: '#666'}}>
                                <p style={{marginBottom: '8px'}}>
                                    <strong>ğŸ”„ å¢é‡ç´¢å¼•ï¼š</strong>åªå¤„ç†æ–°å¢å’Œä¿®æ”¹çš„æ–‡æ¡£ï¼Œæ€§èƒ½æ›´ä¼˜ï¼Œæ¨èæ—¥å¸¸ä½¿ç”¨
                                </p>
                                <p>
                                    <strong>ğŸ”¨ é‡å»ºç´¢å¼•ï¼š</strong>å®Œå…¨é‡å»ºæ‰€æœ‰æ–‡æ¡£ç´¢å¼•ï¼Œè€—æ—¶è¾ƒé•¿ï¼Œé€‚ç”¨äºé¦–æ¬¡æ„å»ºæˆ–å¤§è§„æ¨¡å˜æ›´
                                </p>
                            </div>
                        </div>

                        <div style={{textAlign: 'center', display: 'flex', gap: '10px', justifyContent: 'center', flexWrap: 'wrap'}}>
                            <button
                                className="btn btn-secondary"
                                onClick={loadStatistics}
                                disabled={rebuilding || incrementalIndexing}
                            >
                                ğŸ”„ åˆ·æ–°ç»Ÿè®¡
                            </button>
                            <button
                                className="btn btn-primary"
                                onClick={handleIncrementalIndex}
                                disabled={rebuilding || incrementalIndexing}
                                style={{
                                    background: incrementalIndexing ? '#ccc' : 'linear-gradient(135deg, #52c41a 0%, #73d13d 100%)'
                                }}
                            >
                                {incrementalIndexing ? 'â³ ç´¢å¼•ä¸­...' : 'âš¡ å¢é‡ç´¢å¼•'}
                            </button>
                            <button
                                className="btn btn-primary"
                                onClick={handleRebuild}
                                disabled={rebuilding || incrementalIndexing}
                            >
                                {rebuilding ? 'â³ é‡å»ºä¸­...' : 'ğŸ”¨ é‡å»ºç´¢å¼•'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ä¸»åº”ç”¨ç»„ä»¶
        function App() {
            const [activeTab, setActiveTab] = useState('qa');
            const [health, setHealth] = useState(null);

            useEffect(() => {
                checkHealth();
            }, []);

            const checkHealth = async () => {
                try {
                    const result = await api.health();
                    setHealth(result);
                } catch (err) {
                    setHealth({ status: 'DOWN', message: 'æœåŠ¡è¿æ¥å¤±è´¥' });
                }
            };

            return (
                <div className="app-container">
                    <header className="header">
                        <h1>ğŸ¤– çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿ</h1>
                        <p>åŸºäº LocalFileRAG çš„æ™ºèƒ½é—®ç­”å¹³å°</p>
                        {health && (
                            <div style={{marginTop: '10px', fontSize: '14px'}}>
                                çŠ¶æ€: {health.status === 'UP' ? 'âœ… è¿è¡Œä¸­' : 'âŒ ç¦»çº¿'}
                            </div>
                        )}
                    </header>

                    <main className="main-content">
                        <div className="tabs">
                            <button
                                className={`tab ${activeTab === 'qa' ? 'active' : ''}`}
                                onClick={() => setActiveTab('qa')}
                            >
                                ğŸ’¬ æ™ºèƒ½é—®ç­”
                            </button>
                            <button
                                className={`tab ${activeTab === 'search' ? 'active' : ''}`}
                                onClick={() => setActiveTab('search')}
                            >
                                ğŸ” æ–‡æ¡£æœç´¢
                            </button>
                            <button
                                className={`tab ${activeTab === 'documents' ? 'active' : ''}`}
                                onClick={() => setActiveTab('documents')}
                            >
                                ğŸ“ æ–‡æ¡£ç®¡ç†
                            </button>
                            <button
                                className={`tab ${activeTab === 'stats' ? 'active' : ''}`}
                                onClick={() => setActiveTab('stats')}
                            >
                                ğŸ“Š ç»Ÿè®¡ä¿¡æ¯
                            </button>
                        </div>

                        <div className="tab-content">
                            {activeTab === 'qa' && <QATab />}
                            {activeTab === 'search' && <SearchTab />}
                            {activeTab === 'documents' && <DocumentsTab />}
                            {activeTab === 'stats' && <StatisticsTab />}
                        </div>
                    </main>

                    <footer className="footer">
                        <p>Â© 2025 LocalFileRAG Knowledge QA System | Powered by GPT-4o & React</p>
                    </footer>
                </div>
            );
        }

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

