# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®æ–‡ä»¶
# Knowledge QA System Configuration

server:
  port: 8080

  # Tomcat é…ç½®
  tomcat:
    # ä¸´æ—¶æ–‡ä»¶ç›®å½•
    basedir: ./temp
    # è¿æ¥è¶…æ—¶
    connection-timeout: 20000
    # çº¿ç¨‹é…ç½®
    threads:
      max: 200
      min-spare: 10

spring:
  application:
    name: knowledge-qa-system

  # å›½é™…åŒ–æ¶ˆæ¯æºé…ç½® (I18n Message Source Configuration)
  # ç¡®ä¿æ‰€æœ‰ messages*.properties æ–‡ä»¶ä»¥ UTF-8 ç¼–ç åŠ è½½
  messages:
    basename: messages
    encoding: UTF-8
    cache-duration: 3600
    fallback-to-system-locale: false

  # æ–‡ä»¶ä¸Šä¼ é…ç½®
  servlet:
    multipart:
      # å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 1MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-file-size: 100MB
      # å•æ¬¡è¯·æ±‚æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 10MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-request-size: 100MB
      # æ˜¯å¦å¯ç”¨æ–‡ä»¶ä¸Šä¼ 
      enabled: true
      # ä¸´æ—¶æ–‡ä»¶ä½ç½®ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ç›®å½•ï¼Œé¿å…ç³»ç»Ÿä¸´æ—¶ç›®å½•æƒé™é—®é¢˜ï¼‰
      location: ./temp/uploads
      # æ–‡ä»¶å†™å…¥ç£ç›˜çš„é˜ˆå€¼ï¼ˆ0 è¡¨ç¤ºå§‹ç»ˆå†™å…¥ç£ç›˜ï¼‰
      file-size-threshold: 0

# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®
knowledge:
  qa:
    # çŸ¥è¯†åº“é…ç½®
    knowledge-base:
      # çŸ¥è¯†åº“å­˜å‚¨è·¯å¾„ï¼ˆç´¢å¼•ã€å…ƒæ•°æ®ç­‰ï¼‰
      storage-path: ./data/knowledge-base

      # æ–‡æ¡£æºè·¯å¾„ï¼ˆæ”¯æŒæ–‡ä»¶å¤¹æˆ–å•ä¸ªæ–‡ä»¶ï¼‰
      # ç¤ºä¾‹ï¼š
      #   - ./data/documents           # æ–‡ä»¶å¤¹
      #   - E:/æ–‡æ¡£/çŸ¥è¯†åº“             # ä¸­æ–‡è·¯å¾„
      #   - ./data/documents/file.xlsx # å•ä¸ªæ–‡ä»¶
      #   - classpath:simpleExcel      # resourcesä¸‹çš„ç›®å½•
      # 
      # æ³¨æ„ï¼šä½¿ç”¨ classpath è·¯å¾„æ—¶ï¼Œä¸­æ–‡æ–‡ä»¶åå¯èƒ½åœ¨æ„å»ºè¿‡ç¨‹ä¸­å‡ºç°ç¼–ç é—®é¢˜
      # æ¨èä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä»¥è·å¾—æ›´å¥½çš„ä¸­æ–‡æ–‡ä»¶åæ”¯æŒ
      source-path: ./data/documents

      # å¯åŠ¨æ—¶ç´¢å¼•æ¨¡å¼
      # true: å®Œå…¨é‡å»ºï¼ˆåˆ é™¤æ—§ç´¢å¼•ï¼Œé‡æ–°ç´¢å¼•æ‰€æœ‰æ–‡ä»¶ï¼‰
      # false: å¢é‡ç´¢å¼•ï¼ˆåªç´¢å¼•æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶ï¼Œé»˜è®¤æ¨èï¼‰
      # æ³¨æ„ï¼šUIç•Œé¢å¯ä»¥éšæ—¶è§¦å‘å®Œå…¨é‡å»ºæˆ–å¢é‡ç´¢å¼•
      rebuild-on-startup: false

      # æ˜¯å¦å¯ç”¨ç¼“å­˜
      enable-cache: true

      # è‡ªåŠ¨ç´¢å¼•é…ç½®
      # ä¸Šä¼ æ–‡ä»¶åæ˜¯å¦è‡ªåŠ¨è§¦å‘å¢é‡ç´¢å¼•
      # true: ä¸Šä¼ å®Œæˆåè‡ªåŠ¨åå°ç´¢å¼•ï¼ˆæ¨èï¼‰
      # false: éœ€è¦æ‰‹åŠ¨ç‚¹å‡»"å¢é‡ç´¢å¼•"æŒ‰é’®
      auto-index-after-upload: true

    # ============================================================
    # æœç´¢é…ç½®ï¼ˆåœç”¨è¯ã€å…³é”®è¯æå–ï¼‰
    # ============================================================
    search:
      # æ˜¯å¦å¯ç”¨åœç”¨è¯è¿‡æ»¤
      enable-stop-words-filter: true

      # æœ€å°å…³é”®è¯é•¿åº¦ï¼ˆå°äºæ­¤é•¿åº¦çš„è¯ä¼šè¢«è¿‡æ»¤ï¼‰
      min-keyword-length: 2

      # ä¸­æ–‡åœç”¨è¯åˆ—è¡¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
      chinese-stop-words:
        - çš„
        - æ˜¯
        - åœ¨
        - äº†
        - å’Œ
        - æœ‰
        - æˆ‘
        - ä½ 
        - ä»–
        - å¥¹
        - å®ƒ
        - ä»¬
        - è¿™
        - é‚£
        - ä¹‹
        - ä¸
        - åŠ
        - æˆ–
        - ç­‰
        - ä¹Ÿ
        - å°±
        - éƒ½
        - è€Œ
        - ç€
        - æŠŠ
        - è¢«
        - è®©
        - ç»™
        - å‘
        - å¾€
        - ä»
        - è‡ª
        - ä»€ä¹ˆ
        - æ€ä¹ˆ
        - å¦‚ä½•
        - ä¸ºä»€ä¹ˆ
        - å“ª
        - å“ªäº›
        - å“ªä¸ª
        - å“ªé‡Œ
        - è°
        - å¤šå°‘
        - å‡ 
        - å—
        - å‘¢
        - å•Š
        - å§
        - å‘€
        - å“¦
        - å—¯
        - ä¸€ä¸ª
        - ä¸€äº›
        - è¿™ä¸ª
        - é‚£ä¸ª
        - è¿™äº›
        - é‚£äº›
        - æŸ
        - æŸäº›
        - å¯ä»¥
        - å¯èƒ½
        - åº”è¯¥
        - éœ€è¦
        - å¿…é¡»
        - èƒ½å¤Ÿ
        - èƒ½
        - ä¼š
        - è¯·
        - è¯·é—®
        - æƒ³
        - è¦
        - æƒ³è¦
        - å¸Œæœ›
        - å¯å¦
        - æ˜¯å¦
        - éå¸¸
        - å¾ˆ
        - å¤ª
        - æœ€
        - æ›´
        - æ¯”è¾ƒ
        - ç›¸å½“
        - ååˆ†

      # è‹±æ–‡åœç”¨è¯åˆ—è¡¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
      english-stop-words:
        # å† è¯
        - "a"
        - "an"
        - "the"
        # be åŠ¨è¯
        - "is"
        - "are"
        - "was"
        - "were"
        - "be"
        - "been"
        - "being"
        - "am"
        # ä»£è¯
        - "i"
        - "you"
        - "he"
        - "she"
        - "it"
        - "we"
        - "they"
        - "me"
        - "him"
        - "her"
        - "us"
        - "them"
        - "my"
        - "your"
        - "his"
        - "its"
        - "our"
        - "their"
        - "this"
        - "that"
        - "these"
        - "those"
        - "who"
        - "whom"
        - "which"
        - "what"
        - "whose"
        # ä»‹è¯
        - "in"
        - "on"
        - "at"
        - "to"
        - "for"
        - "of"
        - "with"
        - "by"
        - "from"
        - "up"
        - "down"
        - "into"
        - "onto"
        - "out"
        - "off"
        - "over"
        - "under"
        - "about"
        - "between"
        - "through"
        # è¿è¯
        - "and"
        - "or"
        - "but"
        - "if"
        - "then"
        - "else"
        - "when"
        - "while"
        - "because"
        - "although"
        - "however"
        - "therefore"
        - "so"
        - "yet"
        - "nor"
        # åŠ©åŠ¨è¯
        - "do"
        - "does"
        - "did"
        - "have"
        - "has"
        - "had"
        - "will"
        - "would"
        - "shall"
        - "should"
        - "can"
        - "could"
        - "may"
        - "might"
        - "must"
        # ç–‘é—®è¯
        - "how"
        - "why"
        - "where"
        # å…¶ä»–å¸¸è§è¯
        - "not"
        - "no"
        - "yes"
        - "all"
        - "any"
        - "some"
        - "each"
        - "every"
        - "both"
        - "few"
        - "more"
        - "most"
        - "other"
        - "such"
        - "only"
        - "same"
        - "than"
        - "too"
        - "very"
        - "just"
        - "also"

    # ============================================================
    # æŸ¥è¯¢æ‰©å±•é…ç½®ï¼ˆä¸­æœŸä¼˜åŒ–ï¼‰
    #
    # ğŸ“ˆ ä¼˜åŒ–è¯´æ˜ï¼ˆ2025-12-05ï¼‰ï¼š
    # æŸ¥è¯¢æ‰©å±•é€šè¿‡åŒä¹‰è¯å’Œæ”¹å†™æå‡å¬å›ç‡ï¼Œå¯å‡å°‘ 2-3 æ¬¡åé¦ˆ
    # è¯¦è§: md/20251205140000-RAGç³»ç»Ÿæ”¶æ•›æ€§åˆ†æ.md
    # ============================================================
    query-expansion:
      # æ˜¯å¦å¯ç”¨æŸ¥è¯¢æ‰©å±•
      enabled: true
      # æ˜¯å¦ä½¿ç”¨ LLM æ”¹å†™ï¼ˆä¼šå¢åŠ å»¶è¿Ÿï¼Œä½†æ•ˆæœæ›´å¥½ï¼‰
      use-llm-rewrite: false
      # æ˜¯å¦å¯ç”¨åŒä¹‰è¯æ‰©å±•
      use-synonym: true
      # è‡ªå®šä¹‰åŒä¹‰è¯æ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰
      synonym-file: ./data/synonyms.txt

    # ============================================================
    # PPL æœåŠ¡é…ç½®ï¼ˆPerplexity-based Chunking & Rerankingï¼‰
    # ============================================================
    ppl:
      # PPL åŠŸèƒ½æ€»å¼€å…³ï¼ˆæš‚æ—¶ç¦ç”¨ä»¥é¿å… ONNX DLL åˆå§‹åŒ–é—®é¢˜ï¼‰
      enabled: true

      # é»˜è®¤æä¾›å•†ï¼šollama, onnx, openai
      # æ¨èä½¿ç”¨ ollamaï¼ˆç®€å•ã€ç¨³å®šã€å¼€ç®±å³ç”¨ï¼‰
      default-provider: onnx

      # å¯ç”¨é™çº§ç­–ç•¥ï¼ˆå½“å‰æä¾›å•†å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢ï¼‰
      enable-fallback: true

      # é™çº§é¡ºåºï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
      fallback-order:
        - onnx      # æ¬¡é€‰ï¼šæœ¬åœ° ONNXï¼ˆéœ€è¦æ¨¡å‹æ–‡ä»¶ï¼‰
        - ollama    # ä¼˜å…ˆï¼šæœ¬åœ° Ollamaï¼ˆæœ€ç®€å•ã€æœ€ç¨³å®šï¼‰âœ…
        - openai    # å¤‡ç”¨ï¼šäº‘ç«¯ APIï¼ˆéœ€è¦ API Keyï¼‰

      # ============================================================
      # ONNX é…ç½®ï¼ˆä½¿ç”¨å›½äº§ Qwen æ¨¡å‹ï¼‰
      # æ³¨æ„ï¼šéœ€è¦å…ˆä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œå»ºè®®ä½¿ç”¨ Ollama æ›¿ä»£
      # ============================================================
      onnx:
        enabled: true  # é»˜è®¤ç¦ç”¨ï¼Œæ¨èä½¿ç”¨ Ollama

        # æ¨¡å‹è·¯å¾„ï¼ˆä½¿ç”¨é˜¿é‡Œ Qwen æ¨¡å‹ï¼‰
        # é€‰é¡¹1ï¼šQwen2.5-0.5Bï¼ˆè½»é‡çº§ï¼Œæ¨èç”¨äº PPLï¼‰
        model-path: ./models/qwen2.5-0.5b-instruct/model.onnx
        tokenizer-path: ./models/qwen2.5-0.5b-instruct/tokenizer.json

        # é€‰é¡¹2ï¼šQwen2.5-1.5Bï¼ˆå¹³è¡¡æ€§èƒ½ï¼‰
        # model-path: ./models/qwen2.5-1.5b-instruct/model.onnx
        # tokenizer-path: ./models/qwen2.5-1.5b-instruct/tokenizer.json

        # é€‰é¡¹3ï¼šQwen2-7Bï¼ˆé«˜è´¨é‡ï¼Œéœ€è¦æ›´å¤šèµ„æºï¼‰
        # model-path: ./models/qwen2-7b-instruct/model.onnx
        # tokenizer-path: ./models/qwen2-7b-instruct/tokenizer.json

        # æ‰¹å¤„ç†é…ç½®
        max-batch-size: 8

        # ç¼“å­˜é…ç½®ï¼ˆæå‡æ€§èƒ½ï¼‰
        use-cache: true
        cache-size: 10000      # æœ€å¤šç¼“å­˜ 10000 ä¸ªç»“æœ
        cache-ttl: 3600        # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰

      # ============================================================
      # Ollama é…ç½®ï¼ˆæœ¬åœ°å¤§æ¨¡å‹ï¼Œä½¿ç”¨å›½äº§ Qwenï¼‰æ¨èæ–¹æ¡ˆ âœ…
      # ä½¿ç”¨æ­¥éª¤ï¼š
      # 1. å®‰è£… Ollamaï¼šhttps://ollama.com/download/windows
      # 2. ä¸‹è½½æ¨¡å‹ï¼šollama pull qwen2.5:0.5b
      # 3. å¯åŠ¨åº”ç”¨å³å¯ä½¿ç”¨ï¼
      # ============================================================
      ollama:
        enabled: true          # é»˜è®¤å¯ç”¨ï¼ˆæ¨èï¼‰

        # Ollama æœåŠ¡åœ°å€
        base-url: http://localhost:11434

        # ä½¿ç”¨ Qwen æ¨¡å‹ï¼ˆé˜¿é‡Œé€šä¹‰åƒé—®ï¼‰
        # é€‰é¡¹1ï¼šQwen2.5-0.5Bï¼ˆè½»é‡çº§ï¼Œæ¨èç”¨äº PPLï¼‰
        model: qwen2.5:0.5b

        # é€‰é¡¹2ï¼šQwen2.5-1.5Bï¼ˆå¹³è¡¡æ€§èƒ½ï¼‰
        # model: qwen2.5:1.5b

        # é€‰é¡¹3ï¼šQwen2.5-7Bï¼ˆé«˜è´¨é‡ï¼‰
        # model: qwen2.5:7b

        # ç½‘ç»œé…ç½®
        timeout: 30000         # è¯·æ±‚è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
        max-retries: 3         # æœ€å¤§é‡è¯•æ¬¡æ•°
        connection-pool-size: 10

      # ============================================================
      # OpenAI é…ç½®ï¼ˆäº‘ç«¯ APIï¼Œå…¼å®¹é€šä¹‰åƒé—®ï¼‰
      # ============================================================
      openai:
        enabled: false         # é»˜è®¤ç¦ç”¨
        # API é…ç½®
        api-key: ${QW_API_KEY:}  # é€šä¹‰åƒé—® API Key
        # ä½¿ç”¨é˜¿é‡Œé€šä¹‰åƒé—®æ¨¡å‹
        # qwen-turboï¼šå¿«é€Ÿã€ç»æµï¼ˆæ¨èç”¨äº PPLï¼‰
        # qwen-plusï¼šå¹³è¡¡æ€§èƒ½
        # qwen-maxï¼šæœ€é«˜è´¨é‡
        model: qwen-turbo
        # é€šä¹‰åƒé—® API ç«¯ç‚¹
        api-url: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
        timeout: 60000
        use-logprobs: false    # é€šä¹‰åƒé—®æš‚ä¸æ”¯æŒ logprobs

      # ============================================================
      # ============================================================
      # Chunking é…ç½®ï¼ˆæ™ºèƒ½æ–‡æ¡£åˆ†å—ï¼‰
      # ============================================================
      chunking:
        # åˆ†å—ç­–ç•¥é€‰æ‹©
        # - ppl: åŸºäºå›°æƒ‘åº¦çš„æœ¬åœ°åˆ†å—ï¼ˆå¿«é€Ÿã€å…è´¹ã€ç¦»çº¿å¯ç”¨ï¼‰
        # - llm: åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½åˆ†å—ï¼ˆè´¨é‡é«˜ã€ç†è§£åŠ›å¼ºã€éœ€è¦ API è°ƒç”¨ï¼‰
        # - auto: è‡ªåŠ¨é€‰æ‹©ï¼ˆä¼˜å…ˆ LLMï¼Œé™çº§åˆ° PPLï¼‰
        strategy: ppl

        # LLM åˆ†å—é…ç½®ï¼ˆå½“ strategy=llm æ—¶ç”Ÿæ•ˆï¼‰
        llm-chunking:
          # æ˜¯å¦å¯ç”¨ LLM åˆ†å—
          enabled: false
          # ä½¿ç”¨ä¸» LLM å®¢æˆ·ç«¯è¿˜æ˜¯ç‹¬ç«‹é…ç½®
          use-main-llm: true
          # å¦‚æœä¸ä½¿ç”¨ä¸» LLMï¼Œå¯ä»¥å•ç‹¬é…ç½®
          api-key: ${CHUNKING_API_KEY:${AI_API_KEY:}}
          api-url: https://api.deepseek.com/v1/chat/completions
          model: deepseek-chat

          # LLM åˆ†å—æç¤ºè¯æ¨¡æ¿ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
          prompt-template: |
            ä½ æ˜¯ä¸€ä¸ªæ–‡æ¡£åˆ†å—ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹æ–‡æ¡£æ™ºèƒ½åœ°åˆ†å‰²æˆå¤šä¸ªè¯­ä¹‰å®Œæ•´çš„å—ã€‚
            
            # åˆ†å—è¦æ±‚
            1. æ¯ä¸ªå—åº”è¯¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯­ä¹‰å•å…ƒï¼ˆå¦‚ï¼šä¸€ä¸ªç« èŠ‚ã€ä¸€ä¸ªä¸»é¢˜ã€ä¸€ä¸ªå®Œæ•´çš„è®ºè¿°ï¼‰
            2. åœ¨è‡ªç„¶çš„è¾¹ç•Œå¤„åˆ‡åˆ†ï¼ˆç« èŠ‚æ ‡é¢˜ã€æ®µè½åˆ†éš”ã€ä¸»é¢˜è½¬æ¢ï¼‰
            3. æ¯ä¸ªå—å¤§å°æ§åˆ¶åœ¨ {minSize}-{maxSize} å­—ç¬¦ä¹‹é—´
            4. ä¿æŒå›¾ç‰‡æ ‡è®°ï¼ˆ[å›¾ç‰‡-xxxï¼š...]ï¼‰ä¸ç›¸å…³æ–‡æœ¬åœ¨åŒä¸€å—ä¸­
            5. ä¸è¦ç ´ååˆ—è¡¨ã€è¡¨æ ¼ã€ä»£ç å—ç­‰ç»“æ„
            
            # è¾“å‡ºæ ¼å¼
            è¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼æ ‡è®°åˆ‡åˆ†ç‚¹ï¼š
            
            [CHUNK_SPLIT]
            
            åœ¨éœ€è¦åˆ‡åˆ†çš„ä½ç½®æ’å…¥ [CHUNK_SPLIT] æ ‡è®°ã€‚ä¸è¦ä¿®æ”¹åŸæ–‡å†…å®¹ï¼Œåªæ·»åŠ æ ‡è®°ã€‚
            
            # æ–‡æ¡£å†…å®¹
            {content}
            
            # è¯·åœ¨åˆé€‚çš„ä½ç½®æ’å…¥ [CHUNK_SPLIT] æ ‡è®°ï¼š

        # PPL é˜ˆå€¼ï¼ˆå›°æƒ‘åº¦å˜åŒ–è¶…è¿‡æ­¤å€¼æ—¶åˆ‡åˆ†ï¼‰
        # å»ºè®®å€¼ï¼š15.0-25.0
        # - 15.0ï¼šåˆ‡åˆ†æ›´ç»†ï¼ˆå—æ›´å°ï¼Œæ›´ç²¾ç¡®ï¼‰
        # - 20.0ï¼šå¹³è¡¡ï¼ˆæ¨èï¼‰
        # - 25.0ï¼šåˆ‡åˆ†æ›´ç²—ï¼ˆå—æ›´å¤§ï¼Œæ›´å®Œæ•´ï¼‰
        ppl-threshold: 20.0

        # å—å¤§å°è®¾ä¸ºè½¯é™åˆ¶ + ç¡¬é™åˆ¶
        target-chunk-size: 1500   # ç›®æ ‡å¤§å°ï¼ˆè½¯é™åˆ¶ï¼Œåˆ°è¾¾åå¯»æ‰¾è¯­ä¹‰è¾¹ç•Œï¼‰
        max-chunk-size: 2500      # ç¡¬æ€§ä¸Šé™ï¼ˆè¶…è¿‡å¼ºåˆ¶åˆ‡åˆ†ï¼‰
        min-chunk-size: 300       # æœ€å°å—å¤§å°ï¼ˆé¿å…è¿‡ç¢ï¼‰

        # ä¸Šä¸‹æ–‡é‡å ï¼ˆä¿æŒè¯­ä¹‰è¿è´¯ï¼‰
        overlap-size: 150         # é‡å å­—ç¬¦æ•°
        overlap-sentences: 2      # é‡å å¥å­æ•°ï¼ˆæ¨è 2-3ï¼‰

        # å¯ç”¨ä¸¤é˜¶æ®µåˆ‡åˆ†ï¼ˆæ¨èï¼‰
        # trueï¼šå…ˆç²—åˆ†å†ç²¾åˆ†ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
        # falseï¼šç›´æ¥ PPL åˆ‡åˆ†
        enable-coarse-chunking: true

        # è¯­ä¹‰æ„ŸçŸ¥åˆ†å—ï¼ˆæ¨èå¯ç”¨ï¼‰
        semantic-aware: true           # åœ¨è¯­ä¹‰è¾¹ç•Œåˆ‡åˆ†
        detect-paragraph: true         # æ£€æµ‹æ®µè½è¾¹ç•Œ
        detect-chapter: true           # æ£€æµ‹ç« èŠ‚æ ‡é¢˜
        detect-list-end: true          # æ£€æµ‹åˆ—è¡¨ç»“æŸ

        # åŠ¨æ€ PPL é˜ˆå€¼ï¼ˆæ ¹æ®æ–‡æ¡£ç‰¹æ€§è‡ªé€‚åº”ï¼‰
        use-dynamic-threshold: false   # é«˜çº§åŠŸèƒ½ï¼ŒæŒ‰éœ€å¯ç”¨

      # ============================================================
      # Reranking é…ç½®ï¼ˆåŸºäº PPL çš„é‡æ’åºï¼‰
      #
      # ğŸ“ˆ ä¼˜åŒ–è¯´æ˜ï¼ˆ2025-12-05ï¼‰ï¼š
      # å¯ç”¨ PPL Rerank å¯å‡å°‘ 20-30% çš„åé¦ˆéœ€æ±‚
      # è¯¦è§: md/20251205140000-RAGç³»ç»Ÿæ”¶æ•›æ€§åˆ†æ.md
      # ============================================================
      reranking:
        # æ˜¯å¦å¯ç”¨ PPL Rerank
        # âœ… ä¼˜åŒ–åå¯ç”¨ï¼Œæå‡è¯­ä¹‰åŒ¹é…å‡†ç¡®æ€§
        enabled: true
        # PPL åˆ†æ•°æƒé‡ï¼ˆ0.0-1.0ï¼‰
        # æœ€ç»ˆåˆ†æ•° = (1-weight) * åŸå§‹åˆ†æ•° + weight * PPLåˆ†æ•°
        # å»ºè®®å€¼ï¼š0.20-0.30ï¼ˆä¼˜åŒ–åä»0.15æå‡åˆ°0.25ï¼‰
        weight: 0.25
        # ä»…å¯¹å‰ K ä¸ªæ–‡æ¡£é‡æ’åºï¼ˆæ§åˆ¶æˆæœ¬ï¼‰
        # å»ºè®®å€¼ï¼š8-10ï¼ˆä¼˜åŒ–åä»5æå‡åˆ°8ï¼‰
        top-k: 8
        # å¼‚æ­¥å¤„ç†ï¼ˆä¸é˜»å¡ä¸»æµç¨‹ï¼‰
        async: true
        # è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        timeout: 5000
        # æ–‡æ¡£å†…å®¹æˆªæ–­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
        content-truncate-length: 500
    # å‘é‡æ£€ç´¢é…ç½®
    vector-search:
      # æ˜¯å¦å¯ç”¨å‘é‡æ£€ç´¢
      # true: ä½¿ç”¨è¯­ä¹‰å‘é‡æ£€ç´¢ï¼ˆéœ€è¦æ¨¡å‹æ–‡ä»¶ï¼‰
      # false: ä½¿ç”¨çº¯å…³é”®è¯æ£€ç´¢
      # å½“å‰ç¦ç”¨ï¼šå› ä¸º bge-base-zh æ¨¡å‹æ–‡ä»¶æŸåï¼ˆç¼ºå°‘ model.onnx_dataï¼‰
      enabled: true

      # æ¨¡å‹é…ç½®ï¼ˆå·²æ›´æ–°ä¸ºå›½äº§æ¨¡å‹ï¼‰
      model:
        # æ¨¡å‹åç§°ï¼ˆç”¨äºæ—¥å¿—æ˜¾ç¤ºï¼‰
        # æ¨èä½¿ç”¨å›½äº§ BGE ç³»åˆ—ï¼Œä¸ Qwen é…å¥—æ•ˆæœæ›´å¥½
        name: bge-base-zh

        # æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äº resourcesï¼‰
        # BGE-Base-ZH: æ™ºæºç ”ç©¶é™¢å¼€å‘ï¼Œä¸­æ–‡æ•ˆæœä¼˜ç§€ï¼Œå…¼å®¹æ€§å¥½
        # æ³¨æ„ï¼šbge-m3 æ¨¡å‹ IR ç‰ˆæœ¬è¿‡é«˜ï¼Œä½¿ç”¨ bge-base-zh æ›¿ä»£
        path: ./models/bge-base-zh/model.onnx

        # æ¨¡å‹æœç´¢è·¯å¾„ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå·²è°ƒæ•´ä¸ºå›½äº§ä¼˜å…ˆï¼‰
        # ç³»ç»Ÿä¼šæŒ‰é¡ºåºåœ¨è¿™äº›ç›®å½•ä¸­æŸ¥æ‰¾æ¨¡å‹æ–‡ä»¶
        search-paths:
          - bge-base-zh                 # BGE-Base-ZH (æ¨è, æ™ºæº, å…¼å®¹æ€§å¥½) âœ…
          - bge-large-zh                # BGE Large ZH (æ™ºæº, ä¸­æ–‡ä¼˜åŒ–)
          - bge-base-zh-v1.5            # BGE Base ZH v1.5 (æ™ºæº, è½»é‡çº§)
          - bge-m3                      # BGE-M3 (æ™ºæº, 2024æœ€æ–°, éœ€è¦æ›´æ–°çš„ ONNX Runtime)
          - text2vec-base-chinese       # Text2Vec (é˜¿é‡Œ, ç»å…¸)
#          - paraphrase-multilingual     # Paraphrase Multilingual (å¤‡ç”¨)
#          - multilingual-e5-large       # Multilingual E5 Large (å¤‡ç”¨)

        # æ¨¡å‹æ–‡ä»¶åï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        file-names:
          - model.onnx                  # æ ‡å‡†æ¨¡å‹
          - model_O2.onnx               # ä¼˜åŒ–æ¨¡å‹
          - model_quantized.onnx        # é‡åŒ–æ¨¡å‹
          - model_quint8_avx2.onnx      # AVX2 é‡åŒ–

      # å‘é‡ç´¢å¼•å­˜å‚¨è·¯å¾„
      index-path: ./data/vector-index

      # æ£€ç´¢ç›¸ä¼¼åº¦é˜ˆå€¼ (0.0-1.0)
      # è¶Šé«˜è¶Šä¸¥æ ¼ï¼Œå»ºè®® 0.3-0.5
      # åªæœ‰ç›¸ä¼¼åº¦é«˜äºæ­¤é˜ˆå€¼çš„æ–‡æ¡£æ‰ä¼šè¢«è¿”å›
      similarity-threshold: 0.5

      # === æ··åˆæ£€ç´¢é…ç½®ï¼ˆLucene + å‘é‡ï¼‰ ===
      #
      # ğŸ“ˆ ä¼˜åŒ–è¯´æ˜ï¼ˆ2025-12-05ï¼‰ï¼š
      # æ ¹æ® RAG æ”¶æ•›æ€§åˆ†æï¼Œå¢åŠ æ£€ç´¢èŒƒå›´å¯å‡å°‘ 1-2 æ¬¡åé¦ˆäº¤äº’
      # è¯¦è§: md/20251205140000-RAGç³»ç»Ÿæ”¶æ•›æ€§åˆ†æ.md

      # Lucene æ£€ç´¢è¿”å›çš„å€™é€‰æ–‡æ¡£æ•°
      # ç”¨äºç¬¬ä¸€æ­¥ç²—ç­›ï¼Œé€šå¸¸è®¾ç½®ä¸º hybrid-top-k çš„ 3-5 å€
      # å»ºè®®å€¼ï¼š50-100ï¼ˆä¼˜åŒ–åä»40æå‡åˆ°100ï¼‰
      lucene-top-k: 100

      # å‘é‡æ£€ç´¢è¿”å›çš„å€™é€‰æ–‡æ¡£æ•°
      # ç”¨äºè¯­ä¹‰ç²¾æ’ï¼Œé€šå¸¸è®¾ç½®ä¸º hybrid-top-k çš„ 2-3 å€
      # å»ºè®®å€¼ï¼š30-50ï¼ˆä¼˜åŒ–åä»40æå‡åˆ°50ï¼‰
      vector-top-k: 50

      # æ··åˆæ£€ç´¢æœ€ç»ˆè¿”å›çš„æ–‡æ¡£æ•°ï¼ˆå»é‡åï¼‰
      # è¿™äº›æ–‡æ¡£ä¼šæŒ‰è¯„åˆ†æ’åºï¼Œç”¨äºåç»­çš„åˆ†æ‰¹å¼•ç”¨
      # å»ºè®®å€¼ï¼š15-30ï¼ˆä¼˜åŒ–åä»20æå‡åˆ°30ï¼‰
      hybrid-top-k: 30

      # æ¯æ¬¡é—®ç­”å¼•ç”¨çš„æ–‡æ¡£æ•°
      # ç”¨æˆ·å¯ä»¥é€šè¿‡ next æ¥å£è·å–å‰©ä½™æ–‡æ¡£ç»§ç»­é—®ç­”
      # å»ºè®®å€¼ï¼š5-8ï¼ˆä¿æŒ5ï¼Œç¡®ä¿è´¨é‡ï¼‰
      documents-per-query: 5

      # æ—¥å¿—ä¸­æ˜¾ç¤ºçš„æœ€å¤§æ–‡æ¡£æ•°é‡ï¼ˆè°ƒè¯•ç”¨ï¼‰
      # ç”¨äºæ§åˆ¶ Lucene/å‘é‡æ£€ç´¢ç»“æœçš„æ—¥å¿—è¾“å‡ºæ•°é‡
      log-display-limit: 10

      # æ£€ç´¢è¿”å›çš„æ–‡æ¡£æ•°é‡ä¸Šé™ï¼ˆå·²åºŸå¼ƒï¼‰
      # @deprecated ä½¿ç”¨ hybrid-top-k æ›¿ä»£
      top-k: 20

      # æ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†é˜ˆå€¼ï¼ˆLucene + å‘é‡æ··åˆè¯„åˆ†ï¼‰
      # ä½äºæ­¤åˆ†æ•°çš„æ–‡æ¡£ä¼šè¢«è¿‡æ»¤
      #
      # ğŸ“ˆ ä¼˜åŒ–è¯´æ˜ï¼ˆ2025-12-05ï¼‰ï¼š
      # é™ä½é˜ˆå€¼å¯æé«˜å¬å›ç‡ï¼Œå‡å°‘æ¼å¬å›
      #
      # å»ºè®®å€¼ï¼š
      #   - é«˜ç²¾åº¦ï¼š0.15-0.20
      #   - å¹³è¡¡ï¼š0.10-0.15
      #   - é«˜å¬å›ï¼š0.05-0.08ï¼ˆä¼˜åŒ–åæ¨èï¼‰
      min-score-threshold: 0.06

      # === æ··åˆæ£€ç´¢æƒé‡é…ç½®ï¼ˆ2025-12-07ï¼‰===
      #
      # æ··åˆè¯„åˆ†å…¬å¼ï¼šfinalScore = luceneWeight Ã— luceneScore + vectorWeight Ã— vectorScore
      #
      # è¯´æ˜ï¼š
      #   - luceneWeight: å…³é”®è¯æ£€ç´¢æƒé‡ï¼Œé€‚åˆç²¾ç¡®åŒ¹é…
      #   - vectorWeight: å‘é‡æ£€ç´¢æƒé‡ï¼Œé€‚åˆè¯­ä¹‰ç†è§£
      #   - ä¸¤ä¸ªæƒé‡ä¹‹å’Œä¸å¿…ç­‰äº 1.0ï¼Œä½†å»ºè®®ä¿æŒçº¦ 1.0
      #
      # æ¨èé…ç½®ï¼š
      #   - é€šç”¨åœºæ™¯ï¼šlucene=0.3, vector=0.7ï¼ˆé»˜è®¤ï¼Œè¯­ä¹‰ä¼˜å…ˆï¼‰
      #   - æŠ€æœ¯æ–‡æ¡£ï¼šlucene=0.4, vector=0.6ï¼ˆå…³é”®è¯æ›´é‡è¦ï¼‰
      #   - è‡ªç„¶è¯­è¨€ï¼šlucene=0.2, vector=0.8ï¼ˆè¯­ä¹‰æ›´é‡è¦ï¼‰

      # Lucene å…³é”®è¯æ£€ç´¢æƒé‡ï¼ˆ0.0-1.0ï¼‰
      lucene-weight: 0.3

      # å‘é‡è¯­ä¹‰æ£€ç´¢æƒé‡ï¼ˆ0.0-1.0ï¼‰
      vector-weight: 0.7

    # ============================================================
    # ç›¸ä¼¼é—®é¢˜æ¨èé…ç½®ï¼ˆSimilar QA Recommendationï¼‰
    # ============================================================
    similar-qa:
      # å†å²è®°å½•æŸ¥è¯¢æ•°é‡ä¸Šé™
      # ç³»ç»Ÿä¼šæŸ¥è¯¢æœ€è¿‘ N æ¡é«˜è¯„åˆ†é—®ç­”è®°å½•ç”¨äºç›¸ä¼¼åº¦åŒ¹é…
      history-limit: 100

      # æœ€ä½è¯„åˆ†é˜ˆå€¼ï¼ˆ1-5ï¼‰
      # åªæœ‰è¯„åˆ† >= æ­¤å€¼çš„é—®ç­”è®°å½•æ‰ä¼šè¢«ç”¨äºæ¨è
      min-rating: 4

      # æœ€å°ç›¸ä¼¼åº¦åˆ†æ•°ï¼ˆ0-100ï¼‰
      # ç›¸ä¼¼åº¦ä½äºæ­¤å€¼çš„é—®é¢˜ä¸ä¼šè¢«æ¨è
      min-score: 30

      # æ¨èç»“æœæ•°é‡ä¸Šé™
      limit: 3

    # ============================================================
    # ä¼šè¯ç®¡ç†é…ç½®ï¼ˆSession Managementï¼‰
    # ============================================================
    session:
      # ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
      # è¶…è¿‡æ­¤æ—¶é—´æœªè®¿é—®çš„ä¼šè¯å°†è¢«è‡ªåŠ¨æ¸…ç†
      timeout-minutes: 30

      # æœ€å¤§ä¼šè¯æ•°é‡
      max-sessions: 1000

    # LLM é…ç½®
    llm:
      # LLM æä¾›å•†
      # å¯é€‰å€¼:
      #   - openai: OpenAI å…¼å®¹ APIï¼ˆé»˜è®¤ï¼Œæ”¯æŒ OpenAIã€DeepSeek ç­‰æ‰€æœ‰å…¼å®¹æœåŠ¡ï¼‰
      #   - mock: Mock æ¨¡å¼ï¼ˆæµ‹è¯•ç”¨ï¼Œè¿”å›å›ºå®šå›ç­”ï¼‰
      #
      # è¯´æ˜: OpenAI å®¢æˆ·ç«¯æ”¯æŒæ‰€æœ‰ OpenAI API å…¼å®¹çš„æœåŠ¡
      #       é€šè¿‡é…ç½®ä¸åŒçš„ api-url å’Œ model å³å¯åˆ‡æ¢ä¸åŒçš„æœåŠ¡
      provider: openai

      # API Keyï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
      # DeepSeek: export AI_API_KEY=your-deepseek-key
      # OpenAI: export OPENAI_API_KEY=your-openai-key
      # Qianwen: export QW_API_KEY=your-qianwen-key
      api-key: ${AI_API_KEY:}

      # API ç«¯ç‚¹
      # DeepSeek: https://api.deepseek.com/v1/chat/completions
      # OpenAI: https://api.openai.com/v1/chat/completions
      # Qianwen VL: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completionsï¼ˆé»˜è®¤é…ç½®ï¼‰
      # å…¶ä»–å…¼å®¹æœåŠ¡: é…ç½®ç›¸åº”çš„ API ç«¯ç‚¹
      api-url: https://api.deepseek.com/v1/chat/completions

      # æ¨¡å‹åç§°
      # DeepSeek: deepseek-chatï¼ˆä¸æ”¯æŒå›¾ç‰‡ï¼‰
      # OpenAI: gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-4, gpt-3.5-turbo
      # Qianwen VL: qwen-vl-plus, qwen-vl-maxï¼ˆæ”¯æŒå›¾ç‰‡ï¼Œé»˜è®¤é…ç½®ï¼‰
      model: deepseek-chat

      # æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # å»ºè®®å€¼ï¼š
      #   - DeepSeek: 32000 (32K tokensï¼Œçº¦24Kæ±‰å­—)
      #   - GPT-4o: 100000 (128K tokens)
      #   - Claude-3: 200000 (200K tokens)
      max-context-length: 20000

      # å•æ–‡æ¡£æœ€å¤§é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # å»ºè®®å€¼ï¼šmax-context-length çš„ 1/4 åˆ° 1/2
      max-doc-length: 5000

      # å•æ¬¡é—®ç­”æœ€å¤§å¤„ç†æ–‡æ¡£æ•°
      # ç”¨äºé˜²æ­¢å†…å­˜æº¢å‡ºå’Œæ§åˆ¶å“åº”æ—¶é—´
      # å¦‚æœæ£€ç´¢åˆ°çš„æ–‡æ¡£è¶…è¿‡æ­¤æ•°é‡ï¼Œä¼šåˆ†æ‰¹å¤„ç†
      # å»ºè®®å€¼ï¼š5-15
      max-documents-per-query: 5

      # æ˜¯å¦å¯ç”¨åˆ†æ‰¹å¤„ç†æ¨¡å¼
      # å¯ç”¨åï¼Œå¦‚æœæ–‡æ¡£æ•°è¶…è¿‡ max-documents-per-queryï¼Œ
      # ä¼šåœ¨ç­”æ¡ˆä¸­æç¤ºç”¨æˆ·è¿˜æœ‰æœªå¤„ç†çš„æ–‡æ¡£ï¼Œæ”¯æŒç»§ç»­æé—®
      enable-batch-processing: true

      # æ–‡æ¡£åˆ‡åˆ†ç­–ç•¥
      # å¯é€‰å€¼ï¼š
      #   - SIMPLE: ç®€å•åˆ‡åˆ†ï¼ŒæŒ‰å›ºå®šé•¿åº¦åˆ‡åˆ†ï¼ˆæ€§èƒ½æœ€å¥½ï¼Œæˆæœ¬æœ€ä½ï¼‰
      #   - SMART_KEYWORD: æ™ºèƒ½å…³é”®è¯åˆ‡åˆ†ï¼Œä¼˜å…ˆä¿ç•™åŒ…å«å…³é”®è¯çš„å†…å®¹ï¼ˆæ¨èï¼Œå¹³è¡¡æ•ˆæœå’Œæˆæœ¬ï¼‰
      #   - AI_SEMANTIC: AIè¯­ä¹‰åˆ‡åˆ†ï¼Œä½¿ç”¨AIæ¨¡å‹æ™ºèƒ½åˆ‡åˆ†ï¼ˆæ•ˆæœæœ€å¥½ï¼Œæˆæœ¬æœ€é«˜ï¼‰
      #   - NONE: ä¸åˆ‡åˆ†ï¼Œç›´æ¥æˆªæ–­ï¼ˆä¸æ¨èï¼‰
      chunking-strategy: SMART_KEYWORD

      # æ–‡æ¡£åˆ‡åˆ†é…ç½®
      chunking:
        # åˆ‡åˆ†å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
        # å»ºè®®è®¾ç½®ä¸º max-doc-length çš„ 80%ï¼Œç•™å‡ºé‡å ç©ºé—´
        chunk-size: 4000

        # åˆ‡åˆ†é‡å å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
        # ç”¨äºä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§ï¼Œå»ºè®® 10-20% çš„ chunk-size
        chunk-overlap: 400

        # æ˜¯å¦åœ¨å¥å­è¾¹ç•Œåˆ‡åˆ†ï¼ˆå¼ºçƒˆæ¨èï¼‰
        split-on-sentence: true

        # AI è¯­ä¹‰åˆ‡åˆ†é…ç½®ï¼ˆä»…å½“ chunking-strategy=AI_SEMANTIC æ—¶ç”Ÿæ•ˆï¼‰
        ai-chunking:
          # æ˜¯å¦å¯ç”¨
          enabled: false

          # ç”¨äºè¯­ä¹‰åˆ‡åˆ†çš„æ¨¡å‹
          # å»ºè®®ä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼ˆå¦‚ gpt-4o-mini æˆ– deepseek-chatï¼‰
          model: deepseek-chat

          # è¯­ä¹‰åˆ‡åˆ†çš„ Prompt æ¨¡æ¿
          prompt: |
            è¯·å°†ä»¥ä¸‹æ–‡æ¡£æ™ºèƒ½åˆ‡åˆ†æˆå¤šä¸ªè¯­ä¹‰å®Œæ•´çš„æ®µè½ã€‚
            
            è¦æ±‚ï¼š
            1. æ¯ä¸ªæ®µè½åº”è¯¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸»é¢˜æˆ–æ¦‚å¿µ
            2. ä¿æŒæ®µè½ä¹‹é—´çš„é€»è¾‘è¿è´¯æ€§
            3. æ¯ä¸ªæ®µè½å¤§å°åœ¨ {chunk_size} å­—ç¬¦å·¦å³
            4. è¿”å› JSON æ ¼å¼ï¼š[{"content": "æ®µè½1å†…å®¹", "title": "æ®µè½1æ ‡é¢˜"}, ...]
            
            æ–‡æ¡£å†…å®¹ï¼š
            {content}

      # Prompt æç¤ºè¯æ¨¡æ¿
      # æ”¯æŒä¸¤ä¸ªå ä½ç¬¦ï¼š
      #   - {question}: ç”¨æˆ·é—®é¢˜
      #   - {context}: ç›¸å…³æ–‡æ¡£å†…å®¹
      # å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰æç¤ºè¯é£æ ¼å’Œè¦æ±‚
      prompt-template: |
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŸ¥è¯†åŠ©æ‰‹ã€‚è¯·åŸºäºæ–‡æ¡£å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
        
        # å›ç­”è¦æ±‚
        1. å¿…é¡»åŸºäºæ–‡æ¡£å†…å®¹å›ç­”ï¼Œä¸è¦ç¼–é€ ä¿¡æ¯
        2. å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·
        3. å›ç­”è¦æ¸…æ™°ã€å‡†ç¡®ã€æœ‰æ¡ç†
        4. å¯ä»¥å¼•ç”¨æ–‡æ¡£åç§°ä½œä¸ºä¿¡æ¯æ¥æº
        5. ä¿æŒä¸“ä¸šå‹å¥½çš„è¯­æ°”
        6. å¦‚æœæç¤ºè¯ä¸­æœ‰å›¾ç‰‡URLé“¾æ¥åˆ™ä»¥markdownå±•ç¤ºå›¾ç‰‡
        
        # ç”¨æˆ·é—®é¢˜
        {question}
        
        # ç›¸å…³æ–‡æ¡£
        {context}
        
        # è¯·æä¾›ä½ çš„å›ç­”ï¼š

    # æ–‡æ¡£å¤„ç†é…ç½®
    document:
      # æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
      supported-formats:
        - xlsx
        - xls
        - docx
        - doc
        - pptx
        - ppt
        - pdf
        - txt
        - md
        - html
        - xml

      # æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
      max-file-size-mb: 200

      # æœ€å¤§å†…å®¹å¤§å°ï¼ˆMBï¼‰
      # è¶…è¿‡æ­¤å¤§å°ä¼šå¼ºåˆ¶åˆ†å—
      max-content-size-mb: 50

      # è‡ªåŠ¨åˆ†å—é˜ˆå€¼ï¼ˆMBï¼‰
      # å†…å®¹è¶…è¿‡æ­¤å¤§å°ä¼šè‡ªåŠ¨å¯ç”¨åˆ†å—
      auto-chunk-threshold-mb: 2

      # æ–‡æ¡£åˆ†å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-size: 2000

      # æ–‡æ¡£åˆ†å—é‡å ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-overlap: 400

      # å¹¶è¡Œå¤„ç†é…ç½®
      # æ˜¯å¦å¯ç”¨å¹¶è¡Œå¤„ç†ï¼ˆæ–‡æ¡£æ•°é‡ > 5 æ—¶è‡ªåŠ¨å¯ç”¨ï¼Œå¯æ˜¾è‘—æå‡ç´¢å¼•é€Ÿåº¦ï¼‰
      parallel-processing: true

      # å¹¶è¡Œå¤„ç†çº¿ç¨‹æ•°
      # 0 = è‡ªåŠ¨ï¼ˆä½¿ç”¨ CPU æ ¸å¿ƒæ•°ï¼‰
      # å»ºè®®å€¼: CPU æ ¸å¿ƒæ•°æˆ–ç•¥å°‘ï¼ˆå¦‚ 4æ ¸è®¾ç½®ä¸º 3-4ï¼‰
      parallel-threads: 0

      # æ‰¹å¤„ç†å¤§å°ï¼ˆæ–‡æ¡£æ•°ï¼‰
      # æ¯æ‰¹å¤„ç†å¤šå°‘ä¸ªæ–‡æ¡£åæäº¤ä¸€æ¬¡
      # å»ºè®®å€¼: 10-20
      batch-size: 10

      # ============================================================
      # å†…å®¹é•¿åº¦é™åˆ¶é…ç½®ï¼ˆå½±å“å†…å­˜å ç”¨å’Œæ€§èƒ½ï¼‰
      # ============================================================

      # ç´¢å¼•æ—¶å•ä¸ªæ–‡æ¡£æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # è¶…è¿‡æ­¤é•¿åº¦ä¼šè¢«æˆªæ–­ï¼Œé˜²æ­¢åç»­å¤„ç†å†…å­˜æº¢å‡º
      # å»ºè®®å€¼ï¼š
      #   - å†…å­˜å……è¶³ï¼ˆ8GB+ï¼‰: 100000 (çº¦ 200KB)
      #   - å†…å­˜ä¸€èˆ¬ï¼ˆ4GBï¼‰: 50000 (çº¦ 100KBï¼Œé»˜è®¤)
      #   - å†…å­˜æœ‰é™ï¼ˆ2GBï¼‰: 30000 (çº¦ 60KB)
      max-index-content-length: 50000

      # é—®ç­”æ—¶æ–‡æ¡£åˆ‡åˆ†æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # é€šå¸¸è®¾ç½®ä¸º max-index-content-length çš„ 2 å€
      # å› ä¸ºé—®ç­”æ—¶åªå¤„ç†å°‘é‡æ–‡æ¡£ï¼ˆ5-10ä¸ªï¼‰
      max-chunk-content-length: 100000

      # é—®ç­”æ—¶å•æ¬¡åˆ‡åˆ†æœ€å¤§å—æ•°
      # é˜²æ­¢åˆ‡åˆ†äº§ç”Ÿè¿‡å¤šå—å¯¼è‡´å†…å­˜æº¢å‡º
      # å»ºè®®å€¼ï¼š30-100
      max-chunks-per-document: 50
    # ============================================================
    # å›¾ç‰‡å¤„ç†é…ç½®æ‰©å±•ï¼ˆImage Processing Extendedï¼‰
    # ============================================================
    image-processing:
      # æ¯ä¸ªæ–‡æ¡£åœ¨ä¸Šä¸‹æ–‡ä¸­æœ€å¤šæ˜¾ç¤ºçš„å›¾ç‰‡æ•°é‡
      max-images-per-doc: 5
      # å›¾ç‰‡å¤„ç†ç­–ç•¥:
      #   - placeholder: å ä½ç¬¦ï¼ˆé»˜è®¤ï¼Œé›¶ä¾èµ–ï¼‰
      #   - vision-llm: ä½¿ç”¨ç‹¬ç«‹çš„ Vision LLM é…ç½®ï¼ˆä¸‹æ–¹ vision-llm é…ç½®èŠ‚ï¼‰
      #   - llm-client: ä½¿ç”¨ä¸» LLM å®¢æˆ·ç«¯çš„å›¾ç‰‡è¯†åˆ«åŠŸèƒ½ï¼ˆä»…å½“ä¸» LLM æ”¯æŒ Vision æ—¶æœ‰æ•ˆï¼‰
      #
      # ğŸ’¡ é‡è¦è¯´æ˜ï¼š
      #   - llm-client ç­–ç•¥è¦æ±‚ä¸» LLM æ¨¡å‹æ”¯æŒå›¾ç‰‡ï¼ˆå¦‚ gpt-4oã€qwen-vl-plusï¼‰
      #   - å¦‚æœä¸» LLM ä¸æ”¯æŒå›¾ç‰‡ï¼ˆå¦‚ deepseek-chatï¼‰ï¼Œè¯·ä½¿ç”¨ vision-llm ç­–ç•¥
      #   - vision-llm ç­–ç•¥ä½¿ç”¨ç‹¬ç«‹é…ç½®ï¼Œä¸ä¾èµ–ä¸» LLM
      #
      # æ¨èé…ç½®ï¼š
      #   - ä¸» LLM æ”¯æŒå›¾ç‰‡ï¼ˆqwen-vl-plusã€gpt-4oï¼‰â†’ ä½¿ç”¨ llm-client
      #   - ä¸» LLM ä¸æ”¯æŒå›¾ç‰‡ï¼ˆdeepseek-chatï¼‰â†’ ä½¿ç”¨ vision-llm
      strategy: vision-llm

      # å›¾ç‰‡æ–‡æœ¬åŒ–æå–æ¨¡å¼ï¼ˆImage text extraction modeï¼‰
      #   - concise: ç²¾ç®€æ¨¡å¼ï¼Œæå–å…³é”®ä¿¡æ¯ï¼Œé¿å…å†—ä½™ä½†ä¸é—æ¼é‡è¦å†…å®¹ï¼ˆèŠ‚çœ tokenï¼‰
      #   - detailed: è¯¦ç»†æ¨¡å¼ï¼Œå®Œæ•´åˆ†æå›¾ç‰‡å†…å®¹ï¼ˆæ¨èç”¨äºéœ€è¦è¯¦ç»†æè¿°çš„åœºæ™¯ï¼‰
      extraction-mode: concise

      # Vision LLM é…ç½®
      vision-llm:
        # æ˜¯å¦å¯ç”¨ï¼ˆæ··åˆæ¨¡å¼ä¸‹æ¨èå¯ç”¨ï¼‰
        enabled: true

        # API Key
        # æ–¹å¼1ï¼ˆæ¨èï¼‰ï¼šç›´æ¥é…ç½® API Key
        #   api-key: sk-your-actual-api-key
        #
        # æ–¹å¼2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ›´å®‰å…¨ï¼‰
        #   export VISION_LLM_API_KEY=sk-your-api-key
        #   æˆ–ä½¿ç”¨ä¸» LLM çš„ API Key: export AI_API_KEY=sk-your-api-key
        #
        # å½“å‰é…ç½®: ä¼˜å…ˆä½¿ç”¨ VISION_LLM_API_KEYï¼Œå¦‚æœæœªè®¾ç½®åˆ™ä½¿ç”¨ AI_API_KEY
        # æœ¬åœ° Ollama ä¸éœ€è¦ API Key
        api-key: ${QW_API_KEY:}

        # ğŸ’¡ æç¤ºï¼šå¦‚æœè¦ç›´æ¥é…ç½® API Keyï¼Œæ›¿æ¢ä¸Šé¢ä¸€è¡Œä¸º:
        # api-key: sk-your-actual-api-key

        # æ¨¡å‹åç§°
        # OpenAI: gpt-4o, gpt-4-vision-preview
        # Anthropic: claude-3-opus
        # Google: gemini-pro-vision
        # Qwen: qwen-vl-plus
        # Ollamaï¼ˆæœ¬åœ°ï¼‰: qwen3-vl:8b, llava:7b, minicpm-v
        model: qwen-vl-plus

        # API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
        # OpenAI: https://api.openai.com/v1/chat/completions
        # Ollamaï¼ˆæœ¬åœ°ï¼‰: http://localhost:11434/api/chat
        endpoint: ${VISION_LLM_ENDPOINT:https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions}

        # ğŸ’¡ æç¤ºï¼šå¦‚æœè¦ç›´æ¥é…ç½®ç«¯ç‚¹ï¼Œæ›¿æ¢ä¸Šé¢ä¸€è¡Œä¸º:
        # endpoint: http://localhost:11434/api/chat

        # æ‰¹é‡å¤„ç†é…ç½®ï¼ˆé’ˆå¯¹ PPT/æ¼”ç¤ºæ–‡ç¨¿åœºæ™¯ä¼˜åŒ–ï¼‰
        batch:
          # æ˜¯å¦å¯ç”¨æ‰¹é‡å¤„ç†ï¼ˆä¸€æ¬¡å‘é€å¤šå¼ å›¾ç‰‡ï¼‰
          enabled: true

          # æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡
          # å»ºè®®å€¼ï¼š3-5 å¼ ï¼ˆå–å†³äºæ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶å’Œå›¾ç‰‡å¤§å°ï¼‰
          # - GPT-4o: å¯ä»¥å¤„ç† 10+ å¼ 
          # - Qwen-VL: å»ºè®® 3-5 å¼ 
          # - Claude-3: å¯ä»¥å¤„ç† 5-10 å¼ 
          size: 4

          # å›¾ç‰‡å‹ç¼©é…ç½®
          compress:
            # æ˜¯å¦å¯ç”¨å›¾ç‰‡å‹ç¼©ï¼ˆé™ä½è´¨é‡ä»¥å‡å°‘ token æ¶ˆè€—ï¼‰
            enabled: true

            # å‹ç¼©è´¨é‡ï¼ˆ0.1-1.0ï¼‰
            # 1.0 = ä¸å‹ç¼©ï¼Œ0.8 = è½»åº¦å‹ç¼©ï¼ˆæ¨èï¼‰ï¼Œ0.5 = ä¸­åº¦å‹ç¼©
            quality: 0.8

            # å•å¼ å›¾ç‰‡æœ€å¤§å°ºå¯¸ï¼ˆKBï¼‰
            # è¶…è¿‡æ­¤å¤§å°ä¼šè¿›è¡Œå‹ç¼©
            # å»ºè®®å€¼ï¼š200-500 KB
            max-size-kb: 300

            # å›¾ç‰‡æœ€å¤§åˆ†è¾¨ç‡ï¼ˆå®½xé«˜ï¼‰
            # è¶…è¿‡æ­¤åˆ†è¾¨ç‡ä¼šç­‰æ¯”ä¾‹ç¼©å°
            # å»ºè®®å€¼ï¼š1920x1080ï¼ˆ1080pï¼‰æˆ– 1280x720ï¼ˆ720pï¼‰
            max-width: 1920
            max-height: 1080

    # é—®ç­”å½’æ¡£é…ç½®
    qa-archive:
      # æ˜¯å¦å¯ç”¨å½’æ¡£
      enabled: true

      # å½’æ¡£ç­–ç•¥
      # - auto: è‡ªåŠ¨å½’æ¡£æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é—®ç­”
      # - feedback-based: åŸºäºç”¨æˆ·åé¦ˆå½’æ¡£ï¼ˆæ¨èï¼‰
      # - manual: æ‰‹åŠ¨å®¡æ ¸åå½’æ¡£
      strategy: feedback-based

      # æœ€ä½è¯„åˆ†é˜ˆå€¼ï¼ˆfeedback-based æ¨¡å¼ï¼‰
      min-rating: 4

      # é—®é¢˜æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      min-question-length: 5

      # å›ç­”æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      min-answer-length: 20

      # å½’æ¡£è·¯å¾„
      archive-path: ./data/rag

      # æ˜¯å¦è‡ªåŠ¨ç´¢å¼•å½’æ¡£çš„æ–‡æ¡£
      auto-index: true

      # ä¸´æ—¶æ–‡æ¡£è¿‡æœŸå¤©æ•°ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
      temp-document-expiry-days: 30
    # ============================================================
    # LLM ç»“æœæ–‡æ¡£åŒ–é…ç½®
    # å°† LLM åˆ†æç»“æœä¿å­˜ä¸ºæ–‡æ¡£ï¼Œæ”¯æŒä¸‹è½½å’ŒçŸ¥è¯†åº“é›†æˆ
    # ============================================================
    llm-result:
      # ç»“æœæ–‡æ¡£å­˜å‚¨è·¯å¾„
      storage-path: ./data/llm-results
      # æ˜¯å¦è‡ªåŠ¨å°†ç»“æœæ·»åŠ åˆ°çŸ¥è¯†åº“
      # true: æ¯æ¬¡ LLM åˆ†æç»“æœéƒ½ä¼šè‡ªåŠ¨åŠ å…¥çŸ¥è¯†åº“
      # false: ä»…ä¿å­˜æ–‡æ¡£ï¼Œä¸åŠ å…¥çŸ¥è¯†åº“ï¼ˆé»˜è®¤ï¼‰
      auto-add-to-knowledge-base: false
      # æœ€å¤§å†å²è®°å½•æ•°
      # è¶…è¿‡æ­¤æ•°é‡ä¼šè‡ªåŠ¨æ¸…ç†æ—§è®°å½•
      max-history: 100
      # æ˜¯å¦è‡ªåŠ¨ä¿å­˜ LLM ç»“æœ
      # true: è‡ªåŠ¨ä¿å­˜æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ LLM è°ƒç”¨ç»“æœ
      # false: ä»…æ‰‹åŠ¨ä¿å­˜
      auto-save: true
      # æœ€å°å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # ä½äºæ­¤é•¿åº¦çš„ç»“æœä¸ä¼šè¢«è‡ªåŠ¨ä¿å­˜ï¼ˆé¿å…ä¿å­˜æ— æ„ä¹‰å†…å®¹ï¼‰
      min-content-length: 100
    # æ¸è¿›å¼æ–‡æ¡£åˆ†æé…ç½®
    progressive-analysis:
      # æ˜¯å¦å¯ç”¨æ¸è¿›å¼åˆ†æï¼ˆæ¨èç”¨äºå¤§æ–‡æ¡£ï¼‰
      enabled: true

      # è®°å¿†çª—å£å¤§å°ï¼ˆä¿ç•™å¤šå°‘ä¸ªæ‰¹æ¬¡/å¹»ç¯ç‰‡çš„å…³é”®ä¿¡æ¯ï¼‰
      # å»ºè®®å€¼ï¼š3-5
      # - å¤ªå°ï¼šä¸Šä¸‹æ–‡ä¸è¶³ï¼Œå¯èƒ½ä¸¢å¤±é‡è¦å…³è”
      # - å¤ªå¤§ï¼šä¿¡æ¯è¿‡è½½ï¼Œå¯èƒ½å¹²æ‰°ç†è§£
      memory-window-size: 3

      # å…³é”®ç‚¹æå–ç­–ç•¥
      # - structured: ç»“æ„åŒ–æå–ï¼ˆä½¿ç”¨æ ‡è®°ï¼‰
      # - smart: æ™ºèƒ½æå–ï¼ˆAIè‡ªåŠ¨è¯†åˆ«ï¼‰
      key-point-extraction: structured

      # æ˜¯å¦ç”Ÿæˆä¸­é—´æ€»ç»“
      # true: æ¯Nä¸ªæ‰¹æ¬¡ç”Ÿæˆä¸€æ¬¡ä¸­é—´æ€»ç»“
      # false: åªåœ¨æœ€åç”Ÿæˆæ€»ç»“
      generate-intermediate-summary: false

      # ä¸­é—´æ€»ç»“é—´éš”ï¼ˆæ‰¹æ¬¡æ•°ï¼‰
      intermediate-summary-interval: 5

  # åé¦ˆç³»ç»Ÿé…ç½®
  feedback:
    # æ˜¯å¦éœ€è¦å®¡æ ¸æ‰èƒ½ç”Ÿæ•ˆï¼ˆé»˜è®¤ false - ç›´æ¥ç”Ÿæ•ˆï¼‰
    require-approval: false

    # æ˜¯å¦è‡ªåŠ¨åº”ç”¨åé¦ˆåˆ°æ£€ç´¢ä¼˜åŒ–ï¼ˆé»˜è®¤ trueï¼‰
    auto-apply: true

    # ç‚¹èµæƒé‡å¢é‡ï¼ˆé»˜è®¤ 0.1ï¼‰
    like-weight-increment: 0.1

    # è¸©çš„æƒé‡å‡é‡ï¼ˆé»˜è®¤ -0.15ï¼‰
    dislike-weight-decrement: -0.15

    # æœ€å°æƒé‡é™åˆ¶ï¼ˆé»˜è®¤ 0.1ï¼‰
    min-weight: 0.1

    # æœ€å¤§æƒé‡é™åˆ¶ï¼ˆé»˜è®¤ 2.0ï¼‰
    max-weight: 2.0

    # æ˜¯å¦å¯ç”¨åŠ¨æ€æƒé‡è°ƒæ•´ï¼ˆé»˜è®¤ trueï¼‰
    enable-dynamic-weighting: true

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    top.yumbo.ai.rag: DEBUG
    org.springframework: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# æ—¥å¿—å›½é™…åŒ–é…ç½®: auto | zh | en
log:
  locale: auto
---
# å¼€å‘ç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: dev

logging:
  level:
    top.yumbo.ai.rag: DEBUG

knowledge:
  qa:
    knowledge-base:
      rebuild-on-startup: true  # å¼€å‘æ—¶æ¯æ¬¡é‡å»º
    vector-search:
      enabled: true

---
# ç”Ÿäº§ç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: prod

logging:
  level:
    top.yumbo.ai.rag: INFO

knowledge:
  qa:
    knowledge-base:
      rebuild-on-startup: false  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å·²æœ‰çŸ¥è¯†åº“
    vector-search:
      enabled: true


