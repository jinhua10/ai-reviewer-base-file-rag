# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®æ–‡ä»¶
# Knowledge QA System Configuration

server:
  port: 8080

  # Tomcat é…ç½®
  tomcat:
    # ä¸´æ—¶æ–‡ä»¶ç›®å½•
    basedir: ./temp
    # è¿æ¥è¶…æ—¶
    connection-timeout: 20000
    # çº¿ç¨‹é…ç½®
    threads:
      max: 200
      min-spare: 10

spring:
  application:
    name: knowledge-qa-system

  # å›½é™…åŒ–æ¶ˆæ¯æºé…ç½® (I18n Message Source Configuration)
  # ç¡®ä¿æ‰€æœ‰ messages*.properties æ–‡ä»¶ä»¥ UTF-8 ç¼–ç åŠ è½½
  messages:
    basename: messages
    encoding: UTF-8
    cache-duration: 3600
    fallback-to-system-locale: false

  # æ–‡ä»¶ä¸Šä¼ é…ç½®
  servlet:
    multipart:
      # å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 1MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-file-size: 100MB
      # å•æ¬¡è¯·æ±‚æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 10MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-request-size: 100MB
      # æ˜¯å¦å¯ç”¨æ–‡ä»¶ä¸Šä¼ 
      enabled: true
      # ä¸´æ—¶æ–‡ä»¶ä½ç½®ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ç›®å½•ï¼Œé¿å…ç³»ç»Ÿä¸´æ—¶ç›®å½•æƒé™é—®é¢˜ï¼‰
      location: ./temp/uploads
      # æ–‡ä»¶å†™å…¥ç£ç›˜çš„é˜ˆå€¼ï¼ˆ0 è¡¨ç¤ºå§‹ç»ˆå†™å…¥ç£ç›˜ï¼‰
      file-size-threshold: 0

# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®
knowledge:
  qa:
    # çŸ¥è¯†åº“é…ç½®
    knowledge-base:
      # çŸ¥è¯†åº“å­˜å‚¨è·¯å¾„ï¼ˆç´¢å¼•ã€å…ƒæ•°æ®ç­‰ï¼‰
      storage-path: ./data/knowledge-base

      # æ–‡æ¡£æºè·¯å¾„ï¼ˆæ”¯æŒæ–‡ä»¶å¤¹æˆ–å•ä¸ªæ–‡ä»¶ï¼‰
      # ç¤ºä¾‹ï¼š
      #   - ./data/documents           # æ–‡ä»¶å¤¹
      #   - E:/æ–‡æ¡£/çŸ¥è¯†åº“             # ä¸­æ–‡è·¯å¾„
      #   - ./data/documents/file.xlsx # å•ä¸ªæ–‡ä»¶
      #   - classpath:simpleExcel      # resourcesä¸‹çš„ç›®å½•
      # 
      # æ³¨æ„ï¼šä½¿ç”¨ classpath è·¯å¾„æ—¶ï¼Œä¸­æ–‡æ–‡ä»¶åå¯èƒ½åœ¨æ„å»ºè¿‡ç¨‹ä¸­å‡ºç°ç¼–ç é—®é¢˜
      # æ¨èä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä»¥è·å¾—æ›´å¥½çš„ä¸­æ–‡æ–‡ä»¶åæ”¯æŒ
      source-path: ./data/documents

      # å¯åŠ¨æ—¶ç´¢å¼•æ¨¡å¼
      # true: å®Œå…¨é‡å»ºï¼ˆåˆ é™¤æ—§ç´¢å¼•ï¼Œé‡æ–°ç´¢å¼•æ‰€æœ‰æ–‡ä»¶ï¼‰
      # false: å¢é‡ç´¢å¼•ï¼ˆåªç´¢å¼•æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶ï¼Œé»˜è®¤æ¨èï¼‰
      # æ³¨æ„ï¼šUIç•Œé¢å¯ä»¥éšæ—¶è§¦å‘å®Œå…¨é‡å»ºæˆ–å¢é‡ç´¢å¼•
      rebuild-on-startup: false

      # æ˜¯å¦å¯ç”¨ç¼“å­˜
      enable-cache: true
    # ============================================================
    # PPL æœåŠ¡é…ç½®ï¼ˆPerplexity-based Chunking & Rerankingï¼‰
    # ============================================================
    ppl:
      # é»˜è®¤æä¾›å•†ï¼šonnx, ollama, openai
      # æ¨èä½¿ç”¨ onnxï¼ˆæœ¬åœ°ã€å¿«é€Ÿã€å…è´¹ï¼‰
      default-provider: onnx

      # å¯ç”¨é™çº§ç­–ç•¥ï¼ˆå½“å‰æä¾›å•†å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢ï¼‰
      enable-fallback: true

      # é™çº§é¡ºåºï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
      fallback-order:
        - onnx      # ä¼˜å…ˆï¼šæœ¬åœ° ONNXï¼ˆæœ€å¿«ã€å…è´¹ï¼‰
        - ollama    # æ¬¡é€‰ï¼šæœ¬åœ° Ollamaï¼ˆå¤§æ¨¡å‹æ”¯æŒï¼‰
        - openai    # å¤‡ç”¨ï¼šäº‘ç«¯ APIï¼ˆè´¨é‡æœ€é«˜ï¼‰

      # ============================================================
      # ONNX é…ç½®ï¼ˆæ¨èç”¨äº PPL è®¡ç®—ï¼‰
      # ============================================================
      onnx:
        enabled: true

        # æ¨¡å‹è·¯å¾„ï¼ˆä½¿ç”¨ä¸­æ–‡ä¼˜åŒ–çš„æ¨¡å‹ï¼‰
        # é€‰é¡¹1ï¼šGPT2-Mediumï¼ˆé€šç”¨ï¼Œæ¨èï¼‰
        model-path: ./models/gpt2-medium-int8/model.onnx
        tokenizer-path: ./models/gpt2-medium-int8/tokenizer.json

        # é€‰é¡¹2ï¼šChinese-BERTï¼ˆä¸­æ–‡ä¼˜åŒ–ï¼‰
        # model-path: ./models/chinese-bert-wwm/model.onnx
        # tokenizer-path: ./models/chinese-bert-wwm/tokenizer.json

        # æ‰¹å¤„ç†é…ç½®
        max-batch-size: 8

        # ç¼“å­˜é…ç½®ï¼ˆæå‡æ€§èƒ½ï¼‰
        use-cache: true
        cache-size: 10000      # æœ€å¤šç¼“å­˜ 10000 ä¸ªç»“æœ
        cache-ttl: 3600        # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰

      # ============================================================
      # Ollama é…ç½®ï¼ˆæœ¬åœ°å¤§æ¨¡å‹ï¼Œä½¿ç”¨å›½äº§ Qwenï¼‰
      # ============================================================
      ollama:
        enabled: false         # é»˜è®¤ç¦ç”¨ï¼Œéœ€è¦æ—¶å¯ç”¨

        # Ollama æœåŠ¡åœ°å€
        base-url: http://localhost:11434

        # ä½¿ç”¨ Qwen æ¨¡å‹ï¼ˆé˜¿é‡Œé€šä¹‰åƒé—®ï¼‰
        # é€‰é¡¹1ï¼šQwen2.5-0.5Bï¼ˆè½»é‡çº§ï¼Œæ¨èç”¨äº PPLï¼‰
        model: qwen2.5:0.5b

        # é€‰é¡¹2ï¼šQwen2.5-1.5Bï¼ˆå¹³è¡¡æ€§èƒ½ï¼‰
        # model: qwen2.5:1.5b

        # é€‰é¡¹3ï¼šQwen2.5-7Bï¼ˆé«˜è´¨é‡ï¼‰
        # model: qwen2.5:7b

        # ç½‘ç»œé…ç½®
        timeout: 30000         # è¯·æ±‚è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
        max-retries: 3         # æœ€å¤§é‡è¯•æ¬¡æ•°
        connection-pool-size: 10

      # ============================================================
      # OpenAI é…ç½®ï¼ˆäº‘ç«¯ APIï¼Œå…¼å®¹é€šä¹‰åƒé—®ï¼‰
      # ============================================================
      openai:
        enabled: false         # é»˜è®¤ç¦ç”¨
        # API é…ç½®
        api-key: ${QW_API_KEY:}  # é€šä¹‰åƒé—® API Key
        # ä½¿ç”¨é˜¿é‡Œé€šä¹‰åƒé—®æ¨¡å‹
        # qwen-turboï¼šå¿«é€Ÿã€ç»æµï¼ˆæ¨èç”¨äº PPLï¼‰
        # qwen-plusï¼šå¹³è¡¡æ€§èƒ½
        # qwen-maxï¼šæœ€é«˜è´¨é‡
        model: qwen-turbo
        # é€šä¹‰åƒé—® API ç«¯ç‚¹
        api-url: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
        timeout: 60000
        use-logprobs: false    # é€šä¹‰åƒé—®æš‚ä¸æ”¯æŒ logprobs

      # ============================================================
      # Chunking é…ç½®ï¼ˆåŸºäº PPL çš„æ™ºèƒ½åˆ‡åˆ†ï¼‰
      # ============================================================
      chunking:
        # PPL é˜ˆå€¼ï¼ˆå›°æƒ‘åº¦å˜åŒ–è¶…è¿‡æ­¤å€¼æ—¶åˆ‡åˆ†ï¼‰
        # å»ºè®®å€¼ï¼š15.0-25.0
        # - 15.0ï¼šåˆ‡åˆ†æ›´ç»†ï¼ˆå—æ›´å°ï¼Œæ›´ç²¾ç¡®ï¼‰
        # - 20.0ï¼šå¹³è¡¡ï¼ˆæ¨èï¼‰
        # - 25.0ï¼šåˆ‡åˆ†æ›´ç²—ï¼ˆå—æ›´å¤§ï¼Œæ›´å®Œæ•´ï¼‰
        ppl-threshold: 20.0

        # å—å¤§å°é™åˆ¶ï¼ˆå­—ç¬¦æ•°ï¼‰
        max-chunk-size: 2000   # æœ€å¤§å—å¤§å°
        min-chunk-size: 200    # æœ€å°å—å¤§å°
        overlap-size: 100      # é‡å å¤§å°ï¼ˆä¿æŒä¸Šä¸‹æ–‡ï¼‰

        # å¯ç”¨ä¸¤é˜¶æ®µåˆ‡åˆ†ï¼ˆæ¨èï¼‰
        # trueï¼šå…ˆç²—åˆ†å†ç²¾åˆ†ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
        # falseï¼šç›´æ¥ PPL åˆ‡åˆ†
        enable-coarse-chunking: true

      # ============================================================
      # Reranking é…ç½®ï¼ˆåŸºäº PPL çš„é‡æ’åºï¼‰
      # ============================================================
      reranking:
        # æ˜¯å¦å¯ç”¨ PPL Rerank
        enabled: false         # é»˜è®¤ç¦ç”¨ï¼Œéœ€è¦æ—¶å¯ç”¨
        # PPL åˆ†æ•°æƒé‡ï¼ˆ0.0-1.0ï¼‰
        # æœ€ç»ˆåˆ†æ•° = (1-weight) * åŸå§‹åˆ†æ•° + weight * PPLåˆ†æ•°
        # å»ºè®®å€¼ï¼š0.10-0.20
        weight: 0.15
        # ä»…å¯¹å‰ K ä¸ªæ–‡æ¡£é‡æ’åºï¼ˆæ§åˆ¶æˆæœ¬ï¼‰
        top-k: 5
        # å¼‚æ­¥å¤„ç†ï¼ˆä¸é˜»å¡ä¸»æµç¨‹ï¼‰
        async: true
        # è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        timeout: 5000
        # æ–‡æ¡£å†…å®¹æˆªæ–­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
        content-truncate-length: 500
    # å‘é‡æ£€ç´¢é…ç½®
    vector-search:
      # æ˜¯å¦å¯ç”¨å‘é‡æ£€ç´¢
      # true: ä½¿ç”¨è¯­ä¹‰å‘é‡æ£€ç´¢ï¼ˆéœ€è¦æ¨¡å‹æ–‡ä»¶ï¼‰
      # false: ä½¿ç”¨çº¯å…³é”®è¯æ£€ç´¢
      enabled: true

      # æ¨¡å‹é…ç½®
      model:
        # æ¨¡å‹åç§°ï¼ˆç”¨äºæ—¥å¿—æ˜¾ç¤ºï¼‰
        name: paraphrase-multilingual

        # æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äº resourcesï¼‰
        # ç³»ç»Ÿä¼šè‡ªåŠ¨æŸ¥æ‰¾ä»¥ä¸‹ç›®å½•ä¸­çš„æ¨¡å‹æ–‡ä»¶ï¼š
        path: ./models/paraphrase-multilingual/model.onnx

        # æ¨¡å‹æœç´¢è·¯å¾„ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        # ç³»ç»Ÿä¼šæŒ‰é¡ºåºåœ¨è¿™äº›ç›®å½•ä¸­æŸ¥æ‰¾æ¨¡å‹æ–‡ä»¶
        search-paths:
          - bge-m3                      # BGE-M3 (æ¨è, 2024æœ€æ–°)
          - multilingual-e5-large       # Multilingual E5 Large
          - bge-large-zh                # BGE Large ZH (ä¸­æ–‡)
          - paraphrase-multilingual     # Paraphrase Multilingual
          - text2vec-base-chinese       # Text2Vec (æ—§ç‰ˆ)

        # æ¨¡å‹æ–‡ä»¶åï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        file-names:
          - model.onnx                  # æ ‡å‡†æ¨¡å‹
          - model_O2.onnx               # ä¼˜åŒ–æ¨¡å‹
          - model_quantized.onnx        # é‡åŒ–æ¨¡å‹
          - model_quint8_avx2.onnx      # AVX2 é‡åŒ–

      # å‘é‡ç´¢å¼•å­˜å‚¨è·¯å¾„
      index-path: ./data/vector-index

      # æ£€ç´¢ç›¸ä¼¼åº¦é˜ˆå€¼ (0.0-1.0)
      # è¶Šé«˜è¶Šä¸¥æ ¼ï¼Œå»ºè®® 0.3-0.5
      # åªæœ‰ç›¸ä¼¼åº¦é«˜äºæ­¤é˜ˆå€¼çš„æ–‡æ¡£æ‰ä¼šè¢«è¿”å›
      similarity-threshold: 0.5

      # === æ··åˆæ£€ç´¢é…ç½®ï¼ˆLucene + å‘é‡ï¼‰ ===

      # Lucene æ£€ç´¢è¿”å›çš„å€™é€‰æ–‡æ¡£æ•°
      # ç”¨äºç¬¬ä¸€æ­¥ç²—ç­›ï¼Œé€šå¸¸è®¾ç½®ä¸º hybrid-top-k çš„ 2-3 å€
      # å»ºè®®å€¼ï¼š30-100
      lucene-top-k: 40

      # å‘é‡æ£€ç´¢è¿”å›çš„å€™é€‰æ–‡æ¡£æ•°
      # ç”¨äºè¯­ä¹‰ç²¾æ’ï¼Œé€šå¸¸è®¾ç½®ä¸º hybrid-top-k çš„ 2-3 å€
      # å»ºè®®å€¼ï¼š30-100
      vector-top-k: 40

      # æ··åˆæ£€ç´¢æœ€ç»ˆè¿”å›çš„æ–‡æ¡£æ•°ï¼ˆå»é‡åï¼‰
      # è¿™äº›æ–‡æ¡£ä¼šæŒ‰è¯„åˆ†æ’åºï¼Œç”¨äºåç»­çš„åˆ†æ‰¹å¼•ç”¨
      # å»ºè®®å€¼ï¼š10-50
      hybrid-top-k: 20

      # æ¯æ¬¡é—®ç­”å¼•ç”¨çš„æ–‡æ¡£æ•°
      # ç”¨æˆ·å¯ä»¥é€šè¿‡ next æ¥å£è·å–å‰©ä½™æ–‡æ¡£ç»§ç»­é—®ç­”
      # å»ºè®®å€¼ï¼š3-10
      documents-per-query: 5

      # æ£€ç´¢è¿”å›çš„æ–‡æ¡£æ•°é‡ä¸Šé™ï¼ˆå·²åºŸå¼ƒï¼‰
      # @deprecated ä½¿ç”¨ hybrid-top-k æ›¿ä»£
      top-k: 20

      # æ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†é˜ˆå€¼ï¼ˆLucene + å‘é‡æ··åˆè¯„åˆ†ï¼‰
      # ä½äºæ­¤åˆ†æ•°çš„æ–‡æ¡£ä¼šè¢«è¿‡æ»¤
      # å»ºè®®å€¼ï¼š
      #   - é«˜ç²¾åº¦ï¼š0.15-0.20
      #   - å¹³è¡¡ï¼š0.10-0.15ï¼ˆé»˜è®¤ï¼‰
      #   - é«˜å¬å›ï¼š0.05-0.10
      min-score-threshold: 0.10

    # LLM é…ç½®
    llm:
      # LLM æä¾›å•†
      # å¯é€‰å€¼:
      #   - openai: OpenAI å…¼å®¹ APIï¼ˆé»˜è®¤ï¼Œæ”¯æŒ OpenAIã€DeepSeek ç­‰æ‰€æœ‰å…¼å®¹æœåŠ¡ï¼‰
      #   - mock: Mock æ¨¡å¼ï¼ˆæµ‹è¯•ç”¨ï¼Œè¿”å›å›ºå®šå›ç­”ï¼‰
      #
      # è¯´æ˜: OpenAI å®¢æˆ·ç«¯æ”¯æŒæ‰€æœ‰ OpenAI API å…¼å®¹çš„æœåŠ¡
      #       é€šè¿‡é…ç½®ä¸åŒçš„ api-url å’Œ model å³å¯åˆ‡æ¢ä¸åŒçš„æœåŠ¡
      provider: openai

      # API Keyï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
      # DeepSeek: export AI_API_KEY=your-deepseek-key
      # OpenAI: export OPENAI_API_KEY=your-openai-key
      # Qianwen: export QW_API_KEY=your-qianwen-key
      api-key: ${AI_API_KEY:}

      # API ç«¯ç‚¹
      # DeepSeek: https://api.deepseek.com/v1/chat/completions
      # OpenAI: https://api.openai.com/v1/chat/completions
      # Qianwen VL: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completionsï¼ˆé»˜è®¤é…ç½®ï¼‰
      # å…¶ä»–å…¼å®¹æœåŠ¡: é…ç½®ç›¸åº”çš„ API ç«¯ç‚¹
      api-url: https://api.deepseek.com/v1/chat/completions

      # æ¨¡å‹åç§°
      # DeepSeek: deepseek-chatï¼ˆä¸æ”¯æŒå›¾ç‰‡ï¼‰
      # OpenAI: gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-4, gpt-3.5-turbo
      # Qianwen VL: qwen-vl-plus, qwen-vl-maxï¼ˆæ”¯æŒå›¾ç‰‡ï¼Œé»˜è®¤é…ç½®ï¼‰
      model: deepseek-chat

      # æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # å»ºè®®å€¼ï¼š
      #   - DeepSeek: 32000 (32K tokensï¼Œçº¦24Kæ±‰å­—)
      #   - GPT-4o: 100000 (128K tokens)
      #   - Claude-3: 200000 (200K tokens)
      max-context-length: 20000

      # å•æ–‡æ¡£æœ€å¤§é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # å»ºè®®å€¼ï¼šmax-context-length çš„ 1/4 åˆ° 1/2
      max-doc-length: 5000

      # å•æ¬¡é—®ç­”æœ€å¤§å¤„ç†æ–‡æ¡£æ•°
      # ç”¨äºé˜²æ­¢å†…å­˜æº¢å‡ºå’Œæ§åˆ¶å“åº”æ—¶é—´
      # å¦‚æœæ£€ç´¢åˆ°çš„æ–‡æ¡£è¶…è¿‡æ­¤æ•°é‡ï¼Œä¼šåˆ†æ‰¹å¤„ç†
      # å»ºè®®å€¼ï¼š5-15
      max-documents-per-query: 5

      # æ˜¯å¦å¯ç”¨åˆ†æ‰¹å¤„ç†æ¨¡å¼
      # å¯ç”¨åï¼Œå¦‚æœæ–‡æ¡£æ•°è¶…è¿‡ max-documents-per-queryï¼Œ
      # ä¼šåœ¨ç­”æ¡ˆä¸­æç¤ºç”¨æˆ·è¿˜æœ‰æœªå¤„ç†çš„æ–‡æ¡£ï¼Œæ”¯æŒç»§ç»­æé—®
      enable-batch-processing: true

      # æ–‡æ¡£åˆ‡åˆ†ç­–ç•¥
      # å¯é€‰å€¼ï¼š
      #   - SIMPLE: ç®€å•åˆ‡åˆ†ï¼ŒæŒ‰å›ºå®šé•¿åº¦åˆ‡åˆ†ï¼ˆæ€§èƒ½æœ€å¥½ï¼Œæˆæœ¬æœ€ä½ï¼‰
      #   - SMART_KEYWORD: æ™ºèƒ½å…³é”®è¯åˆ‡åˆ†ï¼Œä¼˜å…ˆä¿ç•™åŒ…å«å…³é”®è¯çš„å†…å®¹ï¼ˆæ¨èï¼Œå¹³è¡¡æ•ˆæœå’Œæˆæœ¬ï¼‰
      #   - AI_SEMANTIC: AIè¯­ä¹‰åˆ‡åˆ†ï¼Œä½¿ç”¨AIæ¨¡å‹æ™ºèƒ½åˆ‡åˆ†ï¼ˆæ•ˆæœæœ€å¥½ï¼Œæˆæœ¬æœ€é«˜ï¼‰
      #   - NONE: ä¸åˆ‡åˆ†ï¼Œç›´æ¥æˆªæ–­ï¼ˆä¸æ¨èï¼‰
      chunking-strategy: SMART_KEYWORD

      # æ–‡æ¡£åˆ‡åˆ†é…ç½®
      chunking:
        # åˆ‡åˆ†å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
        # å»ºè®®è®¾ç½®ä¸º max-doc-length çš„ 80%ï¼Œç•™å‡ºé‡å ç©ºé—´
        chunk-size: 4000

        # åˆ‡åˆ†é‡å å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
        # ç”¨äºä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§ï¼Œå»ºè®® 10-20% çš„ chunk-size
        chunk-overlap: 400

        # æ˜¯å¦åœ¨å¥å­è¾¹ç•Œåˆ‡åˆ†ï¼ˆå¼ºçƒˆæ¨èï¼‰
        split-on-sentence: true

        # AI è¯­ä¹‰åˆ‡åˆ†é…ç½®ï¼ˆä»…å½“ chunking-strategy=AI_SEMANTIC æ—¶ç”Ÿæ•ˆï¼‰
        ai-chunking:
          # æ˜¯å¦å¯ç”¨
          enabled: false

          # ç”¨äºè¯­ä¹‰åˆ‡åˆ†çš„æ¨¡å‹
          # å»ºè®®ä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼ˆå¦‚ gpt-4o-mini æˆ– deepseek-chatï¼‰
          model: deepseek-chat

          # è¯­ä¹‰åˆ‡åˆ†çš„ Prompt æ¨¡æ¿
          prompt: |
            è¯·å°†ä»¥ä¸‹æ–‡æ¡£æ™ºèƒ½åˆ‡åˆ†æˆå¤šä¸ªè¯­ä¹‰å®Œæ•´çš„æ®µè½ã€‚
            
            è¦æ±‚ï¼š
            1. æ¯ä¸ªæ®µè½åº”è¯¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸»é¢˜æˆ–æ¦‚å¿µ
            2. ä¿æŒæ®µè½ä¹‹é—´çš„é€»è¾‘è¿è´¯æ€§
            3. æ¯ä¸ªæ®µè½å¤§å°åœ¨ {chunk_size} å­—ç¬¦å·¦å³
            4. è¿”å› JSON æ ¼å¼ï¼š[{"content": "æ®µè½1å†…å®¹", "title": "æ®µè½1æ ‡é¢˜"}, ...]
            
            æ–‡æ¡£å†…å®¹ï¼š
            {content}

      # Prompt æç¤ºè¯æ¨¡æ¿
      # æ”¯æŒä¸¤ä¸ªå ä½ç¬¦ï¼š
      #   - {question}: ç”¨æˆ·é—®é¢˜
      #   - {context}: ç›¸å…³æ–‡æ¡£å†…å®¹
      # å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰æç¤ºè¯é£æ ¼å’Œè¦æ±‚
      prompt-template: |
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŸ¥è¯†åŠ©æ‰‹ã€‚è¯·åŸºäºæ–‡æ¡£å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
        
        # å›ç­”è¦æ±‚
        1. å¿…é¡»åŸºäºæ–‡æ¡£å†…å®¹å›ç­”ï¼Œä¸è¦ç¼–é€ ä¿¡æ¯
        2. å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·
        3. å›ç­”è¦æ¸…æ™°ã€å‡†ç¡®ã€æœ‰æ¡ç†
        4. å¯ä»¥å¼•ç”¨æ–‡æ¡£åç§°ä½œä¸ºä¿¡æ¯æ¥æº
        5. ä¿æŒä¸“ä¸šå‹å¥½çš„è¯­æ°”
        6. å¦‚æœæç¤ºè¯ä¸­æœ‰å›¾ç‰‡URLé“¾æ¥åˆ™ä»¥markdownå±•ç¤ºå›¾ç‰‡
        
        # ç”¨æˆ·é—®é¢˜
        {question}
        
        # ç›¸å…³æ–‡æ¡£
        {context}
        
        # è¯·æä¾›ä½ çš„å›ç­”ï¼š

    # æ–‡æ¡£å¤„ç†é…ç½®
    document:
      # æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
      supported-formats:
        - xlsx
        - xls
        - docx
        - doc
        - pptx
        - ppt
        - pdf
        - txt
        - md
        - html
        - xml

      # æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
      max-file-size-mb: 200

      # æœ€å¤§å†…å®¹å¤§å°ï¼ˆMBï¼‰
      # è¶…è¿‡æ­¤å¤§å°ä¼šå¼ºåˆ¶åˆ†å—
      max-content-size-mb: 50

      # è‡ªåŠ¨åˆ†å—é˜ˆå€¼ï¼ˆMBï¼‰
      # å†…å®¹è¶…è¿‡æ­¤å¤§å°ä¼šè‡ªåŠ¨å¯ç”¨åˆ†å—
      auto-chunk-threshold-mb: 2

      # æ–‡æ¡£åˆ†å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-size: 2000

      # æ–‡æ¡£åˆ†å—é‡å ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-overlap: 400

      # å¹¶è¡Œå¤„ç†é…ç½®
      # æ˜¯å¦å¯ç”¨å¹¶è¡Œå¤„ç†ï¼ˆæ–‡æ¡£æ•°é‡ > 5 æ—¶è‡ªåŠ¨å¯ç”¨ï¼Œå¯æ˜¾è‘—æå‡ç´¢å¼•é€Ÿåº¦ï¼‰
      parallel-processing: true

      # å¹¶è¡Œå¤„ç†çº¿ç¨‹æ•°
      # 0 = è‡ªåŠ¨ï¼ˆä½¿ç”¨ CPU æ ¸å¿ƒæ•°ï¼‰
      # å»ºè®®å€¼: CPU æ ¸å¿ƒæ•°æˆ–ç•¥å°‘ï¼ˆå¦‚ 4æ ¸è®¾ç½®ä¸º 3-4ï¼‰
      parallel-threads: 0

      # æ‰¹å¤„ç†å¤§å°ï¼ˆæ–‡æ¡£æ•°ï¼‰
      # æ¯æ‰¹å¤„ç†å¤šå°‘ä¸ªæ–‡æ¡£åæäº¤ä¸€æ¬¡
      # å»ºè®®å€¼: 10-20
      batch-size: 10

      # ============================================================
      # å†…å®¹é•¿åº¦é™åˆ¶é…ç½®ï¼ˆå½±å“å†…å­˜å ç”¨å’Œæ€§èƒ½ï¼‰
      # ============================================================

      # ç´¢å¼•æ—¶å•ä¸ªæ–‡æ¡£æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # è¶…è¿‡æ­¤é•¿åº¦ä¼šè¢«æˆªæ–­ï¼Œé˜²æ­¢åç»­å¤„ç†å†…å­˜æº¢å‡º
      # å»ºè®®å€¼ï¼š
      #   - å†…å­˜å……è¶³ï¼ˆ8GB+ï¼‰: 100000 (çº¦ 200KB)
      #   - å†…å­˜ä¸€èˆ¬ï¼ˆ4GBï¼‰: 50000 (çº¦ 100KBï¼Œé»˜è®¤)
      #   - å†…å­˜æœ‰é™ï¼ˆ2GBï¼‰: 30000 (çº¦ 60KB)
      max-index-content-length: 50000

      # é—®ç­”æ—¶æ–‡æ¡£åˆ‡åˆ†æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # é€šå¸¸è®¾ç½®ä¸º max-index-content-length çš„ 2 å€
      # å› ä¸ºé—®ç­”æ—¶åªå¤„ç†å°‘é‡æ–‡æ¡£ï¼ˆ5-10ä¸ªï¼‰
      max-chunk-content-length: 100000

      # é—®ç­”æ—¶å•æ¬¡åˆ‡åˆ†æœ€å¤§å—æ•°
      # é˜²æ­¢åˆ‡åˆ†äº§ç”Ÿè¿‡å¤šå—å¯¼è‡´å†…å­˜æº¢å‡º
      # å»ºè®®å€¼ï¼š30-100
      max-chunks-per-document: 50

    # å›¾ç‰‡å¤„ç†é…ç½®
    image-processing:
      # å›¾ç‰‡å¤„ç†ç­–ç•¥:
      #   - placeholder: å ä½ç¬¦ï¼ˆé»˜è®¤ï¼Œé›¶ä¾èµ–ï¼‰
      #   - ocr: OCR æ–‡å­—è¯†åˆ«ï¼ˆéœ€è¦ Tesseractï¼‰
      #   - vision-llm: Vision LLM è¯­ä¹‰ç†è§£ï¼ˆä½¿ç”¨ç‹¬ç«‹é…ç½®çš„ vision-llmï¼‰
      #   - llm-vision: ä½¿ç”¨ä¸» LLM å®¢æˆ·ç«¯çš„å›¾ç‰‡è¯†åˆ«åŠŸèƒ½ï¼ˆä»…å½“ä¸» LLM æ”¯æŒå›¾ç‰‡æ—¶æœ‰æ•ˆï¼‰
      #   - hybrid: æ··åˆæ¨¡å¼ï¼ˆLLM Vision + OCRï¼Œæ¨èï¼‰
      #
      # ğŸ’¡ é‡è¦è¯´æ˜ï¼š
      #   - llm-vision ç­–ç•¥è¦æ±‚ä¸» LLM æ¨¡å‹æ”¯æŒå›¾ç‰‡ï¼ˆå¦‚ gpt-4oã€qwen-vl-plusï¼‰
      #   - å¦‚æœä¸» LLM æ˜¯ deepseek-chat ç­‰ä¸æ”¯æŒå›¾ç‰‡çš„æ¨¡å‹ï¼Œè¯·ä½¿ç”¨ vision-llm ç­–ç•¥
      #   - vision-llm ç­–ç•¥ä½¿ç”¨ç‹¬ç«‹é…ç½®ï¼Œä¸ä¾èµ–ä¸» LLM
      #
      # æ¨èé…ç½®ï¼š
      #   - ä¸» LLM æ”¯æŒå›¾ç‰‡ï¼ˆqwen-vl-plusã€gpt-4oï¼‰â†’ ä½¿ç”¨ llm-vision
      #   - ä¸» LLM ä¸æ”¯æŒå›¾ç‰‡ï¼ˆdeepseek-chatï¼‰â†’ ä½¿ç”¨ vision-llm
      strategy: vision-llm

      # æ˜¯å¦å¯ç”¨ OCR
      # è®¾ç½®ä¸º true å¯ç”¨ OCR å›¾ç‰‡æ–‡å­—è¯†åˆ«åŠŸèƒ½
      # éœ€è¦å®‰è£… Tesseract OCR è½¯ä»¶
      enable-ocr: true

      # OCR é…ç½®
      ocr:
        # Tesseract æ•°æ®è·¯å¾„
        # æ–¹å¼1ï¼ˆæ¨èï¼‰ï¼šç›´æ¥æŒ‡å®šç»å¯¹è·¯å¾„
        #   Windows ç¤ºä¾‹: C:/Program Files/Tesseract-OCR/tessdata
        #   Linux/Mac ç¤ºä¾‹: /usr/share/tesseract-ocr/4.00/tessdata
        #
        # æ–¹å¼2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
        #   Linux/Mac: export TESSDATA_PREFIX=/path/to/tessdata
        #   Windows: set TESSDATA_PREFIX=C:\path\to\tessdata
        #
        # æ–¹å¼3ï¼šä½¿ç”¨é¡¹ç›®å†…ç½®è·¯å¾„ï¼ˆé»˜è®¤ï¼‰
        #   å¦‚æœæœªé…ç½®ï¼Œå°†ä½¿ç”¨: release/tessdata
        #
        # å½“å‰é…ç½®: ä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡ TESSDATA_PREFIXï¼Œå¦‚æœæœªè®¾ç½®åˆ™ä½¿ç”¨ release/tessdata
        tessdata-path: ${TESSDATA_PREFIX:release/tessdata}

        # ğŸ’¡ æç¤ºï¼šå¦‚æœè¦ç›´æ¥é…ç½®è·¯å¾„ï¼Œæ›¿æ¢ä¸Šé¢ä¸€è¡Œä¸º:
        # tessdata-path: C:/Program Files/Tesseract-OCR/tessdata

        # è¯†åˆ«è¯­è¨€
        # chi_sim: ç®€ä½“ä¸­æ–‡
        # eng: è‹±æ–‡
        # chi_sim+eng: ä¸­è‹±æ–‡æ··åˆï¼ˆæ¨èï¼‰
        language: chi_sim+eng

      # Vision LLM é…ç½®
      vision-llm:
        # æ˜¯å¦å¯ç”¨ï¼ˆæ··åˆæ¨¡å¼ä¸‹æ¨èå¯ç”¨ï¼‰
        enabled: true

        # API Key
        # æ–¹å¼1ï¼ˆæ¨èï¼‰ï¼šç›´æ¥é…ç½® API Key
        #   api-key: sk-your-actual-api-key
        #
        # æ–¹å¼2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ›´å®‰å…¨ï¼‰
        #   export VISION_LLM_API_KEY=sk-your-api-key
        #   æˆ–ä½¿ç”¨ä¸» LLM çš„ API Key: export AI_API_KEY=sk-your-api-key
        #
        # å½“å‰é…ç½®: ä¼˜å…ˆä½¿ç”¨ VISION_LLM_API_KEYï¼Œå¦‚æœæœªè®¾ç½®åˆ™ä½¿ç”¨ AI_API_KEY
        # æœ¬åœ° Ollama ä¸éœ€è¦ API Key
        api-key: ${VISION_LLM_API_KEY:${QW_API_KEY:}}

        # ğŸ’¡ æç¤ºï¼šå¦‚æœè¦ç›´æ¥é…ç½® API Keyï¼Œæ›¿æ¢ä¸Šé¢ä¸€è¡Œä¸º:
        # api-key: sk-your-actual-api-key

        # æ¨¡å‹åç§°
        # OpenAI: gpt-4o, gpt-4-vision-preview
        # Anthropic: claude-3-opus
        # Google: gemini-pro-vision
        # Qwen: qwen-vl-plus
        # Ollamaï¼ˆæœ¬åœ°ï¼‰: qwen3-vl:8b, llava:7b, minicpm-v
        model: qwen-vl-plus

        # API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
        # OpenAI: https://api.openai.com/v1/chat/completions
        # Ollamaï¼ˆæœ¬åœ°ï¼‰: http://localhost:11434/api/chat
        endpoint: ${VISION_LLM_ENDPOINT:https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions}

        # ğŸ’¡ æç¤ºï¼šå¦‚æœè¦ç›´æ¥é…ç½®ç«¯ç‚¹ï¼Œæ›¿æ¢ä¸Šé¢ä¸€è¡Œä¸º:
        # endpoint: http://localhost:11434/api/chat

        # æ‰¹é‡å¤„ç†é…ç½®ï¼ˆé’ˆå¯¹ PPT/æ¼”ç¤ºæ–‡ç¨¿åœºæ™¯ä¼˜åŒ–ï¼‰
        batch:
          # æ˜¯å¦å¯ç”¨æ‰¹é‡å¤„ç†ï¼ˆä¸€æ¬¡å‘é€å¤šå¼ å›¾ç‰‡ï¼‰
          enabled: true

          # æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡
          # å»ºè®®å€¼ï¼š3-5 å¼ ï¼ˆå–å†³äºæ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶å’Œå›¾ç‰‡å¤§å°ï¼‰
          # - GPT-4o: å¯ä»¥å¤„ç† 10+ å¼ 
          # - Qwen-VL: å»ºè®® 3-5 å¼ 
          # - Claude-3: å¯ä»¥å¤„ç† 5-10 å¼ 
          size: 4

          # å›¾ç‰‡å‹ç¼©é…ç½®
          compress:
            # æ˜¯å¦å¯ç”¨å›¾ç‰‡å‹ç¼©ï¼ˆé™ä½è´¨é‡ä»¥å‡å°‘ token æ¶ˆè€—ï¼‰
            enabled: true

            # å‹ç¼©è´¨é‡ï¼ˆ0.1-1.0ï¼‰
            # 1.0 = ä¸å‹ç¼©ï¼Œ0.8 = è½»åº¦å‹ç¼©ï¼ˆæ¨èï¼‰ï¼Œ0.5 = ä¸­åº¦å‹ç¼©
            quality: 0.8

            # å•å¼ å›¾ç‰‡æœ€å¤§å°ºå¯¸ï¼ˆKBï¼‰
            # è¶…è¿‡æ­¤å¤§å°ä¼šè¿›è¡Œå‹ç¼©
            # å»ºè®®å€¼ï¼š200-500 KB
            max-size-kb: 300

            # å›¾ç‰‡æœ€å¤§åˆ†è¾¨ç‡ï¼ˆå®½xé«˜ï¼‰
            # è¶…è¿‡æ­¤åˆ†è¾¨ç‡ä¼šç­‰æ¯”ä¾‹ç¼©å°
            # å»ºè®®å€¼ï¼š1920x1080ï¼ˆ1080pï¼‰æˆ– 1280x720ï¼ˆ720pï¼‰
            max-width: 1920
            max-height: 1080

    # é—®ç­”å½’æ¡£é…ç½®
    qa-archive:
      # æ˜¯å¦å¯ç”¨å½’æ¡£
      enabled: true

      # å½’æ¡£ç­–ç•¥
      # - auto: è‡ªåŠ¨å½’æ¡£æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é—®ç­”
      # - feedback-based: åŸºäºç”¨æˆ·åé¦ˆå½’æ¡£ï¼ˆæ¨èï¼‰
      # - manual: æ‰‹åŠ¨å®¡æ ¸åå½’æ¡£
      strategy: feedback-based

      # æœ€ä½è¯„åˆ†é˜ˆå€¼ï¼ˆfeedback-based æ¨¡å¼ï¼‰
      min-rating: 4

      # é—®é¢˜æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      min-question-length: 5

      # å›ç­”æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      min-answer-length: 20

      # å½’æ¡£è·¯å¾„
      archive-path: ./data/rag

      # æ˜¯å¦è‡ªåŠ¨ç´¢å¼•å½’æ¡£çš„æ–‡æ¡£
      auto-index: true

      # ä¸´æ—¶æ–‡æ¡£è¿‡æœŸå¤©æ•°ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
      temp-document-expiry-days: 30

    # æ¸è¿›å¼æ–‡æ¡£åˆ†æé…ç½®
    progressive-analysis:
      # æ˜¯å¦å¯ç”¨æ¸è¿›å¼åˆ†æï¼ˆæ¨èç”¨äºå¤§æ–‡æ¡£ï¼‰
      enabled: true

      # è®°å¿†çª—å£å¤§å°ï¼ˆä¿ç•™å¤šå°‘ä¸ªæ‰¹æ¬¡/å¹»ç¯ç‰‡çš„å…³é”®ä¿¡æ¯ï¼‰
      # å»ºè®®å€¼ï¼š3-5
      # - å¤ªå°ï¼šä¸Šä¸‹æ–‡ä¸è¶³ï¼Œå¯èƒ½ä¸¢å¤±é‡è¦å…³è”
      # - å¤ªå¤§ï¼šä¿¡æ¯è¿‡è½½ï¼Œå¯èƒ½å¹²æ‰°ç†è§£
      memory-window-size: 3

      # å…³é”®ç‚¹æå–ç­–ç•¥
      # - structured: ç»“æ„åŒ–æå–ï¼ˆä½¿ç”¨æ ‡è®°ï¼‰
      # - smart: æ™ºèƒ½æå–ï¼ˆAIè‡ªåŠ¨è¯†åˆ«ï¼‰
      key-point-extraction: structured

      # æ˜¯å¦ç”Ÿæˆä¸­é—´æ€»ç»“
      # true: æ¯Nä¸ªæ‰¹æ¬¡ç”Ÿæˆä¸€æ¬¡ä¸­é—´æ€»ç»“
      # false: åªåœ¨æœ€åç”Ÿæˆæ€»ç»“
      generate-intermediate-summary: false

      # ä¸­é—´æ€»ç»“é—´éš”ï¼ˆæ‰¹æ¬¡æ•°ï¼‰
      intermediate-summary-interval: 5

  # åé¦ˆç³»ç»Ÿé…ç½®
  feedback:
    # æ˜¯å¦éœ€è¦å®¡æ ¸æ‰èƒ½ç”Ÿæ•ˆï¼ˆé»˜è®¤ false - ç›´æ¥ç”Ÿæ•ˆï¼‰
    require-approval: false

    # æ˜¯å¦è‡ªåŠ¨åº”ç”¨åé¦ˆåˆ°æ£€ç´¢ä¼˜åŒ–ï¼ˆé»˜è®¤ trueï¼‰
    auto-apply: true

    # ç‚¹èµæƒé‡å¢é‡ï¼ˆé»˜è®¤ 0.1ï¼‰
    like-weight-increment: 0.1

    # è¸©çš„æƒé‡å‡é‡ï¼ˆé»˜è®¤ -0.15ï¼‰
    dislike-weight-decrement: -0.15

    # æœ€å°æƒé‡é™åˆ¶ï¼ˆé»˜è®¤ 0.1ï¼‰
    min-weight: 0.1

    # æœ€å¤§æƒé‡é™åˆ¶ï¼ˆé»˜è®¤ 2.0ï¼‰
    max-weight: 2.0

    # æ˜¯å¦å¯ç”¨åŠ¨æ€æƒé‡è°ƒæ•´ï¼ˆé»˜è®¤ trueï¼‰
    enable-dynamic-weighting: true

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    top.yumbo.ai.rag: DEBUG
    org.springframework: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# æ—¥å¿—å›½é™…åŒ–é…ç½®: auto | zh | en
log:
  locale: auto
---
# å¼€å‘ç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: dev

logging:
  level:
    top.yumbo.ai.rag: DEBUG

knowledge:
  qa:
    knowledge-base:
      rebuild-on-startup: true  # å¼€å‘æ—¶æ¯æ¬¡é‡å»º
    vector-search:
      enabled: true

---
# ç”Ÿäº§ç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: prod

logging:
  level:
    top.yumbo.ai.rag: INFO

knowledge:
  qa:
    knowledge-base:
      rebuild-on-startup: false  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å·²æœ‰çŸ¥è¯†åº“
    vector-search:
      enabled: true


