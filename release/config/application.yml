# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®æ–‡ä»¶ - ç”Ÿäº§ç¯å¢ƒ
# Knowledge QA System Configuration - Production

server:
  port: 8080

  # Tomcat é…ç½®
  tomcat:
    # ä¸´æ—¶æ–‡ä»¶ç›®å½•
    basedir: ./temp
    # è¿æ¥è¶…æ—¶
    connection-timeout: 20000
    # çº¿ç¨‹é…ç½®
    threads:
      max: 200
      min-spare: 10

spring:
  application:
    name: knowledge-qa-system

  # æ–‡ä»¶ä¸Šä¼ é…ç½®
  servlet:
    multipart:
      # å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 1MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-file-size: 100MB
      # å•æ¬¡è¯·æ±‚æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 10MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-request-size: 100MB
      # æ˜¯å¦å¯ç”¨æ–‡ä»¶ä¸Šä¼ 
      enabled: true
      # ä¸´æ—¶æ–‡ä»¶ä½ç½®ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ç›®å½•ï¼Œé¿å…ç³»ç»Ÿä¸´æ—¶ç›®å½•æƒé™é—®é¢˜ï¼‰
      location: ./temp/uploads
      # æ–‡ä»¶å†™å…¥ç£ç›˜çš„é˜ˆå€¼ï¼ˆ0 è¡¨ç¤ºå§‹ç»ˆå†™å…¥ç£ç›˜ï¼‰
      file-size-threshold: 0

# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®
knowledge:
  qa:
    # çŸ¥è¯†åº“é…ç½®
    knowledge-base:
      # çŸ¥è¯†åº“å­˜å‚¨è·¯å¾„ï¼ˆç´¢å¼•ã€å…ƒæ•°æ®ç­‰ï¼‰
      storage-path: ./data/knowledge-base

      # æ–‡æ¡£æºè·¯å¾„ï¼ˆæ”¯æŒæ–‡ä»¶å¤¹æˆ–å•ä¸ªæ–‡ä»¶ï¼‰
      # å°†æ­¤è·¯å¾„æŒ‡å‘å¤–éƒ¨æ–‡æ¡£ç›®å½•
      # ç¤ºä¾‹ï¼š
      #   - ./data/documents           # ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰
      #   - E:/æ–‡æ¡£/çŸ¥è¯†åº“             # ç»å¯¹è·¯å¾„
      #   - ./data/documents/file.xlsx # å•ä¸ªæ–‡ä»¶
      source-path: ./data/documents

      # å¯åŠ¨æ—¶ç´¢å¼•æ¨¡å¼
      # true: å®Œå…¨é‡å»ºï¼ˆåˆ é™¤æ—§ç´¢å¼•ï¼Œé‡æ–°ç´¢å¼•æ‰€æœ‰æ–‡ä»¶ï¼‰
      # false: å¢é‡ç´¢å¼•ï¼ˆåªç´¢å¼•æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶ï¼Œé»˜è®¤æ¨èï¼‰
      # æ³¨æ„ï¼šUIç•Œé¢å¯ä»¥éšæ—¶è§¦å‘å®Œå…¨é‡å»ºæˆ–å¢é‡ç´¢å¼•
      rebuild-on-startup: false

      # æ˜¯å¦å¯ç”¨ç¼“å­˜
      enable-cache: true

    # å‘é‡æ£€ç´¢é…ç½®
    vector-search:
      # æ˜¯å¦å¯ç”¨å‘é‡æ£€ç´¢
      # true: ä½¿ç”¨è¯­ä¹‰å‘é‡æ£€ç´¢ï¼ˆéœ€è¦æ¨¡å‹æ–‡ä»¶ï¼Œéœ€è¦å…ˆä¸‹è½½æ¨¡å‹ï¼‰
      # false: ä½¿ç”¨çº¯å…³é”®è¯æ£€ç´¢ï¼ˆæ¨èï¼Œå¼€ç®±å³ç”¨ï¼‰
      enabled: true

      # æ¨¡å‹é…ç½®
      # âš ï¸ å¯ç”¨å‘é‡æ£€ç´¢å‰ï¼Œè¯·ç¡®ä¿å·²ä¸‹è½½æ¨¡å‹æ–‡ä»¶
      # ğŸ“¥ æ¨¡å‹ä¸‹è½½ï¼š
      #    1. è®¿é—® https://huggingface.co/sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
      #    2. ä¸‹è½½ model.onnx æ–‡ä»¶
      #    3. æ”¾ç½®åˆ° models/paraphrase-multilingual/ ç›®å½•
      #
      # ğŸ“ æ¨¡å‹ç›®å½•ç»“æ„ï¼š
      #    ./models/
      #      â”œâ”€â”€ paraphrase-multilingual/
      #      â”‚   â””â”€â”€ model.onnx
      #      â”œâ”€â”€ bge-m3/
      #      â”‚   â””â”€â”€ model.onnx
      #      â””â”€â”€ text2vec-base-chinese/
      #          â””â”€â”€ model.onnx
      model:
        # æ¨¡å‹åç§°ï¼ˆç”¨äºæ—¥å¿—æ˜¾ç¤ºï¼‰
        name: paraphrase-multilingual

        # æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆå¤–éƒ¨è·¯å¾„ï¼Œç›¸å¯¹äºåº”ç”¨ç›®å½•ï¼‰
        # ä¼˜å…ˆçº§ï¼š
        #   1. ç»å¯¹è·¯å¾„: D:/models/xxx/model.onnx
        #   2. ç›¸å¯¹è·¯å¾„: ./models/paraphrase-multilingual/model.onnx
        #   3. classpath: models/paraphrase-multilingual/model.onnx
        path: ./models/paraphrase-multilingual/model.onnx

        # æ¨¡å‹æœç´¢è·¯å¾„ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        search-paths:
          - bge-m3                      # BGE-M3 (æ¨è, 2024æœ€æ–°)
          - multilingual-e5-large       # Multilingual E5 Large
          - bge-large-zh                # BGE Large ZH (ä¸­æ–‡)
          - paraphrase-multilingual     # Paraphrase Multilingual
          - text2vec-base-chinese       # Text2Vec (æ—§ç‰ˆ)

        # æ¨¡å‹æ–‡ä»¶åï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        file-names:
          - model.onnx                  # æ ‡å‡†æ¨¡å‹
          - model_O2.onnx               # ä¼˜åŒ–æ¨¡å‹
          - model_quantized.onnx        # é‡åŒ–æ¨¡å‹
          - model_quint8_avx2.onnx      # AVX2 é‡åŒ–

      # å‘é‡ç´¢å¼•å­˜å‚¨è·¯å¾„
      index-path: ./data/vector-index

      # æ£€ç´¢ç›¸ä¼¼åº¦é˜ˆå€¼ (0.0-1.0)
      similarity-threshold: 0.4

      # æ£€ç´¢è¿”å›çš„æ–‡æ¡£æ•°é‡
      top-k: 20

    # LLM é…ç½®
    llm:
      # LLM æä¾›å•†
      # å¯é€‰å€¼:
      #   - openai: OpenAI å…¼å®¹ APIï¼ˆé»˜è®¤ï¼Œæ”¯æŒ OpenAIã€DeepSeek ç­‰ï¼‰
      #   - mock: Mock æ¨¡å¼ï¼ˆæµ‹è¯•ç”¨ï¼‰
      #
      # è¯´æ˜ï¼šé€šè¿‡é…ç½®ä¸åŒçš„ api-url å’Œ model åˆ‡æ¢ä¸åŒçš„æœåŠ¡
      #   DeepSeek: api-url=https://api.deepseek.com, model=deepseek-chat
      #   OpenAI: api-url=https://api.openai.com, model=gpt-4o
      provider: openai

      # API Keyï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
      # DeepSeek: set AI_API_KEY=your-deepseek-key
      # OpenAI: set OPENAI_API_KEY=your-openai-key
      # æœªè®¾ç½®æ—¶å°†ä½¿ç”¨ Mock æ¨¡å¼è¿”å›å›ºå®šå›ç­”
      api-key: ${AI_API_KEY:}

      # API ç«¯ç‚¹ï¼ˆæ ¹æ®ä½¿ç”¨çš„æœåŠ¡é…ç½®ï¼‰
      # DeepSeekï¼ˆé»˜è®¤ï¼‰: https://api.deepseek.com/v1/chat/completions
      # OpenAI: https://api.openai.com/v1/chat/completions
      api-url: https://api.deepseek.com/v1/chat/completions

      # æ¨¡å‹åç§°ï¼ˆæ ¹æ®ä½¿ç”¨çš„æœåŠ¡é…ç½®ï¼‰
      # DeepSeekï¼ˆé»˜è®¤ï¼‰: deepseek-chat
      # OpenAI: gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-4, gpt-3.5-turbo
      model: deepseek-chat

      # æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      max-context-length: 20000

      # å•æ–‡æ¡£æœ€å¤§é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      max-doc-length: 5000

    # æ–‡æ¡£å¤„ç†é…ç½®
    document:
      # æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
      supported-formats:
        - xlsx
        - xls
        - docx
        - doc
        - pptx
        - ppt
        - pdf
        - txt
        - md
        - html
        - xml

      # æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
      max-file-size-mb: 200

      # æœ€å¤§å†…å®¹å¤§å°ï¼ˆMBï¼‰
      max-content-size-mb: 50

      # è‡ªåŠ¨åˆ†å—é˜ˆå€¼ï¼ˆMBï¼‰
      auto-chunk-threshold-mb: 2

      # æ–‡æ¡£åˆ†å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-size: 2000

      # æ–‡æ¡£åˆ†å—é‡å ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-overlap: 400

    # å›¾ç‰‡å¤„ç†é…ç½®
    image-processing:
      # å›¾ç‰‡å¤„ç†ç­–ç•¥: placeholder, ocr, vision-llm, hybrid
      strategy: placeholder

      # æ˜¯å¦å¯ç”¨ OCR
      enable-ocr: true

      # OCR é…ç½®
      ocr:
        tessdata-path: ${TESSDATA_PREFIX:./tessdata}
        language: chi_sim+eng

      # Vision LLM é…ç½®
      vision-llm:
        enabled: false
        api-key: ${VISION_LLM_API_KEY:}
        model: gpt-4-vision-preview
        endpoint: ${VISION_LLM_ENDPOINT:}

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    top.yumbo.ai.rag: INFO
    org.springframework: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: ./logs/knowledge-qa-system.log

