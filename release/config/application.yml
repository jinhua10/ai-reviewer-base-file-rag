# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®æ–‡ä»¶ - ç”Ÿäº§ç¯å¢ƒ
# Knowledge QA System Configuration - Production

server:
  port: 8080

  # Tomcat é…ç½®
  tomcat:
    # ä¸´æ—¶æ–‡ä»¶ç›®å½•
    basedir: ./temp
    # è¿æ¥è¶…æ—¶
    connection-timeout: 20000
    # çº¿ç¨‹é…ç½®
    threads:
      max: 200
      min-spare: 10

spring:
  application:
    name: knowledge-qa-system

  # å›½é™…åŒ–æ¶ˆæ¯æºé…ç½® (I18n Message Source Configuration)
  # ç¡®ä¿æ‰€æœ‰ messages*.properties æ–‡ä»¶ä»¥ UTF-8 ç¼–ç åŠ è½½
  messages:
    basename: messages
    encoding: UTF-8
    cache-duration: 3600
    fallback-to-system-locale: false

  # æ–‡ä»¶ä¸Šä¼ é…ç½®
  servlet:
    multipart:
      # å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 1MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-file-size: 100MB
      # å•æ¬¡è¯·æ±‚æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ 10MBï¼Œè°ƒæ•´ä¸º 100MBï¼‰
      max-request-size: 100MB
      # æ˜¯å¦å¯ç”¨æ–‡ä»¶ä¸Šä¼ 
      enabled: true
      # ä¸´æ—¶æ–‡ä»¶ä½ç½®ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ç›®å½•ï¼Œé¿å…ç³»ç»Ÿä¸´æ—¶ç›®å½•æƒé™é—®é¢˜ï¼‰
      location: ./temp/uploads
      # æ–‡ä»¶å†™å…¥ç£ç›˜çš„é˜ˆå€¼ï¼ˆ0 è¡¨ç¤ºå§‹ç»ˆå†™å…¥ç£ç›˜ï¼‰
      file-size-threshold: 0

# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿé…ç½®
knowledge:
  qa:
    # çŸ¥è¯†åº“é…ç½®
    knowledge-base:
      # çŸ¥è¯†åº“å­˜å‚¨è·¯å¾„ï¼ˆç´¢å¼•ã€å…ƒæ•°æ®ç­‰ï¼‰
      storage-path: ./data/knowledge-base

      # æ–‡æ¡£æºè·¯å¾„ï¼ˆæ”¯æŒæ–‡ä»¶å¤¹æˆ–å•ä¸ªæ–‡ä»¶ï¼‰
      # å°†æ­¤è·¯å¾„æŒ‡å‘å¤–éƒ¨æ–‡æ¡£ç›®å½•
      # ç¤ºä¾‹ï¼š
      #   - ./data/documents           # ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰
      #   - E:/æ–‡æ¡£/çŸ¥è¯†åº“             # ç»å¯¹è·¯å¾„
      #   - ./data/documents/file.xlsx # å•ä¸ªæ–‡ä»¶
      source-path: ./data/documents

      # å¯åŠ¨æ—¶ç´¢å¼•æ¨¡å¼
      # true: å®Œå…¨é‡å»ºï¼ˆåˆ é™¤æ—§ç´¢å¼•ï¼Œé‡æ–°ç´¢å¼•æ‰€æœ‰æ–‡ä»¶ï¼‰
      # false: å¢é‡ç´¢å¼•ï¼ˆåªç´¢å¼•æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶ï¼Œé»˜è®¤æ¨èï¼‰
      # æ³¨æ„ï¼šUIç•Œé¢å¯ä»¥éšæ—¶è§¦å‘å®Œå…¨é‡å»ºæˆ–å¢é‡ç´¢å¼•
      rebuild-on-startup: false

      # æ˜¯å¦å¯ç”¨ç¼“å­˜
      enable-cache: true

      # è‡ªåŠ¨ç´¢å¼•é…ç½®
      # ä¸Šä¼ æ–‡ä»¶åæ˜¯å¦è‡ªåŠ¨è§¦å‘å¢é‡ç´¢å¼•
      # true: ä¸Šä¼ å®Œæˆåè‡ªåŠ¨åå°ç´¢å¼•ï¼ˆæ¨èï¼‰
      # false: éœ€è¦æ‰‹åŠ¨ç‚¹å‡»"å¢é‡ç´¢å¼•"æŒ‰é’®
      auto-index-after-upload: true

    # å‘é‡æ£€ç´¢é…ç½®
    vector-search:
      # æ˜¯å¦å¯ç”¨å‘é‡æ£€ç´¢
      # true: ä½¿ç”¨è¯­ä¹‰å‘é‡æ£€ç´¢ï¼ˆéœ€è¦æ¨¡å‹æ–‡ä»¶ï¼Œéœ€è¦å…ˆä¸‹è½½æ¨¡å‹ï¼‰
      # false: ä½¿ç”¨çº¯å…³é”®è¯æ£€ç´¢ï¼ˆæ¨èï¼Œå¼€ç®±å³ç”¨ï¼‰
      enabled: true

      # æ¨¡å‹é…ç½®ï¼ˆå·²æ›´æ–°ä¸ºå›½äº§æ¨¡å‹ï¼‰
      model:
        # æ¨¡å‹åç§°ï¼ˆç”¨äºæ—¥å¿—æ˜¾ç¤ºï¼‰
        # æ¨èä½¿ç”¨å›½äº§ BGE ç³»åˆ—ï¼Œä¸ Qwen é…å¥—æ•ˆæœæ›´å¥½
        name: bge-base-zh

        # æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äº resourcesï¼‰
        # BGE-Base-ZH: æ™ºæºç ”ç©¶é™¢å¼€å‘ï¼Œä¸­æ–‡æ•ˆæœä¼˜ç§€ï¼Œå…¼å®¹æ€§å¥½
        path: ./models/bge-base-zh/model.onnx

        # æ¨¡å‹æœç´¢è·¯å¾„ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå·²è°ƒæ•´ä¸ºå›½äº§ä¼˜å…ˆï¼‰
        search-paths:
          - bge-base-zh                 # BGE-Base-ZH (æ¨è, æ™ºæº, å…¼å®¹æ€§å¥½) âœ…
          - bge-large-zh                # BGE Large ZH (æ™ºæº, ä¸­æ–‡ä¼˜åŒ–)
          - bge-base-zh-v1.5            # BGE Base ZH v1.5 (æ™ºæº, è½»é‡çº§)
          - bge-m3                      # BGE-M3 (æ™ºæº, 2024æœ€æ–°, éœ€è¦æ›´æ–°çš„ ONNX Runtime)
          - text2vec-base-chinese       # Text2Vec (é˜¿é‡Œ, ç»å…¸)

        # æ¨¡å‹æ–‡ä»¶åï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        file-names:
          - model.onnx                  # æ ‡å‡†æ¨¡å‹
          - model_O2.onnx               # ä¼˜åŒ–æ¨¡å‹
          - model_quantized.onnx        # é‡åŒ–æ¨¡å‹
          - model_quint8_avx2.onnx      # AVX2 é‡åŒ–

      # å‘é‡ç´¢å¼•å­˜å‚¨è·¯å¾„
      index-path: ./data/vector-index

      # æ£€ç´¢ç›¸ä¼¼åº¦é˜ˆå€¼ (0.0-1.0)
      similarity-threshold: 0.5

      # === æ··åˆæ£€ç´¢é…ç½®ï¼ˆLucene + å‘é‡ï¼‰ ===
      # Lucene æ£€ç´¢è¿”å›çš„å€™é€‰æ–‡æ¡£æ•°
      lucene-top-k: 100

      # å‘é‡æ£€ç´¢è¿”å›çš„å€™é€‰æ–‡æ¡£æ•°
      vector-top-k: 50

      # æ··åˆæ£€ç´¢æœ€ç»ˆè¿”å›çš„æ–‡æ¡£æ•°ï¼ˆå»é‡åï¼‰
      hybrid-top-k: 30

      # æ¯æ¬¡é—®ç­”å¼•ç”¨çš„æ–‡æ¡£æ•°
      documents-per-query: 5

      # æ£€ç´¢è¿”å›çš„æ–‡æ¡£æ•°é‡ä¸Šé™ï¼ˆå·²åºŸå¼ƒï¼Œä½¿ç”¨ hybrid-top-k æ›¿ä»£ï¼‰
      top-k: 20

      # æ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†é˜ˆå€¼
      min-score-threshold: 0.06

    # ============================================================
    # æœç´¢é…ç½®ï¼ˆåœç”¨è¯ã€å…³é”®è¯æå–ï¼‰
    # ============================================================
    search:
      # æ˜¯å¦å¯ç”¨åœç”¨è¯è¿‡æ»¤
      enable-stop-words-filter: true

      # æœ€å°å…³é”®è¯é•¿åº¦ï¼ˆå°äºæ­¤é•¿åº¦çš„è¯ä¼šè¢«è¿‡æ»¤ï¼‰
      min-keyword-length: 2

      # ä¸­æ–‡åœç”¨è¯åˆ—è¡¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
      chinese-stop-words:
        - çš„
        - æ˜¯
        - åœ¨
        - äº†
        - å’Œ
        - æœ‰
        - æˆ‘
        - ä½ 
        - ä»–
        - å¥¹
        - å®ƒ
        - ä»¬
        - è¿™
        - é‚£
        - ä¹‹
        - ä¸
        - åŠ
        - æˆ–

      # è‹±æ–‡åœç”¨è¯åˆ—è¡¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
      english-stop-words:
        - "the"
        - "a"
        - "an"
        - "in"
        - "on"
        - "at"
        - "of"
        - "for"
        - "to"
        - "and"
        - "or"
        - "but"

    # LLM é…ç½®
    llm:
      # LLM æä¾›å•†
      # å¯é€‰å€¼:
      #   - openai: OpenAI å…¼å®¹ APIï¼ˆé»˜è®¤ï¼Œæ”¯æŒ OpenAIã€DeepSeek ç­‰ï¼‰
      #   - mock: Mock æ¨¡å¼ï¼ˆæµ‹è¯•ç”¨ï¼‰
      #
      # è¯´æ˜ï¼šé€šè¿‡é…ç½®ä¸åŒçš„ api-url å’Œ model åˆ‡æ¢ä¸åŒçš„æœåŠ¡
      #   DeepSeek: api-url=https://api.deepseek.com, model=deepseek-chat
      #   OpenAI: api-url=https://api.openai.com, model=gpt-4o
      provider: openai

      # API Keyï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
      # DeepSeek: set AI_API_KEY=your-deepseek-key
      # OpenAI: set OPENAI_API_KEY=your-openai-key
      # æœªè®¾ç½®æ—¶å°†ä½¿ç”¨ Mock æ¨¡å¼è¿”å›å›ºå®šå›ç­”
      api-key: ${AI_API_KEY:}

      # API ç«¯ç‚¹ï¼ˆæ ¹æ®ä½¿ç”¨çš„æœåŠ¡é…ç½®ï¼‰
      # DeepSeekï¼ˆé»˜è®¤ï¼‰: https://api.deepseek.com/v1/chat/completions
      # OpenAI: https://api.openai.com/v1/chat/completions
      api-url: https://api.deepseek.com/v1/chat/completions

      # æ¨¡å‹åç§°ï¼ˆæ ¹æ®ä½¿ç”¨çš„æœåŠ¡é…ç½®ï¼‰
      # DeepSeekï¼ˆé»˜è®¤ï¼‰: deepseek-chat
      # OpenAI: gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-4, gpt-3.5-turbo
      model: deepseek-chat

      # æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      max-context-length: 20000

      # å•æ–‡æ¡£æœ€å¤§é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      max-doc-length: 5000

      # å•æ¬¡é—®ç­”æœ€å¤§å¤„ç†æ–‡æ¡£æ•°
      max-documents-per-query: 5

      # æ˜¯å¦å¯ç”¨åˆ†æ‰¹å¤„ç†æ¨¡å¼
      enable-batch-processing: true

      # æ–‡æ¡£åˆ‡åˆ†ç­–ç•¥: SIMPLE, SMART_KEYWORD, AI_SEMANTIC, NONE
      chunking-strategy: SMART_KEYWORD

      # æ–‡æ¡£åˆ‡åˆ†é…ç½®
      chunking:
        chunk-size: 4000
        chunk-overlap: 400
        split-on-sentence: true

        # AI è¯­ä¹‰åˆ‡åˆ†é…ç½®
        ai-chunking:
          enabled: false
          model: deepseek-chat
          prompt: |
            è¯·å°†ä»¥ä¸‹æ–‡æ¡£æ™ºèƒ½åˆ‡åˆ†æˆå¤šä¸ªè¯­ä¹‰å®Œæ•´çš„æ®µè½ã€‚
            
            è¦æ±‚ï¼š
            1. æ¯ä¸ªæ®µè½åº”è¯¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸»é¢˜æˆ–æ¦‚å¿µ
            2. ä¿æŒæ®µè½ä¹‹é—´çš„é€»è¾‘è¿è´¯æ€§
            3. æ¯ä¸ªæ®µè½å¤§å°åœ¨ {chunk_size} å­—ç¬¦å·¦å³
            4. è¿”å› JSON æ ¼å¼ï¼š[{"content": "æ®µè½1å†…å®¹", "title": "æ®µè½1æ ‡é¢˜"}, ...]
            
            æ–‡æ¡£å†…å®¹ï¼š
            {content}

      # Prompt æç¤ºè¯æ¨¡æ¿
      # æ”¯æŒä¸¤ä¸ªå ä½ç¬¦ï¼š
      #   - {question}: ç”¨æˆ·é—®é¢˜
      #   - {context}: ç›¸å…³æ–‡æ¡£å†…å®¹
      # å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰æç¤ºè¯é£æ ¼å’Œè¦æ±‚
      prompt-template: |
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŸ¥è¯†åŠ©æ‰‹ã€‚è¯·åŸºäºæ–‡æ¡£å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
        
        # å›ç­”è¦æ±‚
        1. å¿…é¡»åŸºäºæ–‡æ¡£å†…å®¹å›ç­”ï¼Œä¸è¦ç¼–é€ ä¿¡æ¯
        2. å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·
        3. å›ç­”è¦æ¸…æ™°ã€å‡†ç¡®ã€æœ‰æ¡ç†
        4. å¯ä»¥å¼•ç”¨æ–‡æ¡£åç§°ä½œä¸ºä¿¡æ¯æ¥æº
        5. ä¿æŒä¸“ä¸šå‹å¥½çš„è¯­æ°”
        6. å¦‚æœæç¤ºè¯ä¸­æœ‰å›¾ç‰‡URLé“¾æ¥åˆ™ä»¥markdownå±•ç¤ºå›¾ç‰‡
        
        # ç”¨æˆ·é—®é¢˜
        {question}
        
        # ç›¸å…³æ–‡æ¡£
        {context}
        
        # è¯·æä¾›ä½ çš„å›ç­”ï¼š

    # æ–‡æ¡£å¤„ç†é…ç½®
    document:
      # æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
      supported-formats:
        - xlsx
        - xls
        - docx
        - doc
        - pptx
        - ppt
        - pdf
        - txt
        - md
        - html
        - xml

      # æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
      max-file-size-mb: 200

      # æœ€å¤§å†…å®¹å¤§å°ï¼ˆMBï¼‰
      max-content-size-mb: 50

      # è‡ªåŠ¨åˆ†å—é˜ˆå€¼ï¼ˆMBï¼‰
      auto-chunk-threshold-mb: 2

      # æ–‡æ¡£åˆ†å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-size: 2000

      # æ–‡æ¡£åˆ†å—é‡å ï¼ˆå­—ç¬¦æ•°ï¼‰
      chunk-overlap: 400

      # å¹¶è¡Œå¤„ç†é…ç½®ï¼ˆğŸš€ å¤§å¹…æå‡ç´¢å¼•é€Ÿåº¦ï¼‰
      parallel-processing: true

      # å¹¶è¡Œå¤„ç†çº¿ç¨‹æ•°ï¼ˆ0 = è‡ªåŠ¨ï¼Œä½¿ç”¨ CPU æ ¸å¿ƒæ•°ï¼‰
      parallel-threads: 0

      # æ‰¹å¤„ç†å¤§å°ï¼ˆæ–‡æ¡£æ•°ï¼‰
      batch-size: 10

      # ============================================================
      # å†…å®¹é•¿åº¦é™åˆ¶é…ç½®ï¼ˆå½±å“å†…å­˜å ç”¨å’Œæ€§èƒ½ï¼‰
      # ============================================================

      # ç´¢å¼•æ—¶å•ä¸ªæ–‡æ¡£æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      max-index-content-length: 50000

      # é—®ç­”æ—¶æ–‡æ¡£åˆ‡åˆ†æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      max-chunk-content-length: 100000

      # é—®ç­”æ—¶å•æ¬¡åˆ‡åˆ†æœ€å¤§å—æ•°
      max-chunks-per-document: 50


    # ============================================================
    # PPL æœåŠ¡é…ç½®ï¼ˆPerplexity-based Chunking & Rerankingï¼‰
    # ============================================================
    ppl:
      # PPL åŠŸèƒ½æ€»å¼€å…³
      enabled: true

      # é»˜è®¤æä¾›å•†ï¼šollama, onnx, openai
      default-provider: onnx

      # å¯ç”¨é™çº§ç­–ç•¥
      enable-fallback: true

      # é™çº§é¡ºåº
      fallback-order:
        - onnx
        - ollama
        - openai

      # ONNX é…ç½®
      onnx:
        enabled: true
        model-path: ./models/qwen2.5-0.5b-instruct/model.onnx
        tokenizer-path: ./models/qwen2.5-0.5b-instruct/tokenizer.json
        max-batch-size: 8
        use-cache: true
        cache-size: 10000
        cache-ttl: 3600

      # Ollama é…ç½®ï¼ˆæ¨èï¼‰
      ollama:
        enabled: true
        base-url: http://localhost:11434
        model: qwen2.5:0.5b
        timeout: 30000
        max-retries: 3
        connection-pool-size: 10

      # OpenAI é…ç½®
      openai:
        enabled: false
        api-key: ${QW_API_KEY:}
        model: qwen-turbo
        api-url: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
        timeout: 60000
        use-logprobs: false

      # Chunking é…ç½®ï¼ˆæ™ºèƒ½æ–‡æ¡£åˆ†å—ï¼‰
      chunking:
        # åˆ†å—ç­–ç•¥é€‰æ‹©: ppl, llm, auto
        strategy: ppl

        # LLM åˆ†å—é…ç½®
        llm-chunking:
          enabled: false
          use-main-llm: true
          api-key: ${CHUNKING_API_KEY:${AI_API_KEY:}}
          api-url: https://api.deepseek.com/v1/chat/completions
          model: deepseek-chat

          prompt-template: |
            ä½ æ˜¯ä¸€ä¸ªæ–‡æ¡£åˆ†å—ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹æ–‡æ¡£æ™ºèƒ½åœ°åˆ†å‰²æˆå¤šä¸ªè¯­ä¹‰å®Œæ•´çš„å—ã€‚
            
            # åˆ†å—è¦æ±‚
            1. æ¯ä¸ªå—åº”è¯¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯­ä¹‰å•å…ƒï¼ˆå¦‚ï¼šä¸€ä¸ªç« èŠ‚ã€ä¸€ä¸ªä¸»é¢˜ã€ä¸€ä¸ªå®Œæ•´çš„è®ºè¿°ï¼‰
            2. åœ¨è‡ªç„¶çš„è¾¹ç•Œå¤„åˆ‡åˆ†ï¼ˆç« èŠ‚æ ‡é¢˜ã€æ®µè½åˆ†éš”ã€ä¸»é¢˜è½¬æ¢ï¼‰
            3. æ¯ä¸ªå—å¤§å°æ§åˆ¶åœ¨ {minSize}-{maxSize} å­—ç¬¦ä¹‹é—´
            4. ä¿æŒå›¾ç‰‡æ ‡è®°ï¼ˆ[å›¾ç‰‡-xxxï¼š...]ï¼‰ä¸ç›¸å…³æ–‡æœ¬åœ¨åŒä¸€å—ä¸­
            5. ä¸è¦ç ´ååˆ—è¡¨ã€è¡¨æ ¼ã€ä»£ç å—ç­‰ç»“æ„
            
            # è¾“å‡ºæ ¼å¼
            è¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼æ ‡è®°åˆ‡åˆ†ç‚¹ï¼š
            
            [CHUNK_SPLIT]
            
            åœ¨éœ€è¦åˆ‡åˆ†çš„ä½ç½®æ’å…¥ [CHUNK_SPLIT] æ ‡è®°ã€‚ä¸è¦ä¿®æ”¹åŸæ–‡å†…å®¹ï¼Œåªæ·»åŠ æ ‡è®°ã€‚
            
            # æ–‡æ¡£å†…å®¹
            {content}
            
            # è¯·åœ¨åˆé€‚çš„ä½ç½®æ’å…¥ [CHUNK_SPLIT] æ ‡è®°ï¼š

        # PPL é˜ˆå€¼
        ppl-threshold: 20.0
        target-chunk-size: 1500
        max-chunk-size: 2500
        min-chunk-size: 300
        overlap-size: 150
        overlap-sentences: 2
        enable-coarse-chunking: true
        semantic-aware: true
        detect-paragraph: true
        detect-chapter: true
        detect-list-end: true
        use-dynamic-threshold: false

      # Reranking é…ç½®
      # âœ… å·²æ”¯æŒ KV Cache æ¨¡å‹ï¼ˆä½¿ç”¨ DirectBuffer åˆ›å»ºç©ºå¼ é‡ï¼‰
      reranking:
        enabled: true
        weight: 0.25
        top-k: 8
        async: true
        timeout: 5000
        content-truncate-length: 500

    # ============================================================
    # æŸ¥è¯¢æ‰©å±•é…ç½®ï¼ˆä¸­æœŸä¼˜åŒ–ï¼‰
    # ============================================================
    query-expansion:
      enabled: true
      use-llm-rewrite: false
      use-synonym: true
      synonym-file: ./data/synonyms.txt

    # å›¾ç‰‡å¤„ç†é…ç½®
    image-processing:
      # å›¾ç‰‡å¤„ç†ç­–ç•¥:
      #   - placeholder: å ä½ç¬¦ï¼ˆé»˜è®¤ï¼Œé›¶ä¾èµ–ï¼‰
      #   - vision-llm: ä½¿ç”¨ç‹¬ç«‹çš„ Vision LLM é…ç½®ï¼ˆä¸‹æ–¹ vision-llm é…ç½®èŠ‚ï¼‰
      #   - llm-client: ä½¿ç”¨ä¸» LLM å®¢æˆ·ç«¯çš„å›¾ç‰‡è¯†åˆ«åŠŸèƒ½ï¼ˆä»…å½“ä¸» LLM æ”¯æŒ Vision æ—¶æœ‰æ•ˆï¼‰
      #
      # ğŸ’¡ é‡è¦è¯´æ˜ï¼š
      #   - llm-client ç­–ç•¥è¦æ±‚ä¸» LLM æ¨¡å‹æ”¯æŒå›¾ç‰‡ï¼ˆå¦‚ gpt-4oã€qwen-vl-plusï¼‰
      #   - å¦‚æœä¸» LLM ä¸æ”¯æŒå›¾ç‰‡ï¼ˆå¦‚ deepseek-chatï¼‰ï¼Œè¯·ä½¿ç”¨ vision-llm ç­–ç•¥
      #   - vision-llm ç­–ç•¥ä½¿ç”¨ç‹¬ç«‹é…ç½®ï¼Œä¸ä¾èµ–ä¸» LLM
      #
      # æ¨èé…ç½®ï¼š
      #   - ä¸» LLM æ”¯æŒå›¾ç‰‡ï¼ˆqwen-vl-plusã€gpt-4oï¼‰â†’ ä½¿ç”¨ llm-client
      #   - ä¸» LLM ä¸æ”¯æŒå›¾ç‰‡ï¼ˆdeepseek-chatï¼‰â†’ ä½¿ç”¨ vision-llm
      strategy: vision-llm

      # å›¾ç‰‡æ–‡æœ¬åŒ–æå–æ¨¡å¼ï¼ˆImage text extraction modeï¼‰
      #   - concise: ç²¾ç®€æ¨¡å¼ï¼Œæå–å…³é”®ä¿¡æ¯ï¼Œé¿å…å†—ä½™ä½†ä¸é—æ¼é‡è¦å†…å®¹ï¼ˆèŠ‚çœ tokenï¼‰
      #   - detailed: è¯¦ç»†æ¨¡å¼ï¼Œå®Œæ•´åˆ†æå›¾ç‰‡å†…å®¹ï¼ˆæ¨èç”¨äºéœ€è¦è¯¦ç»†æè¿°çš„åœºæ™¯ï¼‰
      extraction-mode: concise

      # Vision LLM é…ç½®
      vision-llm:
        # æ˜¯å¦å¯ç”¨ï¼ˆæ··åˆæ¨¡å¼ä¸‹æ¨èå¯ç”¨ï¼‰
        enabled: true

        # API Key
        # æ–¹å¼1ï¼ˆæ¨èï¼‰ï¼šç›´æ¥é…ç½® API Key
        #   api-key: sk-your-actual-api-key
        #
        # æ–¹å¼2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ›´å®‰å…¨ï¼‰
        #   export VISION_LLM_API_KEY=sk-your-api-key
        #   æˆ–ä½¿ç”¨ä¸» LLM çš„ API Key: export AI_API_KEY=sk-your-api-key
        #
        # å½“å‰é…ç½®: ä¼˜å…ˆä½¿ç”¨ VISION_LLM_API_KEYï¼Œå¦‚æœæœªè®¾ç½®åˆ™ä½¿ç”¨ AI_API_KEY
        # æœ¬åœ° Ollama ä¸éœ€è¦ API Key
        api-key: ${QW_API_KEY:}

        # ğŸ’¡ æç¤ºï¼šå¦‚æœè¦ç›´æ¥é…ç½® API Keyï¼Œæ›¿æ¢ä¸Šé¢ä¸€è¡Œä¸º:
        # api-key: sk-your-actual-api-key

        # æ¨¡å‹åç§°
        # OpenAI: gpt-4o, gpt-4-vision-preview
        # Anthropic: claude-3-opus
        # Google: gemini-pro-vision
        # Qwen: qwen-vl-plus
        # Ollamaï¼ˆæœ¬åœ°ï¼‰: qwen3-vl:8b, llava:7b, minicpm-v
        model: qwen-vl-plus

        # API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
        # OpenAI: https://api.openai.com/v1/chat/completions
        # Ollamaï¼ˆæœ¬åœ°ï¼‰: http://localhost:11434/api/chat
        endpoint: ${VISION_LLM_ENDPOINT:https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions}

        # ğŸ’¡ æç¤ºï¼šå¦‚æœè¦ç›´æ¥é…ç½®ç«¯ç‚¹ï¼Œæ›¿æ¢ä¸Šé¢ä¸€è¡Œä¸º:
        # endpoint: http://localhost:11434/api/chat

        # æ‰¹é‡å¤„ç†é…ç½®ï¼ˆé’ˆå¯¹ PPT/æ¼”ç¤ºæ–‡ç¨¿åœºæ™¯ä¼˜åŒ–ï¼‰
        batch:
          # æ˜¯å¦å¯ç”¨æ‰¹é‡å¤„ç†ï¼ˆä¸€æ¬¡å‘é€å¤šå¼ å›¾ç‰‡ï¼‰
          enabled: true

          # æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡
          # å»ºè®®å€¼ï¼š3-5 å¼ ï¼ˆå–å†³äºæ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶å’Œå›¾ç‰‡å¤§å°ï¼‰
          # - GPT-4o: å¯ä»¥å¤„ç† 10+ å¼ 
          # - Qwen-VL: å»ºè®® 3-5 å¼ 
          # - Claude-3: å¯ä»¥å¤„ç† 5-10 å¼ 
          size: 4

          # å›¾ç‰‡å‹ç¼©é…ç½®
          compress:
            enabled: true
            quality: 0.8
            max-size-kb: 300
            max-width: 1920
            max-height: 1080

    # é—®ç­”å½’æ¡£é…ç½®
    qa-archive:
      enabled: true
      strategy: feedback-based
      min-rating: 4
      min-question-length: 5
      min-answer-length: 20
      archive-path: ./data/rag
      auto-index: true
      temp-document-expiry-days: 30

    # ============================================================
    # LLM ç»“æœæ–‡æ¡£åŒ–é…ç½®
    # ============================================================
    llm-result:
      storage-path: ./data/llm-results
      auto-add-to-knowledge-base: false
      max-history: 100
      auto-save: true
      min-content-length: 100

    # æ¸è¿›å¼æ–‡æ¡£åˆ†æé…ç½®
    progressive-analysis:
      enabled: true
      memory-window-size: 3
      key-point-extraction: structured
      generate-intermediate-summary: false
      intermediate-summary-interval: 5

  # åé¦ˆç³»ç»Ÿé…ç½®
  feedback:
    require-approval: false
    auto-apply: true
    like-weight-increment: 0.1
    dislike-weight-decrement: -0.15
    min-weight: 0.1
    max-weight: 2.0
    enable-dynamic-weighting: true

  # ============================================================
  # HOPE ä¸‰å±‚è®°å¿†æ¶æ„é…ç½®ï¼ˆå‚è€ƒ Google HOPE è®ºæ–‡ï¼‰
  # è®©çŸ¥è¯†åº“è¶Šæ¥è¶Šæ™ºèƒ½ï¼Œå‡å°‘ AI è°ƒç”¨ï¼Œæå‡å“åº”é€Ÿåº¦
  # ============================================================
  hope:
    # æ˜¯å¦å¯ç”¨ HOPE æ¶æ„
    enabled: true

    # ä½é¢‘å±‚é…ç½® - æŠ€èƒ½çŸ¥è¯†åº“ï¼ˆæ°¸ä¹…å­˜å‚¨ï¼‰
    permanent:
      storage-path: ./data/hope/permanent
      # æ™‹å‡åˆ°ä½é¢‘å±‚çš„æœ€å°è®¿é—®æ¬¡æ•°
      promotion-min-access-count: 10
      # æ™‹å‡åˆ°ä½é¢‘å±‚çš„æœ€å°å¹³å‡è¯„åˆ†
      promotion-min-avg-rating: 4.5
      # ç›´æ¥å›ç­”çš„æœ€å°ç½®ä¿¡åº¦
      direct-answer-confidence: 0.9

    # ä¸­é¢‘å±‚é…ç½® - è¿‘æœŸçŸ¥è¯†ï¼ˆPhase 2ï¼‰
    ordinary:
      storage-path: ./data/hope/ordinary
      # ä¿ç•™æ—¶é—´ï¼ˆå¤©ï¼‰
      retention-days: 30
      # ç›´æ¥ä½¿ç”¨å†å²ç­”æ¡ˆçš„ç›¸ä¼¼åº¦é˜ˆå€¼
      similarity-threshold: 0.95
      # ä½œä¸ºå‚è€ƒçš„ç›¸ä¼¼åº¦é˜ˆå€¼
      reference-threshold: 0.7
      # æœ€å¤§å­˜å‚¨æ¡ç›®æ•°
      max-entries: 10000

    # é«˜é¢‘å±‚é…ç½® - å®æ—¶ä¸Šä¸‹æ–‡ï¼ˆPhase 3ï¼‰
    high-frequency:
      # å­˜å‚¨æ–¹å¼: memory / redis
      storage: memory
      # ä¼šè¯è¶…æ—¶ï¼ˆåˆ†é’Ÿï¼‰
      session-timeout-minutes: 30
      # æœ€å¤§ä¼šè¯æ•°
      max-sessions: 1000
      # æ¯ä¸ªä¼šè¯æœ€å¤§å†å²è®°å½•æ•°
      max-history-per-session: 20

    # å“åº”ç­–ç•¥é…ç½®
    strategy:
      # ç›´æ¥å›ç­”çš„ç½®ä¿¡åº¦é˜ˆå€¼
      direct-answer-confidence: 0.9
      # æ˜¯å¦å¯ç”¨æŠ€èƒ½æ¨¡æ¿
      enable-skill-templates: true
      # æ˜¯å¦å¯ç”¨é—®é¢˜åˆ†ç±»
      enable-question-classification: true

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    top.yumbo.ai.rag: INFO
    org.springframework: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# æ—¥å¿—å›½é™…åŒ–é…ç½®: auto | zh | en
log:
  locale: auto
---
# å¼€å‘ç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: dev

logging:
  level:
    top.yumbo.ai.rag: DEBUG

knowledge:
  qa:
    knowledge-base:
      rebuild-on-startup: true  # å¼€å‘æ—¶æ¯æ¬¡é‡å»º
    vector-search:
      enabled: true

---
# ç”Ÿäº§ç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: prod

logging:
  level:
    top.yumbo.ai.rag: INFO

knowledge:
  qa:
    knowledge-base:
      rebuild-on-startup: false  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å·²æœ‰çŸ¥è¯†åº“
    vector-search:
      enabled: true
  file:
    name: ./logs/knowledge-qa-system.log

