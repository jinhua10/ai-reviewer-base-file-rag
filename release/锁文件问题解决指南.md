# Lucene ç´¢å¼•é”é—®é¢˜ - å¿«é€Ÿè§£å†³æŒ‡å—

## ğŸ› é—®é¢˜æè¿°

å¯åŠ¨åº”ç”¨æ—¶å‡ºç°é”™è¯¯ï¼š

```
LockObtainFailedException: Lock held by this virtual machine
Lock file: data\knowledge-base\index\lucene-index\write.lock
```

---

## âš¡ å¿«é€Ÿè§£å†³ï¼ˆæ¨èï¼‰

### æ–¹æ³• 1: ä½¿ç”¨ä¿®å¤è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

1. åŒå‡»è¿è¡Œ `fix-lock.bat`
2. è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶æ¸…ç†é”æ–‡ä»¶
3. é‡æ–°è¿è¡Œ `start.bat` å¯åŠ¨åº”ç”¨

---

### æ–¹æ³• 2: æ‰‹åŠ¨æ¸…ç†

1. åœæ­¢åº”ç”¨
   ```batch
   stop.bat
   ```

2. åˆ é™¤é”æ–‡ä»¶
   ```batch
   del data\knowledge-base\index\lucene-index\write.lock
   ```

3. é‡æ–°å¯åŠ¨
   ```batch
   start.bat
   ```

---

### æ–¹æ³• 3: é‡å»ºç´¢å¼•ï¼ˆå½»åº•è§£å†³ï¼‰

å¦‚æœä¸Šè¿°æ–¹æ³•æ— æ•ˆï¼Œå¯ä»¥é‡å»ºæ•´ä¸ªç´¢å¼•ï¼š

1. åœæ­¢åº”ç”¨
   ```batch
   stop.bat
   ```

2. åˆ é™¤ç´¢å¼•ç›®å½•
   ```batch
   rmdir /s /q data\knowledge-base\index
   ```

3. é‡æ–°å¯åŠ¨ï¼ˆä¼šè‡ªåŠ¨é‡å»ºï¼‰
   ```batch
   start.bat
   ```

---

## ğŸ” é—®é¢˜åŸå› 

### ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

1. **åº”ç”¨å¼‚å¸¸é€€å‡º**
   - ä½¿ç”¨ Ctrl+C å¼ºåˆ¶å…³é—­
   - ç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µ
   - ä»»åŠ¡ç®¡ç†å™¨å¼ºåˆ¶ç»“æŸè¿›ç¨‹

2. **å¤šä¸ªå®ä¾‹åŒæ—¶è¿è¡Œ**
   - é‡å¤å¯åŠ¨åº”ç”¨
   - ä¸Šä¸€ä¸ªå®ä¾‹æœªå®Œå…¨å…³é—­

3. **æ–‡ä»¶ç³»ç»Ÿæƒé™é—®é¢˜**
   - æ²¡æœ‰å†™æƒé™
   - æ–‡ä»¶è¢«å…¶ä»–ç¨‹åºå ç”¨

---

## âœ… é¢„é˜²æªæ–½

### 1. æ­£ç¡®åœæ­¢åº”ç”¨

**æ¨èæ–¹å¼**:
```batch
# ä½¿ç”¨åœæ­¢è„šæœ¬
stop.bat
```

**ä¸æ¨èæ–¹å¼**:
- âŒ ç›´æ¥å…³é—­å‘½ä»¤çª—å£
- âŒ ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨ç»“æŸè¿›ç¨‹
- âŒ æŒ‰ Ctrl+Cï¼ˆé™¤éå¿…è¦ï¼‰

---

### 2. æ£€æŸ¥è¿è¡ŒçŠ¶æ€

å¯åŠ¨å‰æ£€æŸ¥æ˜¯å¦å·²æœ‰å®ä¾‹åœ¨è¿è¡Œï¼š

```batch
# æŸ¥çœ‹Javaè¿›ç¨‹
tasklist | findstr java

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :8080
```

---

### 3. ä½¿ç”¨æ­£ç¡®çš„å¯åŠ¨é¡ºåº

```
1. stop.bat      # ç¡®ä¿æ²¡æœ‰æ—§å®ä¾‹
2. fix-lock.bat  # æ¸…ç†å¯èƒ½çš„é”æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
3. start.bat     # å¯åŠ¨æ–°å®ä¾‹
```

---

## ğŸ”§ ä»£ç çº§ä¿®å¤

æ–°ç‰ˆæœ¬å·²åŒ…å«è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ï¼š

```java
// LuceneIndexEngine åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ¸…ç†æ—§é”
Path lockFile = indexDir.resolve("write.lock");
if (Files.exists(lockFile)) {
    Files.delete(lockFile);
    log.info("Removed stale lock file");
}
```

---

## ğŸ“ ä»ç„¶æ— æ³•è§£å†³ï¼Ÿ

### æ£€æŸ¥æ¸…å•

- [ ] æ˜¯å¦æœ‰å¤šä¸ªå®ä¾‹åœ¨è¿è¡Œï¼Ÿ
  ```batch
  tasklist | findstr /i "java.*ai-reviewer"
  ```

- [ ] æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ–‡ä»¶æƒé™ï¼Ÿ
  ```batch
  # å³é”® release æ–‡ä»¶å¤¹ â†’ å±æ€§ â†’ å®‰å…¨
  ```

- [ ] é”æ–‡ä»¶æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼Ÿ
  ```batch
  # ä½¿ç”¨ Process Explorer æŸ¥çœ‹
  ```

- [ ] ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Ÿ
  ```batch
  dir data\knowledge-base
  ```

---

### ç»ˆæè§£å†³æ–¹æ¡ˆ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ•ˆï¼š

1. **å®Œå…¨æ¸…ç†**
   ```batch
   stop.bat
   rmdir /s /q data
   ```

2. **é‡æ–°å¯åŠ¨**
   ```batch
   start.bat
   ```

3. **é‡æ–°ç´¢å¼•æ–‡æ¡£**
   - åº”ç”¨ä¼šè‡ªåŠ¨æ‰«æ `data/documents/` ç›®å½•
   - é‡æ–°æ„å»ºçŸ¥è¯†åº“

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `fix-lock.bat` - è‡ªåŠ¨ä¿®å¤è„šæœ¬
- `stop.bat` - åœæ­¢è„šæœ¬ï¼ˆå·²å¢å¼ºï¼Œè‡ªåŠ¨æ¸…ç†é”ï¼‰
- `README.md` - è¯¦ç»†æ–‡æ¡£

---

<div align="center">

**é—®é¢˜å·²è§£å†³ï¼Ÿ**

è¯·ä½¿ç”¨ `start.bat` å¯åŠ¨åº”ç”¨

å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `logs/knowledge-qa-system.log`

</div>

