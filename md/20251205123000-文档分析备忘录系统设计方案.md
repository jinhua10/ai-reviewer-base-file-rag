# æ–‡æ¡£åˆ†æå¤‡å¿˜å½•ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-05 12:30:00  
> **çŠ¶æ€**: å¾… Review

---

## 1. é—®é¢˜åˆ†æ

### 1.1 å½“å‰é—®é¢˜

å½“å‰æ–‡æ¡£æ¸è¿›å¼åˆ†æå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

| é—®é¢˜ | æè¿° | å½±å“ |
|------|------|------|
| è®°å¿†å®¹é‡æœ‰é™ | åªä¿ç•™æœ€è¿‘å‡ ä¸ªç‰‡æ®µçš„å…³é”®ç‚¹ | æ—©æœŸå†…å®¹è¢«é—å¿˜ |
| ä¿¡æ¯ä¸¢å¤± | æ—©æœŸæ–‡æ¡£ç‰‡æ®µçš„è¯¦ç»†å†…å®¹åœ¨åˆ†æåæœŸå¯èƒ½è¢«é—å¿˜ | æœ€ç»ˆæ€»ç»“ä¸å®Œæ•´ |
| ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ | LLM çš„ prompt ä¸èƒ½æ— é™é•¿ | éœ€è¦æ™ºèƒ½å‹ç¼© |
| ç¼ºä¹å…³è”åˆ†æ | æ— æ³•å°†å½“å‰å†…å®¹ä¸æ—©æœŸç›¸å…³å†…å®¹å…³è” | åˆ†æä¸å¤Ÿæ·±å…¥ |

### 1.2 é€‚ç”¨åœºæ™¯

æœ¬æ–¹æ¡ˆé€‚ç”¨äºä»¥ä¸‹æ–‡æ¡£ç±»å‹çš„æ¸è¿›å¼åˆ†æï¼š

| æ–‡æ¡£ç±»å‹ | åˆ†æå•ä½ | ç‰¹ç‚¹ |
|----------|----------|------|
| **PPT/PPTX** | å¹»ç¯ç‰‡ | ç»“æ„åŒ–ã€å›¾æ–‡æ··åˆ |
| **PDF** | é¡µé¢/ç« èŠ‚ | é•¿æ–‡æ¡£ã€æ’ç‰ˆå¤æ‚ |
| **Word/DOCX** | æ®µè½/ç« èŠ‚ | ç»“æ„åŒ–æ–‡æœ¬ |
| **Markdown** | ç« èŠ‚/æ ‡é¢˜å— | å±‚çº§åˆ†æ˜ |
| **é•¿æ–‡æœ¬** | å›ºå®šé•¿åº¦ç‰‡æ®µ | éœ€è¦æ™ºèƒ½åˆ†å‰² |
| **ä»£ç æ–‡ä»¶** | å‡½æ•°/ç±»/æ¨¡å— | ç»“æ„åŒ–ã€ä¾èµ–å…³ç³» |

### 1.3 ç›®æ ‡

1. **ä¸ä¸¢å¤±å…³é”®ç»†èŠ‚**ï¼šæ‰€æœ‰æ–‡æ¡£ç‰‡æ®µçš„é‡è¦ä¿¡æ¯éƒ½åº”è¢«ä¿ç•™
2. **æ™ºèƒ½å¬å›**ï¼šåœ¨éœ€è¦æ—¶èƒ½å¤Ÿæ‰¾åˆ°ç›¸å…³çš„å†å²å†…å®¹
3. **é«˜æ•ˆå‹ç¼©**ï¼šåœ¨æœ‰é™çš„ token é¢„ç®—å†…æœ€å¤§åŒ–ä¿¡æ¯å¯†åº¦
4. **æ— ç¼é›†æˆ**ï¼šä¸ç°æœ‰åˆ†ææµç¨‹å¹³æ»‘æ•´åˆ
5. **é€šç”¨æ€§**ï¼šæ”¯æŒå¤šç§æ–‡æ¡£ç±»å‹

---

## 2. æ–¹æ¡ˆè®¾è®¡

### 2.1 æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ–‡æ¡£åˆ†ææµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚   æ–‡æ¡£è§£æå™¨     â”‚  æ”¯æŒ: PPT, PDF, Word, Markdown, ä»£ç ç­‰    â”‚
â”‚  â”‚ DocumentParser  â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚           â”‚                                                     â”‚
â”‚           v                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å½“å‰ç‰‡æ®µ     â”‚ -> â”‚  çŸ­æœŸè®°å¿†     â”‚ -> â”‚   é•¿æœŸå¤‡å¿˜å½•   â”‚      â”‚
â”‚  â”‚ (å®Œæ•´å†…å®¹)   â”‚    â”‚ (æœ€è¿‘Nä¸ªè¦ç‚¹) â”‚    â”‚  (å…¨éƒ¨å‹ç¼©ç‰ˆ)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                    â”‚              â”‚
â”‚         v                  v                    v              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æ™ºèƒ½å¬å›å¼•æ“                          â”‚   â”‚
â”‚  â”‚  æ ¹æ®å½“å‰å†…å®¹ç›¸å…³æ€§ï¼Œä»å¤‡å¿˜å½•ä¸­æå–ç›¸å…³ç»†èŠ‚               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                           v                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Prompt ç»„è£…å™¨                         â”‚   â”‚
â”‚  â”‚  å½“å‰å†…å®¹ + çŸ­æœŸè®°å¿† + å¬å›çš„å¤‡å¿˜å½•æ¡ç›®                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åˆ†å±‚è®°å¿†æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è®°å¿†å±‚æ¬¡ç»“æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Layer 1: å·¥ä½œè®°å¿†ï¼ˆå½“å‰ç‰‡æ®µï¼‰                              â”‚
â”‚  â”œâ”€â”€ å®Œæ•´çš„åŸå§‹å†…å®¹                                        â”‚
â”‚  â”œâ”€â”€ å›¾ç‰‡/è¡¨æ ¼æè¿°ï¼ˆå¦‚æœ‰ï¼‰                                 â”‚
â”‚  â””â”€â”€ é¢„ç•™ Token: ~1500                                     â”‚
â”‚                                                            â”‚
â”‚  Layer 2: çŸ­æœŸè®°å¿†ï¼ˆæœ€è¿‘ N ä¸ªç‰‡æ®µï¼‰                         â”‚
â”‚  â”œâ”€â”€ å®Œæ•´çš„å…³é”®ç‚¹                                          â”‚
â”‚  â”œâ”€â”€ ä¿æŒç»†èŠ‚å®Œæ•´æ€§                                        â”‚
â”‚  â””â”€â”€ é¢„ç•™ Token: ~1000                                     â”‚
â”‚                                                            â”‚
â”‚  Layer 3: é•¿æœŸå¤‡å¿˜å½•ï¼ˆæ‰€æœ‰å†å²ï¼‰                            â”‚
â”‚  â”œâ”€â”€ å‹ç¼©åçš„æ‘˜è¦                                          â”‚
â”‚  â”œâ”€â”€ å…³é”®è¯ç´¢å¼•                                            â”‚
â”‚  â”œâ”€â”€ æŒ‰éœ€å¬å›                                              â”‚
â”‚  â””â”€â”€ é¢„ç•™ Token: ~800                                      â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 å¤‡å¿˜å½•åˆ†å±‚å¤„ç†ä¸é˜¶æ®µæ€§è¾“å‡º

#### 2.4.1 é—®é¢˜åœºæ™¯

å½“æ–‡æ¡£è¾ƒå¤§æ—¶ï¼Œå³ä½¿å¤‡å¿˜å½•ä¸­çš„å†…å®¹å·²ç»å‹ç¼©ï¼Œæœ€ç»ˆæ€»ç»“æ—¶ä»å¯èƒ½é¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š

| é—®é¢˜ | åœºæ™¯ | å½±å“ |
|------|------|------|
| å¤‡å¿˜å½•æ¡ç›®è¿‡å¤š | 100é¡µ PDF äº§ç”Ÿ 100 æ¡å¤‡å¿˜å½• | æ— æ³•ä¸€æ¬¡æ€§å–‚ç»™ LLM |
| ç‹¬ç«‹ç‰‡æ®µè¢«åŸ‹æ²¡ | æŸä¸ªé‡è¦ä½†ç‹¬ç«‹çš„è§‚ç‚¹ | æœ€ç»ˆæ€»ç»“æ—¶è¢«é—æ¼ |
| é‡å¤å¤„ç†æµªè´¹ | å·²è¶³å¤Ÿç²¾ç®€çš„å†…å®¹å†æ¬¡å‹ç¼© | ä¿¡æ¯æŸå¤±ã€æ•ˆç‡ä½ |
| ç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿ | å¿…é¡»ç­‰æ•´ä¸ªæ–‡æ¡£åˆ†æå®Œ | ç”¨æˆ·ä½“éªŒå·® |

#### 2.4.2 è§£å†³æ–¹æ¡ˆï¼šåˆ†å±‚å¤‡å¿˜å½• + é˜¶æ®µæ€§è¾“å‡º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åˆ†å±‚å¤‡å¿˜å½•æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Layer 0: åŸå§‹å¤‡å¿˜å½• (Raw Memos)                          â”‚   â”‚
â”‚  â”‚ - æ¯ä¸ªç‰‡æ®µçš„å‹ç¼©æ‘˜è¦                                     â”‚   â”‚
â”‚  â”‚ - ä¿ç•™æ‰€æœ‰ç»†èŠ‚                                           â”‚   â”‚
â”‚  â”‚ - æ¡ç›®æ•° = ç‰‡æ®µæ•°                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                           v (å½“æ¡ç›®æ•° > é˜ˆå€¼æ—¶è§¦å‘)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Layer 1: ç« èŠ‚æ‘˜è¦ (Section Summaries)                    â”‚   â”‚
â”‚  â”‚ - å°†ç›¸é‚»/ç›¸å…³çš„å¤‡å¿˜å½•èšåˆ                                â”‚   â”‚
â”‚  â”‚ - ç”Ÿæˆç« èŠ‚çº§åˆ«çš„æ‘˜è¦                                     â”‚   â”‚
â”‚  â”‚ - æ ‡è®°ç‹¬ç«‹é‡è¦æ¡ç›®ï¼ˆä¸èšåˆï¼‰                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                           v (å¯é€‰ï¼Œè¶…å¤§æ–‡æ¡£)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Layer 2: ä¸»é¢˜æ‘˜è¦ (Topic Summaries)                      â”‚   â”‚
â”‚  â”‚ - æŒ‰ä¸»é¢˜/å…³é”®è¯èšç±»                                      â”‚   â”‚
â”‚  â”‚ - ç”Ÿæˆä¸»é¢˜çº§åˆ«çš„æ‘˜è¦                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                           v                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æœ€ç»ˆæ€»ç»“è¾“å…¥                                             â”‚   â”‚
â”‚  â”‚ = ç« èŠ‚æ‘˜è¦ + ç‹¬ç«‹é‡è¦æ¡ç›® + ä¸»é¢˜æ‘˜è¦                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.3 æ™ºèƒ½èšåˆç­–ç•¥

```java
/**
 * å¤‡å¿˜å½•èšåˆç­–ç•¥
 */
public enum MemoAggregationStrategy {
    /**
     * é¡ºåºèšåˆï¼šæŒ‰æ–‡æ¡£é¡ºåºå°†ç›¸é‚» N ä¸ªå¤‡å¿˜å½•åˆå¹¶
     * é€‚ç”¨äºï¼šçº¿æ€§å™è¿°çš„æ–‡æ¡£ï¼ˆå¦‚æŠ¥å‘Šã€è®ºæ–‡ï¼‰
     */
    SEQUENTIAL,
    
    /**
     * ä¸»é¢˜èšåˆï¼šæŒ‰å…³é”®è¯/ä¸»é¢˜ç›¸ä¼¼åº¦èšç±»
     * é€‚ç”¨äºï¼šä¸»é¢˜åˆ†æ•£çš„æ–‡æ¡£ï¼ˆå¦‚ä¼šè®®è®°å½•ã€FAQï¼‰
     */
    TOPIC_BASED,
    
    /**
     * ç»“æ„èšåˆï¼šæŒ‰æ–‡æ¡£ç»“æ„ï¼ˆç« èŠ‚ã€æ ‡é¢˜å±‚çº§ï¼‰èšåˆ
     * é€‚ç”¨äºï¼šç»“æ„åŒ–æ–‡æ¡£ï¼ˆå¦‚æŠ€æœ¯æ–‡æ¡£ã€æ‰‹å†Œï¼‰
     */
    STRUCTURAL,
    
    /**
     * æ··åˆèšåˆï¼šå…ˆç»“æ„ï¼Œå†ä¸»é¢˜
     * é€‚ç”¨äºï¼šå¤æ‚æ–‡æ¡£
     */
    HYBRID
}
```

#### 2.4.4 ç‹¬ç«‹æ¡ç›®æ ‡è®°

æŸäº›å¤‡å¿˜å½•æ¡ç›®åº”ä¿æŒç‹¬ç«‹ï¼Œä¸å‚ä¸èšåˆï¼š

```java
/**
 * ç‹¬ç«‹æ¡ç›®åˆ¤æ–­æ ‡å‡†
 */
public class IndependentMemoDetector {
    
    /**
     * åˆ¤æ–­æ˜¯å¦ä¸ºç‹¬ç«‹é‡è¦æ¡ç›®
     */
    public boolean isIndependent(MemoEntry entry) {
        return 
            // 1. é‡è¦æ€§è¯„åˆ†é«˜äºé˜ˆå€¼
            entry.getImportance() > 0.8 ||
            
            // 2. åŒ…å«å…³é”®æ•°æ®ï¼ˆæ•°å­—ã€æ—¥æœŸã€é‡‘é¢ï¼‰
            containsCriticalData(entry) ||
            
            // 3. åŒ…å«ç»“è®ºæ€§å…³é”®è¯
            containsConclusionKeywords(entry) ||
            
            // 4. ä¸å…¶ä»–æ¡ç›®ä¸»é¢˜å·®å¼‚å¤§
            isTopicOutlier(entry) ||
            
            // 5. ç”¨æˆ·æ ‡è®°ä¸ºé‡è¦
            entry.isUserMarked();
    }
}
```

#### 2.4.5 é˜¶æ®µæ€§è¾“å‡ºæœºåˆ¶

ä¸å¿…ç­‰æ•´ä¸ªæ–‡æ¡£åˆ†æå®Œï¼Œå¯ä»¥**è¾¹åˆ†æè¾¹è¾“å‡º**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µæ€§è¾“å‡ºæµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  é˜¶æ®µ 1: å®æ—¶ç‰‡æ®µåˆ†æ                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ¯åˆ†æå®Œä¸€ä¸ªç‰‡æ®µ -> è¾“å‡ºè¯¥ç‰‡æ®µçš„åˆ†æç»“æœ                   â”‚   â”‚
â”‚  â”‚ ç”¨æˆ·å¯ä»¥ï¼š                                                â”‚   â”‚
â”‚  â”‚ - å®æ—¶æŸ¥çœ‹è¿›åº¦                                            â”‚   â”‚
â”‚  â”‚ - æ ‡è®°é‡è¦å†…å®¹                                            â”‚   â”‚
â”‚  â”‚ - æå‡ºè¿½é—®                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                           v                                    â”‚
â”‚  é˜¶æ®µ 2: ä¸­æœŸé˜¶æ®µæ€»ç»“ï¼ˆå¯é€‰ï¼Œæ¯ N ä¸ªç‰‡æ®µè§¦å‘ï¼‰                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å½“åˆ†æè¾¾åˆ° 25%ã€50%ã€75% æ—¶ -> è¾“å‡ºé˜¶æ®µæ€§æ€»ç»“              â”‚   â”‚
â”‚  â”‚ åŒ…å«ï¼š                                                    â”‚   â”‚
â”‚  â”‚ - ç›®å‰å‘ç°çš„ä¸»è¦è§‚ç‚¹                                      â”‚   â”‚
â”‚  â”‚ - å…³é”®æ•°æ®æ±‡æ€»                                            â”‚   â”‚
â”‚  â”‚ - å¾…ç¡®è®¤/å¾…æ·±å…¥çš„é—®é¢˜                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                           v                                    â”‚
â”‚  é˜¶æ®µ 3: å¤‡å¿˜å½•æ–‡æ¡£åŒ–è¾“å‡º                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åˆ†æå®Œæˆå -> ç”Ÿæˆç»“æ„åŒ–çš„å¤‡å¿˜å½•æ–‡æ¡£                       â”‚   â”‚
â”‚  â”‚ æ ¼å¼ï¼šMarkdown / JSON / æ€ç»´å¯¼å›¾                          â”‚   â”‚
â”‚  â”‚ ç”¨æˆ·å¯ä»¥ï¼š                                                â”‚   â”‚
â”‚  â”‚ - ç›´æ¥ä½¿ç”¨å¤‡å¿˜å½•æ–‡æ¡£                                      â”‚   â”‚
â”‚  â”‚ - é€‰æ‹©æ€§æ·±å…¥åˆ†ææŸäº›éƒ¨åˆ†                                  â”‚   â”‚
â”‚  â”‚ - åŸºäºå¤‡å¿˜å½•æå‡ºæ–°é—®é¢˜                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                           v                                    â”‚
â”‚  é˜¶æ®µ 4: æœ€ç»ˆç»¼åˆæ€»ç»“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”¨æˆ·ç¡®è®¤å -> åŸºäºå¤‡å¿˜å½•ç”Ÿæˆæœ€ç»ˆæ€»ç»“                       â”‚   â”‚
â”‚  â”‚ å¦‚æœå¤‡å¿˜å½•å·²è¶³å¤Ÿç²¾ç®€ -> ç›´æ¥æ±‡æ€»ï¼Œè·³è¿‡å†æ¬¡å‹ç¼©             â”‚   â”‚
â”‚  â”‚ å¦‚æœå¤‡å¿˜å½•è¿‡å¤š -> å…ˆèšåˆå†æ€»ç»“                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.6 å¤‡å¿˜å½•æ–‡æ¡£åŒ–

å°†å¤‡å¿˜å½•å¯¼å‡ºä¸ºç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨çš„æ–‡æ¡£ï¼š

```markdown
# ğŸ“‹ æ–‡æ¡£åˆ†æå¤‡å¿˜å½•

> æ–‡æ¡£: äº§å“å‘å¸ƒè®¡åˆ’.pptx
> åˆ†ææ—¶é—´: 2025-12-05 12:30
> ç‰‡æ®µæ•°: 20 å¼ å¹»ç¯ç‰‡
> ç”¨æˆ·é—®é¢˜: è¯·æ€»ç»“è¿™ä»½æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹

---

## ğŸ“Š æ•´ä½“æ¦‚è§ˆ

- **ä¸»è¦ä¸»é¢˜**: äº§å“å‘å¸ƒè®¡åˆ’ã€å¸‚åœºåˆ†æã€æŠ€æœ¯æ¶æ„
- **å…³é”®æ•°æ®**: å¸‚åœºè§„æ¨¡ 1000äº¿ã€å¢é•¿ç‡ 15%ã€Q2 ä¸Šçº¿
- **æ ¸å¿ƒç»“è®º**: å»ºè®®åˆ†ä¸‰é˜¶æ®µå®æ–½ï¼Œé¢„è®¡ ROI 200%

---

## ğŸ”– ç« èŠ‚æ‘˜è¦

### ç¬¬ä¸€éƒ¨åˆ†ï¼šèƒŒæ™¯ä¸ç›®æ ‡ï¼ˆå¹»ç¯ç‰‡ 1-5ï¼‰
- é¡¹ç›®èµ·æºäº 2024 å¹´ä¼ä¸šæ•°å­—åŒ–è½¬å‹éœ€æ±‚
- ç›®æ ‡ç”¨æˆ·ï¼šä¸­å¤§å‹ä¼ä¸š IT éƒ¨é—¨
- æ ¸å¿ƒç›®æ ‡ï¼šé™æœ¬å¢æ•ˆã€å¿«é€Ÿè¿­ä»£

### ç¬¬äºŒéƒ¨åˆ†ï¼šå¸‚åœºåˆ†æï¼ˆå¹»ç¯ç‰‡ 6-10ï¼‰
- å…¨çƒå¸‚åœºè§„æ¨¡ 1000 äº¿ç¾å…ƒ
- å¹´å¤åˆå¢é•¿ç‡ 15%
- ä¸»è¦ç«äº‰å¯¹æ‰‹ï¼šAã€Bã€C

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ–¹æ¡ˆè®¾è®¡ï¼ˆå¹»ç¯ç‰‡ 11-15ï¼‰
...

---

## â­ ç‹¬ç«‹é‡è¦æ¡ç›®

> ä»¥ä¸‹å†…å®¹ç‹¬ç«‹æ€§å¼ºï¼Œå»ºè®®å•ç‹¬å…³æ³¨

### ã€ç¬¬ 8 å¼ ã€‘å…³é”®å†³ç­–ç‚¹
- æŠ€æœ¯é€‰å‹ï¼šé€‰æ‹© Kubernetes è€Œé Docker Swarm
- åŸå› ï¼šç¤¾åŒºæ´»è·ƒã€ç”Ÿæ€å®Œå–„ã€ä¼ä¸šæ”¯æŒ

### ã€ç¬¬ 15 å¼ ã€‘é£é™©æç¤º
- é£é™© 1ï¼šäººæ‰çŸ­ç¼ºï¼Œå»ºè®®æå‰æ‹›è˜
- é£é™© 2ï¼šç«å“åŠ¨æ€ï¼Œéœ€æŒç»­ç›‘æ§

---

## ğŸ” å¾…æ·±å…¥åˆ†æ

ä»¥ä¸‹å†…å®¹å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ¢è®¨ï¼š
1. ç¬¬ 12 å¼ æåˆ°çš„"æŠ€æœ¯å€ºåŠ¡"å…·ä½“æŒ‡ä»€ä¹ˆï¼Ÿ
2. ROI 200% çš„è®¡ç®—ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ
3. ç«å“ A çš„å…·ä½“ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ

---

## ğŸ“ åŸå§‹å¤‡å¿˜å½•

<details>
<summary>ç‚¹å‡»å±•å¼€å®Œæ•´å¤‡å¿˜å½•ï¼ˆ20 æ¡ï¼‰</summary>

### å¹»ç¯ç‰‡ 1: å°é¢
- æ ‡é¢˜ï¼š2025 äº§å“å‘å¸ƒè®¡åˆ’
- æ—¥æœŸï¼š2025-01

### å¹»ç¯ç‰‡ 2: é¡¹ç›®èƒŒæ™¯
- èµ·æºï¼š2024å¹´ä¼ä¸šæ•°å­—åŒ–è½¬å‹
- ç—›ç‚¹ï¼šæ•ˆç‡ä½ã€æˆæœ¬é«˜
...

</details>
```

#### 2.4.7 è·³è¿‡é‡å¤å¤„ç†çš„åˆ¤æ–­

```java
/**
 * åˆ¤æ–­æ˜¯å¦å¯ä»¥è·³è¿‡å†æ¬¡å¤„ç†
 */
public class ProcessingSkipDecision {
    
    /**
     * åˆ¤æ–­å¤‡å¿˜å½•æ˜¯å¦å·²è¶³å¤Ÿç²¾ç®€
     */
    public boolean canSkipReprocessing(MemoEntry entry) {
        // 1. Token æ•°å·²ä½äºé˜ˆå€¼
        if (entry.getCompressedTokens() < MIN_TOKENS_THRESHOLD) {
            return true;
        }
        
        // 2. å‹ç¼©æ¯”å·²è¾¾åˆ°ç›®æ ‡
        double ratio = (double) entry.getCompressedTokens() / entry.getOriginalTokens();
        if (ratio < TARGET_COMPRESSION_RATIO) {
            return true;
        }
        
        // 3. å†…å®¹å·²æ˜¯ç»“æ„åŒ–è¦ç‚¹å½¢å¼
        if (isStructuredBulletPoints(entry.getCompressedContent())) {
            return true;
        }
        
        // 4. å·²ç»è¿‡å¤šè½®å‹ç¼©
        if (entry.getCompressionCount() >= MAX_COMPRESSION_ROUNDS) {
            return true;
        }
        
        return false;
    }
    
    /**
     * åˆ¤æ–­æ•´ä¸ªå¤‡å¿˜å½•é›†åˆæ˜¯å¦å¯ä»¥ç›´æ¥ç”¨äºæ€»ç»“
     */
    public boolean canDirectlySummarize(List<MemoEntry> memos, int tokenBudget) {
        int totalTokens = memos.stream()
            .mapToInt(MemoEntry::getCompressedTokens)
            .sum();
        
        // æ€» Token æ•°åœ¨é¢„ç®—å†…ï¼Œå¯ä»¥ç›´æ¥æ±‡æ€»
        return totalTokens <= tokenBudget;
    }
}
```

### 2.3 æ–‡æ¡£ç‰‡æ®µæŠ½è±¡

```java
/**
 * æ–‡æ¡£ç‰‡æ®µ - ç»Ÿä¸€æŠ½è±¡ä¸åŒæ–‡æ¡£ç±»å‹çš„åˆ†æå•ä½
 */
@Data
@Builder
public class DocumentSegment {
    /** ç‰‡æ®µå”¯ä¸€æ ‡è¯† */
    private String id;
    
    /** ç‰‡æ®µåºå·ï¼ˆä»1å¼€å§‹ï¼‰ */
    private int index;
    
    /** ç‰‡æ®µç±»å‹ */
    private SegmentType type;
    
    /** ç‰‡æ®µæ ‡é¢˜/åç§° */
    private String title;
    
    /** æ–‡æœ¬å†…å®¹ */
    private String textContent;
    
    /** å›¾ç‰‡åˆ—è¡¨ï¼ˆBase64 æˆ– URLï¼‰ */
    private List<String> images;
    
    /** è¡¨æ ¼æ•°æ® */
    private List<TableData> tables;
    
    /** ä»£ç å—ï¼ˆå¦‚æœæ˜¯ä»£ç æ–‡ä»¶ï¼‰ */
    private List<CodeBlock> codeBlocks;
    
    /** å…ƒæ•°æ® */
    private Map<String, Object> metadata;
    
    /** çˆ¶ç‰‡æ®µIDï¼ˆç”¨äºå±‚çº§ç»“æ„ï¼‰ */
    private String parentId;
    
    /** å­ç‰‡æ®µIDåˆ—è¡¨ */
    private List<String> childIds;
}

/**
 * ç‰‡æ®µç±»å‹æšä¸¾
 */
public enum SegmentType {
    // PPT
    SLIDE,              // å¹»ç¯ç‰‡
    
    // PDF/Word
    PAGE,               // é¡µé¢
    CHAPTER,            // ç« èŠ‚
    SECTION,            // å°èŠ‚
    PARAGRAPH,          // æ®µè½
    
    // Markdown
    HEADING_BLOCK,      // æ ‡é¢˜å—
    
    // ä»£ç 
    FILE,               // æ–‡ä»¶
    CLASS,              // ç±»
    FUNCTION,           // å‡½æ•°/æ–¹æ³•
    MODULE,             // æ¨¡å—
    
    // é€šç”¨
    TEXT_CHUNK,         // æ–‡æœ¬å—ï¼ˆå›ºå®šé•¿åº¦åˆ†å‰²ï¼‰
    TABLE,              // è¡¨æ ¼
    IMAGE,              // å›¾ç‰‡
    LIST,               // åˆ—è¡¨
}
```

---

## 3. æ•°æ®ç»“æ„è®¾è®¡

### 3.1 å¤‡å¿˜å½•æ¡ç›®

```java
/**
 * å¤‡å¿˜å½•æ¡ç›® - å­˜å‚¨å•ä¸ªæ–‡æ¡£ç‰‡æ®µçš„åˆ†æç»“æœ
 */
@Data
@Builder
public class MemoEntry {
    /** ç‰‡æ®µç¼–å·/ç´¢å¼• */
    private int segmentIndex;
    
    /** ç‰‡æ®µç±»å‹ */
    private SegmentType segmentType;
    
    /** ç‰‡æ®µæ ‡é¢˜ */
    private String title;
    
    /** åŸå§‹å†…å®¹ï¼ˆå®Œæ•´ç‰ˆï¼‰ */
    private String originalContent;
    
    /** å‹ç¼©åå†…å®¹ï¼ˆæ‘˜è¦ç‰ˆï¼‰ */
    private String compressedContent;
    
    /** å…³é”®è¯åˆ—è¡¨ï¼ˆç”¨äºå¬å›åŒ¹é…ï¼‰ */
    private List<String> keywords;
    
    /** å‘½åå®ä½“ï¼ˆäººåã€åœ°åã€ç»„ç»‡ç­‰ï¼‰ */
    private List<String> namedEntities;
    
    /** é‡è¦æ€§è¯„åˆ† (0.0 - 1.0) */
    private double importance;
    
    /** æ˜¯å¦å·²å‹ç¼© */
    private boolean compressed;
    
    /** åŸå§‹ Token æ•° */
    private int originalTokens;
    
    /** å‹ç¼©å Token æ•° */
    private int compressedTokens;
    
    /** åˆ›å»ºæ—¶é—´ */
    private Instant createdAt;
    
    /** æœ€åè®¿é—®æ—¶é—´ï¼ˆç”¨äº LRUï¼‰ */
    private Instant lastAccessedAt;
    
    /** æ¥æºæ–‡æ¡£ä¿¡æ¯ */
    private DocumentSource source;
    
    // ==================== æ–°å¢ï¼šåˆ†å±‚å¤„ç†æ”¯æŒ ====================
    
    /** å‹ç¼©æ¬¡æ•°ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦è·³è¿‡å†æ¬¡å¤„ç†ï¼‰ */
    private int compressionCount;
    
    /** æ˜¯å¦ä¸ºç‹¬ç«‹é‡è¦æ¡ç›®ï¼ˆä¸å‚ä¸èšåˆï¼‰ */
    private boolean independent;
    
    /** ç”¨æˆ·æ˜¯å¦æ ‡è®°ä¸ºé‡è¦ */
    private boolean userMarked;
    
    /** æ‰€å±èšåˆç»„IDï¼ˆå¦‚æœå·²è¢«èšåˆï¼‰ */
    private String aggregationGroupId;
    
    /** èšåˆå±‚çº§ (0=åŸå§‹, 1=ç« èŠ‚æ‘˜è¦, 2=ä¸»é¢˜æ‘˜è¦) */
    private int aggregationLevel;
    
    /** å†…å®¹å½¢å¼æ ‡è®° */
    private ContentForm contentForm;
}

/**
 * å†…å®¹å½¢å¼æšä¸¾ - ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦å†æ¬¡å¤„ç†
 */
public enum ContentForm {
    /** åŸå§‹æ–‡æœ¬ - éœ€è¦å‹ç¼© */
    RAW_TEXT,
    
    /** ç»“æ„åŒ–è¦ç‚¹ - å·²ç²¾ç®€ï¼Œå¯èƒ½è·³è¿‡å¤„ç† */
    STRUCTURED_BULLETS,
    
    /** å…³é”®æ•°æ® - æ•°å­—/æ—¥æœŸä¸ºä¸»ï¼Œä¿æŒåŸæ · */
    KEY_DATA,
    
    /** ä»£ç /å…¬å¼ - ç‰¹æ®Šæ ¼å¼ï¼Œè°¨æ…å¤„ç† */
    CODE_OR_FORMULA,
    
    /** å·²èšåˆæ‘˜è¦ - ä¸Šå±‚æ‘˜è¦ */
    AGGREGATED_SUMMARY
}

/**
 * æ–‡æ¡£æ¥æºä¿¡æ¯
 */
@Data
@Builder
public class DocumentSource {
    /** æ–‡æ¡£ç±»å‹ */
    private String documentType;  // ppt, pdf, word, markdown, code
    
    /** æ–‡æ¡£åç§° */
    private String documentName;
    
    /** æ–‡æ¡£è·¯å¾„ */
    private String documentPath;
    
    /** æ€»ç‰‡æ®µæ•° */
    private int totalSegments;
}
```

### 3.2 å¤‡å¿˜å½•ç®¡ç†å™¨

```java
/**
 * æ–‡æ¡£å¤‡å¿˜å½•ç®¡ç†å™¨
 * 
 * èŒè´£ï¼š
 * 1. ç®¡ç†çŸ­æœŸè®°å¿†å’Œé•¿æœŸå¤‡å¿˜å½•
 * 2. æ§åˆ¶å†…å®¹å‹ç¼©æ—¶æœº
 * 3. å®ç°æ™ºèƒ½å¬å›
 * 4. Token é¢„ç®—ç®¡ç†
 * 5. æ”¯æŒå¤šç§æ–‡æ¡£ç±»å‹
 */
public class DocumentMemoManager {
    
    // ==================== é…ç½® ====================
    
    /** çŸ­æœŸè®°å¿†å®¹é‡ï¼ˆå¯æŒ‰æ–‡æ¡£ç±»å‹é…ç½®ï¼‰ */
    private final Map<SegmentType, Integer> shortTermCapacityByType;
    
    /** é»˜è®¤çŸ­æœŸè®°å¿†å®¹é‡ */
    private final int defaultShortTermCapacity;
    
    /** é•¿æœŸå¤‡å¿˜å½•æœ€å¤§æ¡ç›®æ•° */
    private final int longTermMaxEntries;
    
    /** å•æ¡å¤‡å¿˜å½•æœ€å¤§ Token æ•° */
    private final int memoEntryMaxTokens;
    
    /** å¬å›ç›¸å…³æ¡ç›®æ•° */
    private final int recallTopK;
    
    /** ç›¸å…³æ€§é˜ˆå€¼ */
    private final double relevanceThreshold;
    
    // ==================== å­˜å‚¨ ====================
    
    /** çŸ­æœŸè®°å¿†ï¼šæœ€è¿‘ N ä¸ªç‰‡æ®µçš„å®Œæ•´è¦ç‚¹ */
    private final LinkedList<MemoEntry> shortTermMemory;
    
    /** é•¿æœŸå¤‡å¿˜å½•ï¼šæ‰€æœ‰ç‰‡æ®µçš„å‹ç¼©ç‰ˆæœ¬ */
    private final List<MemoEntry> longTermMemo;
    
    /** å…³é”®è¯å€’æ’ç´¢å¼•ï¼ˆç”¨äºå¿«é€Ÿå¬å›ï¼‰ */
    private final Map<String, Set<Integer>> keywordIndex;
    
    /** å‘½åå®ä½“ç´¢å¼•ï¼ˆç”¨äºå®ä½“å…³è”ï¼‰ */
    private final Map<String, Set<Integer>> entityIndex;
    
    // ==================== ä¾èµ– ====================
    
    /** LLM å®¢æˆ·ç«¯ï¼ˆç”¨äºå‹ç¼©ï¼‰ */
    private final LLMClient llmClient;
    
    /** Token ä¼°ç®—å™¨ */
    private final TokenEstimator tokenEstimator;
    
    /** å…³é”®è¯æå–å™¨ */
    private final KeywordExtractor keywordExtractor;
}
```

### 3.3 Token é¢„ç®—é…ç½®

```java
/**
 * Prompt Token é¢„ç®—åˆ†é…
 */
@Data
@ConfigurationProperties(prefix = "document-analysis.memo.prompt-budget")
public class PromptBudgetConfig {
    /** æ€»é¢„ç®—ï¼ˆå¯æŒ‰æ¨¡å‹é…ç½®ï¼‰ */
    private int total = 4000;
    
    /** å½“å‰ç‰‡æ®µé¢„ç•™ */
    private int currentSegment = 1500;
    
    /** çŸ­æœŸè®°å¿†é¢„ç•™ */
    private int shortTermMemory = 1000;
    
    /** é•¿æœŸå¬å›é¢„ç•™ */
    private int longTermRecall = 800;
    
    /** æŒ‡ä»¤é¢„ç•™ */
    private int instruction = 500;
    
    /** å®‰å…¨ä½™é‡ */
    private int safetyMargin = 200;
    
    /** æŒ‰æ–‡æ¡£ç±»å‹çš„é¢„ç®—è¦†ç›– */
    private Map<String, PromptBudgetOverride> typeOverrides;
}

/**
 * ç‰¹å®šæ–‡æ¡£ç±»å‹çš„é¢„ç®—è¦†ç›–
 */
@Data
public class PromptBudgetOverride {
    private Integer total;
    private Integer currentSegment;
    private Integer shortTermMemory;
    private Integer longTermRecall;
}
```

---

## 4. æ ¸å¿ƒæµç¨‹

### 4.1 æ–‡æ¡£è§£ææµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ–‡æ¡£è§£ææµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥æ–‡æ¡£
    â”‚
    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ£€æµ‹æ–‡æ¡£ç±»å‹        â”‚
â”‚ - æ ¹æ®æ‰©å±•å           â”‚
â”‚ - æ ¹æ® MIME ç±»å‹       â”‚
â”‚ - æ ¹æ®å†…å®¹ç‰¹å¾         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. é€‰æ‹©è§£æå™¨          â”‚
â”‚ - PPTParser           â”‚
â”‚ - PDFParser           â”‚
â”‚ - WordParser          â”‚
â”‚ - MarkdownParser      â”‚
â”‚ - CodeParser          â”‚
â”‚ - GenericTextParser   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è§£æä¸ºç‰‡æ®µåˆ—è¡¨      â”‚
â”‚ List<DocumentSegment> â”‚
â”‚ ä¿æŒæ–‡æ¡£ç»“æ„           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç‰‡æ®µé¢„å¤„ç†          â”‚
â”‚ - æå–æ–‡æœ¬             â”‚
â”‚ - å¤„ç†å›¾ç‰‡             â”‚
â”‚ - è§£æè¡¨æ ¼             â”‚
â”‚ - è¯†åˆ«ä»£ç å—           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    v
è¿”å›ç‰‡æ®µåˆ—è¡¨
```

### 4.2 å†…å®¹å…¥åº“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…å®¹å…¥åº“æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰‡æ®µ N åˆ†æå®Œæˆ
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æå–å…³é”®ä¿¡æ¯    â”‚
â”‚ - æå–å…³é”®è¯       â”‚
â”‚ - è¯†åˆ«å‘½åå®ä½“     â”‚
â”‚ - è®¡ç®—é‡è¦æ€§è¯„åˆ†   â”‚
â”‚ - ä¼°ç®— Token æ•°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆ›å»ºå¤‡å¿˜å½•æ¡ç›®  â”‚
â”‚ MemoEntry {       â”‚
â”‚   segmentIndex: N â”‚
â”‚   segmentType:... â”‚
â”‚   title: "..."    â”‚
â”‚   content: "..."  â”‚
â”‚   keywords: [...] â”‚
â”‚   entities: [...] â”‚
â”‚   importance: 0.8 â”‚
â”‚ }                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å­˜å…¥çŸ­æœŸè®°å¿†    â”‚
â”‚ shortTermMemory   â”‚
â”‚   .addLast(entry) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ£€æŸ¥çŸ­æœŸè®°å¿†å®¹é‡                â”‚
â”‚ capacity = getCapacity(type)      â”‚
â”‚ if (size > capacity)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€ å¦ â”€â”€> å®Œæˆ
        â”‚
        v (æ˜¯)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. å¼¹å‡ºæœ€æ—§æ¡ç›®    â”‚
â”‚ oldEntry =        â”‚
â”‚   shortTermMemory â”‚
â”‚   .removeFirst()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è°ƒç”¨ LLM å‹ç¼©   â”‚
â”‚ compressed =      â”‚
â”‚   compress(       â”‚
â”‚     oldEntry,     â”‚
â”‚     targetTokens  â”‚
â”‚   )               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å­˜å…¥é•¿æœŸå¤‡å¿˜å½•  â”‚
â”‚ longTermMemo      â”‚
â”‚   .add(compressed)â”‚
â”‚                   â”‚
â”‚ æ›´æ–°ç´¢å¼•ï¼š         â”‚
â”‚ - å…³é”®è¯ç´¢å¼•       â”‚
â”‚ - å‘½åå®ä½“ç´¢å¼•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
      å®Œæˆ
```

### 4.3 å†…å®¹å¬å›æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…å®¹å¬å›æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†æç‰‡æ®µ N æ—¶
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æå–å½“å‰ç‰‡æ®µç‰¹å¾    â”‚
â”‚ - å…³é”®è¯              â”‚
â”‚ - å‘½åå®ä½“            â”‚
â”‚ - ä¸»é¢˜è¯              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å¤šç»´åº¦ç´¢å¼•æŸ¥è¯¢      â”‚
â”‚ - å…³é”®è¯å€’æ’ç´¢å¼•       â”‚
â”‚ - å‘½åå®ä½“ç´¢å¼•         â”‚
â”‚ - ï¼ˆå¯é€‰ï¼‰å‘é‡ç›¸ä¼¼åº¦   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è®¡ç®—ç»¼åˆç›¸å…³æ€§å¾—åˆ†  â”‚
â”‚ for each candidate:   â”‚
â”‚   score = calculate(  â”‚
â”‚     keywordMatch,     â”‚
â”‚     entityMatch,      â”‚
â”‚     importance,       â”‚
â”‚     recency,          â”‚
â”‚     structuralDist    â”‚
â”‚   )                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è¿‡æ»¤ä½ç›¸å…³æ€§æ¡ç›®    â”‚
â”‚ filter(               â”‚
â”‚   score >= threshold  â”‚
â”‚ )                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. é€‰æ‹© Top-K æ¡ç›®     â”‚
â”‚ topK = sortByScore()  â”‚
â”‚   .limit(recallTopK)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Token é¢„ç®—æ£€æŸ¥      â”‚
â”‚ if (totalTokens >     â”‚
â”‚     budgetLimit)      â”‚
â”‚   truncateOrCompress()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. è¿”å›å¬å›ç»“æœ        â”‚
â”‚ return RecallResult { â”‚
â”‚   entries: [...],     â”‚
â”‚   totalTokens: N      â”‚
â”‚ }                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Prompt ç»„è£…æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Prompt ç»„è£…æµç¨‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¼€å§‹ç»„è£… Prompt
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å›ºå®šéƒ¨åˆ†ï¼ˆæŒ‡ä»¤ï¼‰                      â”‚
â”‚ - ç³»ç»Ÿè§’è‰²è¯´æ˜                          â”‚
â”‚ - æ–‡æ¡£ç±»å‹è¯´æ˜                          â”‚
â”‚ - ç”¨æˆ·é—®é¢˜                              â”‚
â”‚ - å½“å‰è¿›åº¦                              â”‚
â”‚ - åˆ†ææŒ‡å¯¼                              â”‚
â”‚ é¢„ç®—: ~500 tokens                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å½“å‰ç‰‡æ®µï¼ˆå·¥ä½œè®°å¿†ï¼‰                  â”‚
â”‚ - æ ‡é¢˜/åç§°                             â”‚
â”‚ - å®Œæ•´æ–‡å­—å†…å®¹                          â”‚
â”‚ - å›¾ç‰‡/è¡¨æ ¼æè¿°                         â”‚
â”‚ - ä»£ç å—ï¼ˆå¦‚æœ‰ï¼‰                        â”‚
â”‚ é¢„ç®—: ~1500 tokens                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. çŸ­æœŸè®°å¿†ï¼ˆæœ€è¿‘ N ä¸ªç‰‡æ®µï¼‰             â”‚
â”‚ - å®Œæ•´çš„å…³é”®ç‚¹                          â”‚
â”‚ - ä¿æŒç»†èŠ‚                              â”‚
â”‚ é¢„ç®—: ~1000 tokens                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. é•¿æœŸå¬å›ï¼ˆç›¸å…³å†å²ï¼‰                  â”‚
â”‚ - å¬å›çš„å¤‡å¿˜å½•æ¡ç›®                      â”‚
â”‚ - æ ‡æ³¨ç›¸å…³åº¦                            â”‚
â”‚ - æ ‡æ³¨æ¥æºä½ç½®                          â”‚
â”‚ é¢„ç®—: ~800 tokens                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. åŠ¨æ€è°ƒæ•´                             â”‚
â”‚ - å¦‚æœå½“å‰å†…å®¹çŸ­ï¼Œå¢åŠ å¬å›é¢„ç®—           â”‚
â”‚ - å¦‚æœå¬å›å†…å®¹å°‘ï¼Œå‡å°‘è¯¥éƒ¨åˆ†             â”‚
â”‚ - ç¡®ä¿æ€»é‡ä¸è¶…é¢„ç®—                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
      è¿”å›ç»„è£…å¥½çš„ Prompt
```

---

## 5. æ™ºèƒ½å‹ç¼©ç­–ç•¥

### 5.1 å‹ç¼©ç­–ç•¥ç±»å‹

```java
/**
 * å‹ç¼©ç­–ç•¥æšä¸¾
 */
public enum CompressionStrategy {
    /**
     * æŠ½å–å¼å‹ç¼©
     * - æå–å…³é”®å¥å­
     * - ä¿ç•™åŸæ–‡è¡¨è¿°
     * - é€Ÿåº¦å¿«ï¼Œä¸æ¶ˆè€— LLM è°ƒç”¨
     */
    EXTRACTIVE,
    
    /**
     * ç”Ÿæˆå¼å‹ç¼©
     * - è°ƒç”¨ LLM ç”Ÿæˆæ‘˜è¦
     * - è¯­è¨€æ›´æµç•…
     * - ä¿¡æ¯å¯†åº¦æ›´é«˜
     */
    ABSTRACTIVE,
    
    /**
     * æ··åˆå‹ç¼©
     * - å…ˆæŠ½å–å…³é”®å¥
     * - å†ç”¨ LLM æ¶¦è‰²æ•´åˆ
     * - å¹³è¡¡æ•ˆæœå’Œæˆæœ¬
     */
    HYBRID,
    
    /**
     * ç»“æ„åŒ–å‹ç¼©ï¼ˆé€‚ç”¨äºä»£ç /è¡¨æ ¼ï¼‰
     * - ä¿ç•™ç»“æ„ä¿¡æ¯
     * - å‹ç¼©å…·ä½“å†…å®¹
     */
    STRUCTURAL
}
```

### 5.2 å‹ç¼© Prompt æ¨¡æ¿

```markdown
# å†…å®¹å‹ç¼©ä»»åŠ¡

è¯·å°†ä»¥ä¸‹æ–‡æ¡£ç‰‡æ®µå‹ç¼©ä¸ºç®€æ´çš„æ‘˜è¦ï¼Œä¿ç•™æœ€å…³é”®çš„ä¿¡æ¯ã€‚

## æ–‡æ¡£ä¿¡æ¯
- ç±»å‹: {documentType}
- ç‰‡æ®µ: ç¬¬ {segmentIndex} ä¸ª {segmentTypeName}
- æ ‡é¢˜: {title}

## åŸå§‹å†…å®¹
{originalContent}

## å‹ç¼©è¦æ±‚
1. ä¿ç•™æ ¸å¿ƒè§‚ç‚¹å’Œå…³é”®æ•°æ®
2. å»é™¤å†—ä½™æè¿°å’Œè¿‡æ¸¡è¯­å¥
3. ä½¿ç”¨ç®€æ´çš„è¦ç‚¹å½¢å¼
4. ä¿ç•™é‡è¦çš„ä¸“æœ‰åè¯ã€æ•°å­—ã€æ—¥æœŸ
5. ç›®æ ‡é•¿åº¦ï¼šçº¦ {targetChars} å­—ç¬¦

## ä¸Šä¸‹æ–‡ï¼ˆç”¨æˆ·å…³æ³¨ç‚¹ï¼‰
{userQuestion}

## è¾“å‡ºæ ¼å¼
ç›´æ¥è¾“å‡ºå‹ç¼©åçš„å†…å®¹ï¼Œä½¿ç”¨è¦ç‚¹åˆ—è¡¨å½¢å¼ã€‚
```

### 5.3 æŒ‰æ–‡æ¡£ç±»å‹çš„å‹ç¼©ç­–ç•¥

| æ–‡æ¡£ç±»å‹ | æ¨èç­–ç•¥ | è¯´æ˜ |
|----------|----------|------|
| PPT | ABSTRACTIVE | ä¿ç•™è§‚ç‚¹ï¼Œå»é™¤å†—ä½™ |
| PDF/Word | HYBRID | æŠ½å– + æ¶¦è‰² |
| Markdown | EXTRACTIVE | ç»“æ„æ¸…æ™°ï¼Œç›´æ¥æŠ½å– |
| ä»£ç  | STRUCTURAL | ä¿ç•™ç­¾åï¼Œå‹ç¼©å®ç° |
| è¡¨æ ¼ | STRUCTURAL | ä¿ç•™ç»“æ„ï¼Œæ¦‚æ‹¬æ•°æ® |

---

## 6. æ¥å£è®¾è®¡

### 6.1 æ ¸å¿ƒæ¥å£

```java
/**
 * æ–‡æ¡£å¤‡å¿˜å½•ç®¡ç†å™¨æ¥å£
 */
public interface DocumentMemoManager {
    
    // ==================== å†™å…¥æ“ä½œ ====================
    
    /**
     * æ·»åŠ ç‰‡æ®µåˆ†æç»“æœåˆ°å¤‡å¿˜å½•
     *
     * @param segment æ–‡æ¡£ç‰‡æ®µ
     * @param analysis åˆ†æç»“æœ
     * @param keyPoints å…³é”®ç‚¹
     */
    void addSegmentAnalysis(DocumentSegment segment, 
                            String analysis, String keyPoints);
    
    // ==================== è¯»å–æ“ä½œ ====================
    
    /**
     * è·å–çŸ­æœŸè®°å¿†
     *
     * @return çŸ­æœŸè®°å¿†æ¡ç›®åˆ—è¡¨
     */
    List<MemoEntry> getShortTermMemory();
    
    /**
     * æ ¹æ®å½“å‰å†…å®¹å¬å›ç›¸å…³çš„é•¿æœŸå¤‡å¿˜å½•æ¡ç›®
     *
     * @param currentSegment å½“å‰ç‰‡æ®µ
     * @param maxTokens æœ€å¤§è¿”å› token æ•°
     * @return å¬å›çš„å¤‡å¿˜å½•æ¡ç›®
     */
    List<MemoEntry> recallRelevantMemos(DocumentSegment currentSegment, 
                                         int maxTokens);
    
    /**
     * è·å–æ‰€æœ‰å¤‡å¿˜å½•çš„æ‘˜è¦ï¼ˆç”¨äºæœ€ç»ˆæ€»ç»“ï¼‰
     *
     * @return å®Œæ•´æ‘˜è¦
     */
    String getAllMemosSummary();
    
    // ==================== å‹ç¼©æ“ä½œ ====================
    
    /**
     * å‹ç¼©å†…å®¹
     *
     * @param content åŸå§‹å†…å®¹
     * @param segmentType ç‰‡æ®µç±»å‹
     * @param targetTokens ç›®æ ‡ token æ•°
     * @return å‹ç¼©åçš„å†…å®¹
     */
    String compressContent(String content, SegmentType segmentType, 
                           int targetTokens);
    
    // ==================== å·¥å…·æ–¹æ³• ====================
    
    /**
     * ä¼°ç®—æ–‡æœ¬çš„ token æ•°é‡
     */
    int estimateTokens(String text);
    
    /**
     * æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ token é¢„ç®—
     */
    boolean hasTokenBudget(int requiredTokens);
    
    /**
     * æ¸…ç©ºæ‰€æœ‰è®°å¿†ï¼ˆç”¨äºæ–°çš„æ–‡æ¡£åˆ†æï¼‰
     */
    void clear();
    
    /**
     * è·å–å½“å‰æ–‡æ¡£çš„åˆ†æè¿›åº¦
     */
    AnalysisProgress getProgress();
}

/**
 * å¤‡å¿˜å½•èšåˆå™¨æ¥å£ - ç”¨äºåˆ†å±‚å¤„ç†
 */
public interface MemoAggregator {
    
    /**
     * åˆ¤æ–­æ˜¯å¦éœ€è¦è§¦å‘èšåˆ
     *
     * @param memos å½“å‰å¤‡å¿˜å½•åˆ—è¡¨
     * @param tokenBudget ç›®æ ‡ token é¢„ç®—
     * @return æ˜¯å¦éœ€è¦èšåˆ
     */
    boolean needsAggregation(List<MemoEntry> memos, int tokenBudget);
    
    /**
     * æ‰§è¡Œå¤‡å¿˜å½•èšåˆ
     *
     * @param memos åŸå§‹å¤‡å¿˜å½•åˆ—è¡¨
     * @param strategy èšåˆç­–ç•¥
     * @return èšåˆåçš„å¤‡å¿˜å½•åˆ—è¡¨
     */
    List<MemoEntry> aggregate(List<MemoEntry> memos, 
                               MemoAggregationStrategy strategy);
    
    /**
     * è¯†åˆ«ç‹¬ç«‹é‡è¦æ¡ç›®ï¼ˆä¸å‚ä¸èšåˆï¼‰
     *
     * @param memos å¤‡å¿˜å½•åˆ—è¡¨
     * @return ç‹¬ç«‹æ¡ç›®åˆ—è¡¨
     */
    List<MemoEntry> identifyIndependentEntries(List<MemoEntry> memos);
    
    /**
     * æŒ‰ç»“æ„åˆ†ç»„ï¼ˆç« èŠ‚ã€ä¸»é¢˜ç­‰ï¼‰
     *
     * @param memos å¤‡å¿˜å½•åˆ—è¡¨
     * @return åˆ†ç»„åçš„å¤‡å¿˜å½• Map<ç»„å, æ¡ç›®åˆ—è¡¨>
     */
    Map<String, List<MemoEntry>> groupByStructure(List<MemoEntry> memos);
    
    /**
     * åˆ¤æ–­æ¡ç›®æ˜¯å¦å¯ä»¥è·³è¿‡å†æ¬¡å¤„ç†
     *
     * @param entry å¤‡å¿˜å½•æ¡ç›®
     * @return æ˜¯å¦å¯è·³è¿‡
     */
    boolean canSkipReprocessing(MemoEntry entry);
}

/**
 * é˜¶æ®µæ€§è¾“å‡ºç®¡ç†å™¨æ¥å£
 */
public interface StageOutputManager {
    
    /**
     * è¾“å‡ºå•ä¸ªç‰‡æ®µçš„åˆ†æç»“æœï¼ˆå®æ—¶ï¼‰
     *
     * @param segment ç‰‡æ®µ
     * @param analysis åˆ†æç»“æœ
     */
    void outputSegmentAnalysis(DocumentSegment segment, String analysis);
    
    /**
     * è¾“å‡ºé˜¶æ®µæ€§æ€»ç»“
     *
     * @param progress å½“å‰è¿›åº¦
     * @param memos å½“å‰å¤‡å¿˜å½•
     * @return é˜¶æ®µæ€§æ€»ç»“
     */
    StageSummary outputStageSummary(AnalysisProgress progress, 
                                     List<MemoEntry> memos);
    
    /**
     * å¯¼å‡ºå¤‡å¿˜å½•ä¸ºæ–‡æ¡£
     *
     * @param memos å¤‡å¿˜å½•åˆ—è¡¨
     * @param format å¯¼å‡ºæ ¼å¼
     * @return å¯¼å‡ºçš„æ–‡æ¡£å†…å®¹
     */
    String exportMemoDocument(List<MemoEntry> memos, ExportFormat format);
    
    /**
     * æ£€æŸ¥æ˜¯å¦åº”è¯¥è§¦å‘é˜¶æ®µæ€§è¾“å‡º
     *
     * @param progress å½“å‰è¿›åº¦
     * @return æ˜¯å¦åº”è¯¥è¾“å‡º
     */
    boolean shouldTriggerStageOutput(AnalysisProgress progress);
}

/**
 * å¯¼å‡ºæ ¼å¼æšä¸¾
 */
public enum ExportFormat {
    MARKDOWN,       // Markdown æ–‡æ¡£
    JSON,           // ç»“æ„åŒ– JSON
    HTML,           // HTML é¡µé¢
    MIND_MAP        // æ€ç»´å¯¼å›¾æ ¼å¼
}

/**
 * é˜¶æ®µæ€§æ€»ç»“
 */
@Data
@Builder
public class StageSummary {
    /** å½“å‰è¿›åº¦ç™¾åˆ†æ¯” */
    private double progressPercent;
    
    /** å·²åˆ†æç‰‡æ®µæ•° */
    private int analyzedSegments;
    
    /** æ€»ç‰‡æ®µæ•° */
    private int totalSegments;
    
    /** ç›®å‰å‘ç°çš„ä¸»è¦è§‚ç‚¹ */
    private List<String> mainFindings;
    
    /** å…³é”®æ•°æ®æ±‡æ€» */
    private List<String> keyData;
    
    /** å¾…ç¡®è®¤çš„é—®é¢˜ */
    private List<String> pendingQuestions;
    
    /** ç‹¬ç«‹é‡è¦æ¡ç›® */
    private List<MemoEntry> independentEntries;
    
    /** ç”Ÿæˆæ—¶é—´ */
    private Instant generatedAt;
}
```

### 6.2 æ–‡æ¡£è§£æå™¨æ¥å£

```java
/**
 * æ–‡æ¡£è§£æå™¨æ¥å£
 */
public interface DocumentParser {
    
    /**
     * æ£€æŸ¥æ˜¯å¦æ”¯æŒè¯¥æ–‡æ¡£ç±»å‹
     */
    boolean supports(String documentPath, String mimeType);
    
    /**
     * è§£ææ–‡æ¡£ä¸ºç‰‡æ®µåˆ—è¡¨
     *
     * @param documentPath æ–‡æ¡£è·¯å¾„
     * @return æ–‡æ¡£ç‰‡æ®µåˆ—è¡¨
     */
    List<DocumentSegment> parse(String documentPath) throws IOException;
    
    /**
     * è·å–æ”¯æŒçš„æ–‡æ¡£ç±»å‹
     */
    List<String> getSupportedTypes();
}

/**
 * è§£æå™¨å·¥å‚
 */
public interface DocumentParserFactory {
    
    /**
     * æ ¹æ®æ–‡æ¡£è·å–åˆé€‚çš„è§£æå™¨
     */
    DocumentParser getParser(String documentPath);
    
    /**
     * æ³¨å†Œè‡ªå®šä¹‰è§£æå™¨
     */
    void registerParser(DocumentParser parser);
}
```

### 6.3 Prompt ç»„è£…å™¨æ¥å£

```java
/**
 * Prompt ç»„è£…å™¨æ¥å£
 */
public interface PromptAssembler {
    
    /**
     * ç»„è£…å®Œæ•´çš„åˆ†æ Prompt
     *
     * @param currentSegment å½“å‰ç‰‡æ®µ
     * @param question ç”¨æˆ·é—®é¢˜
     * @param memoManager å¤‡å¿˜å½•ç®¡ç†å™¨
     * @return ç»„è£…å¥½çš„ Prompt
     */
    String assembleAnalysisPrompt(
        DocumentSegment currentSegment,
        String question,
        DocumentMemoManager memoManager
    );
    
    /**
     * ç»„è£…æœ€ç»ˆæ€»ç»“ Prompt
     *
     * @param documentInfo æ–‡æ¡£ä¿¡æ¯
     * @param question ç”¨æˆ·é—®é¢˜
     * @param memoManager å¤‡å¿˜å½•ç®¡ç†å™¨
     * @return ç»„è£…å¥½çš„ Prompt
     */
    String assembleSummaryPrompt(
        DocumentSource documentInfo,
        String question,
        DocumentMemoManager memoManager
    );
}
```

---

## 7. é…ç½®é€‰é¡¹

### 7.1 YAML é…ç½®

```yaml
document-analysis:
  memo:
    # ==================== å®¹é‡é…ç½® ====================
    
    # é»˜è®¤çŸ­æœŸè®°å¿†å®¹é‡
    default-short-term-capacity: 3
    
    # æŒ‰æ–‡æ¡£ç±»å‹çš„çŸ­æœŸè®°å¿†å®¹é‡
    short-term-capacity-by-type:
      SLIDE: 3          # PPT å¹»ç¯ç‰‡
      PAGE: 2           # PDF/Word é¡µé¢
      CHAPTER: 2        # ç« èŠ‚
      FUNCTION: 5       # ä»£ç å‡½æ•°
      TEXT_CHUNK: 4     # æ–‡æœ¬å—
    
    # é•¿æœŸå¤‡å¿˜å½•æœ€å¤§æ¡ç›®æ•°
    long-term-max-entries: 100
    
    # å•æ¡å¤‡å¿˜å½•æœ€å¤§ token æ•°
    memo-entry-max-tokens: 200
    
    # ==================== å¬å›é…ç½® ====================
    
    # å¬å›ç›¸å…³æ¡ç›®æ•°
    recall-top-k: 3
    
    # ç›¸å…³æ€§é˜ˆå€¼ï¼ˆä½äºæ­¤å€¼ä¸å¬å›ï¼‰
    relevance-threshold: 0.3
    
    # ç›¸å…³æ€§è®¡ç®—æƒé‡
    relevance-weights:
      keyword-match: 0.4
      entity-match: 0.2
      importance: 0.2
      recency: 0.1
      structural-distance: 0.1
    
    # ==================== å‹ç¼©é…ç½® ====================
    
    # é»˜è®¤å‹ç¼©ç­–ç•¥
    default-compression-strategy: hybrid
    
    # æŒ‰æ–‡æ¡£ç±»å‹çš„å‹ç¼©ç­–ç•¥
    compression-strategy-by-type:
      SLIDE: abstractive
      PAGE: hybrid
      CHAPTER: hybrid
      FUNCTION: structural
      TEXT_CHUNK: extractive
    
    # å‹ç¼©æ¯”ä¾‹ï¼ˆå‹ç¼©åå¤§å° / åŸå§‹å¤§å°ï¼‰
    compression-ratio: 0.3
    
    # æœ€å°ä¿ç•™ token æ•°
    min-compressed-tokens: 50
    
    # ==================== åˆ†å±‚å¤„ç†é…ç½® ====================
    
    aggregation:
      # æ˜¯å¦å¯ç”¨åˆ†å±‚èšåˆ
      enabled: true
      
      # è§¦å‘èšåˆçš„å¤‡å¿˜å½•æ¡ç›®æ•°é˜ˆå€¼
      trigger-threshold: 20
      
      # é»˜è®¤èšåˆç­–ç•¥: sequential, topic_based, structural, hybrid
      default-strategy: structural
      
      # æ¯ç»„èšåˆçš„æœ€å¤§æ¡ç›®æ•°
      max-entries-per-group: 5
      
      # èšåˆåæ¯ç»„çš„ç›®æ ‡ token æ•°
      group-target-tokens: 300
      
      # ç‹¬ç«‹æ¡ç›®åˆ¤æ–­
      independent-entry:
        # é‡è¦æ€§é˜ˆå€¼ï¼ˆé«˜äºæ­¤å€¼æ ‡è®°ä¸ºç‹¬ç«‹ï¼‰
        importance-threshold: 0.8
        
        # æ˜¯å¦æ£€æµ‹å…³é”®æ•°æ®
        detect-critical-data: true
        
        # æ˜¯å¦æ£€æµ‹ç»“è®ºæ€§å…³é”®è¯
        detect-conclusion-keywords: true
        
        # ç»“è®ºæ€§å…³é”®è¯åˆ—è¡¨
        conclusion-keywords:
          - æ€»ç»“
          - ç»“è®º
          - å…³é”®
          - é‡è¦
          - æ ¸å¿ƒ
          - å†³ç­–
          - å»ºè®®
          - é£é™©
          - summary
          - conclusion
          - key
          - important
    
    # è·³è¿‡é‡å¤å¤„ç†çš„åˆ¤æ–­
    skip-reprocessing:
      # æœ€å° token é˜ˆå€¼ï¼ˆä½äºæ­¤å€¼è·³è¿‡ï¼‰
      min-tokens-threshold: 50
      
      # ç›®æ ‡å‹ç¼©æ¯”ï¼ˆå·²è¾¾åˆ°åˆ™è·³è¿‡ï¼‰
      target-compression-ratio: 0.3
      
      # æœ€å¤§å‹ç¼©è½®æ•°
      max-compression-rounds: 2
      
      # æ˜¯å¦æ£€æµ‹ç»“æ„åŒ–è¦ç‚¹
      detect-structured-bullets: true
    
    # ==================== é˜¶æ®µæ€§è¾“å‡ºé…ç½® ====================
    
    stage-output:
      # æ˜¯å¦å¯ç”¨é˜¶æ®µæ€§è¾“å‡º
      enabled: true
      
      # è§¦å‘é˜¶æ®µæ€§æ€»ç»“çš„è¿›åº¦ç‚¹ï¼ˆç™¾åˆ†æ¯”ï¼‰
      trigger-points:
        - 25
        - 50
        - 75
      
      # å®æ—¶è¾“å‡ºå•ä¸ªç‰‡æ®µåˆ†æ
      realtime-segment-output: true
      
      # æ˜¯å¦è‡ªåŠ¨å¯¼å‡ºå¤‡å¿˜å½•æ–‡æ¡£
      auto-export-memo-document: true
      
      # é»˜è®¤å¯¼å‡ºæ ¼å¼: markdown, json, html
      default-export-format: markdown
      
      # é˜¶æ®µæ€§æ€»ç»“åŒ…å«çš„å†…å®¹
      stage-summary-content:
        main-findings: true
        key-data: true
        pending-questions: true
        independent-entries: true
    
    # ==================== Token é¢„ç®—é…ç½® ====================
    
    prompt-budget:
      total: 4000
      current-segment: 1500
      short-term-memory: 1000
      long-term-recall: 800
      instruction: 500
      safety-margin: 200
      
      # æŒ‰æ–‡æ¡£ç±»å‹è¦†ç›–
      type-overrides:
        code:
          total: 6000
          current-segment: 2500
    
    # ==================== å…³é”®è¯é…ç½® ====================
    
    keyword:
      max-keywords-per-entry: 10
      filter-stopwords: true
      min-keyword-length: 2
      extract-named-entities: true
    
    # ==================== è§£æå™¨é…ç½® ====================
    
    parser:
      # æ–‡æœ¬å—æœ€å¤§å­—ç¬¦æ•°ï¼ˆç”¨äºé•¿æ–‡æœ¬åˆ†å‰²ï¼‰
      text-chunk-max-chars: 2000
      
      # æ–‡æœ¬å—é‡å å­—ç¬¦æ•°
      text-chunk-overlap: 200
      
      # æ˜¯å¦æå–å›¾ç‰‡
      extract-images: true
      
      # æ˜¯å¦è§£æè¡¨æ ¼
      parse-tables: true
```

---

## 8. Prompt æ¨¡æ¿ç¤ºä¾‹

### 8.1 é€šç”¨åˆ†æ Prompt æ¨¡æ¿

```markdown
# {documentType} æ–‡æ¡£æ¸è¿›å¼åˆ†æ

## ç”¨æˆ·é—®é¢˜
{question}

## å½“å‰è¿›åº¦
- å½“å‰: ç¬¬ {currentIndex} ä¸ª {segmentTypeName} / å…± {totalSegments} ä¸ª
- å®Œæˆåº¦: {progressPercent}%
- æ–‡æ¡£: {documentName}

## ğŸ“š çŸ­æœŸè®°å¿†ï¼ˆæœ€è¿‘{shortTermCount}ä¸ª{segmentTypeName}çš„è¯¦ç»†è¦ç‚¹ï¼‰

{shortTermMemoryContent}

## ğŸ“‹ é•¿æœŸå¤‡å¿˜å½•ï¼ˆç›¸å…³å†å²å†…å®¹ï¼‰

*ä»¥ä¸‹æ˜¯ä¸å½“å‰å†…å®¹ç›¸å…³çš„æ—©æœŸç‰‡æ®µæ‘˜è¦*

{longTermRecallContent}

## ğŸ“„ å½“å‰{segmentTypeName}

**æ ‡é¢˜**: {title}

{segmentContent}

## ğŸ¯ åˆ†ææŒ‡å¯¼

1. **ç†è§£å½“å‰å†…å®¹**: è¿™ä¸ª{segmentTypeName}è®²äº†ä»€ä¹ˆï¼Ÿæ ¸å¿ƒè§‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ
2. **æ‰¿æ¥å‰æ–‡**: ä¸å‰é¢çš„å†…å®¹æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ
3. **æç‚¼è¦ç‚¹**: æ‰¾å‡º2-3ä¸ªæœ€é‡è¦çš„ä¿¡æ¯ç‚¹
4. **å…³æ³¨é—®é¢˜**: é‡ç‚¹å…³æ³¨ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„å†…å®¹
{positionHint}

## ğŸ“ è¯·æä¾›åˆ†æ

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡º:

### æœ¬æ®µåˆ†æ
[ä½ å¯¹è¿™ä¸ª{segmentTypeName}çš„ç†è§£å’Œåˆ†æ]

### æ ¸å¿ƒè¦ç‚¹ (KEY_POINTS)
- [è¦ç‚¹1]
- [è¦ç‚¹2]
- [è¦ç‚¹3]
(END_KEY_POINTS)
```

### 8.2 PPT ç¤ºä¾‹

```markdown
# PPT æ–‡æ¡£æ¸è¿›å¼åˆ†æ

## ç”¨æˆ·é—®é¢˜
è¯·è¯¦ç»†æ€»ç»“è¿™ä»½æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹å’Œå…³é”®è§‚ç‚¹ã€‚

## å½“å‰è¿›åº¦
- å½“å‰: ç¬¬ 10 å¼ å¹»ç¯ç‰‡ / å…± 20 å¼ 
- å®Œæˆåº¦: 50.0%
- æ–‡æ¡£: äº§å“å‘å¸ƒè®¡åˆ’.pptx

## ğŸ“š çŸ­æœŸè®°å¿†ï¼ˆæœ€è¿‘3å¼ å¹»ç¯ç‰‡çš„è¯¦ç»†è¦ç‚¹ï¼‰

### ç¬¬ 7 å¼  - å¸‚åœºåˆ†æ
- å…¨çƒå¸‚åœºè§„æ¨¡è¾¾åˆ° 1000 äº¿ç¾å…ƒ
- å¹´å¤åˆå¢é•¿ç‡ 15%
- ä¸»è¦ç«äº‰å¯¹æ‰‹ï¼šAå…¬å¸ã€Bå…¬å¸ã€Cå…¬å¸

### ç¬¬ 8 å¼  - äº§å“ä¼˜åŠ¿
- æ€§èƒ½æå‡ 50%
- æˆæœ¬é™ä½ 30%
- æ”¯æŒå¤šå¹³å°éƒ¨ç½²

### ç¬¬ 9 å¼  - æŠ€æœ¯æ¶æ„
- å¾®æœåŠ¡æ¶æ„
- æ”¯æŒé«˜å¹¶å‘
- 99.99% å¯ç”¨æ€§

## ğŸ“‹ é•¿æœŸå¤‡å¿˜å½•ï¼ˆç›¸å…³å†å²å†…å®¹ï¼‰

ã€ç¬¬ 2 å¼  - é¡¹ç›®èƒŒæ™¯ã€‘ï¼ˆç›¸å…³åº¦: é«˜ï¼‰
> é¡¹ç›®èµ·æºäº 2024 å¹´ï¼Œç›®æ ‡æ˜¯è§£å†³ä¼ä¸šæ•°å­—åŒ–è½¬å‹æŒ‘æˆ˜

ã€ç¬¬ 5 å¼  - ç”¨æˆ·éœ€æ±‚ã€‘ï¼ˆç›¸å…³åº¦: ä¸­ï¼‰
> ç›®æ ‡ç”¨æˆ·ï¼šä¸­å¤§å‹ä¼ä¸šï¼›ä¸»è¦ç—›ç‚¹ï¼šæ•ˆç‡ä½ã€æˆæœ¬é«˜

## ğŸ“„ å½“å‰å¹»ç¯ç‰‡

**æ ‡é¢˜**: å®æ–½è®¡åˆ’

**æ–‡å­—å†…å®¹**:
é¡¹ç›®å®æ–½åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š
1. ç¬¬ä¸€é˜¶æ®µï¼ˆQ1ï¼‰ï¼šåŸºç¡€è®¾æ–½æ­å»º
2. ç¬¬äºŒé˜¶æ®µï¼ˆQ2ï¼‰ï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘
3. ç¬¬ä¸‰é˜¶æ®µï¼ˆQ3-Q4ï¼‰ï¼šæ¨å¹¿ä¸Šçº¿

**åŒ…å«å›¾ç‰‡**: 1 å¼ ï¼ˆç”˜ç‰¹å›¾ï¼‰

## ğŸ¯ åˆ†ææŒ‡å¯¼
...
```

### 8.3 ä»£ç æ–‡ä»¶ç¤ºä¾‹

```markdown
# ä»£ç æ–‡ä»¶æ¸è¿›å¼åˆ†æ

## ç”¨æˆ·é—®é¢˜
è¯·åˆ†æè¿™ä¸ªé¡¹ç›®çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œè®¾è®¡æ¨¡å¼ã€‚

## å½“å‰è¿›åº¦
- å½“å‰: ç¬¬ 15 ä¸ªå‡½æ•°/ç±» / å…± 42 ä¸ª
- å®Œæˆåº¦: 35.7%
- æ–‡æ¡£: UserService.java

## ğŸ“š çŸ­æœŸè®°å¿†ï¼ˆæœ€è¿‘5ä¸ªå‡½æ•°/ç±»çš„è¯¦ç»†è¦ç‚¹ï¼‰

### createUser() - ç”¨æˆ·åˆ›å»º
- å‚æ•°éªŒè¯ -> å¯†ç åŠ å¯† -> ä¿å­˜æ•°æ®åº“
- ä½¿ç”¨ BCrypt åŠ å¯†
- å‘é€æ¬¢è¿é‚®ä»¶

### validateUserInput() - è¾“å…¥éªŒè¯
- é‚®ç®±æ ¼å¼æ ¡éªŒ
- å¯†ç å¼ºåº¦æ£€æŸ¥
- ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯

...

## ğŸ“‹ é•¿æœŸå¤‡å¿˜å½•ï¼ˆç›¸å…³å†å²å†…å®¹ï¼‰

ã€UserRepository - æ•°æ®è®¿é—®å±‚ã€‘ï¼ˆç›¸å…³åº¦: é«˜ï¼‰
> ä½¿ç”¨ JPA å®ç°ï¼›æä¾› findByEmail, findByUsername ç­‰æ–¹æ³•

ã€PasswordEncoder - å¯†ç ç¼–ç å™¨ã€‘ï¼ˆç›¸å…³åº¦: é«˜ï¼‰
> BCrypt å®ç°ï¼›å¼ºåº¦å› å­ = 12

## ğŸ“„ å½“å‰å‡½æ•°/ç±»

**åç§°**: updateUserProfile()

**ä»£ç **:
```java
public UserDTO updateUserProfile(Long userId, UpdateProfileRequest request) {
    User user = userRepository.findById(userId)
        .orElseThrow(() -> new UserNotFoundException(userId));
    
    user.setNickname(request.getNickname());
    user.setAvatar(request.getAvatar());
    user.setUpdatedAt(Instant.now());
    
    return userMapper.toDTO(userRepository.save(user));
}
```

## ğŸ¯ åˆ†ææŒ‡å¯¼

1. **ç†è§£åŠŸèƒ½**: è¿™ä¸ªå‡½æ•°çš„èŒè´£æ˜¯ä»€ä¹ˆï¼Ÿ
2. **è®¾è®¡æ¨¡å¼**: ä½¿ç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Ÿ
3. **ä¾èµ–å…³ç³»**: ä¸å…¶ä»–ç»„ä»¶çš„äº¤äº’ï¼Ÿ
4. **æ½œåœ¨é—®é¢˜**: æ˜¯å¦æœ‰æ€§èƒ½/å®‰å…¨éšæ‚£ï¼Ÿ
...
```

---

## 9. å®ç°è®¡åˆ’

### 9.1 é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | åŠŸèƒ½ | é¢„è®¡å·¥æ—¶ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| **P0** | åŸºç¡€æ•°æ®ç»“æ„ï¼ˆMemoEntryã€DocumentSegmentï¼‰ | 2h | ğŸ”´ é«˜ |
| **P0** | DocumentMemoManager æ ¸å¿ƒå®ç° | 3h | ğŸ”´ é«˜ |
| **P0** | çŸ­æœŸè®°å¿†ç®¡ç†ï¼ˆFIFO é˜Ÿåˆ—ï¼‰ | 1h | ğŸ”´ é«˜ |
| **P0** | ç®€å•çš„ Token ä¼°ç®— | 1h | ğŸ”´ é«˜ |
| **P0** | PPT è§£æå™¨é€‚é… | 1h | ğŸ”´ é«˜ |
| **P1** | LLM å‹ç¼©åŠŸèƒ½ | 2h | ğŸŸ¡ ä¸­ |
| **P1** | åŸºäºè§„åˆ™çš„å…³é”®è¯æå– | 2h | ğŸŸ¡ ä¸­ |
| **P1** | Prompt ç»„è£…å™¨ | 2h | ğŸŸ¡ ä¸­ |
| **P1** | PDF/Word è§£æå™¨ | 3h | ğŸŸ¡ ä¸­ |
| **P1** | **å¤‡å¿˜å½•èšåˆå™¨ï¼ˆMemoAggregatorï¼‰** | 3h | ğŸŸ¡ ä¸­ |
| **P1** | **ç‹¬ç«‹æ¡ç›®æ£€æµ‹å™¨** | 2h | ğŸŸ¡ ä¸­ |
| **P1** | **é˜¶æ®µæ€§è¾“å‡ºç®¡ç†å™¨ï¼ˆStageOutputManagerï¼‰** | 2h | ğŸŸ¡ ä¸­ |
| **P1** | **å¤‡å¿˜å½•æ–‡æ¡£å¯¼å‡ºï¼ˆMarkdown/JSONï¼‰** | 2h | ğŸŸ¡ ä¸­ |
| **P2** | å…³é”®è¯å€’æ’ç´¢å¼• | 2h | ğŸŸ¢ ä½ |
| **P2** | ç›¸å…³æ€§å¬å›ç®—æ³• | 3h | ğŸŸ¢ ä½ |
| **P2** | å‘½åå®ä½“è¯†åˆ« | 2h | ğŸŸ¢ ä½ |
| **P2** | ä»£ç è§£æå™¨ | 3h | ğŸŸ¢ ä½ |
| **P2** | åŠ¨æ€ Token é¢„ç®—è°ƒæ•´ | 2h | ğŸŸ¢ ä½ |
| **P2** | **ä¸»é¢˜èšç±»ç®—æ³•** | 3h | ğŸŸ¢ ä½ |
| **P2** | **æ€ç»´å¯¼å›¾å¯¼å‡º** | 2h | ğŸŸ¢ ä½ |

### 9.2 æ–‡ä»¶ç»“æ„

```
src/main/java/top/yumbo/ai/rag/spring/boot/
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ document/
â”‚   â”‚   â”œâ”€â”€ DocumentMemoManager.java           # å¤‡å¿˜å½•ç®¡ç†å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ DocumentMemoManagerImpl.java       # å®ç°ç±»
â”‚   â”‚   â”œâ”€â”€ MemoAggregator.java                # å¤‡å¿˜å½•èšåˆå™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ MemoAggregatorImpl.java            # èšåˆå™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ StageOutputManager.java            # é˜¶æ®µæ€§è¾“å‡ºç®¡ç†å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ StageOutputManagerImpl.java        # é˜¶æ®µæ€§è¾“å‡ºå®ç°
â”‚   â”‚   â”œâ”€â”€ MemoDocumentExporter.java          # å¤‡å¿˜å½•æ–‡æ¡£å¯¼å‡ºå™¨
â”‚   â”‚   â”œâ”€â”€ IndependentEntryDetector.java      # ç‹¬ç«‹æ¡ç›®æ£€æµ‹å™¨
â”‚   â”‚   â”œâ”€â”€ PromptAssembler.java               # Prompt ç»„è£…å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ PromptAssemblerImpl.java           # å®ç°ç±»
â”‚   â”‚   â”œâ”€â”€ ContentCompressor.java             # å†…å®¹å‹ç¼©å™¨
â”‚   â”‚   â”œâ”€â”€ KeywordExtractor.java              # å…³é”®è¯æå–å™¨
â”‚   â”‚   â””â”€â”€ TokenEstimator.java                # Token ä¼°ç®—å™¨
â”‚   â”œâ”€â”€ parser/
â”‚   â”‚   â”œâ”€â”€ DocumentParser.java                # è§£æå™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ DocumentParserFactory.java         # è§£æå™¨å·¥å‚
â”‚   â”‚   â”œâ”€â”€ PPTDocumentParser.java             # PPT è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ PDFDocumentParser.java             # PDF è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ WordDocumentParser.java            # Word è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ MarkdownDocumentParser.java        # Markdown è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ CodeDocumentParser.java            # ä»£ç è§£æå™¨
â”‚   â”‚   â””â”€â”€ GenericTextParser.java             # é€šç”¨æ–‡æœ¬è§£æå™¨
â”‚   â”œâ”€â”€ DocumentProgressiveAnalysisService.java # é€šç”¨æ–‡æ¡£åˆ†ææœåŠ¡
â”‚   â””â”€â”€ PPTProgressiveAnalysisService.java      # PPT åˆ†ææœåŠ¡ï¼ˆå…¼å®¹ï¼‰
â”œâ”€â”€ model/
â”‚   â””â”€â”€ document/
â”‚       â”œâ”€â”€ DocumentSegment.java               # æ–‡æ¡£ç‰‡æ®µ
â”‚       â”œâ”€â”€ SegmentType.java                   # ç‰‡æ®µç±»å‹æšä¸¾
â”‚       â”œâ”€â”€ MemoEntry.java                     # å¤‡å¿˜å½•æ¡ç›®
â”‚       â”œâ”€â”€ ContentForm.java                   # å†…å®¹å½¢å¼æšä¸¾
â”‚       â”œâ”€â”€ DocumentSource.java                # æ–‡æ¡£æ¥æº
â”‚       â”œâ”€â”€ RecallResult.java                  # å¬å›ç»“æœ
â”‚       â”œâ”€â”€ AnalysisProgress.java              # åˆ†æè¿›åº¦
â”‚       â”œâ”€â”€ StageSummary.java                  # é˜¶æ®µæ€§æ€»ç»“
â”‚       â”œâ”€â”€ CompressionStrategy.java           # å‹ç¼©ç­–ç•¥æšä¸¾
â”‚       â”œâ”€â”€ MemoAggregationStrategy.java       # èšåˆç­–ç•¥æšä¸¾
â”‚       â””â”€â”€ ExportFormat.java                  # å¯¼å‡ºæ ¼å¼æšä¸¾
â””â”€â”€ config/
    â”œâ”€â”€ DocumentAnalysisConfig.java            # æ–‡æ¡£åˆ†æé…ç½®
    â”œâ”€â”€ PromptBudgetConfig.java                # Token é¢„ç®—é…ç½®
    â”œâ”€â”€ AggregationConfig.java                 # èšåˆé…ç½®
    â””â”€â”€ StageOutputConfig.java                 # é˜¶æ®µæ€§è¾“å‡ºé…ç½®
```

---

## 10. å…³é”®å†³ç­–ç‚¹

### 10.1 å¾…ç¡®è®¤äº‹é¡¹

| # | å†³ç­–ç‚¹ | é€‰é¡¹ | æ¨è | è¯´æ˜ |
|---|--------|------|------|------|
| 1 | å‹ç¼©æ—¶æœº | A: æ»‘å‡ºçŸ­æœŸè®°å¿†æ—¶ç«‹å³å‹ç¼©<br>B: å»¶è¿Ÿå‹ç¼© | **A** | é¿å…åˆ†ææ—¶å»¶è¿Ÿ |
| 2 | å¬å›ç­–ç•¥ | A: å…³é”®è¯åŒ¹é…<br>B: å‘é‡ç›¸ä¼¼åº¦<br>C: æ··åˆ | **A** (å…ˆ) | ç®€å•å…ˆè¡Œ |
| 3 | å‹ç¼©æ–¹å¼ | A: è§„åˆ™æŠ½å–<br>B: LLM ç”Ÿæˆ | **B** | æ•ˆæœæ›´å¥½ |
| 4 | Token ä¼°ç®— | A: å­—ç¬¦æ•°/2<br>B: tiktoken | **A** (å…ˆ) | ç®€å•å…ˆè¡Œ |
| 5 | å…³é”®è¯æå– | A: è§„åˆ™<br>B: åˆ†è¯åº“<br>C: LLM | **A** (å…ˆ) | ç®€å•å…ˆè¡Œ |
| 6 | è§£æå™¨ä¼˜å…ˆçº§ | å…ˆå®ç°å“ªäº›ï¼Ÿ | **PPT > PDF > Word** | æŒ‰ä½¿ç”¨é¢‘ç‡ |
| 7 | **èšåˆè§¦å‘æ—¶æœº** | A: å¤‡å¿˜å½•æ•°é‡è¶…é˜ˆå€¼<br>B: Token é¢„ç®—ä¸è¶³<br>C: ä¸¤è€…éƒ½æ»¡è¶³ | **B** | æŒ‰éœ€èšåˆæ›´çµæ´» |
| 8 | **èšåˆç­–ç•¥é€‰æ‹©** | A: å›ºå®šä½¿ç”¨ä¸€ç§<br>B: æŒ‰æ–‡æ¡£ç±»å‹é€‰æ‹©<br>C: è‡ªåŠ¨æ£€æµ‹ | **B** | å¹³è¡¡æ•ˆæœå’Œå¤æ‚åº¦ |
| 9 | **é˜¶æ®µæ€§è¾“å‡ºè§¦å‘** | A: å›ºå®šè¿›åº¦ç‚¹<br>B: æ—¶é—´é—´éš”<br>C: ç”¨æˆ·æ‰‹åŠ¨ | **A** | å¯é¢„æµ‹ï¼Œæ˜“ç†è§£ |
| 10 | **å¤‡å¿˜å½•å¯¼å‡ºæ—¶æœº** | A: åˆ†æå®Œæˆåè‡ªåŠ¨<br>B: ç”¨æˆ·è¯·æ±‚æ—¶<br>C: ä¸¤è€…éƒ½æ”¯æŒ | **C** | çµæ´»æ€§æœ€é«˜ |
| 11 | **ç‹¬ç«‹æ¡ç›®å¤„ç†** | A: å§‹ç»ˆä¿ç•™åŸæ–‡<br>B: å…è®¸è½»åº¦å‹ç¼©<br>C: ç”¨æˆ·å†³å®š | **A** | é¿å…ä¿¡æ¯ä¸¢å¤± |

### 10.2 è¾¹ç•Œæƒ…å†µ

| åœºæ™¯ | å¤„ç†ç­–ç•¥ |
|------|----------|
| ç‰‡æ®µå†…å®¹ä¸ºç©º | è·³è¿‡å‹ç¼©ï¼Œä»…è®°å½•æ ‡é¢˜/ä½ç½® |
| å‹ç¼©åä»è¶…é¢„ç®— | æˆªæ–­åˆ°é¢„ç®—ä¸Šé™ï¼Œä¿ç•™å¼€å¤´ |
| æ— ç›¸å…³å¬å›ç»“æœ | è·³è¿‡é•¿æœŸå¬å›éƒ¨åˆ† |
| LLM å‹ç¼©å¤±è´¥ | é™çº§ä½¿ç”¨è§„åˆ™æŠ½å– |
| Token ä¼°ç®—è¯¯å·®å¤§ | é¢„ç•™ 10% å®‰å…¨ä½™é‡ |
| ä¸æ”¯æŒçš„æ–‡æ¡£ç±»å‹ | ä½¿ç”¨é€šç”¨æ–‡æœ¬è§£æå™¨ |
| æ–‡æ¡£è¿‡å¤§ï¼ˆ>100é¡µï¼‰ | åˆ†æ‰¹å¤„ç†ï¼Œåˆå¹¶ç»“æœ |
| **å¤‡å¿˜å½•å…¨æ˜¯ç‹¬ç«‹æ¡ç›®** | ä»æ‰§è¡Œèšåˆï¼Œä½†ä¿ç•™ç‹¬ç«‹æ ‡è®° |
| **å†…å®¹å·²è¶³å¤Ÿç²¾ç®€** | è·³è¿‡å†æ¬¡å‹ç¼©ï¼Œç›´æ¥ä½¿ç”¨ |
| **é˜¶æ®µæ€»ç»“å¤±è´¥** | ç»§ç»­åˆ†æï¼Œæœ€ç»ˆæ€»ç»“æ—¶é‡è¯• |
| **å¯¼å‡ºæ ¼å¼ä¸æ”¯æŒ** | é™çº§ä¸º Markdown æ ¼å¼ |

---

## 11. é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| LLM å‹ç¼©å»¶è¿Ÿé«˜ | åˆ†æé€Ÿåº¦å˜æ…¢ | ä¸­ | å¼‚æ­¥å‹ç¼©ï¼Œä½¿ç”¨ç¼“å­˜ |
| å‹ç¼©ä¸¢å¤±å…³é”®ä¿¡æ¯ | åˆ†æè´¨é‡ä¸‹é™ | ä¸­ | ä¿ç•™åŸæ–‡å‰¯æœ¬ï¼Œæ”¯æŒå›æº¯ |
| Token ä¼°ç®—ä¸å‡† | è¶…å‡º context é™åˆ¶ | ä½ | é¢„ç•™å®‰å…¨ä½™é‡ |
| å¬å›ç»“æœä¸ç›¸å…³ | å¢åŠ å™ªéŸ³ | ä½ | è®¾ç½®ç›¸å…³æ€§é˜ˆå€¼ |
| è§£æå™¨å…¼å®¹æ€§ | éƒ¨åˆ†æ–‡æ¡£è§£æå¤±è´¥ | ä¸­ | æä¾›é™çº§æ–¹æ¡ˆ |
| å†…å­˜å ç”¨è¿‡é«˜ | å¤§æ–‡æ¡£åˆ†æ OOM | ä½ | æµå¼å¤„ç†ï¼Œé™åˆ¶ç¼“å­˜å¤§å° |

---

## é™„å½• A: Token ä¼°ç®—å‚è€ƒ

| è¯­è¨€ | ä¼°ç®—è§„åˆ™ | è¯´æ˜ |
|------|----------|------|
| ä¸­æ–‡ | 1 å­—ç¬¦ â‰ˆ 0.6 token | ä¸­æ–‡ä¸€ä¸ªå­—çº¦ 0.5-0.7 token |
| è‹±æ–‡ | 1 å•è¯ â‰ˆ 1.3 token | å«ç©ºæ ¼å’Œæ ‡ç‚¹ |
| ä»£ç  | 1 å­—ç¬¦ â‰ˆ 0.4 token | ç¬¦å·å’Œå…³é”®å­—è¾ƒçŸ­ |
| æ··åˆ | å­—ç¬¦æ•° / 2 | ä¿å®ˆä¼°ç®— |

## é™„å½• B: ç›¸å…³æ€§è®¡ç®—å…¬å¼

```
ç›¸å…³æ€§å¾—åˆ† = 
    å…³é”®è¯åŒ¹é…åº¦ Ã— 0.4 +
    å‘½åå®ä½“åŒ¹é…åº¦ Ã— 0.2 +
    é‡è¦æ€§è¯„åˆ† Ã— 0.2 +
    æ—¶é—´è¡°å‡å› å­ Ã— 0.1 +
    ç»“æ„è·ç¦»å› å­ Ã— 0.1

å…¶ä¸­ï¼š
- å…³é”®è¯åŒ¹é…åº¦ = åŒ¹é…å…³é”®è¯æ•° / æ€»å…³é”®è¯æ•°
- å‘½åå®ä½“åŒ¹é…åº¦ = åŒ¹é…å®ä½“æ•° / æ€»å®ä½“æ•°
- é‡è¦æ€§è¯„åˆ† = å¤‡å¿˜å½•æ¡ç›®çš„ importance å­—æ®µ
- æ—¶é—´è¡°å‡å› å­ = 1 / (1 + 0.1 Ã— é—´éš”ç‰‡æ®µæ•°)
- ç»“æ„è·ç¦»å› å­ = 1 / (1 + log(ç»“æ„å±‚çº§å·®))
```

## é™„å½• C: æ”¯æŒçš„æ–‡æ¡£ç±»å‹

| ç±»å‹ | æ‰©å±•å | è§£æå™¨ | åˆ†æå•ä½ |
|------|--------|--------|----------|
| PowerPoint | .pptx, .ppt | PPTDocumentParser | å¹»ç¯ç‰‡ |
| PDF | .pdf | PDFDocumentParser | é¡µé¢/ç« èŠ‚ |
| Word | .docx, .doc | WordDocumentParser | æ®µè½/ç« èŠ‚ |
| Markdown | .md | MarkdownDocumentParser | æ ‡é¢˜å— |
| çº¯æ–‡æœ¬ | .txt | GenericTextParser | æ–‡æœ¬å— |
| Java | .java | CodeDocumentParser | ç±»/æ–¹æ³• |
| Python | .py | CodeDocumentParser | å‡½æ•°/ç±» |
| JavaScript | .js, .ts | CodeDocumentParser | å‡½æ•°/ç±» |

---

**æ–‡æ¡£ç»“æŸ**

*è¯· Review åç¡®è®¤ï¼Œæˆ‘å°†å¼€å§‹å®ç°ã€‚*

