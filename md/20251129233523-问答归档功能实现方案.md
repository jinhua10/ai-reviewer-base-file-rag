# é—®ç­”å½’æ¡£åŠŸèƒ½å®ç°æ–¹æ¡ˆ - è®©çŸ¥è¯†åº“è‡ªæˆ‘è¿›åŒ–

> æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2025-11-29 23:35:23 (åŒ—äº¬æ—¶é—´)
> 
> ä½œè€…ï¼šAI Reviewer Team

---

## ğŸ“‹ ç›®å½•

- [1. æ ¸å¿ƒç†å¿µ](#1-æ ¸å¿ƒç†å¿µ)
- [2. å½“å‰ç³»ç»Ÿçš„å±€é™](#2-å½“å‰ç³»ç»Ÿçš„å±€é™)
- [3. è§£å†³æ–¹æ¡ˆï¼šé—®ç­”å½’æ¡£](#3-è§£å†³æ–¹æ¡ˆé—®ç­”å½’æ¡£)
- [4. è¯¦ç»†å®ç°æ–¹æ¡ˆ](#4-è¯¦ç»†å®ç°æ–¹æ¡ˆ)
- [5. ä»£ç å®ç°](#5-ä»£ç å®ç°)
- [6. é…ç½®è¯´æ˜](#6-é…ç½®è¯´æ˜)
- [7. æ•ˆæœè¯„ä¼°](#7-æ•ˆæœè¯„ä¼°)
- [8. é«˜çº§ç‰¹æ€§](#8-é«˜çº§ç‰¹æ€§)

---

## 1. æ ¸å¿ƒç†å¿µ

### 1.1 é—®é¢˜æè¿°

å½“å‰ç³»ç»Ÿçš„åé¦ˆæœºåˆ¶åªèƒ½ **è°ƒæ•´æ–‡æ¡£æ’åº**ï¼Œä½†æ— æ³• **å¢åŠ æ–°çŸ¥è¯†**ã€‚æ¯æ¬¡ AI ç”Ÿæˆçš„é«˜è´¨é‡å›ç­”éƒ½è¢«"æµªè´¹"äº†ï¼Œæ²¡æœ‰æ²‰æ·€åˆ°çŸ¥è¯†åº“ä¸­ã€‚

### 1.2 æ ¸å¿ƒæ€æƒ³

**å°†æ¯æ¬¡é«˜è´¨é‡çš„é—®ç­”å¯¹è½¬åŒ–ä¸ºæ–°çš„çŸ¥è¯†æ–‡æ¡£**ï¼Œå½¢æˆçŸ¥è¯†åº“çš„è‡ªæˆ‘è¿›åŒ–ï¼š

```
ç”¨æˆ·é—®é¢˜ + AIå›ç­” + æ¥æºæ–‡æ¡£ â†’ æ„å»ºæ–°æ–‡æ¡£ â†’ ç´¢å¼•åˆ°çŸ¥è¯†åº“
                                    â†“
                            æœªæ¥å¯è¢«æ£€ç´¢å’Œå¼•ç”¨
```

### 1.3 é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| çŸ¥è¯†è¦†ç›– | ä»…é™åŸå§‹æ–‡æ¡£ | åŸå§‹æ–‡æ¡£ + é—®ç­”çŸ¥è¯† |
| æ£€ç´¢å‘½ä¸­ç‡ | 60% | 85% |
| é‡å¤é—®é¢˜å“åº”é€Ÿåº¦ | 5ç§’ | 0.5ç§’ï¼ˆç›´æ¥å‘½ä¸­ï¼‰ |
| çŸ¥è¯†æ–°é²œåº¦ | æ‰‹åŠ¨æ›´æ–° | è‡ªåŠ¨ç§¯ç´¯ |

---

## 2. å½“å‰ç³»ç»Ÿçš„å±€é™

### 2.1 åé¦ˆé—­ç¯çš„å±€é™æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å½“å‰åé¦ˆæœºåˆ¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æé—®: "ä»€ä¹ˆæ˜¯ Agentï¼Ÿ"
   â†“
æ£€ç´¢åˆ°: [æ–‡æ¡£A, æ–‡æ¡£B, æ–‡æ¡£C]
   â†“
AIå›ç­”: "Agent æ˜¯ä¸€ç§æ™ºèƒ½ä»£ç†ç³»ç»Ÿ..."ï¼ˆéå¸¸è¯¦ç»†å’Œå‡†ç¡®ï¼‰
   â†“
ç”¨æˆ·åé¦ˆ: ğŸ‘ 5åˆ† "å›ç­”éå¸¸å¥½"
   â†“
ç³»ç»ŸåŠ¨ä½œ: 
  âœ… æå‡æ–‡æ¡£Aã€Bã€Cçš„æƒé‡
  âŒ ä½†æ˜¯ï¼Œè¿™ä¸ªä¼˜è´¨å›ç­”æ²¡æœ‰è¢«ä¿å­˜ä¸ºçŸ¥è¯†ï¼
  
é—®é¢˜:
  1. ä¸‹æ¬¡å…¶ä»–ç”¨æˆ·é—®"Agent æ˜¯ä»€ä¹ˆ"ï¼Œè¿˜éœ€è¦é‡æ–°æ£€ç´¢ã€é‡æ–°ç”Ÿæˆ
  2. å¦‚æœé—®"æ™ºèƒ½ä»£ç†ç³»ç»Ÿçš„ç‰¹ç‚¹"ï¼Œå¯èƒ½æ£€ç´¢ä¸åˆ°ï¼ˆå…³é”®è¯ä¸åŒ¹é…ï¼‰
  3. AI æ¯æ¬¡ç”Ÿæˆçš„å›ç­”å¯èƒ½ä¸ä¸€è‡´
  4. æµªè´¹äº† LLM API è°ƒç”¨æ¬¡æ•°å’Œæˆæœ¬
```

### 2.2 å…·ä½“åœºæ™¯ç¤ºä¾‹

#### åœºæ™¯1ï¼šé‡å¤é—®é¢˜

```
æ—¶é—´çº¿ï¼š
  Day 1: ç”¨æˆ·Aé—® "Agent æ˜¯ä»€ä¹ˆï¼Ÿ"
         â†’ AI ç”Ÿæˆè¯¦ç»†å›ç­”ï¼ˆè€—æ—¶ 5ç§’ï¼ŒèŠ±è´¹ $0.01ï¼‰
         â†’ ç”¨æˆ·A ç»™ 5åˆ†å¥½è¯„
         
  Day 2: ç”¨æˆ·Bé—® "ä»€ä¹ˆæ˜¯ Agentï¼Ÿ"ï¼ˆå‡ ä¹ç›¸åŒçš„é—®é¢˜ï¼‰
         â†’ ç³»ç»Ÿé‡æ–°æ£€ç´¢ï¼Œé‡æ–°ç”Ÿæˆï¼ˆåˆè€—æ—¶ 5ç§’ï¼ŒèŠ±è´¹ $0.01ï¼‰
         â†’ å›ç­”å¯èƒ½ä¸ Day 1 ä¸åŒï¼ˆä¸ä¸€è‡´æ€§ï¼‰
```

**é—®é¢˜**ï¼š
- âŒ é‡å¤è®¡ç®—æµªè´¹
- âŒ å“åº”é€Ÿåº¦æ…¢
- âŒ API æˆæœ¬é«˜
- âŒ å›ç­”ä¸ä¸€è‡´

#### åœºæ™¯2ï¼šå˜ä½“é—®é¢˜

```
ç”¨æˆ·é—®é¢˜å˜ä½“ï¼š
  - "Agent æ˜¯ä»€ä¹ˆï¼Ÿ"
  - "ä»€ä¹ˆæ˜¯æ™ºèƒ½ä»£ç†ï¼Ÿ"
  - "è§£é‡Šä¸€ä¸‹ Agent ç³»ç»Ÿ"
  - "Agent çš„å®šä¹‰"
  
é—®é¢˜ï¼š
  å¦‚æœåŸå§‹æ–‡æ¡£æ²¡æœ‰ç›´æ¥å‡ºç° "æ™ºèƒ½ä»£ç†" è¿™ä¸ªè¯ï¼Œ
  å‘é‡æ£€ç´¢å¯èƒ½æ•ˆæœä¸ä½³ï¼Œéœ€è¦ AI ç†è§£å’Œæ¨ç†ã€‚
  
  ä½†å¦‚æœä¹‹å‰çš„é—®ç­”å·²å½’æ¡£ä¸ºæ–‡æ¡£ï¼š
  â†’ å¯ä»¥ç›´æ¥å‘½ä¸­ "Agent æ˜¯æ™ºèƒ½ä»£ç†ç³»ç»Ÿ" è¿™å¥è¯
  â†’ å“åº”æ›´å¿«ï¼Œæ›´å‡†ç¡®
```

---

## 3. è§£å†³æ–¹æ¡ˆï¼šé—®ç­”å½’æ¡£

### 3.1 æ ¸å¿ƒæœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é—®ç­”å½’æ¡£æœºåˆ¶                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æé—®: "ä»€ä¹ˆæ˜¯ Agentï¼Ÿ"
   â†“
æ£€ç´¢ â†’ AIå›ç­” â†’ ä¿å­˜é—®ç­”è®°å½•
   â†“
ç”¨æˆ·åé¦ˆ: ğŸ‘ 5åˆ†
   â†“
è§¦å‘å½’æ¡£:
  1. æ„å»ºæ–°æ–‡æ¡£ï¼ˆMarkdown æ ¼å¼ï¼‰
     â”œâ”€ æ ‡é¢˜ï¼šç”¨æˆ·é—®é¢˜
     â”œâ”€ å†…å®¹ï¼šAI å›ç­”
     â”œâ”€ å…ƒæ•°æ®ï¼šæ¥æºæ–‡æ¡£ã€è¯„åˆ†ã€æ—¶é—´
     â””â”€ æ ‡ç­¾ï¼šè‡ªåŠ¨æå–çš„å…³é”®è¯
     
  2. ä¿å­˜åˆ°å½’æ¡£ç›®å½•
     è·¯å¾„: ./data/rag/20251129233523-QA-ä»€ä¹ˆæ˜¯Agent.md
     
  3. å¢é‡ç´¢å¼•æ–°æ–‡æ¡£
     â†’ Lucene ç´¢å¼•
     â†’ å‘é‡ç´¢å¼•
     
  4. ç«‹å³ç”Ÿæ•ˆ
     ä¸‹æ¬¡æ£€ç´¢å¯ä»¥å‘½ä¸­è¿™ä¸ªæ–‡æ¡£
```

### 3.2 å½’æ¡£ç­–ç•¥

#### ç­–ç•¥Aï¼šè‡ªåŠ¨å½’æ¡£ï¼ˆæ¨èç”¨äºå†…éƒ¨ç³»ç»Ÿï¼‰

**è§¦å‘æ¡ä»¶**ï¼š
- é—®é¢˜é•¿åº¦ >= 10 å­—ç¬¦
- å›ç­”é•¿åº¦ >= 50 å­—ç¬¦
- å›ç­”ä¸åŒ…å« "æ— æ³•å›ç­”"ã€"æ²¡æœ‰ç›¸å…³ä¿¡æ¯"

**ä¼˜ç‚¹**ï¼š
- âœ… çŸ¥è¯†ç§¯ç´¯é€Ÿåº¦å¿«
- âœ… æ— éœ€äººå·¥ä»‹å…¥

**ç¼ºç‚¹**ï¼š
- âš ï¸ å¯èƒ½åŒ…å«ä½è´¨é‡é—®ç­”
- âš ï¸ éœ€è¦å®šæœŸæ¸…ç†

#### ç­–ç•¥Bï¼šåŸºäºåé¦ˆå½’æ¡£ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

**è§¦å‘æ¡ä»¶**ï¼š
- ç”¨æˆ·è¯„åˆ† >= 4 åˆ†
- æˆ–è€…ï¼Œæ–‡æ¡£åé¦ˆä¸­ç‚¹èµæ•° >= ç‚¹è¸©æ•°

**ä¼˜ç‚¹**ï¼š
- âœ… è´¨é‡æœ‰ä¿è¯
- âœ… ç”¨æˆ·å‚ä¸ç­›é€‰

**ç¼ºç‚¹**ï¼š
- âš ï¸ ç§¯ç´¯é€Ÿåº¦è¾ƒæ…¢
- âš ï¸ ä¾èµ–ç”¨æˆ·åé¦ˆ

#### ç­–ç•¥Cï¼šæ··åˆç­–ç•¥ï¼ˆæœ€ä½³å®è·µï¼‰

```
è‡ªåŠ¨å½’æ¡£ï¼ˆä¸´æ—¶ï¼‰ + åé¦ˆå®¡æ ¸ï¼ˆæ°¸ä¹…ï¼‰

æµç¨‹:
  1. æ‰€æœ‰é—®ç­”è‡ªåŠ¨å½’æ¡£åˆ° ./data/rag/temp/
  2. ä¸´æ—¶æ–‡æ¡£å¯è¢«æ£€ç´¢ï¼Œä½†æœ‰ "ä¸´æ—¶" æ ‡è®°
  3. ç”¨æˆ·åé¦ˆ >= 4åˆ† â†’ ç§»åŠ¨åˆ° ./data/rag/approved/ï¼Œæˆä¸ºæ°¸ä¹…çŸ¥è¯†
  4. ç”¨æˆ·åé¦ˆ <= 2åˆ† â†’ ç§»åŠ¨åˆ° ./data/rag/rejected/ï¼Œä¸å†æ£€ç´¢
  5. å®šæœŸæ¸…ç† 30å¤© å†…æœªè¢«åé¦ˆçš„ä¸´æ—¶æ–‡æ¡£
```

---

## 4. è¯¦ç»†å®ç°æ–¹æ¡ˆ

### 4.1 æ•°æ®ç»“æ„è®¾è®¡

#### 4.1.1 å½’æ¡£æ–‡æ¡£æ ¼å¼ï¼ˆMarkdownï¼‰

```markdown
---
# YAML Front Matterï¼ˆå…ƒæ•°æ®ï¼‰
id: "a1b2c3d4-e5f6-7890"
question: "ä»€ä¹ˆæ˜¯ Agentï¼Ÿ"
timestamp: "2025-11-29T23:30:46"
rating: 5
feedbackCount: 3
status: "approved"
category: "æ¦‚å¿µè§£é‡Š"
keywords: ["Agent", "æ™ºèƒ½ä»£ç†", "è‡ªä¸»æ€§"]
sourceDocuments: ["åŸ¹è®­é€šçŸ¥.pdf", "AIç³»ç»Ÿæ–‡æ¡£.docx"]
usageCount: 12
lastUsed: "2025-11-30T10:15:30"
---

# ä»€ä¹ˆæ˜¯ Agentï¼Ÿ

> **ç±»å‹**: æ¦‚å¿µè§£é‡Š  
> **æ¥æº**: åŸºäº 3 ä¸ªæ–‡æ¡£ç”Ÿæˆ  
> **è¯„åˆ†**: â­â­â­â­â­ (5.0)  
> **å¼•ç”¨æ¬¡æ•°**: 12 æ¬¡

## å›ç­”

Agent æ˜¯ä¸€ç§æ™ºèƒ½ä»£ç†ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹å¾ï¼š

### 1. è‡ªä¸»æ€§ï¼ˆAutonomyï¼‰
Agent èƒ½å¤Ÿåœ¨æ²¡æœ‰äººç±»ç›´æ¥æ§åˆ¶çš„æƒ…å†µä¸‹ç‹¬ç«‹è¿ä½œï¼Œè‡ªä¸»åšå‡ºå†³ç­–å’Œæ‰§è¡Œä»»åŠ¡ã€‚

### 2. ååº”æ€§ï¼ˆReactivityï¼‰
Agent èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒçš„å˜åŒ–ï¼Œå¹¶åŠæ—¶åšå‡ºé€‚å½“çš„å“åº”ã€‚

### 3. ä¸»åŠ¨æ€§ï¼ˆProactivityï¼‰
Agent ä¸ä»…èƒ½è¢«åŠ¨å“åº”ï¼Œè¿˜èƒ½ä¸»åŠ¨é‡‡å–è¡ŒåŠ¨ä»¥è¾¾æˆé¢„è®¾çš„ç›®æ ‡ã€‚

### 4. ç¤¾äº¤æ€§ï¼ˆSocial Abilityï¼‰
Agent èƒ½å¤Ÿä¸å…¶ä»– Agent æˆ–äººç±»ç”¨æˆ·è¿›è¡Œäº¤äº’å’Œåä½œã€‚

## åº”ç”¨åœºæ™¯

åœ¨æœ¬ç³»ç»Ÿä¸­ï¼ŒAgent å¯ç”¨äºï¼š
- ğŸ¤– è‡ªåŠ¨åŒ–çŸ¥è¯†åº“ç®¡ç†
- ğŸ’¬ æ™ºèƒ½é—®ç­”æœåŠ¡
- ğŸ“Š æ•°æ®åˆ†æä¸æŠ¥å‘Š
- ğŸ” æ™ºèƒ½æ£€ç´¢ä¼˜åŒ–

## æ¥æºæ–‡æ¡£

æœ¬å›ç­”ç»¼åˆäº†ä»¥ä¸‹æ–‡æ¡£çš„å†…å®¹ï¼š

1. **åŸ¹è®­é€šçŸ¥.pdf** (ç›¸å…³åº¦: 0.85)
   - ç¬¬3é¡µï¼šAgent ç³»ç»Ÿæ¶æ„
   
2. **AIç³»ç»Ÿæ¶æ„æ–‡æ¡£.docx** (ç›¸å…³åº¦: 0.92)
   - ç¬¬2.1èŠ‚ï¼šæ™ºèƒ½ä»£ç†æ¦‚è¿°
   
3. **æŠ€æœ¯ç™½çš®ä¹¦.pdf** (ç›¸å…³åº¦: 0.78)
   - ç¬¬5ç« ï¼šå¤š Agent ç³»ç»Ÿ

## ç”¨æˆ·åé¦ˆ

- ğŸ‘ **3 äººç‚¹èµ**
- ğŸ’¬ ç”¨æˆ·è¯„ä»·ï¼š
  - "è§£é‡Šéå¸¸æ¸…æ™°" - 2025-11-29
  - "ç¤ºä¾‹å¾ˆæœ‰å¸®åŠ©" - 2025-11-29

---

**ç”Ÿæˆæ—¶é—´**: 2025-11-29 23:30:46  
**æœ€åæ›´æ–°**: 2025-11-30 10:15:30  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.2
```

#### 4.1.2 ç›®å½•ç»“æ„

```
data/rag/
â”œâ”€â”€ approved/                    # å·²å®¡æ ¸çš„æ°¸ä¹…çŸ¥è¯†
â”‚   â”œâ”€â”€ concept/                # æ¦‚å¿µè§£é‡Šç±»
â”‚   â”‚   â”œâ”€â”€ 20251129233046-ä»€ä¹ˆæ˜¯Agent.md
â”‚   â”‚   â””â”€â”€ 20251129235678-MASå¤šä»£ç†ç³»ç»Ÿ.md
â”‚   â”œâ”€â”€ howto/                  # æ“ä½œæŒ‡å—ç±»
â”‚   â”‚   â””â”€â”€ 20251130101234-å¦‚ä½•é…ç½®å‘é‡æ£€ç´¢.md
â”‚   â””â”€â”€ troubleshooting/        # é—®é¢˜æ’æŸ¥ç±»
â”‚       â””â”€â”€ 20251130112345-ç´¢å¼•æ„å»ºå¤±è´¥.md
â”‚
â”œâ”€â”€ temp/                       # ä¸´æ—¶çŸ¥è¯†ï¼ˆå¾…å®¡æ ¸ï¼‰
â”‚   â””â”€â”€ 20251130123456-ä»€ä¹ˆæ˜¯RAG.md
â”‚
â”œâ”€â”€ rejected/                   # å·²æ‹’ç»ï¼ˆå½’æ¡£ä½†ä¸æ£€ç´¢ï¼‰
â”‚   â””â”€â”€ 20251130123457-æµ‹è¯•é—®é¢˜.md
â”‚
â””â”€â”€ index.json                  # å½’æ¡£ç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥æ‰¾ï¼‰
```

### 4.2 å½’æ¡£ç´¢å¼•ï¼ˆindex.jsonï¼‰

```json
{
  "version": "1.0",
  "totalDocuments": 156,
  "lastUpdated": "2025-11-30T12:34:56",
  "categories": {
    "concept": 45,
    "howto": 38,
    "troubleshooting": 23,
    "other": 50
  },
  "documents": [
    {
      "id": "a1b2c3d4",
      "path": "approved/concept/20251129233046-ä»€ä¹ˆæ˜¯Agent.md",
      "question": "ä»€ä¹ˆæ˜¯ Agentï¼Ÿ",
      "category": "concept",
      "keywords": ["Agent", "æ™ºèƒ½ä»£ç†"],
      "rating": 5.0,
      "usageCount": 12,
      "status": "approved",
      "created": "2025-11-29T23:30:46",
      "lastUsed": "2025-11-30T10:15:30"
    }
  ]
}
```

---

## 5. ä»£ç å®ç°

### 5.1 æ ¸å¿ƒæœåŠ¡ç±»ï¼šQAArchiveService

```java
package top.yumbo.ai.rag.spring.boot.service;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import top.yumbo.ai.rag.feedback.QARecord;
import top.yumbo.ai.rag.model.Document;
import top.yumbo.ai.rag.spring.boot.config.QAArchiveProperties;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.time.LocalDateTime;
import java.time.ZoneId;
import java.time.format.DateTimeFormatter;
import java.util.List;
import java.util.stream.Collectors;

/**
 * é—®ç­”å½’æ¡£æœåŠ¡
 * å°†é«˜è´¨é‡é—®ç­”è½¬åŒ–ä¸ºæ–°çš„çŸ¥è¯†æ–‡æ¡£
 *
 * @author AI Reviewer Team
 * @since 2025-11-29
 */
@Slf4j
@Service
public class QAArchiveService {

    private static final DateTimeFormatter FILENAME_FORMATTER =
        DateTimeFormatter.ofPattern("yyyyMMddHHmmss");
    
    private final QAArchiveProperties archiveProperties;
    private final KnowledgeBaseService knowledgeBaseService;
    private final Path archivePath;

    public QAArchiveService(QAArchiveProperties archiveProperties,
                           KnowledgeBaseService knowledgeBaseService) {
        this.archiveProperties = archiveProperties;
        this.knowledgeBaseService = knowledgeBaseService;
        this.archivePath = Paths.get(archiveProperties.getArchivePath());
        
        // åˆå§‹åŒ–ç›®å½•ç»“æ„
        initDirectories();
    }

    /**
     * åˆå§‹åŒ–ç›®å½•ç»“æ„
     */
    private void initDirectories() {
        try {
            Files.createDirectories(archivePath.resolve("approved/concept"));
            Files.createDirectories(archivePath.resolve("approved/howto"));
            Files.createDirectories(archivePath.resolve("approved/troubleshooting"));
            Files.createDirectories(archivePath.resolve("approved/other"));
            Files.createDirectories(archivePath.resolve("temp"));
            Files.createDirectories(archivePath.resolve("rejected"));
            
            log.info("ğŸ“‚ é—®ç­”å½’æ¡£ç›®å½•åˆå§‹åŒ–å®Œæˆ: {}", archivePath.toAbsolutePath());
        } catch (IOException e) {
            log.error("âŒ åˆå§‹åŒ–å½’æ¡£ç›®å½•å¤±è´¥", e);
        }
    }

    /**
     * åˆ¤æ–­æ˜¯å¦åº”è¯¥å½’æ¡£
     */
    public boolean shouldArchive(QARecord record) {
        if (!archiveProperties.isEnabled()) {
            return false;
        }

        String strategy = archiveProperties.getStrategy();
        
        switch (strategy) {
            case "auto":
                return shouldArchiveAuto(record);
            case "feedback-based":
                return shouldArchiveFeedbackBased(record);
            case "manual":
                return false; // æ‰‹åŠ¨æ¨¡å¼ä¸è‡ªåŠ¨å½’æ¡£
            default:
                log.warn("âš ï¸ æœªçŸ¥çš„å½’æ¡£ç­–ç•¥: {}", strategy);
                return false;
        }
    }

    /**
     * è‡ªåŠ¨å½’æ¡£ç­–ç•¥
     */
    private boolean shouldArchiveAuto(QARecord record) {
        // æ£€æŸ¥é—®é¢˜é•¿åº¦
        if (record.getQuestion().length() < archiveProperties.getMinQuestionLength()) {
            return false;
        }

        // æ£€æŸ¥å›ç­”é•¿åº¦
        if (record.getAnswer().length() < archiveProperties.getMinAnswerLength()) {
            return false;
        }

        // æ£€æŸ¥æ˜¯å¦åŒ…å« "æ— æ³•å›ç­”" ç­‰å…³é”®è¯
        String answer = record.getAnswer().toLowerCase();
        if (answer.contains("æ— æ³•å›ç­”") || 
            answer.contains("æ²¡æœ‰ç›¸å…³ä¿¡æ¯") ||
            answer.contains("æŠ±æ­‰") ||
            answer.contains("æ— æ³•æ‰¾åˆ°")) {
            return false;
        }

        return true;
    }

    /**
     * åŸºäºåé¦ˆçš„å½’æ¡£ç­–ç•¥
     */
    private boolean shouldArchiveFeedbackBased(QARecord record) {
        // å¿…é¡»æœ‰è¯„åˆ†
        if (record.getOverallRating() == null) {
            return false;
        }

        // è¯„åˆ†å¿…é¡» >= é˜ˆå€¼
        if (record.getOverallRating() < archiveProperties.getMinRating()) {
            return false;
        }

        // åŒæ—¶æ»¡è¶³è‡ªåŠ¨å½’æ¡£çš„åŸºæœ¬æ¡ä»¶
        return shouldArchiveAuto(record);
    }

    /**
     * å½’æ¡£é—®ç­”ä¸ºæ–°æ–‡æ¡£
     */
    public String archiveQA(QARecord record) {
        try {
            // 1. æ„å»ºæ–‡æ¡£å†…å®¹
            String content = buildDocumentContent(record);

            // 2. ç¡®å®šåˆ†ç±»å’Œè·¯å¾„
            String category = detectCategory(record.getQuestion(), record.getAnswer());
            String status = determineStatus(record);
            
            // 3. ç”Ÿæˆæ–‡ä»¶åï¼ˆä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼‰
            LocalDateTime beijingTime = LocalDateTime.now(ZoneId.of("Asia/Shanghai"));
            String timestamp = beijingTime.format(FILENAME_FORMATTER);
            String questionPrefix = sanitizeFileName(
                record.getQuestion().substring(0, Math.min(20, record.getQuestion().length()))
            );
            String fileName = String.format("%s-QA-%s.md", timestamp, questionPrefix);

            // 4. ç¡®å®šä¿å­˜è·¯å¾„
            Path targetPath;
            if ("approved".equals(status)) {
                targetPath = archivePath.resolve("approved").resolve(category).resolve(fileName);
            } else {
                targetPath = archivePath.resolve("temp").resolve(fileName);
            }

            // 5. ä¿å­˜æ–‡ä»¶
            Files.writeString(targetPath, content);
            log.info("ğŸ’¾ é—®ç­”å½’æ¡£æˆåŠŸ: {}", targetPath.getFileName());

            // 6. è‡ªåŠ¨ç´¢å¼•ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
            if (archiveProperties.isAutoIndex()) {
                knowledgeBaseService.incrementalIndexFile(targetPath);
                log.info("ğŸ“‘ å½’æ¡£æ–‡æ¡£å·²ç´¢å¼•: {}", fileName);
            }

            return targetPath.toString();

        } catch (Exception e) {
            log.error("âŒ é—®ç­”å½’æ¡£å¤±è´¥: recordId={}", record.getId(), e);
            return null;
        }
    }

    /**
     * æ„å»ºæ–‡æ¡£å†…å®¹ï¼ˆMarkdown æ ¼å¼ï¼‰
     */
    private String buildDocumentContent(QARecord record) {
        StringBuilder content = new StringBuilder();

        // YAML Front Matter
        content.append("---\n");
        content.append("id: \"").append(record.getId()).append("\"\n");
        content.append("question: \"").append(escapeYaml(record.getQuestion())).append("\"\n");
        content.append("timestamp: \"").append(record.getTimestamp()).append("\"\n");
        if (record.getOverallRating() != null) {
            content.append("rating: ").append(record.getOverallRating()).append("\n");
        }
        content.append("status: \"").append(determineStatus(record)).append("\"\n");
        content.append("category: \"").append(detectCategory(record.getQuestion(), record.getAnswer())).append("\"\n");
        
        // å…³é”®è¯
        List<String> keywords = extractKeywords(record.getQuestion(), record.getAnswer());
        content.append("keywords: [");
        content.append(keywords.stream()
            .map(k -> "\"" + k + "\"")
            .collect(Collectors.joining(", ")));
        content.append("]\n");
        
        // æ¥æºæ–‡æ¡£
        if (record.getUsedDocuments() != null && !record.getUsedDocuments().isEmpty()) {
            content.append("sourceDocuments: [");
            content.append(record.getUsedDocuments().stream()
                .map(d -> "\"" + d + "\"")
                .collect(Collectors.joining(", ")));
            content.append("]\n");
        }
        
        content.append("usageCount: 1\n");
        content.append("lastUsed: \"").append(LocalDateTime.now()).append("\"\n");
        content.append("---\n\n");

        // ä¸»æ ‡é¢˜
        content.append("# ").append(record.getQuestion()).append("\n\n");

        // å…ƒæ•°æ®æ‘˜è¦
        content.append("> **ç±»å‹**: ").append(getCategoryDisplayName(detectCategory(record.getQuestion(), record.getAnswer()))).append("  \n");
        if (record.getUsedDocuments() != null) {
            content.append("> **æ¥æº**: åŸºäº ").append(record.getUsedDocuments().size()).append(" ä¸ªæ–‡æ¡£ç”Ÿæˆ  \n");
        }
        if (record.getOverallRating() != null) {
            content.append("> **è¯„åˆ†**: ").append("â­".repeat(record.getOverallRating())).append(" (").append(record.getOverallRating()).append(".0)  \n");
        }
        content.append("\n");

        // å›ç­”å†…å®¹
        content.append("## å›ç­”\n\n");
        content.append(record.getAnswer()).append("\n\n");

        // æ¥æºæ–‡æ¡£è¯¦æƒ…
        if (record.getUsedDocuments() != null && !record.getUsedDocuments().isEmpty()) {
            content.append("## æ¥æºæ–‡æ¡£\n\n");
            content.append("æœ¬å›ç­”ç»¼åˆäº†ä»¥ä¸‹æ–‡æ¡£çš„å†…å®¹ï¼š\n\n");
            for (int i = 0; i < record.getUsedDocuments().size(); i++) {
                content.append(i + 1).append(". **").append(record.getUsedDocuments().get(i)).append("**\n");
            }
            content.append("\n");
        }

        // ç”¨æˆ·åé¦ˆ
        if (record.getDocumentFeedbacks() != null && !record.getDocumentFeedbacks().isEmpty()) {
            content.append("## ç”¨æˆ·åé¦ˆ\n\n");
            long likeCount = record.getDocumentFeedbacks().stream()
                .filter(f -> f.getFeedbackType() == QARecord.FeedbackType.LIKE)
                .count();
            content.append("- ğŸ‘ **").append(likeCount).append(" äººç‚¹èµ**\n");
            
            if (record.getOverallFeedback() != null) {
                content.append("- ğŸ’¬ ç”¨æˆ·è¯„ä»·ï¼š\"").append(record.getOverallFeedback()).append("\"\n");
            }
            content.append("\n");
        }

        // é¡µè„š
        content.append("---\n\n");
        content.append("**ç”Ÿæˆæ—¶é—´**: ").append(record.getTimestamp()).append("  \n");
        content.append("**æ–‡æ¡£ç‰ˆæœ¬**: 1.0\n");

        return content.toString();
    }

    /**
     * æ£€æµ‹é—®é¢˜ç±»åˆ«
     */
    private String detectCategory(String question, String answer) {
        question = question.toLowerCase();
        
        if (question.contains("ä»€ä¹ˆæ˜¯") || question.contains("æ˜¯ä»€ä¹ˆ") || 
            question.contains("å®šä¹‰") || question.contains("è§£é‡Š")) {
            return "concept";
        }
        
        if (question.contains("å¦‚ä½•") || question.contains("æ€ä¹ˆ") || 
            question.contains("æ€æ ·") || question.contains("æ€ä¹ˆæ ·")) {
            return "howto";
        }
        
        if (question.contains("å¤±è´¥") || question.contains("é”™è¯¯") || 
            question.contains("é—®é¢˜") || question.contains("ä¸ºä»€ä¹ˆä¸")) {
            return "troubleshooting";
        }
        
        return "other";
    }

    /**
     * è·å–åˆ†ç±»æ˜¾ç¤ºåç§°
     */
    private String getCategoryDisplayName(String category) {
        switch (category) {
            case "concept": return "æ¦‚å¿µè§£é‡Š";
            case "howto": return "æ“ä½œæŒ‡å—";
            case "troubleshooting": return "é—®é¢˜æ’æŸ¥";
            default: return "å…¶ä»–";
        }
    }

    /**
     * ç¡®å®šæ–‡æ¡£çŠ¶æ€
     */
    private String determineStatus(QARecord record) {
        if ("feedback-based".equals(archiveProperties.getStrategy())) {
            return record.getOverallRating() != null && 
                   record.getOverallRating() >= archiveProperties.getMinRating() 
                   ? "approved" : "temp";
        }
        return "temp"; // è‡ªåŠ¨å½’æ¡£é»˜è®¤ä¸ºä¸´æ—¶çŠ¶æ€
    }

    /**
     * æå–å…³é”®è¯
     */
    private List<String> extractKeywords(String question, String answer) {
        // ç®€å•å®ç°ï¼šæå–é—®é¢˜ä¸­çš„åè¯
        // ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ NLP å·¥å…·ï¼ˆå¦‚ HanLPï¼‰
        List<String> stopWords = List.of(
            "çš„", "æ˜¯", "åœ¨", "äº†", "å’Œ", "æœ‰", "æˆ‘", "ä½ ", "ä»–", "å¥¹",
            "ä»€ä¹ˆ", "æ€ä¹ˆ", "å¦‚ä½•", "ä¸ºä»€ä¹ˆ", "å—", "å‘¢", "å•Š"
        );
        
        return java.util.Arrays.stream(question.split("[\\sï¼Œã€‚ï¼ï¼Ÿã€ï¼›ï¼š]"))
            .filter(word -> word.length() > 1)
            .filter(word -> !stopWords.contains(word))
            .limit(5)
            .collect(Collectors.toList());
    }

    /**
     * æ¸…ç†æ–‡ä»¶åï¼ˆç§»é™¤éæ³•å­—ç¬¦ï¼‰
     */
    private String sanitizeFileName(String fileName) {
        return fileName.replaceAll("[\\\\/:*?\"<>|]", "_");
    }

    /**
     * è½¬ä¹‰ YAML ç‰¹æ®Šå­—ç¬¦
     */
    private String escapeYaml(String text) {
        return text.replace("\"", "\\\"").replace("\n", "\\n");
    }

    /**
     * å®¡æ ¸å½’æ¡£æ–‡æ¡£ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
     */
    public boolean reviewArchive(String archiveId, String action) {
        // action: "approve", "reject"
        try {
            // æŸ¥æ‰¾ä¸´æ—¶æ–‡æ¡£
            Path tempFile = findArchiveFile(archiveId, "temp");
            if (tempFile == null) {
                log.warn("âš ï¸ å½’æ¡£æ–‡æ¡£ä¸å­˜åœ¨: {}", archiveId);
                return false;
            }

            // ç§»åŠ¨æ–‡ä»¶
            if ("approve".equals(action)) {
                // è¯»å–æ–‡æ¡£ç¡®å®šåˆ†ç±»
                String content = Files.readString(tempFile);
                String category = extractCategoryFromContent(content);
                
                Path approvedPath = archivePath.resolve("approved")
                    .resolve(category)
                    .resolve(tempFile.getFileName());
                    
                Files.move(tempFile, approvedPath);
                log.info("âœ… å½’æ¡£æ–‡æ¡£å·²æ‰¹å‡†: {}", tempFile.getFileName());
                return true;
                
            } else if ("reject".equals(action)) {
                Path rejectedPath = archivePath.resolve("rejected")
                    .resolve(tempFile.getFileName());
                    
                Files.move(tempFile, rejectedPath);
                log.info("âŒ å½’æ¡£æ–‡æ¡£å·²æ‹’ç»: {}", tempFile.getFileName());
                return true;
            }

            return false;

        } catch (IOException e) {
            log.error("å®¡æ ¸å½’æ¡£æ–‡æ¡£å¤±è´¥: archiveId={}", archiveId, e);
            return false;
        }
    }

    /**
     * æŸ¥æ‰¾å½’æ¡£æ–‡ä»¶
     */
    private Path findArchiveFile(String archiveId, String directory) throws IOException {
        Path searchPath = archivePath.resolve(directory);
        return Files.walk(searchPath)
            .filter(Files::isRegularFile)
            .filter(p -> p.toString().contains(archiveId))
            .findFirst()
            .orElse(null);
    }

    /**
     * ä»æ–‡æ¡£å†…å®¹ä¸­æå–åˆ†ç±»
     */
    private String extractCategoryFromContent(String content) {
        // ä» YAML Front Matter ä¸­æå–
        if (content.contains("category:")) {
            String line = content.lines()
                .filter(l -> l.startsWith("category:"))
                .findFirst()
                .orElse("");
            return line.replaceAll("category:\\s*\"(.*)\"", "$1");
        }
        return "other";
    }
}
```

### 5.2 é…ç½®ç±»ï¼šQAArchiveProperties

```java
package top.yumbo.ai.rag.spring.boot.config;

import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

/**
 * é—®ç­”å½’æ¡£é…ç½®
 *
 * @author AI Reviewer Team
 * @since 2025-11-29
 */
@Data
@Component
@ConfigurationProperties(prefix = "knowledge.qa.qa-archive")
public class QAArchiveProperties {

    /**
     * æ˜¯å¦å¯ç”¨å½’æ¡£
     */
    private boolean enabled = true;

    /**
     * å½’æ¡£ç­–ç•¥
     * - auto: è‡ªåŠ¨å½’æ¡£æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é—®ç­”
     * - feedback-based: åŸºäºç”¨æˆ·åé¦ˆå½’æ¡£ï¼ˆæ¨èï¼‰
     * - manual: æ‰‹åŠ¨å®¡æ ¸åå½’æ¡£
     */
    private String strategy = "feedback-based";

    /**
     * æœ€ä½è¯„åˆ†é˜ˆå€¼ï¼ˆfeedback-based æ¨¡å¼ï¼‰
     */
    private int minRating = 4;

    /**
     * é—®é¢˜æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
     */
    private int minQuestionLength = 10;

    /**
     * å›ç­”æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
     */
    private int minAnswerLength = 50;

    /**
     * å½’æ¡£è·¯å¾„
     */
    private String archivePath = "./data/rag";

    /**
     * æ˜¯å¦è‡ªåŠ¨ç´¢å¼•å½’æ¡£çš„æ–‡æ¡£
     */
    private boolean autoIndex = true;

    /**
     * ä¸´æ—¶æ–‡æ¡£è¿‡æœŸå¤©æ•°ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
     */
    private int tempDocumentExpiryDays = 30;
}
```

### 5.3 é›†æˆåˆ° KnowledgeQAService

```java
// åœ¨ KnowledgeQAService.java ä¸­

@Autowired
private QAArchiveService qaArchiveService;

// åœ¨ answer() æ–¹æ³•æœ«å°¾æ·»åŠ 
public Map<String, Object> answer(String question, String sessionId) {
    // ... ç°æœ‰é€»è¾‘ ...
    
    // ä¿å­˜é—®ç­”è®°å½•
    String recordId = qaRecordService.saveRecord(record);
    
    // âœ¨ æ–°å¢ï¼šå°è¯•å½’æ¡£
    if (qaArchiveService.shouldArchive(record)) {
        String archivePath = qaArchiveService.archiveQA(record);
        if (archivePath != null) {
            log.info("ğŸ“š é—®ç­”å·²å½’æ¡£: {}", archivePath);
        }
    }
    
    return response;
}
```

### 5.4 é›†æˆåˆ° QARecordService

```java
// åœ¨ QARecordService.addOverallFeedback() ä¸­

@Autowired
private QAArchiveService qaArchiveService;

public boolean addOverallFeedback(String recordId, int rating, String feedback) {
    // ... ç°æœ‰é€»è¾‘ ...
    
    boolean updated = updateRecord(record);
    
    // âœ¨ æ–°å¢ï¼šé«˜è¯„åˆ†è‡ªåŠ¨å½’æ¡£
    if (updated && rating >= 4 && qaArchiveService.shouldArchive(record)) {
        String archivePath = qaArchiveService.archiveQA(record);
        if (archivePath != null) {
            log.info("â­ é«˜è¯„åˆ†é—®ç­”å·²å½’æ¡£: rating={}, path={}", rating, archivePath);
        }
    }
    
    return updated;
}
```

---

## 6. é…ç½®è¯´æ˜

### 6.1 application.yml é…ç½®

```yaml
knowledge:
  qa:
    # é—®ç­”å½’æ¡£é…ç½®
    qa-archive:
      # æ˜¯å¦å¯ç”¨å½’æ¡£
      enabled: true
      
      # å½’æ¡£ç­–ç•¥
      # - auto: è‡ªåŠ¨å½’æ¡£æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é—®ç­”
      # - feedback-based: åŸºäºç”¨æˆ·åé¦ˆå½’æ¡£ï¼ˆæ¨èï¼‰
      # - manual: æ‰‹åŠ¨å®¡æ ¸åå½’æ¡£
      strategy: feedback-based
      
      # æœ€ä½è¯„åˆ†é˜ˆå€¼ï¼ˆfeedback-based æ¨¡å¼ï¼‰
      # åªæœ‰è¯„åˆ† >= æ­¤å€¼çš„é—®ç­”æ‰ä¼šè¢«å½’æ¡£
      min-rating: 4
      
      # é—®é¢˜æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # è¿‡çŸ­çš„é—®é¢˜ä¸å½’æ¡£
      min-question-length: 10
      
      # å›ç­”æœ€çŸ­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # è¿‡çŸ­çš„å›ç­”ä¸å½’æ¡£
      min-answer-length: 50
      
      # å½’æ¡£è·¯å¾„
      # å½’æ¡£çš„æ–‡æ¡£ä¿å­˜ä½ç½®
      archive-path: ./data/rag
      
      # æ˜¯å¦è‡ªåŠ¨ç´¢å¼•å½’æ¡£çš„æ–‡æ¡£
      # true: å½’æ¡£åç«‹å³ç´¢å¼•ï¼Œä¸‹æ¬¡æ£€ç´¢å¯ç”¨
      # false: éœ€è¦æ‰‹åŠ¨è§¦å‘ç´¢å¼•
      auto-index: true
      
      # ä¸´æ—¶æ–‡æ¡£è¿‡æœŸå¤©æ•°
      # temp/ ç›®å½•ä¸­çš„æ–‡æ¡£ï¼Œè¶…è¿‡æ­¤å¤©æ•°æœªè¢«åé¦ˆåˆ™è‡ªåŠ¨åˆ é™¤
      temp-document-expiry-days: 30
```

### 6.2 ä¸åŒåœºæ™¯çš„æ¨èé…ç½®

#### åœºæ™¯1ï¼šå†…éƒ¨çŸ¥è¯†åº“ï¼ˆå›¢é˜Ÿåä½œï¼‰

```yaml
qa-archive:
  enabled: true
  strategy: auto
  min-question-length: 5
  min-answer-length: 30
  auto-index: true
```

**ç‰¹ç‚¹**ï¼š
- å¿«é€Ÿç§¯ç´¯çŸ¥è¯†
- ä½é—¨æ§›å½’æ¡£
- ä¾é å›¢é˜Ÿè‡ªå¾‹

#### åœºæ™¯2ï¼šå®¢æˆ·æœåŠ¡ç³»ç»Ÿ

```yaml
qa-archive:
  enabled: true
  strategy: feedback-based
  min-rating: 4
  min-question-length: 10
  min-answer-length: 50
  auto-index: true
```

**ç‰¹ç‚¹**ï¼š
- ä¿è¯è´¨é‡
- ç”¨æˆ·å‚ä¸
- å¯ä¿¡åº¦é«˜

#### åœºæ™¯3ï¼šå…¬å¼€çŸ¥è¯†åº“

```yaml
qa-archive:
  enabled: true
  strategy: manual
  min-rating: 5
  auto-index: false
```

**ç‰¹ç‚¹**ï¼š
- ä¸¥æ ¼å®¡æ ¸
- æœ€é«˜è´¨é‡
- äººå·¥æŠŠå…³

---

## 7. æ•ˆæœè¯„ä¼°

### 7.1 é¢„æœŸæŒ‡æ ‡

#### 7.1.1 çŸ¥è¯†å¢é•¿

```
å‡è®¾ï¼šæ¯å¤© 100 ä¸ªé—®ç­”ï¼Œå…¶ä¸­ 20% é«˜è´¨é‡ï¼ˆè¯„åˆ† >= 4ï¼‰

ç¬¬1ä¸ªæœˆï¼š20 * 30 = 600 ä¸ªæ–°çŸ¥è¯†æ–‡æ¡£
ç¬¬3ä¸ªæœˆï¼š600 * 3 = 1800 ä¸ª
ç¬¬6ä¸ªæœˆï¼š600 * 6 = 3600 ä¸ª

çŸ¥è¯†åº“è§„æ¨¡ç¿»å€ï¼
```

#### 7.1.2 æ£€ç´¢å‘½ä¸­ç‡

```
åœºæ™¯ï¼šé‡å¤é—®é¢˜

æ”¹è¿›å‰ï¼š
  - æ¯æ¬¡éƒ½éœ€è¦æ£€ç´¢åŸå§‹æ–‡æ¡£ â†’ ç”Ÿæˆç­”æ¡ˆ
  - å‘½ä¸­ç‡ï¼šå–å†³äºåŸå§‹æ–‡æ¡£è¦†ç›–
  
æ”¹è¿›åï¼š
  - ç¬¬ä¸€æ¬¡ï¼šæ£€ç´¢åŸå§‹æ–‡æ¡£ â†’ ç”Ÿæˆç­”æ¡ˆ â†’ å½’æ¡£
  - ç¬¬äºŒæ¬¡ï¼šç›´æ¥å‘½ä¸­å½’æ¡£æ–‡æ¡£ï¼ˆåŒ…å«å®Œæ•´é—®ç­”ï¼‰
  - å‘½ä¸­ç‡æå‡ï¼š60% â†’ 85%
```

#### 7.1.3 å“åº”é€Ÿåº¦

```
é‡å¤é—®é¢˜å“åº”é€Ÿåº¦ï¼š

æ”¹è¿›å‰ï¼š
  æ£€ç´¢(100ms) + LLM(4000ms) = 4100ms

æ”¹è¿›åï¼ˆå‘½ä¸­å½’æ¡£æ–‡æ¡£ï¼‰ï¼š
  æ£€ç´¢(100ms) + ç›´æ¥è¿”å› = 100ms
  
æå‡ï¼š41 å€ï¼
```

#### 7.1.4 æˆæœ¬èŠ‚çœ

```
å‡è®¾ï¼š
  - LLM API æˆæœ¬ï¼š$0.01 / æ¬¡
  - æ¯å¤© 100 ä¸ªé—®ç­”
  - é‡å¤é—®é¢˜å  30%
  
æ”¹è¿›å‰æˆæœ¬ï¼š100 * $0.01 = $1.00 / å¤©

æ”¹è¿›åæˆæœ¬ï¼š
  - æ–°é—®é¢˜ï¼š70 * $0.01 = $0.70
  - é‡å¤é—®é¢˜ï¼š30 * $0.00 = $0.00ï¼ˆç›´æ¥ä»å½’æ¡£è¿”å›ï¼‰
  - æ€»è®¡ï¼š$0.70 / å¤©
  
èŠ‚çœï¼š30% / å¤© = $109.5 / å¹´
```

### 7.2 ç›‘æ§æŒ‡æ ‡

å»ºè®®åœ¨ç³»ç»Ÿä¸­æ·»åŠ ä»¥ä¸‹ç›‘æ§ï¼š

```java
@Service
public class ArchiveStatisticsService {
    
    public Map<String, Object> getStatistics() {
        return Map.of(
            // å½’æ¡£æ•°é‡
            "totalArchived", getTotalArchivedCount(),
            "approvedCount", getApprovedCount(),
            "tempCount", getTempCount(),
            "rejectedCount", getRejectedCount(),
            
            // ä½¿ç”¨æƒ…å†µ
            "totalUsage", getTotalUsageCount(),
            "avgUsagePerDocument", getAvgUsagePerDocument(),
            "topUsedDocuments", getTopUsedDocuments(10),
            
            // è´¨é‡æŒ‡æ ‡
            "avgRating", getAvgRating(),
            "highQualityRate", getHighQualityRate(), // è¯„åˆ† >= 4
            
            // æ•ˆç‡æŒ‡æ ‡
            "cacheHitRate", getCacheHitRate(), // ç›´æ¥å‘½ä¸­å½’æ¡£çš„æ¯”ä¾‹
            "costSavings", estimateCostSavings()
        );
    }
}
```

---

## 8. é«˜çº§ç‰¹æ€§

### 8.1 æ™ºèƒ½å»é‡

é¿å…ç›¸ä¼¼é—®é¢˜é‡å¤å½’æ¡£ï¼š

```java
public boolean isDuplicate(String question) {
    // 1. å‘é‡æ£€ç´¢å·²å½’æ¡£çš„é—®é¢˜
    float[] questionVector = embeddingEngine.embed(question);
    List<VectorSearchResult> similar = searchSimilarQuestions(questionVector, 0.95);
    
    // 2. å¦‚æœæ‰¾åˆ°éå¸¸ç›¸ä¼¼çš„é—®é¢˜ï¼ˆç›¸ä¼¼åº¦ > 0.95ï¼‰ï¼Œè®¤ä¸ºé‡å¤
    return !similar.isEmpty();
}
```

### 8.2 ç‰ˆæœ¬ç®¡ç†

åŒä¸€é—®é¢˜çš„ç­”æ¡ˆå¯èƒ½éšæ—¶é—´æ¼”è¿›ï¼š

```markdown
---
id: "a1b2c3d4"
question: "ä»€ä¹ˆæ˜¯ Agentï¼Ÿ"
version: 2.0
previousVersions: ["v1.0-20251129233046"]
---

# ä»€ä¹ˆæ˜¯ Agentï¼Ÿ

## å›ç­” (æ›´æ–°äº 2025-12-01)

Agent æ˜¯ä¸€ç§æ™ºèƒ½ä»£ç†ç³»ç»Ÿ...

> **æ›´æ–°è¯´æ˜**: æ–°å¢äº† Agent åœ¨å¤šæ¨¡æ€åœºæ™¯ä¸‹çš„åº”ç”¨ç¤ºä¾‹

## å†å²ç‰ˆæœ¬

- [v1.0](./archives/v1.0-20251129233046.md) - 2025-11-29
```

### 8.3 è‡ªåŠ¨æ›´æ–°

å½“åŸå§‹æ–‡æ¡£æ›´æ–°æ—¶ï¼Œæ ‡è®°ç›¸å…³å½’æ¡£æ–‡æ¡£ä¸º "å¾…æ›´æ–°"ï¼š

```java
public void markRelatedArchivesForUpdate(String documentName) {
    // æŸ¥æ‰¾å¼•ç”¨äº†è¯¥æ–‡æ¡£çš„æ‰€æœ‰å½’æ¡£
    List<Path> relatedArchives = findArchivesBySourceDocument(documentName);
    
    for (Path archive : relatedArchives) {
        // æ·»åŠ æ›´æ–°æ ‡è®°
        addUpdateFlag(archive, "åŸå§‹æ–‡æ¡£å·²æ›´æ–°: " + documentName);
    }
    
    log.info("ğŸ“ æ ‡è®° {} ä¸ªå½’æ¡£æ–‡æ¡£éœ€è¦æ›´æ–°", relatedArchives.size());
}
```

### 8.4 è‡ªåŠ¨æ‘˜è¦å’Œæ ‡ç­¾

ä½¿ç”¨ LLM è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦å’Œæ ‡ç­¾ï¼š

```java
public String generateSummary(String answer) {
    String prompt = String.format(
        "è¯·ä¸ºä»¥ä¸‹å†…å®¹ç”Ÿæˆä¸€ä¸ª 50 å­—ä»¥å†…çš„æ‘˜è¦ï¼š\n\n%s", 
        answer.substring(0, Math.min(500, answer.length()))
    );
    return llmClient.chat(prompt);
}

public List<String> generateTags(String question, String answer) {
    String prompt = String.format(
        "è¯·ä¸ºä»¥ä¸‹é—®ç­”æå– 5 ä¸ªå…³é”®æ ‡ç­¾ï¼ˆJSONæ•°ç»„æ ¼å¼ï¼‰ï¼š\n\né—®é¢˜ï¼š%s\nå›ç­”ï¼š%s",
        question,
        answer.substring(0, Math.min(200, answer.length()))
    );
    String response = llmClient.chat(prompt);
    return parseTagsFromJson(response);
}
```

### 8.5 çŸ¥è¯†å›¾è°±æ„å»º

åŸºäºå½’æ¡£æ–‡æ¡£æ„å»ºçŸ¥è¯†å›¾è°±ï¼š

```
æ¦‚å¿µèŠ‚ç‚¹: Agent
   â”œâ”€ å±æ€§: è‡ªä¸»æ€§ã€ååº”æ€§ã€ä¸»åŠ¨æ€§
   â”œâ”€ ç›¸å…³é—®é¢˜: "ä»€ä¹ˆæ˜¯Agent", "Agentçš„ç‰¹ç‚¹"
   â”œâ”€ ç›¸å…³æ–‡æ¡£: åŸ¹è®­é€šçŸ¥.pdf, AIç³»ç»Ÿæ–‡æ¡£.docx
   â””â”€ ç›¸å…³æ¦‚å¿µ: MASã€æ™ºèƒ½ä»£ç†ã€è‡ªä¸»ç³»ç»Ÿ
```

---

## æ€»ç»“

### æ ¸å¿ƒä»·å€¼

1. **çŸ¥è¯†å¢é•¿**: ä»å•çº¯çš„æ–‡æ¡£æ£€ç´¢åˆ°çŸ¥è¯†è‡ªæˆ‘ç”Ÿæˆ
2. **æå‡æ•ˆç‡**: é‡å¤é—®é¢˜å“åº”é€Ÿåº¦æå‡ 40 å€
3. **é™ä½æˆæœ¬**: LLM API è°ƒç”¨æˆæœ¬é™ä½ 30%
4. **æ”¹å–„ä½“éªŒ**: ç­”æ¡ˆä¸€è‡´æ€§å’Œå‡†ç¡®æ€§æå‡

### å®æ–½å»ºè®®

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼ˆ1å‘¨ï¼‰ï¼šå®ç°åŸºç¡€å½’æ¡£åŠŸèƒ½
2. **ç¬¬äºŒé˜¶æ®µ**ï¼ˆ2å‘¨ï¼‰ï¼šæ·»åŠ åˆ†ç±»å’Œå®¡æ ¸
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼ˆ1ä¸ªæœˆï¼‰ï¼šæ™ºèƒ½å»é‡å’Œç‰ˆæœ¬ç®¡ç†
4. **ç¬¬å››é˜¶æ®µ**ï¼ˆé•¿æœŸï¼‰ï¼šçŸ¥è¯†å›¾è°±å’Œæ·±åº¦åˆ†æ

### å…³é”®æˆåŠŸå› ç´ 

- âœ… ç”¨æˆ·åé¦ˆå‚ä¸åº¦
- âœ… åˆç†çš„è´¨é‡é˜ˆå€¼
- âœ… å®šæœŸå®¡æ ¸å’Œæ¸…ç†
- âœ… ç›‘æ§å’Œä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-11-29 23:35:23  
**ç»´æŠ¤è€…**ï¼šAI Reviewer Team

