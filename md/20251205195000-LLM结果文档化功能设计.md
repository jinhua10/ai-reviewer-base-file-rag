# LLM ç»“æœæ–‡æ¡£åŒ–åŠŸèƒ½è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-05  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 ç›®æ ‡

å°† LLM åˆ†æç»“æœæ–‡æ¡£åŒ–å¤„ç†ï¼Œå®ç°ä»¥ä¸‹ç›®æ ‡ï¼š

1. **çŸ¥è¯†æ²‰æ·€**ï¼šå°†æ¯æ¬¡ LLM è°ƒç”¨çš„æœ‰ä»·å€¼ç»“æœä¿å­˜ä¸‹æ¥ï¼Œå¢å¼ºçŸ¥è¯†åº“
2. **ç”¨æˆ·ä»·å€¼**ï¼šæ”¯æŒç”¨æˆ·ä¸‹è½½åˆ†æç»“æœï¼ˆMarkdown/PDFï¼‰
3. **å›¾ç‰‡å¤„ç†**ï¼šåœ¨çº¿é¢„è§ˆç”¨é“¾æ¥ï¼Œä¸‹è½½æ—¶è½¬ Base64 åµŒå…¥

### 1.2 é€‚ç”¨åœºæ™¯

| åœºæ™¯ | è¯´æ˜ |
|------|------|
| é—®ç­”ç»“æœ | å•æ¬¡é—®ç­”çš„ LLM å›ç­” |
| æ–‡æ¡£åˆ†æ | PPT/PDF/Word ç­‰æ–‡æ¡£çš„åˆ†æç»“æœ |
| å›¾ç‰‡åˆ†æ | Vision LLM å¯¹å›¾ç‰‡çš„æè¿° |
| æ¸è¿›å¼åˆ†æ | å¤šè½®å¯¹è¯æˆ–åˆ†æ­¥åˆ†æçš„èšåˆç»“æœ |

---

## 2. å·²å®Œæˆçš„åŠŸèƒ½

### 2.1 åç«¯æœåŠ¡

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `LLMResultDocumentService.java` | æ ¸å¿ƒæ–‡æ¡£åŒ–æœåŠ¡ |
| `LLMResultCollector.java` | ç»“æœæ”¶é›†å™¨ |
| `LLMResultDocumentController.java` | REST API æ§åˆ¶å™¨ |

### 2.2 å‰ç«¯ç•Œé¢

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `LLMResultsTab.jsx` | LLM ç»“æœå†å²æ ‡ç­¾é¡µç»„ä»¶ |
| `llm-results-tab.css` | æ ·å¼æ–‡ä»¶ |
| `api.js` | API æ¥å£ï¼ˆæ–°å¢ LLM ç»“æœç›¸å…³æ–¹æ³•ï¼‰ |
| `lang.js` | å¤šè¯­è¨€ç¿»è¯‘ |
| `index.html` | ä¸»é¡µé¢ï¼ˆæ–°å¢æ ‡ç­¾é¡µï¼‰ |

### 2.3 é…ç½®æ–‡ä»¶

```yaml
# application.yml ä¸­æ–°å¢é…ç½®
knowledge:
  qa:
    llm-result:
      storage-path: ./data/llm-results
      auto-add-to-knowledge-base: false
      max-history: 100
      auto-save: true
      min-content-length: 100
```

---

## 2. æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LLM ç»“æœæ–‡æ¡£åŒ–æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   LLM Client    â”‚ -> â”‚ LLMResultCollector â”‚                  â”‚
â”‚  â”‚ (å„ç§ AI è°ƒç”¨)   â”‚    â”‚    (ç»“æœæ”¶é›†å™¨)      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                â”‚                                â”‚
â”‚                                v                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚ LLMResultDocumentServiceâ”‚                   â”‚
â”‚                    â”‚     (æ–‡æ¡£åŒ–æœåŠ¡)         â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                          â”‚         â”‚                            â”‚
â”‚                          v         v                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   æ–‡ä»¶å­˜å‚¨        â”‚  â”‚  çŸ¥è¯†åº“é›†æˆ       â”‚                     â”‚
â”‚  â”‚ (Markdown æ–‡ä»¶)   â”‚  â”‚ (å¯é€‰: è‡ªåŠ¨å…¥åº“)  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               LLMResultDocumentController                â”‚   â”‚
â”‚  â”‚                       (REST API)                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ POST /api/llm-results/save          ä¿å­˜ç»“æœ             â”‚   â”‚
â”‚  â”‚ GET  /api/llm-results/history       è·å–å†å²             â”‚   â”‚
â”‚  â”‚ GET  /api/llm-results/{id}          è·å–è¯¦æƒ…             â”‚   â”‚
â”‚  â”‚ GET  /api/llm-results/{id}/preview  é¢„è§ˆ (å›¾ç‰‡ä¸ºé“¾æ¥)     â”‚   â”‚
â”‚  â”‚ GET  /api/llm-results/{id}/download/markdown  ä¸‹è½½ MD    â”‚   â”‚
â”‚  â”‚ GET  /api/llm-results/{id}/download/pdf       ä¸‹è½½ PDF   â”‚   â”‚
â”‚  â”‚ DELETE /api/llm-results/{id}        åˆ é™¤æ–‡æ¡£             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ ¸å¿ƒç±»è¯´æ˜

### 3.1 LLMResultDocumentService

ä¸»è¦æœåŠ¡ç±»ï¼Œè´Ÿè´£ï¼š
- ä¿å­˜ LLM åˆ†æç»“æœä¸º Markdown æ–‡ä»¶
- ç”Ÿæˆå¸¦å…ƒä¿¡æ¯çš„æ–‡æ¡£
- å›¾ç‰‡å¤„ç†ï¼ˆé¢„è§ˆ/ä¸‹è½½ï¼‰
- å†å²è®°å½•ç®¡ç†

### 3.2 LLMResultCollector

ç»“æœæ”¶é›†å™¨ï¼Œæ”¯æŒï¼š
- è‡ªåŠ¨æ”¶é›†é—®ç­”ç»“æœ
- æ–‡æ¡£åˆ†æç»“æœæ”¶é›†
- å›¾ç‰‡åˆ†æç»“æœæ”¶é›†
- ä¼šè¯çº§åˆ«çš„ç»“æœèšåˆï¼ˆç”¨äºæ¸è¿›å¼åˆ†æï¼‰

### 3.3 LLMResultDocumentController

REST API æ§åˆ¶å™¨ï¼Œæä¾›ï¼š
- ç»“æœä¿å­˜æ¥å£
- å†å²æŸ¥è¯¢æ¥å£
- é¢„è§ˆ/ä¸‹è½½æ¥å£

---

## 4. å›¾ç‰‡å¤„ç†ç­–ç•¥

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|----------|
| **åœ¨çº¿é¢„è§ˆ** | å›¾ç‰‡ä¿æŒ URL é“¾æ¥å½¢å¼ |
| **ä¸‹è½½ Markdown** | å›¾ç‰‡è½¬æ¢ä¸º Base64 åµŒå…¥ |
| **ä¸‹è½½ PDF** | å›¾ç‰‡åµŒå…¥ PDFï¼ˆå¾…å®ç°ï¼‰ |

### 4.1 å›¾ç‰‡è½¬æ¢æµç¨‹

```
åŸå§‹ Markdown:
![å›¾ç‰‡æè¿°](https://example.com/image.png)

ä¸‹è½½æ—¶è½¬æ¢ä¸º:
![å›¾ç‰‡æè¿°](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...)
```

---

## 5. é…ç½®é€‰é¡¹

```yaml
knowledge:
  qa:
    llm-result:
      # å­˜å‚¨è·¯å¾„
      storage-path: ./data/llm-results
      
      # æ˜¯å¦è‡ªåŠ¨æ·»åŠ åˆ°çŸ¥è¯†åº“
      auto-add-to-knowledge-base: false
      
      # æœ€å¤§å†å²è®°å½•æ•°
      max-history: 100
      
      # æ˜¯å¦è‡ªåŠ¨ä¿å­˜
      auto-save: true
      
      # æœ€å°å†…å®¹é•¿åº¦ï¼ˆä½äºæ­¤å€¼ä¸æ”¶é›†ï¼‰
      min-content-length: 100
```

---

## 6. API æ¥å£

### 6.1 ä¿å­˜ç»“æœ

```http
POST /api/llm-results/save
Content-Type: application/json

{
  "title": "æ–‡æ¡£åˆ†æç»“æœ",
  "sourceDocument": "äº§å“è¯´æ˜.pptx",
  "question": "è¯·æ€»ç»“è¿™ä»½æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹",
  "analysisType": "æ–‡æ¡£åˆ†æ",
  "content": "## åˆ†æç»“æœ\n\nè¿™ä»½æ–‡æ¡£ä¸»è¦ä»‹ç»...",
  "keyPoints": ["è¦ç‚¹1", "è¦ç‚¹2", "è¦ç‚¹3"]
}
```

### 6.2 è·å–å†å²

```http
GET /api/llm-results/history?limit=20
```

### 6.3 ä¸‹è½½ Markdown

```http
GET /api/llm-results/{docId}/download/markdown
```

### 6.4 ä¸‹è½½ PDF

```http
GET /api/llm-results/{docId}/download/pdf
```

---

## 7. ç”Ÿæˆçš„æ–‡æ¡£ç¤ºä¾‹

```markdown
# æ–‡æ¡£åˆ†æ: äº§å“è¯´æ˜.pptx

> **ç”Ÿæˆæ—¶é—´**: 2025-12-05 19:50:30  
> **æºæ–‡æ¡£**: äº§å“è¯´æ˜.pptx  
> **åˆ†æé—®é¢˜**: è¯·æ€»ç»“è¿™ä»½æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹  
> **åˆ†æç±»å‹**: æ–‡æ¡£åˆ†æ

---

## åˆ†æç»“æœ

è¿™ä»½æ–‡æ¡£ä¸»è¦ä»‹ç»äº†äº§å“çš„æ ¸å¿ƒåŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•...

### ç¬¬ä¸€éƒ¨åˆ†ï¼šäº§å“æ¦‚è¿°

äº§å“å®šä½äºä¼ä¸šçº§ç”¨æˆ·ï¼Œä¸»è¦è§£å†³...

### ç¬¬äºŒéƒ¨åˆ†ï¼šåŠŸèƒ½ç‰¹æ€§

1. **åŠŸèƒ½A**: æ”¯æŒxxx
2. **åŠŸèƒ½B**: æä¾›xxx
3. **åŠŸèƒ½C**: å®ç°xxx

---

## ğŸ“Œ å…³é”®è¦ç‚¹

- äº§å“é¢å‘ä¼ä¸šçº§ç”¨æˆ·
- æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ Aã€Bã€C
- é¢„è®¡ Q2 ä¸Šçº¿

---

*æœ¬æ–‡æ¡£ç”± AI æ™ºèƒ½åˆ†æç”Ÿæˆ*
```

---

## 8. æ–‡ä»¶ç»“æ„

```
src/main/java/top/yumbo/ai/rag/spring/boot/
â”œâ”€â”€ service/document/
â”‚   â”œâ”€â”€ LLMResultDocumentService.java  âœ… æ–‡æ¡£åŒ–æœåŠ¡
â”‚   â””â”€â”€ LLMResultCollector.java        âœ… ç»“æœæ”¶é›†å™¨
â””â”€â”€ controller/
    â””â”€â”€ LLMResultDocumentController.java âœ… REST API
```

---

## 9. ä½¿ç”¨ç¤ºä¾‹

### 9.1 è‡ªåŠ¨æ”¶é›†é—®ç­”ç»“æœ

```java
@Autowired
private LLMResultCollector collector;

// åœ¨é—®ç­”æœåŠ¡ä¸­
String answer = llmClient.generate(prompt);
collector.collectQAResult(question, answer, null);
```

### 9.2 æ¸è¿›å¼åˆ†ææ”¶é›†

```java
// å¼€å§‹ä¼šè¯
String sessionId = collector.startSession("PPTåˆ†æ");

// åˆ†ææ¯å¼ å¹»ç¯ç‰‡
for (int i = 0; i < slides.size(); i++) {
    String analysis = analyzeSlide(slides.get(i));
    collector.addToSession(sessionId, "å¹»ç¯ç‰‡ " + (i+1), analysis, keyPoints);
}

// ç»“æŸå¹¶ä¿å­˜
LLMResultDocument doc = collector.endSessionAndSave(
    sessionId, 
    "PPTåˆ†æ: " + fileName,
    question,
    finalSummary
);
```

---

## 10. åç»­ä¼˜åŒ–

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| PDF å¯¼å‡º | ğŸŸ¡ ä¸­ | ä½¿ç”¨ iText æˆ– Flying Saucer |
| çŸ¥è¯†åº“è‡ªåŠ¨å…¥åº“ | ğŸŸ¡ ä¸­ | å°†ç»“æœè‡ªåŠ¨åŠ å…¥çŸ¥è¯†åº“ç´¢å¼• |
| ç»“æœè¯„ä»· | ğŸŸ¢ ä½ | ç”¨æˆ·å¯¹ç»“æœæ‰“åˆ†ï¼Œç”¨äºä¼˜åŒ– |
| ç»“æœæœç´¢ | ğŸŸ¢ ä½ | æ”¯æŒå…¨æ–‡æ£€ç´¢å†å²ç»“æœ |

---

**æ–‡æ¡£ç»“æŸ**

