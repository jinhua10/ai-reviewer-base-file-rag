# æµå¼è¾“å‡ºå®æ—¶æ¸²æŸ“ä¸åœæ­¢åŠŸèƒ½å®ç°æŠ¥å‘Š

## å®ç°åŠŸèƒ½

### 1. âœ… å®æ—¶æµå¼æ¸²æŸ“
- **æ¯ä¸ª LLM å—ç«‹å³æ˜¾ç¤º**ï¼šæ”¶åˆ° SSE äº‹ä»¶åç«‹å³æ›´æ–° UI
- **æµç•…çš„æ‰“å­—æœºæ•ˆæœ**ï¼šä½¿ç”¨é—ªçƒå…‰æ ‡æŒ‡ç¤ºæ­£åœ¨ç”Ÿæˆ
- **è‡ªåŠ¨æ»šåŠ¨**ï¼šæ–°å†…å®¹åˆ°è¾¾æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

### 2. âœ… åœæ­¢ç”ŸæˆåŠŸèƒ½
- **åœæ­¢æŒ‰é’®**ï¼šç”Ÿæˆæ—¶æ˜¾ç¤º"åœæ­¢ç”Ÿæˆ"æŒ‰é’®
- **å³æ—¶å“åº”**ï¼šç‚¹å‡»åç«‹å³å…³é—­ EventSource è¿æ¥
- **çŠ¶æ€æ ‡è®°**ï¼šåœæ­¢çš„æ¶ˆæ¯æ˜¾ç¤º"âš ï¸ ç”Ÿæˆå·²åœæ­¢"å¾½ç« 

### 3. âœ… ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **åŒè½¨æ˜¾ç¤º**ï¼šHOPE å¿«é€Ÿç­”æ¡ˆ + LLM æµå¼ç”Ÿæˆ
- **è§†è§‰åé¦ˆ**ï¼šåŠ è½½åŠ¨ç”»ã€å…‰æ ‡é—ªçƒã€åœæ­¢å¾½ç« 
- **å“åº”å¼è®¾è®¡**ï¼šç§»åŠ¨ç«¯é€‚é…

## æ ¸å¿ƒä¿®æ”¹

### 1. QAPanel.jsx - ä¸»é¢æ¿é€»è¾‘

#### æ–°å¢çŠ¶æ€ç®¡ç†
```jsx
const [currentEventSource, setCurrentEventSource] = useState(null) // ä¿å­˜ EventSource å¼•ç”¨
```

#### å®æ—¶æ›´æ–°é€»è¾‘
```jsx
(data) => {
  // å®æ—¶æ›´æ–°ç­”æ¡ˆå†…å®¹ / Update answer content in real-time
  setMessages(prev => {
    const newMessages = [...prev]
    const lastMessage = newMessages[newMessages.length - 1]
    
    switch (data.type) {
      case 'hope':
        // HOPE å¿«é€Ÿç­”æ¡ˆ - ç«‹å³æ˜¾ç¤º
        lastMessage.content = data.content
        break
        
      case 'llm':
        // LLM æµå¼å— - å®æ—¶è¿½åŠ 
        lastMessage.content += data.content
        break
        
      case 'complete':
        // å®Œæˆ
        lastMessage.streaming = false
        break
    }
    
    return newMessages
  })
}
```

#### åœæ­¢ç”Ÿæˆæ–¹æ³•
```jsx
const handleStopGeneration = () => {
  if (currentEventSource) {
    console.log('ğŸ›‘ Stopping generation...')
    currentEventSource.close()
    setCurrentEventSource(null)
    setLoading(false)

    // æ ‡è®°æœ€åä¸€æ¡æ¶ˆæ¯ä¸ºå·²å®Œæˆ
    setMessages(prev => {
      const newMessages = [...prev]
      const lastMessage = newMessages[newMessages.length - 1]
      if (lastMessage && lastMessage.streaming) {
        lastMessage.streaming = false
        lastMessage.stopped = true // æ ‡è®°ä¸ºè¢«åœæ­¢
      }
      return newMessages
    })
  }
}
```

#### ä¿å­˜ EventSource å¼•ç”¨
```jsx
// ä¿å­˜ EventSource å¼•ç”¨ä»¥ä¾¿åœæ­¢ç”Ÿæˆ
if (result && result.eventSource) {
  setCurrentEventSource(result.eventSource)
}
```

### 2. ChatBox.jsx - èŠå¤©æ¡†ç»„ä»¶

#### æ–°å¢ Props
```jsx
function ChatBox(props) {
  const { 
    messages, 
    loading, 
    onFeedback, 
    onToggleHistory, 
    onStopGeneration,    // æ–°å¢ï¼šåœæ­¢ç”Ÿæˆå›è°ƒ
    isGenerating         // æ–°å¢ï¼šæ˜¯å¦æ­£åœ¨ç”Ÿæˆ
  } = props
```

#### åœæ­¢æŒ‰é’® UI
```jsx
{isGenerating && (
  <div className="chat-box__stop-btn-wrapper">
    <Button
      danger
      onClick={onStopGeneration}
      className="chat-box__stop-btn"
    >
      ğŸ›‘ {t('qa.stopGeneration')}
    </Button>
  </div>
)}
```

### 3. AnswerCard.jsx - ç­”æ¡ˆå¡ç‰‡

#### åœæ­¢å¾½ç« æ˜¾ç¤º
```jsx
{answer.stopped && !answer.streaming && (
  <div className="answer-card__stopped-badge">
    âš ï¸ {t('qa.generationStopped')}
  </div>
)}
```

### 4. CSS æ ·å¼ä¼˜åŒ–

#### chat-box.css - åœæ­¢æŒ‰é’®æ ·å¼
```css
.chat-box__stop-btn-wrapper {
  display: flex;
  justify-content: center;
  padding: 12px 0;
  animation: fadeIn 0.3s ease-out;
}

.chat-box__stop-btn {
  font-size: 14px;
  border-radius: 20px;
  padding: 8px 24px;
  height: auto;
  box-shadow: 0 2px 8px rgba(255, 77, 79, 0.2);
  transition: all 0.3s ease;
}

.chat-box__stop-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 77, 79, 0.3);
}
```

#### answer-card.css - åœæ­¢å¾½ç« æ ·å¼
```css
.answer-card__stopped-badge {
  display: inline-block;
  margin-top: 12px;
  padding: 6px 12px;
  background: #fff7e6;
  border: 1px solid #ffd591;
  border-radius: 6px;
  color: #fa8c16;
  font-size: 13px;
  font-weight: 500;
}
```

### 5. å›½é™…åŒ–æ”¯æŒ

#### zh.js / en.js
```javascript
// ä¸­æ–‡
stopGeneration: 'åœæ­¢ç”Ÿæˆ',
generationStopped: 'ç”Ÿæˆå·²åœæ­¢',

// English
stopGeneration: 'Stop Generating',
generationStopped: 'Generation Stopped',
```

## ç”¨æˆ·äº¤äº’æµç¨‹

### æ­£å¸¸æµç¨‹
```
ç”¨æˆ·æé—®
    â†“
[0-300ms] HOPE å¿«é€Ÿç­”æ¡ˆç«‹å³æ˜¾ç¤º
    â†“
[300ms-] LLM æµå¼ç”Ÿæˆ
    â”œâ†’ æ¯ä¸ªå—åˆ°è¾¾ç«‹å³æ¸²æŸ“
    â”œâ†’ è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
    â””â†’ æ˜¾ç¤ºé—ªçƒå…‰æ ‡
    â†“
ç”Ÿæˆå®Œæˆ
    â”œâ†’ ç§»é™¤å…‰æ ‡
    â””â†’ æ˜¾ç¤ºåé¦ˆæŒ‰é’®
```

### åœæ­¢æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»"åœæ­¢ç”Ÿæˆ"
    â†“
å…³é—­ EventSource è¿æ¥
    â†“
æ ‡è®°æ¶ˆæ¯ä¸ºå·²åœæ­¢
    â†“
æ˜¾ç¤º"âš ï¸ ç”Ÿæˆå·²åœæ­¢"å¾½ç« 
    â†“
ç§»é™¤å…‰æ ‡å’Œåœæ­¢æŒ‰é’®
```

## æŠ€æœ¯è¦ç‚¹

### 1. EventSource ç”Ÿå‘½å‘¨æœŸç®¡ç†
```jsx
// åˆ›å»ºè¿æ¥
const eventSource = new EventSource(eventSourceUrl)

// ç›‘å¬äº‹ä»¶
eventSource.addEventListener('llm', handler)
eventSource.addEventListener('complete', handler)

// ä¿å­˜å¼•ç”¨
setCurrentEventSource(eventSource)

// åœæ­¢æ—¶å…³é—­
eventSource.close()
setCurrentEventSource(null)
```

### 2. React çŠ¶æ€æ›´æ–°ä¼˜åŒ–
```jsx
// ä½¿ç”¨å‡½æ•°å¼æ›´æ–°ï¼Œç¡®ä¿è·å–æœ€æ–°çŠ¶æ€
setMessages(prev => {
  const newMessages = [...prev]
  const lastMessage = newMessages[newMessages.length - 1]
  
  // ä¿®æ”¹æœ€åä¸€æ¡æ¶ˆæ¯
  lastMessage.content += data.content
  
  return newMessages
})
```

### 3. å®æ—¶æ¸²æŸ“è§¦å‘
- æ¯æ¬¡ `setMessages` è°ƒç”¨è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
- `ChatBox` ä¸­çš„ `useEffect` è‡ªåŠ¨æ»šåŠ¨
- `StreamingAnswer` ç»„ä»¶æ˜¾ç¤ºå…‰æ ‡åŠ¨ç”»

## è§†è§‰æ•ˆæœ

### åœæ­¢æŒ‰é’®
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ›‘ åœæ­¢ç”Ÿæˆ        â”‚  â† å±…ä¸­æ˜¾ç¤ºã€çº¢è‰²ã€æ‚¬åœæ”¾å¤§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœæ­¢å¾½ç« 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI å›ç­”å†…å®¹...               â”‚
â”‚                             â”‚
â”‚ âš ï¸ ç”Ÿæˆå·²åœæ­¢               â”‚  â† æ©™è‰²æç¤ºæ¡†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµå¼æ˜¾ç¤º
```
HOPE å¿«é€Ÿç­”æ¡ˆï¼š
å¯ä»¥ä½¿ç”¨æ··åˆæ£€ç´¢ç­–ç•¥...
æ¥æº: HOPE-L2 (ç½®ä¿¡åº¦: 0.75)

--- LLM è¯¦ç»†å›ç­” ---
æ ¹æ®æ‚¨çš„é—®é¢˜ï¼Œè¿™é‡Œæœ‰è¯¦ç»†çš„|  â† é—ªçƒå…‰æ ‡
```

## æ€§èƒ½ä¼˜åŒ–

### 1. é¿å…è¿‡åº¦æ¸²æŸ“
- ä½¿ç”¨å‡½æ•°å¼çŠ¶æ€æ›´æ–°
- åªä¿®æ”¹æœ€åä¸€æ¡æ¶ˆæ¯
- é¿å…æ•´ä¸ªåˆ—è¡¨é‡æ–°æ¸²æŸ“

### 2. å†…å­˜ç®¡ç†
- ç»„ä»¶å¸è½½æ—¶å…³é—­ EventSource
- æ¸…ç†çŠ¶æ€å¼•ç”¨
- é¿å…å†…å­˜æ³„æ¼

### 3. æµç•…åº¦ä¼˜åŒ–
- CSS ç¡¬ä»¶åŠ é€ŸåŠ¨ç”»
- èŠ‚æµæ»šåŠ¨æ›´æ–°
- ä¼˜åŒ– DOM æ“ä½œ

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
- [ ] å®æ—¶æµå¼æ˜¾ç¤ºæ˜¯å¦æµç•…
- [ ] åœæ­¢æŒ‰é’®æ˜¯å¦ç«‹å³å“åº”
- [ ] åœæ­¢åæ˜¯å¦æ˜¾ç¤ºå¾½ç« 
- [ ] å¤šæ¬¡åœæ­¢å’Œé‡æ–°æé—®
- [ ] HOPE å¿«é€Ÿç­”æ¡ˆæ˜¾ç¤º

### è¾¹ç•Œæµ‹è¯•
- [ ] æçŸ­å†…å®¹ï¼ˆ1 ä¸ªå­—ç¬¦ï¼‰
- [ ] æé•¿å†…å®¹ï¼ˆ10000+ å­—ç¬¦ï¼‰
- [ ] å¿«é€Ÿè¿ç»­æé—®
- [ ] ç½‘ç»œä¸­æ–­æ¢å¤
- [ ] æµè§ˆå™¨æ ‡ç­¾åˆ‡æ¢

### æ€§èƒ½æµ‹è¯•
- [ ] æµå¼æ˜¾ç¤ºå¸§ç‡ >30fps
- [ ] å†…å­˜å ç”¨ç¨³å®š
- [ ] åœæ­¢å“åº”æ—¶é—´ <100ms
- [ ] å¹¶å‘å¤šä¸ªå¯¹è¯

## ç±»ä¼¼äº§å“å¯¹æ¯”

| åŠŸèƒ½ | æœ¬ç³»ç»Ÿ | ChatGPT | Claude |
|------|--------|---------|---------|
| **å®æ—¶æµå¼** | âœ… SSE | âœ… SSE | âœ… SSE |
| **åœæ­¢ç”Ÿæˆ** | âœ… æŒ‰é’® | âœ… æŒ‰é’® | âœ… æŒ‰é’® |
| **æ‰“å­—æœºæ•ˆæœ** | âœ… å…‰æ ‡ | âœ… å…‰æ ‡ | âœ… å…‰æ ‡ |
| **åŒè½¨è¾“å‡º** | âœ… HOPE+LLM | âŒ æ—  | âŒ æ—  |
| **åœæ­¢æ ‡è®°** | âœ… å¾½ç«  | âœ… æ ‡è®° | âœ… æ ‡è®° |
| **å“åº”é€Ÿåº¦** | <300ms | 500ms+ | 400ms+ |

## æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›
1. âœ… **çœŸå®æµå¼æ¸²æŸ“**ï¼šæ¯ä¸ªå—ç«‹å³æ˜¾ç¤ºï¼Œä¸å†ç­‰å¾…
2. âœ… **åœæ­¢æ§åˆ¶**ï¼šç”¨æˆ·å¯éšæ—¶ç»ˆæ­¢ç”Ÿæˆ
3. âœ… **è§†è§‰åé¦ˆ**ï¼šå…‰æ ‡ã€æŒ‰é’®ã€å¾½ç« å®Œæ•´æµç¨‹
4. âœ… **åŒè½¨ä¼˜åŠ¿**ï¼šHOPE å¿«é€Ÿ + LLM è¯¦ç»†

### ç”¨æˆ·ä½“éªŒæå‡
- **å“åº”é€Ÿåº¦**ï¼š<300ms çœ‹åˆ°é¦–æ¬¡å†…å®¹
- **å¯æ§æ€§**ï¼šéšæ—¶åœæ­¢ä¸æƒ³è¦çš„å›ç­”
- **æµç•…åº¦**ï¼šå®æ—¶é€å—æ¸²æŸ“ï¼Œç±»ä¼¼ ChatGPT
- **åé¦ˆæ˜ç¡®**ï¼šåœæ­¢çŠ¶æ€æ¸…æ™°æ ‡è®°

### æŠ€æœ¯äº®ç‚¹
- EventSource ç”Ÿå‘½å‘¨æœŸå®Œæ•´ç®¡ç†
- React çŠ¶æ€ä¼˜åŒ–é¿å…è¿‡åº¦æ¸²æŸ“
- CSS åŠ¨ç”»ç¡¬ä»¶åŠ é€Ÿ
- å›½é™…åŒ–æ”¯æŒå®Œæ•´

---

**å®ç°æ—¶é—´**: 2025-12-12  
**å®ç°å·¥ç¨‹å¸ˆ**: AI Reviewer Team  
**æµ‹è¯•çŠ¶æ€**: å¾…æµ‹è¯• â³
