# ğŸš€ PPL ç»Ÿä¸€æ¥å£æ¶æ„ - å®Œæ•´å®æ–½è®¡åˆ’

## ğŸ“… é¡¹ç›®ä¿¡æ¯
- **åˆ›å»ºæ—¶é—´**ï¼š2025-12-04 20:00:00
- **ç›®æ ‡**ï¼šæ„å»ºçµæ´»çš„ PPL Chunker å’Œ Rerank ç»Ÿä¸€æ¥å£
- **æ”¯æŒåç«¯**ï¼šHugging Face ONNXã€Ollamaã€OpenAI (HTTP)
- **å·¥æœŸé¢„ä¼°**ï¼š10-15 å¤©

---

## ğŸ¯ ä¸€ã€é¡¹ç›®ç›®æ ‡

### 1.1 æ ¸å¿ƒç›®æ ‡

**æ„å»ºç»Ÿä¸€çš„ PPL æœåŠ¡å±‚**ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡é…ç½®æˆ– HTTP æ¥å£åŠ¨æ€åˆ‡æ¢ä¸åŒçš„å®ç°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç»Ÿä¸€ PPL æœåŠ¡æ¥å£å±‚                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  PPLService (æ¥å£)                              â”‚
â”‚  â”œâ”€ calculatePerplexity(text): double           â”‚
â”‚  â”œâ”€ chunk(content, query): List<Chunk>          â”‚
â”‚  â””â”€ rerank(question, docs): List<Document>      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–²
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚ ONNX å®ç°    â”‚ â”‚Ollama å®ç°â”‚ â”‚OpenAI å®ç° â”‚
â”‚ (æœ¬åœ°åµŒå…¥)   â”‚ â”‚(æœ¬åœ°æœåŠ¡) â”‚ â”‚(äº‘ç«¯API)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è®¾è®¡åŸåˆ™

1. **æ¥å£ç»Ÿä¸€**ï¼šæ‰€æœ‰å®ç°éµå¾ªåŒä¸€å¥—æ¥å£
2. **å¯é…ç½®**ï¼šé€šè¿‡ YAML é…ç½®æ–‡ä»¶åˆ‡æ¢
3. **å¯æ‰©å±•**ï¼šæ”¯æŒ HTTP API åŠ¨æ€åˆ‡æ¢
4. **é™çº§ç­–ç•¥**ï¼šæŸä¸ªåç«¯å¤±è´¥æ—¶è‡ªåŠ¨é™çº§
5. **ç›‘æ§å®Œå–„**ï¼šæ¯ç§å®ç°çš„æ€§èƒ½æŒ‡æ ‡ç‹¬ç«‹ç»Ÿè®¡

---

## ğŸ—ï¸ äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨å±‚ (Application)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  DocumentsTab  â”‚  â”‚HybridSearchSvc â”‚  â”‚   QAService  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                  â”‚                  â”‚
            â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PPL æœåŠ¡å±‚ (Service Layer)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           PPLServiceFacade (ç»Ÿä¸€é—¨é¢)                 â”‚   â”‚
â”‚  â”‚  - ç­–ç•¥æ¨¡å¼ç®¡ç†å¤šç§å®ç°                               â”‚   â”‚
â”‚  â”‚  - åŠ¨æ€åˆ‡æ¢ (é…ç½®/API)                                â”‚   â”‚
â”‚  â”‚  - é™çº§å¤„ç†                                           â”‚   â”‚
â”‚  â”‚  - æ€§èƒ½ç›‘æ§                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â”‚                                          â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚       â–¼           â–¼           â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚PPLOnnx â”‚ â”‚PPLOllamaâ”‚ â”‚PPLOpenAI â”‚ â† å®ç° PPLService     â”‚
â”‚  â”‚Service â”‚ â”‚Service  â”‚ â”‚Service   â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚          â”‚           â”‚
        â–¼          â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  ONNX  â”‚ â”‚   Ollama    â”‚ â”‚   OpenAI     â”‚               â”‚
â”‚  â”‚Runtime â”‚ â”‚   Server    â”‚ â”‚     API      â”‚               â”‚
â”‚  â”‚(Native)â”‚ â”‚  (REST API) â”‚ â”‚  (REST API)  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¥å£è®¾è®¡

```java
// PPLService.java - æ ¸å¿ƒæ¥å£
public interface PPLService {
    
    /**
     * è®¡ç®—æ–‡æœ¬å›°æƒ‘åº¦
     */
    double calculatePerplexity(String text) throws PPLException;
    
    /**
     * æ‰¹é‡è®¡ç®—å›°æƒ‘åº¦ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰
     */
    default Map<String, Double> batchCalculatePerplexity(List<String> texts) {
        Map<String, Double> results = new HashMap<>();
        texts.forEach(text -> {
            try {
                results.put(text, calculatePerplexity(text));
            } catch (PPLException e) {
                results.put(text, Double.MAX_VALUE);
            }
        });
        return results;
    }
    
    /**
     * åŸºäº PPL çš„æ–‡æ¡£åˆ‡åˆ†
     */
    List<DocumentChunk> chunk(String content, String query, ChunkConfig config) 
        throws PPLException;
    
    /**
     * åŸºäº PPL çš„æ–‡æ¡£é‡æ’åº
     */
    List<Document> rerank(String question, List<Document> candidates, RerankConfig config)
        throws PPLException;
    
    /**
     * è·å–æœåŠ¡æä¾›å•†ç±»å‹
     */
    PPLProviderType getProviderType();
    
    /**
     * å¥åº·æ£€æŸ¥
     */
    boolean isHealthy();
    
    /**
     * è·å–æ€§èƒ½æŒ‡æ ‡
     */
    PPLMetrics getMetrics();
}

// PPLProviderType.java - æä¾›å•†æšä¸¾
public enum PPLProviderType {
    ONNX("Hugging Face ONNX", "æœ¬åœ°åµŒå…¥å¼"),
    OLLAMA("Ollama", "æœ¬åœ°æœåŠ¡"),
    OPENAI("OpenAI API", "äº‘ç«¯API");
    
    private final String displayName;
    private final String description;
    
    // ... constructor and getters
}
```

### 2.3 é…ç½®æ¨¡å‹

```java
// PPLConfig.java - ç»Ÿä¸€é…ç½®
@Data
@ConfigurationProperties(prefix = "knowledge.qa.ppl")
public class PPLConfig {
    
    /**
     * é»˜è®¤æä¾›å•†ï¼šonnx, ollama, openai
     */
    private String defaultProvider = "onnx";
    
    /**
     * å¯ç”¨é™çº§ç­–ç•¥
     */
    private boolean enableFallback = true;
    
    /**
     * é™çº§é¡ºåºï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
     */
    private List<String> fallbackOrder = Arrays.asList("onnx", "ollama", "openai");
    
    /**
     * ONNX é…ç½®
     */
    private OnnxConfig onnx = new OnnxConfig();
    
    /**
     * Ollama é…ç½®
     */
    private OllamaConfig ollama = new OllamaConfig();
    
    /**
     * OpenAI é…ç½®
     */
    private OpenAIConfig openai = new OpenAIConfig();
    
    /**
     * Chunking é…ç½®
     */
    private ChunkConfig chunking = new ChunkConfig();
    
    /**
     * Rerank é…ç½®
     */
    private RerankConfig reranking = new RerankConfig();
    
    @Data
    public static class OnnxConfig {
        private boolean enabled = true;
        private String modelPath = "./models/gpt2-medium-int8/model.onnx";
        private String tokenizerPath = "./models/gpt2-medium-int8/tokenizer.json";
        private int maxBatchSize = 8;
        private boolean useCache = true;
    }
    
    @Data
    public static class OllamaConfig {
        private boolean enabled = false;
        private String baseUrl = "http://localhost:11434";
        private String model = "qwen:0.5b";
        private int timeout = 30000;
        private int maxRetries = 3;
    }
    
    @Data
    public static class OpenAIConfig {
        private boolean enabled = false;
        private String apiKey = "${AI_API_KEY:}";
        private String model = "gpt-4o";
        private String apiUrl = "https://api.openai.com/v1/chat/completions";
        private int timeout = 60000;
    }
    
    @Data
    public static class ChunkConfig {
        private double pplThreshold = 20.0;
        private int maxChunkSize = 2000;
        private int minChunkSize = 200;
    }
    
    @Data
    public static class RerankConfig {
        private boolean enabled = false;
        private double weight = 0.15;
        private int topK = 5;
        private boolean async = true;
    }
}
```

---

## ğŸ“‹ ä¸‰ã€å®æ–½è®¡åˆ’ï¼ˆåˆ†é˜¶æ®µï¼‰

### Phase 1: åŸºç¡€æ¶æ„ï¼ˆ2-3å¤©ï¼‰

#### ç›®æ ‡
æ­å»ºç»Ÿä¸€æ¥å£å±‚å’Œé…ç½®ç³»ç»Ÿ

#### ä»»åŠ¡æ¸…å•
- [x] è®¾è®¡æ ¸å¿ƒæ¥å£ `PPLService`
- [ ] å®ç°é…ç½®æ¨¡å‹ `PPLConfig`
- [ ] åˆ›å»ºå¼‚å¸¸ä½“ç³» `PPLException`
- [ ] å®ç°é—¨é¢ç±» `PPLServiceFacade`
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§ `PPLMetrics`
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

#### äº§å‡º
```
src/main/java/top/yumbo/ai/rag/ppl/
â”œâ”€â”€ PPLService.java                  # æ ¸å¿ƒæ¥å£
â”œâ”€â”€ PPLServiceFacade.java            # é—¨é¢å®ç°
â”œâ”€â”€ PPLProviderType.java             # æä¾›å•†æšä¸¾
â”œâ”€â”€ PPLException.java                # å¼‚å¸¸å®šä¹‰
â”œâ”€â”€ PPLMetrics.java                  # æ€§èƒ½æŒ‡æ ‡
â”œâ”€â”€ config/
â”‚   â””â”€â”€ PPLConfig.java               # é…ç½®æ¨¡å‹
â””â”€â”€ model/
    â”œâ”€â”€ DocumentChunk.java           # æ•°æ®æ¨¡å‹
    â”œâ”€â”€ ChunkConfig.java
    â””â”€â”€ RerankConfig.java
```

---

### Phase 2: ONNX å®ç°ï¼ˆ3-4å¤©ï¼‰

#### ç›®æ ‡
å®ç°åŸºäº Hugging Face ONNX çš„ PPL æœåŠ¡

#### ä»»åŠ¡æ¸…å•
- [ ] æ·»åŠ  Maven ä¾èµ–ï¼ˆONNX Runtimeã€Tokenizersï¼‰
- [ ] å®ç° `PPLOnnxService`
- [ ] å®ç°å›°æƒ‘åº¦è®¡ç®—
- [ ] å®ç° PPL Chunker
- [ ] å®ç° PPL Reranker
- [ ] æ·»åŠ ç¼“å­˜å±‚ï¼ˆCaffeineï¼‰
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

#### äº§å‡º
```
src/main/java/top/yumbo/ai/rag/ppl/onnx/
â”œâ”€â”€ PPLOnnxService.java              # ONNX å®ç°
â”œâ”€â”€ OnnxModelLoader.java             # æ¨¡å‹åŠ è½½å™¨
â”œâ”€â”€ PerplexityCalculator.java       # PPL è®¡ç®—å™¨
â”œâ”€â”€ PPLOnnxChunker.java              # åˆ‡åˆ†å™¨
â””â”€â”€ PPLOnnxReranker.java             # é‡æ’åºå™¨
```

#### ä¾èµ–é…ç½®
```xml
<dependencies>
    <!-- ONNX Runtime -->
    <dependency>
        <groupId>com.microsoft.onnxruntime</groupId>
        <artifactId>onnxruntime</artifactId>
        <version>1.16.0</version>
    </dependency>
    
    <!-- Hugging Face Tokenizers -->
    <dependency>
        <groupId>ai.djl.huggingface</groupId>
        <artifactId>tokenizers</artifactId>
        <version>0.25.0</version>
    </dependency>
    
    <!-- Cache -->
    <dependency>
        <groupId>com.github.ben-manes.caffeine</groupId>
        <artifactId>caffeine</artifactId>
    </dependency>
</dependencies>
```

---

### Phase 3: Ollama å®ç°ï¼ˆ2-3å¤©ï¼‰

#### ç›®æ ‡
å®ç°åŸºäº Ollama çš„ PPL æœåŠ¡

#### ä»»åŠ¡æ¸…å•
- [ ] å®ç° `PPLOllamaService`
- [ ] å°è£… Ollama REST API è°ƒç”¨
- [ ] å®ç°å›°æƒ‘åº¦æå–é€»è¾‘ï¼ˆä» logprobsï¼‰
- [ ] å®ç° PPL Chunker
- [ ] å®ç° PPL Reranker
- [ ] æ·»åŠ è¿æ¥æ± å’Œé‡è¯•æœºåˆ¶
- [ ] å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

#### äº§å‡º
```
src/main/java/top/yumbo/ai/rag/ppl/ollama/
â”œâ”€â”€ PPLOllamaService.java            # Ollama å®ç°
â”œâ”€â”€ OllamaClient.java                # HTTP å®¢æˆ·ç«¯
â”œâ”€â”€ OllamaResponse.java              # å“åº”æ¨¡å‹
â”œâ”€â”€ PPLOllamaChunker.java            # åˆ‡åˆ†å™¨
â””â”€â”€ PPLOllamaReranker.java           # é‡æ’åºå™¨
```

#### Ollama API ç¤ºä¾‹
```java
// Ollama API è¯·æ±‚
{
    "model": "qwen:0.5b",
    "prompt": "ä»Šå¤©å¤©æ°”å¾ˆå¥½",
    "stream": false,
    "options": {
        "temperature": 0.0,
        "num_predict": 1
    }
}

// å“åº”ï¼ˆéœ€è¦ä» response ä¸­è®¡ç®— PPLï¼‰
{
    "model": "qwen:0.5b",
    "created_at": "2025-12-04T12:00:00Z",
    "response": "...",
    "done": true
}
```

---

### Phase 4: OpenAI å®ç°ï¼ˆ1-2å¤©ï¼‰

#### ç›®æ ‡
å®ç°åŸºäº OpenAI API çš„ PPL æœåŠ¡ï¼ˆå¤ç”¨ç°æœ‰å®¢æˆ·ç«¯ï¼‰

#### ä»»åŠ¡æ¸…å•
- [ ] å®ç° `PPLOpenAIService`
- [ ] å¤ç”¨ç°æœ‰ `OpenAILLMClient`
- [ ] å®ç° PPL ä¼°ç®—é€»è¾‘ï¼ˆé€šè¿‡ token æ¦‚ç‡ï¼‰
- [ ] å®ç° PPL Chunker
- [ ] å®ç° PPL Reranker
- [ ] æ·»åŠ æˆæœ¬ç»Ÿè®¡
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

#### äº§å‡º
```
src/main/java/top/yumbo/ai/rag/ppl/openai/
â”œâ”€â”€ PPLOpenAIService.java            # OpenAI å®ç°
â”œâ”€â”€ PPLOpenAIChunker.java            # åˆ‡åˆ†å™¨
â””â”€â”€ PPLOpenAIReranker.java           # é‡æ’åºå™¨
```

#### æ³¨æ„äº‹é¡¹
- OpenAI API ä¸ç›´æ¥è¿”å› PPL
- å¯ä»¥é€šè¿‡ logprobs å‚æ•°è·å– token æ¦‚ç‡
- æˆæœ¬è¾ƒé«˜ï¼Œå»ºè®®ä»…ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ

---

### Phase 5: HTTP API æ¥å£ï¼ˆ2å¤©ï¼‰

#### ç›®æ ‡
æä¾› REST API ä¾›ç”¨æˆ·åŠ¨æ€åˆ‡æ¢ PPL æä¾›å•†

#### ä»»åŠ¡æ¸…å•
- [ ] è®¾è®¡ REST API æ¥å£
- [ ] å®ç° `PPLController`
- [ ] æ·»åŠ é…ç½®åˆ‡æ¢ç«¯ç‚¹
- [ ] æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] æ·»åŠ æ€§èƒ½æŒ‡æ ‡ç«¯ç‚¹
- [ ] API æ–‡æ¡£ï¼ˆSwaggerï¼‰
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

#### API è®¾è®¡

```java
@RestController
@RequestMapping("/api/ppl")
public class PPLController {
    
    /**
     * è·å–å½“å‰é…ç½®
     * GET /api/ppl/config
     */
    @GetMapping("/config")
    public PPLConfigResponse getConfig();
    
    /**
     * åˆ‡æ¢é»˜è®¤æä¾›å•†
     * POST /api/ppl/config/provider
     * Body: { "provider": "onnx" }
     */
    @PostMapping("/config/provider")
    public ApiResponse switchProvider(@RequestBody ProviderSwitchRequest request);
    
    /**
     * è®¡ç®—å›°æƒ‘åº¦
     * POST /api/ppl/calculate
     * Body: { "text": "æµ‹è¯•æ–‡æœ¬", "provider": "onnx" }
     */
    @PostMapping("/calculate")
    public PerplexityResponse calculatePerplexity(@RequestBody PerplexityRequest request);
    
    /**
     * æ–‡æ¡£åˆ‡åˆ†
     * POST /api/ppl/chunk
     * Body: { "content": "...", "query": "...", "provider": "onnx" }
     */
    @PostMapping("/chunk")
    public ChunkResponse chunk(@RequestBody ChunkRequest request);
    
    /**
     * æ–‡æ¡£é‡æ’åº
     * POST /api/ppl/rerank
     * Body: { "question": "...", "documents": [...], "provider": "onnx" }
     */
    @PostMapping("/rerank")
    public RerankResponse rerank(@RequestBody RerankRequest request);
    
    /**
     * å¥åº·æ£€æŸ¥
     * GET /api/ppl/health
     */
    @GetMapping("/health")
    public HealthResponse health();
    
    /**
     * æ€§èƒ½æŒ‡æ ‡
     * GET /api/ppl/metrics
     */
    @GetMapping("/metrics")
    public MetricsResponse metrics();
}
```

#### äº§å‡º
```
src/main/java/top/yumbo/ai/rag/spring/boot/controller/
â”œâ”€â”€ PPLController.java               # REST Controller
â””â”€â”€ model/
    â”œâ”€â”€ PPLConfigResponse.java
    â”œâ”€â”€ ProviderSwitchRequest.java
    â”œâ”€â”€ PerplexityRequest.java
    â”œâ”€â”€ PerplexityResponse.java
    â”œâ”€â”€ ChunkRequest.java
    â”œâ”€â”€ ChunkResponse.java
    â”œâ”€â”€ RerankRequest.java
    â”œâ”€â”€ RerankResponse.java
    â”œâ”€â”€ HealthResponse.java
    â””â”€â”€ MetricsResponse.java
```

---

### Phase 6: é›†æˆä¸æµ‹è¯•ï¼ˆ2-3å¤©ï¼‰

#### ç›®æ ‡
é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿå¹¶å…¨é¢æµ‹è¯•

#### ä»»åŠ¡æ¸…å•
- [ ] é›†æˆåˆ° `DocumentsTab`ï¼ˆChunkingï¼‰
- [ ] é›†æˆåˆ° `HybridSearchService`ï¼ˆRerankï¼‰
- [ ] æ·»åŠ å‰ç«¯é…ç½®ç•Œé¢ï¼ˆå¯é€‰ï¼‰
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½å‹æµ‹
- [ ] æ–‡æ¡£ç¼–å†™
- [ ] éƒ¨ç½²æŒ‡å—

#### é›†æˆç¤ºä¾‹

```java
// é›†æˆåˆ° ChunkingService
@Service
public class ChunkingService {
    
    private final PPLServiceFacade pplService;
    
    public List<DocumentChunk> chunk(String content, ChunkingStrategy strategy) {
        if (strategy == ChunkingStrategy.PPL_BASED) {
            // ä½¿ç”¨ PPL æœåŠ¡
            return pplService.chunk(content, null, new ChunkConfig());
        }
        // ... å…¶ä»–ç­–ç•¥
    }
}

// é›†æˆåˆ° HybridSearchService
@Service
public class HybridSearchService {
    
    private final PPLServiceFacade pplService;
    
    public List<Document> hybridSearch(String question, ...) {
        // ... ç°æœ‰æ£€ç´¢é€»è¾‘ ...
        
        // PPL Rerankï¼ˆå¯é€‰ï¼‰
        if (pplConfig.getReranking().isEnabled()) {
            finalDocs = pplService.rerank(question, finalDocs, pplConfig.getReranking());
        }
        
        return finalDocs;
    }
}
```

---

## ğŸ“ å››ã€é…ç½®æ–‡ä»¶ç¤ºä¾‹

### 4.1 å®Œæ•´é…ç½®ï¼ˆapplication.ymlï¼‰

```yaml
knowledge:
  qa:
    # PPL æœåŠ¡é…ç½®
    ppl:
      # é»˜è®¤æä¾›å•†ï¼šonnx, ollama, openai
      default-provider: onnx
      
      # å¯ç”¨é™çº§ç­–ç•¥
      enable-fallback: true
      
      # é™çº§é¡ºåºï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
      fallback-order:
        - onnx      # ä¼˜å…ˆä½¿ç”¨ ONNXï¼ˆæœ€å¿«ï¼‰
        - ollama    # å…¶æ¬¡ Ollamaï¼ˆæœ¬åœ°ï¼‰
        - openai    # æœ€å OpenAIï¼ˆäº‘ç«¯ï¼‰
      
      # ONNX é…ç½®
      onnx:
        enabled: true
        model-path: ./models/gpt2-medium-int8/model.onnx
        tokenizer-path: ./models/gpt2-medium-int8/tokenizer.json
        max-batch-size: 8
        use-cache: true
        cache-size: 10000
        cache-ttl: 3600  # ç§’
      
      # Ollama é…ç½®
      ollama:
        enabled: false
        base-url: http://localhost:11434
        model: qwen:0.5b
        timeout: 30000
        max-retries: 3
        connection-pool-size: 10
      
      # OpenAI é…ç½®
      openai:
        enabled: false
        api-key: ${AI_API_KEY:}
        model: gpt-4o
        api-url: https://api.openai.com/v1/chat/completions
        timeout: 60000
        use-logprobs: true
      
      # Chunking é…ç½®
      chunking:
        ppl-threshold: 20.0      # PPL é˜ˆå€¼
        max-chunk-size: 2000     # æœ€å¤§å—å¤§å°ï¼ˆå­—ç¬¦ï¼‰
        min-chunk-size: 200      # æœ€å°å—å¤§å°ï¼ˆå­—ç¬¦ï¼‰
        overlap-size: 100        # é‡å å¤§å°ï¼ˆå­—ç¬¦ï¼‰
      
      # Reranking é…ç½®
      reranking:
        enabled: true            # æ˜¯å¦å¯ç”¨
        weight: 0.15             # PPL æƒé‡
        top-k: 5                 # ä»…å¯¹å‰ K ä¸ªé‡æ’åº
        async: true              # å¼‚æ­¥å¤„ç†
        timeout: 5000            # è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
```

### 4.2 åœºæ™¯åŒ–é…ç½®

#### åœºæ™¯1ï¼šå¼€å‘ç¯å¢ƒï¼ˆæˆæœ¬ä¼˜å…ˆï¼‰
```yaml
knowledge:
  qa:
    ppl:
      default-provider: onnx
      onnx:
        enabled: true
      ollama:
        enabled: false
      openai:
        enabled: false
      reranking:
        enabled: false  # å¼€å‘æ—¶å…³é—­
```

#### åœºæ™¯2ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰
```yaml
knowledge:
  qa:
    ppl:
      default-provider: onnx
      enable-fallback: true
      fallback-order: [onnx, ollama]
      onnx:
        enabled: true
        max-batch-size: 16  # æé«˜æ‰¹å¤„ç†
      ollama:
        enabled: true
        base-url: http://ollama-cluster:11434
      reranking:
        enabled: true
        async: true
```

#### åœºæ™¯3ï¼šé«˜è´¨é‡åœºæ™¯ï¼ˆè´¨é‡ä¼˜å…ˆï¼‰
```yaml
knowledge:
  qa:
    ppl:
      default-provider: openai
      enable-fallback: true
      fallback-order: [openai, ollama, onnx]
      openai:
        enabled: true
        use-logprobs: true
      reranking:
        enabled: true
        weight: 0.25  # æé«˜ PPL æƒé‡
        top-k: 10
```

---

## ğŸ§ª äº”ã€æµ‹è¯•è®¡åˆ’

### 5.1 å•å…ƒæµ‹è¯•

```java
@SpringBootTest
public class PPLServiceTest {
    
    @Autowired
    private PPLServiceFacade pplService;
    
    @Test
    public void testCalculatePerplexity() {
        String text = "ä»Šå¤©å¤©æ°”å¾ˆå¥½";
        double ppl = pplService.calculatePerplexity(text);
        assertTrue(ppl > 0 && ppl < 1000);
    }
    
    @Test
    public void testChunk() {
        String content = "å¾ˆé•¿çš„æ–‡æ¡£å†…å®¹...";
        List<DocumentChunk> chunks = pplService.chunk(content, null, new ChunkConfig());
        assertFalse(chunks.isEmpty());
    }
    
    @Test
    public void testRerank() {
        String question = "å¦‚ä½•èŠ‚çº¦ç”¨æ°´ï¼Ÿ";
        List<Document> docs = Arrays.asList(/* ... */);
        List<Document> reranked = pplService.rerank(question, docs, new RerankConfig());
        assertEquals(docs.size(), reranked.size());
    }
    
    @Test
    public void testProviderSwitch() {
        // åˆ‡æ¢åˆ° ONNX
        pplService.switchProvider(PPLProviderType.ONNX);
        assertEquals(PPLProviderType.ONNX, pplService.getCurrentProvider());
        
        // åˆ‡æ¢åˆ° Ollama
        pplService.switchProvider(PPLProviderType.OLLAMA);
        assertEquals(PPLProviderType.OLLAMA, pplService.getCurrentProvider());
    }
}
```

### 5.2 é›†æˆæµ‹è¯•

```java
@SpringBootTest
@AutoConfigureMockMvc
public class PPLControllerIntegrationTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    public void testCalculateAPI() throws Exception {
        mockMvc.perform(post("/api/ppl/calculate")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"text\":\"æµ‹è¯•æ–‡æœ¬\",\"provider\":\"onnx\"}"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.perplexity").exists());
    }
    
    @Test
    public void testSwitchProvider() throws Exception {
        mockMvc.perform(post("/api/ppl/config/provider")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"provider\":\"ollama\"}"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.success").value(true));
    }
}
```

### 5.3 æ€§èƒ½æµ‹è¯•

```java
@SpringBootTest
public class PPLPerformanceTest {
    
    @Autowired
    private PPLServiceFacade pplService;
    
    @Test
    public void benchmarkONNX() {
        long start = System.currentTimeMillis();
        for (int i = 0; i < 1000; i++) {
            pplService.calculatePerplexity("æµ‹è¯•æ–‡æœ¬");
        }
        long elapsed = System.currentTimeMillis() - start;
        System.out.println("ONNX: " + elapsed + "ms for 1000 calls");
        // é¢„æœŸ < 10000msï¼ˆå¹³å‡ 10ms/callï¼‰
    }
    
    @Test
    public void compareProviders() {
        String text = "è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬ï¼Œç”¨äºå¯¹æ¯”ä¸åŒæä¾›å•†çš„æ€§èƒ½ã€‚";
        
        // ONNX
        long onnxTime = measureTime(() -> {
            pplService.switchProvider(PPLProviderType.ONNX);
            return pplService.calculatePerplexity(text);
        });
        
        // Ollama
        long ollamaTime = measureTime(() -> {
            pplService.switchProvider(PPLProviderType.OLLAMA);
            return pplService.calculatePerplexity(text);
        });
        
        System.out.println("ONNX: " + onnxTime + "ms");
        System.out.println("Ollama: " + ollamaTime + "ms");
    }
}
```

---

## ğŸ“Š å…­ã€æ€§èƒ½æŒ‡æ ‡ä¸ç›‘æ§

### 6.1 å…³é”®æŒ‡æ ‡

```java
@Data
public class PPLMetrics {
    // è°ƒç”¨ç»Ÿè®¡
    private long totalCalls;
    private long successCalls;
    private long failedCalls;
    
    // æ€§èƒ½ç»Ÿè®¡
    private double avgLatencyMs;
    private double p50LatencyMs;
    private double p95LatencyMs;
    private double p99LatencyMs;
    
    // ç¼“å­˜ç»Ÿè®¡ï¼ˆä»… ONNXï¼‰
    private long cacheHits;
    private long cacheMisses;
    private double cacheHitRate;
    
    // æˆæœ¬ç»Ÿè®¡ï¼ˆä»… OpenAIï¼‰
    private double totalCost;
    private long totalTokens;
}
```

### 6.2 ç›‘æ§ç«¯ç‚¹

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/api/ppl/health

# å“åº”ç¤ºä¾‹
{
  "status": "UP",
  "providers": {
    "onnx": { "healthy": true, "latency": 15 },
    "ollama": { "healthy": false, "error": "Connection refused" },
    "openai": { "healthy": true, "latency": 234 }
  },
  "currentProvider": "onnx",
  "fallbackEnabled": true
}

# æ€§èƒ½æŒ‡æ ‡
curl http://localhost:8080/api/ppl/metrics

# å“åº”ç¤ºä¾‹
{
  "onnx": {
    "totalCalls": 10523,
    "avgLatency": 12.3,
    "cacheHitRate": 0.623
  },
  "ollama": {
    "totalCalls": 0,
    "avgLatency": 0,
    "error": "Not enabled"
  },
  "openai": {
    "totalCalls": 45,
    "avgLatency": 1234.5,
    "totalCost": 2.34
  }
}
```

---

## ğŸš€ ä¸ƒã€éƒ¨ç½²æŒ‡å—

### 7.1 ONNX éƒ¨ç½²

```bash
# 1. ä¸‹è½½æ¨¡å‹
mkdir -p models/gpt2-medium-int8
cd models/gpt2-medium-int8

# 2. è½¬æ¢æ¨¡å‹ï¼ˆåœ¨ Python ç¯å¢ƒä¸­ï¼‰
python convert_to_onnx.py

# 3. éªŒè¯æ¨¡å‹
ls -lh
# åº”è¯¥çœ‹åˆ°ï¼šmodel.onnx, tokenizer.json

# 4. é…ç½® application.yml
# è®¾ç½® ppl.onnx.enabled=true
# è®¾ç½®æ­£ç¡®çš„ model-path å’Œ tokenizer-path

# 5. å¯åŠ¨åº”ç”¨
./mvnw spring-boot:run
```

### 7.2 Ollama éƒ¨ç½²

```bash
# 1. å®‰è£… Ollama
curl -fsSL https://ollama.com/install.sh | sh

# 2. ä¸‹è½½æ¨¡å‹
ollama pull qwen:0.5b

# 3. å¯åŠ¨ Ollama
ollama serve

# 4. éªŒè¯
curl http://localhost:11434/api/generate -d '{
  "model": "qwen:0.5b",
  "prompt": "æµ‹è¯•"
}'

# 5. é…ç½® application.yml
# è®¾ç½® ppl.ollama.enabled=true
# è®¾ç½®æ­£ç¡®çš„ base-url å’Œ model

# 6. å¯åŠ¨åº”ç”¨
./mvnw spring-boot:run
```

### 7.3 OpenAI éƒ¨ç½²

```bash
# 1. è®¾ç½® API Key
export AI_API_KEY=sk-xxxxx

# 2. é…ç½® application.yml
# è®¾ç½® ppl.openai.enabled=true
# è®¾ç½®æ­£ç¡®çš„ api-key å’Œ model

# 3. å¯åŠ¨åº”ç”¨
./mvnw spring-boot:run
```

---

## ğŸ“š å…«ã€å¼€å‘è§„èŒƒ

### 8.1 ä»£ç è§„èŒƒ

```java
// 1. æ¥å£å®ç°å¿…é¡»æ·»åŠ  @Service æ³¨è§£
@Service
@ConditionalOnProperty(prefix = "knowledge.qa.ppl.onnx", name = "enabled", havingValue = "true")
public class PPLOnnxService implements PPLService {
    // ...
}

// 2. å¼‚å¸¸å¤„ç†ç»Ÿä¸€ä½¿ç”¨ PPLException
public double calculatePerplexity(String text) throws PPLException {
    try {
        // ... å®ç° ...
    } catch (Exception e) {
        throw new PPLException("Failed to calculate perplexity", e);
    }
}

// 3. æ—¥å¿—è§„èŒƒ
log.info("ğŸ“Š PPL ONNX Service initialized");
log.debug("ğŸ” Calculating PPL for text: {}", text.substring(0, Math.min(50, text.length())));
log.error("âŒ PPL calculation failed", e);

// 4. æ€§èƒ½ç›‘æ§
@Timed("ppl.calculate")
public double calculatePerplexity(String text) {
    // ...
}
```

### 8.2 æµ‹è¯•è§„èŒƒ

```java
// 1. å•å…ƒæµ‹è¯•å‘½å
@Test
public void testCalculatePerplexity_WithValidText_ShouldReturnPositiveValue() {
    // Given
    String text = "æµ‹è¯•æ–‡æœ¬";
    
    // When
    double ppl = service.calculatePerplexity(text);
    
    // Then
    assertTrue(ppl > 0);
}

// 2. é›†æˆæµ‹è¯•åˆ†ç»„
@Tag("integration")
@SpringBootTest
public class PPLOnnxServiceIntegrationTest {
    // ...
}

// 3. æ€§èƒ½æµ‹è¯•åˆ†ç»„
@Tag("performance")
@SpringBootTest
public class PPLPerformanceTest {
    // ...
}
```

---

## ğŸ¯ ä¹ã€é‡Œç¨‹ç¢‘ä¸äº¤ä»˜ç‰©

### é‡Œç¨‹ç¢‘ 1ï¼ˆDay 3ï¼‰
- âœ… åŸºç¡€æ¶æ„å®Œæˆ
- âœ… é…ç½®ç³»ç»Ÿå°±ç»ª
- âœ… å•å…ƒæµ‹è¯•é€šè¿‡

### é‡Œç¨‹ç¢‘ 2ï¼ˆDay 7ï¼‰
- âœ… ONNX å®ç°å®Œæˆ
- âœ… æ€§èƒ½æµ‹è¯•é€šè¿‡
- âœ… é›†æˆæµ‹è¯•é€šè¿‡

### é‡Œç¨‹ç¢‘ 3ï¼ˆDay 10ï¼‰
- âœ… Ollama å®ç°å®Œæˆ
- âœ… OpenAI å®ç°å®Œæˆ
- âœ… æ‰€æœ‰å®ç°é›†æˆæµ‹è¯•é€šè¿‡

### é‡Œç¨‹ç¢‘ 4ï¼ˆDay 12ï¼‰
- âœ… HTTP API å®Œæˆ
- âœ… API æ–‡æ¡£å®Œæˆ
- âœ… å‰ç«¯é›†æˆå®Œæˆï¼ˆå¯é€‰ï¼‰

### é‡Œç¨‹ç¢‘ 5ï¼ˆDay 15ï¼‰
- âœ… ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½å‹æµ‹å®Œæˆ
- âœ… æ–‡æ¡£ç¼–å†™å®Œæˆ
- âœ… éƒ¨ç½²ä¸Šçº¿

---

## ğŸ“– åã€æ–‡æ¡£æ¸…å•

### æŠ€æœ¯æ–‡æ¡£
1. **æ¶æ„è®¾è®¡æ–‡æ¡£**ï¼ˆæœ¬æ–‡æ¡£ï¼‰
2. **API æ¥å£æ–‡æ¡£**ï¼ˆSwaggerï¼‰
3. **é…ç½®æŒ‡å—**
4. **å¼€å‘è€…æŒ‡å—**
5. **éƒ¨ç½²æŒ‡å—**
6. **æ€§èƒ½æµ‹è¯•æŠ¥å‘Š**

### ç”¨æˆ·æ–‡æ¡£
1. **å¿«é€Ÿå¼€å§‹æŒ‡å—**
2. **é…ç½®åˆ‡æ¢æ•™ç¨‹**
3. **API ä½¿ç”¨ç¤ºä¾‹**
4. **å¸¸è§é—®é¢˜ FAQ**
5. **æ•…éšœæ’æŸ¥æŒ‡å—**

---

## âœ… åä¸€ã€éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æ”¯æŒ ONNXã€Ollamaã€OpenAI ä¸‰ç§æä¾›å•†
- [ ] æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶åˆ‡æ¢
- [ ] æ”¯æŒé€šè¿‡ HTTP API åŠ¨æ€åˆ‡æ¢
- [ ] æ”¯æŒé™çº§ç­–ç•¥
- [ ] æ”¯æŒ PPL Chunking
- [ ] æ”¯æŒ PPL Rerank

### æ€§èƒ½éªŒæ”¶
- [ ] ONNX è®¡ç®— PPLï¼š< 50msï¼ˆå•æ¬¡ï¼‰
- [ ] Ollama è®¡ç®— PPLï¼š< 500msï¼ˆå•æ¬¡ï¼‰
- [ ] OpenAI è®¡ç®— PPLï¼š< 3sï¼ˆå•æ¬¡ï¼‰
- [ ] ç¼“å­˜å‘½ä¸­ç‡ï¼š> 50%ï¼ˆONNXï¼‰
- [ ] å¹¶å‘æ”¯æŒï¼š100 QPS

### è´¨é‡éªŒæ”¶
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼š> 80%
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ç‡ï¼š100%
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ–‡æ¡£å®Œæ•´æ€§ï¼š100%

---

## ğŸ‰ åäºŒã€é¢„æœŸæ”¶ç›Š

### æˆæœ¬æ”¶ç›Š
- **Chunking æˆæœ¬é™ä½**ï¼š95%ï¼ˆä» $0.10-0.50 â†’ $0ï¼‰
- **æœˆåº¦æˆæœ¬èŠ‚çœ**ï¼š$10,000-50,000ï¼ˆ10ä¸‡æ–‡æ¡£åœºæ™¯ï¼‰

### æ€§èƒ½æ”¶ç›Š
- **Chunking é€Ÿåº¦æå‡**ï¼š2-3å€ï¼ˆ5-15ç§’ â†’ 1-3ç§’ï¼‰
- **Rerank å»¶è¿Ÿå¢åŠ **ï¼š< 150msï¼ˆå¯æ¥å—ï¼‰
- **å‡†ç¡®ç‡æå‡**ï¼š5-10%ï¼ˆå¯ç”¨ Rerankï¼‰

### çµæ´»æ€§æ”¶ç›Š
- **å¤šåç«¯æ”¯æŒ**ï¼š3 ç§ï¼ˆONNXã€Ollamaã€OpenAIï¼‰
- **åŠ¨æ€åˆ‡æ¢**ï¼šæ”¯æŒ
- **é™çº§ç­–ç•¥**ï¼šè‡ªåŠ¨
- **æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°æä¾›å•†

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¶é—´**ï¼š2025-12-04 20:00:00  
**ä½œè€…**ï¼šAI Assistant  
**çŠ¶æ€**ï¼šâœ… è®¡åˆ’å®Œæˆï¼Œå¾…å®æ–½

