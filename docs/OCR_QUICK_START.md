# OCR å›¾ç‰‡è¯†åˆ«å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ“– æ¦‚è¿°

æœ¬ç³»ç»Ÿæ”¯æŒé€šè¿‡ OCRï¼ˆå…‰å­¦å­—ç¬¦è¯†åˆ«ï¼‰æŠ€æœ¯ä»å›¾ç‰‡ä¸­æå–æ–‡å­—å†…å®¹ï¼Œæ— éœ€è®¾ç½®å¤æ‚çš„ç¯å¢ƒå˜é‡ï¼Œæ‰€æœ‰é…ç½®éƒ½å¯ä»¥åœ¨ `application.yml` æ–‡ä»¶ä¸­å®Œæˆã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… Tesseract OCR

æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿé€‰æ‹©å®‰è£…æ–¹å¼ï¼š

#### Windows
1. ä¸‹è½½ Tesseract å®‰è£…åŒ…ï¼šhttps://github.com/UB-Mannheim/tesseract/wiki
2. è¿è¡Œå®‰è£…ç¨‹åºï¼ˆæ¨èå®‰è£…åˆ°ï¼š`C:\Program Files\Tesseract-OCR`ï¼‰
3. è®°ä¸‹ `tessdata` æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼ˆé€šå¸¸æ˜¯ï¼š`C:\Program Files\Tesseract-OCR\tessdata`ï¼‰

#### Linux (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install tesseract-ocr tesseract-ocr-chi-sim tesseract-ocr-eng
```

#### macOS
```bash
brew install tesseract tesseract-lang
```

### 2. é…ç½® application.yml

æ‰“å¼€ `src/main/resources/application.yml` æˆ– `release/config/application.yml`ï¼Œæ‰¾åˆ° `image-processing` éƒ¨åˆ†ï¼š

```yaml
knowledge:
  qa:
    image-processing:
      # é€‰æ‹© OCR ç­–ç•¥
      strategy: ocr
      
      # å¯ç”¨ OCR
      enable-ocr: true
      
      # OCR é…ç½®
      ocr:
        # æ–¹å¼1ï¼šç›´æ¥æŒ‡å®š tessdata è·¯å¾„ï¼ˆæ¨èï¼‰
        tessdata-path: C:/Program Files/Tesseract-OCR/tessdata
        
        # æ–¹å¼2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœä½ å·²ç»è®¾ç½®äº† TESSDATA_PREFIXï¼‰
        # tessdata-path: ${TESSDATA_PREFIX:./tessdata}
        
        # è¯†åˆ«è¯­è¨€
        language: chi_sim+eng
```

### 3. é‡å¯åº”ç”¨

ä¿å­˜é…ç½®æ–‡ä»¶åï¼Œé‡å¯åº”ç”¨å³å¯ã€‚

## ğŸ”§ é…ç½®è¯´æ˜

### å›¾ç‰‡å¤„ç†ç­–ç•¥

ç³»ç»Ÿæ”¯æŒ4ç§å›¾ç‰‡å¤„ç†ç­–ç•¥ï¼š

| ç­–ç•¥ | è¯´æ˜ | ä¾èµ– |
|------|------|------|
| `placeholder` | å ä½ç¬¦æ¨¡å¼ï¼Œæ˜¾ç¤º `[å›¾ç‰‡: xxx.png]` | æ—  |
| `ocr` | OCR æ–‡å­—è¯†åˆ«ï¼Œæå–å›¾ç‰‡ä¸­çš„æ–‡å­— | Tesseract OCR |
| `vision-llm` | ä½¿ç”¨ AI æ¨¡å‹ç†è§£å›¾ç‰‡å†…å®¹ | API Key |
| `hybrid` | æ··åˆæ¨¡å¼ï¼ˆOCR + Vision LLMï¼‰ | Tesseract + API Key |

### tessdata-path é…ç½®æ–¹å¼

#### æ–¹å¼1ï¼šç›´æ¥æŒ‡å®šè·¯å¾„ï¼ˆæ¨èï¼‰

```yaml
tessdata-path: C:/Program Files/Tesseract-OCR/tessdata
```

**ä¼˜ç‚¹**ï¼š
- âœ… é…ç½®æ¸…æ™°æ˜ç¡®
- âœ… ä¸éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡
- âœ… ä¾¿äºå›¢é˜Ÿåä½œå’Œéƒ¨ç½²

#### æ–¹å¼2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡

```yaml
tessdata-path: ${TESSDATA_PREFIX:./tessdata}
```

è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
# Windows
set TESSDATA_PREFIX=C:\Program Files\Tesseract-OCR\tessdata

# Linux/Mac
export TESSDATA_PREFIX=/usr/share/tesseract-ocr/4.00/tessdata
```

**ä¼˜ç‚¹**ï¼š
- âœ… å…¼å®¹æ—§ç‰ˆæœ¬é…ç½®
- âœ… é€‚åˆå¤šç¯å¢ƒéƒ¨ç½²

#### æ–¹å¼3ï¼šä½¿ç”¨é¡¹ç›®å†…ç½®è·¯å¾„

```yaml
tessdata-path: ./tessdata
```

å°† tessdata æ–‡ä»¶å¤¹å¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•ã€‚

**ä¼˜ç‚¹**ï¼š
- âœ… ä¾¿äºæ‰“åŒ…åˆ†å‘
- âœ… æ— éœ€å®‰è£… Tesseract

### è¯­è¨€é…ç½®

| é…ç½®å€¼ | è¯´æ˜ |
|--------|------|
| `chi_sim` | ç®€ä½“ä¸­æ–‡ |
| `chi_tra` | ç¹ä½“ä¸­æ–‡ |
| `eng` | è‹±æ–‡ |
| `chi_sim+eng` | ä¸­è‹±æ–‡æ··åˆï¼ˆæ¨èï¼‰ |
| `jpn` | æ—¥æ–‡ |
| `kor` | éŸ©æ–‡ |

## âœ… éªŒè¯é…ç½®

å¯åŠ¨åº”ç”¨åï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

```
âœ… ç®€åŒ–ç‰ˆå‘é‡ç´¢å¼•å¼•æ“å·²åˆå§‹åŒ–
   - ç´¢å¼•è·¯å¾„: ./data/vector-index
   - å‘é‡ç»´åº¦: 384
   - å½“å‰å‘é‡æ•°: 210
   - æ£€ç´¢æ–¹å¼: çº¿æ€§æ‰«æï¼ˆé€‚åˆ<10ä¸‡æ¡ï¼‰

ğŸ¨ å›¾ç‰‡å¤„ç†é…ç½®å·²åˆå§‹åŒ–
   - ç­–ç•¥: ocr
   æ·»åŠ  OCR ç­–ç•¥ï¼š
   - Tesseract æ•°æ®è·¯å¾„ï¼šC:/Program Files/Tesseract-OCR/tessdata
   - è¯†åˆ«è¯­è¨€ï¼šchi_sim+eng
   âœ… OCR ç­–ç•¥å¯ç”¨
   ğŸ¯ æ¿€æ´»ç­–ç•¥ï¼šTesseract OCR (ä¼˜å…ˆçº§: 2)
```

å¦‚æœçœ‹åˆ° `âœ… OCR ç­–ç•¥å¯ç”¨`ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ˜¾ç¤º "OCR ç­–ç•¥ä¸å¯ç”¨"

**å¯èƒ½åŸå› **ï¼š
1. Tesseract OCR æœªå®‰è£…
2. tessdata è·¯å¾„é…ç½®é”™è¯¯
3. ç¼ºå°‘è¯­è¨€æ•°æ®æ–‡ä»¶

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ Tesseract æ˜¯å¦å·²æ­£ç¡®å®‰è£…
2. éªŒè¯ tessdata è·¯å¾„æ˜¯å¦å­˜åœ¨
3. ç¡®è®¤è¯­è¨€æ•°æ®æ–‡ä»¶ï¼ˆå¦‚ `chi_sim.traineddata`ï¼‰å­˜åœ¨äº tessdata ç›®å½•

### Q2: å›¾ç‰‡ä¸­çš„ä¸­æ–‡è¯†åˆ«ä¸å‡†ç¡®

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®ä¿å·²å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…
2. ä½¿ç”¨æ··åˆè¯­è¨€é…ç½®ï¼š`language: chi_sim+eng`
3. è€ƒè™‘å‡çº§åˆ°æ··åˆæ¨¡å¼ï¼ˆhybridï¼‰ï¼Œç»“åˆ Vision LLM æé«˜å‡†ç¡®ç‡

### Q3: ä¸æƒ³è®¾ç½®ç¯å¢ƒå˜é‡æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šç»å¯¹è·¯å¾„ï¼š

```yaml
ocr:
  tessdata-path: C:/Program Files/Tesseract-OCR/tessdata
```

è¿™æ˜¯æœ€ç®€å•ç›´æ¥çš„æ–¹å¼ï¼Œæ— éœ€è®¾ç½®ä»»ä½•ç¯å¢ƒå˜é‡ï¼

### Q4: å‡ºç°å¤§é‡ "Warning: Invalid resolution 1 dpi" è­¦å‘Š

**é—®é¢˜è¯´æ˜**ï¼š
è¿™æ˜¯ Tesseract OCR çš„æ­£å¸¸è­¦å‘Šä¿¡æ¯ï¼Œå‡ºç°åŸå› ï¼š
- æŸäº›å›¾ç‰‡ï¼ˆç‰¹åˆ«æ˜¯ä» Office æ–‡æ¡£æå–çš„ï¼‰ç¼ºå°‘æ­£ç¡®çš„ DPIï¼ˆæ¯è‹±å¯¸ç‚¹æ•°ï¼‰å…ƒæ•°æ®
- Tesseract è¦æ±‚ DPI >= 70ï¼Œå¦åˆ™ä¼šä½¿ç”¨é»˜è®¤çš„ 70 DPI

**å½±å“**ï¼š
- âš ï¸ è¿™åªæ˜¯è­¦å‘Šï¼Œä¸æ˜¯é”™è¯¯
- âœ… **ä¸å½±å“ OCR è¯†åˆ«çš„å‡†ç¡®æ€§**
- âœ… ç³»ç»Ÿå·²è‡ªåŠ¨å¤„ç†ï¼Œä½¿ç”¨æ ‡å‡† DPI è¿›è¡Œè¯†åˆ«

**è§£å†³æ–¹æ³•**ï¼š

æ–¹å¼1ï¼š**å¿½ç•¥è­¦å‘Š**ï¼ˆæ¨èï¼‰
- è¿™äº›è­¦å‘Šä¸å½±å“åŠŸèƒ½ï¼Œå¯ä»¥å®‰å…¨å¿½ç•¥
- ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨åˆé€‚çš„ DPI å€¼

æ–¹å¼2ï¼š**é™ä½æ—¥å¿—çº§åˆ«**
åœ¨ `application.yml` ä¸­é…ç½®ï¼š
```yaml
logging:
  level:
    root: INFO
    top.yumbo.ai.rag: INFO
    net.sourceforge.tess4j: ERROR  # åªæ˜¾ç¤ºé”™è¯¯ï¼Œä¸æ˜¾ç¤ºè­¦å‘Š
```

æ–¹å¼3ï¼š**é¢„å¤„ç†å›¾ç‰‡**
å¦‚æœæ‚¨æƒ³å®Œå…¨æ¶ˆé™¤è­¦å‘Šï¼Œå¯ä»¥åœ¨å¯¼å…¥æ–‡æ¡£å‰ï¼š
- ä½¿ç”¨å›¾ç‰‡ç¼–è¾‘å·¥å…·ï¼ˆå¦‚ Photoshopã€GIMPï¼‰è®¾ç½®å›¾ç‰‡ DPI ä¸º 300
- é‡æ–°ä¿å­˜å›¾ç‰‡

**æŠ€æœ¯è¯´æ˜**ï¼š
ç³»ç»Ÿå·²ç»å®ç°äº†è‡ªåŠ¨ DPI æ ‡å‡†åŒ–åŠŸèƒ½ï¼Œä¼šåœ¨ OCR å‰æ¸…ç†å›¾ç‰‡çš„æ— æ•ˆ DPI ä¿¡æ¯ï¼Œä½† Tesseract åœ¨æŸäº›æƒ…å†µä¸‹ä»ä¼šè¾“å‡ºè­¦å‘Šã€‚è¿™æ˜¯ Tesseract æœ¬èº«çš„è¡Œä¸ºï¼Œä¸å½±å“è¯†åˆ«æ•ˆæœã€‚

### Q5: å‡ºç° "Image too small to scale" é”™è¯¯

**é—®é¢˜è¯´æ˜**ï¼š
```
Image too small to scale!! (2x48 vs min width of 3)
Line cannot be recognized!!
```

è¿™ä¸ªé”™è¯¯è¡¨ç¤ºå›¾ç‰‡å°ºå¯¸è¿‡å°ï¼ˆå¦‚ 2x48 åƒç´ ï¼‰ï¼ŒTesseract æ— æ³•å¤„ç†ã€‚è¿™äº›å°å›¾ç‰‡é€šå¸¸æ˜¯ï¼š
- è£…é¥°æ€§å›¾æ ‡å’Œç¬¦å·
- åˆ†éš”çº¿ã€è¾¹æ¡†å…ƒç´ 
- é¡µçœ‰é¡µè„šä¸­çš„å°å›¾æ ‡

**å½±å“**ï¼š
- âœ… **ä¸å½±å“æ–‡æ¡£å†…å®¹æå–**
- âœ… è¿™äº›å°å›¾ç‰‡é€šå¸¸ä¸åŒ…å«æœ‰ç”¨çš„æ–‡æœ¬ä¿¡æ¯
- âœ… ç³»ç»Ÿä¼šè‡ªåŠ¨è·³è¿‡è¿™äº›å›¾ç‰‡

**è§£å†³æ–¹æ³•**ï¼š

æ–¹å¼1ï¼š**è‡ªåŠ¨å¤„ç†**ï¼ˆæ¨èï¼Œå·²å®ç°ï¼‰
- ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å›¾ç‰‡å°ºå¯¸
- < 3 åƒç´ ï¼šç›´æ¥è·³è¿‡ï¼ˆTesseract æ— æ³•å¤„ç†ï¼‰
- < 10 åƒç´ ï¼šè·³è¿‡è£…é¥°æ€§å…ƒç´ 
- >= 10 åƒç´ ï¼šæ­£å¸¸è¿›è¡Œ OCR è¯†åˆ«

æ–¹å¼2ï¼š**é™ä½æ—¥å¿—çº§åˆ«**
åœ¨ `logback.xml` ä¸­å·²é…ç½®æŠ‘åˆ¶è¿™äº›é”™è¯¯æ—¥å¿—ï¼š
```xml
<logger name="net.sourceforge.tess4j" level="ERROR"/>
```

æ–¹å¼3ï¼š**æ¸…ç†æ–‡æ¡£**
å¦‚æœä¸æƒ³çœ‹åˆ°è¿™äº›æç¤ºï¼Œå¯ä»¥åœ¨å¯¼å…¥å‰ï¼š
- åˆ é™¤æ–‡æ¡£ä¸­çš„è£…é¥°æ€§å°å›¾æ ‡
- ä½¿ç”¨"å¦å­˜ä¸º"åŠŸèƒ½é‡æ–°ä¿å­˜æ–‡æ¡£

## ğŸ“š è¿›é˜¶é…ç½®

### æ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰

ç»“åˆ OCR å’Œ Vision LLMï¼Œè·å¾—æœ€ä½³æ•ˆæœï¼š

```yaml
image-processing:
  strategy: hybrid
  enable-ocr: true
  
  ocr:
    tessdata-path: C:/Program Files/Tesseract-OCR/tessdata
    language: chi_sim+eng
  
  vision-llm:
    enabled: true
    api-key: sk-your-api-key
    model: gpt-4o
```

### Vision LLM ç‹¬ç«‹æ¨¡å¼

å¦‚æœä¸æƒ³å®‰è£… Tesseractï¼Œå¯ä»¥åªä½¿ç”¨ Vision LLMï¼š

```yaml
image-processing:
  strategy: vision-llm
  enable-ocr: false
  
  vision-llm:
    enabled: true
    api-key: sk-your-api-key
    model: gpt-4o
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨ç›´æ¥è·¯å¾„é…ç½®ï¼Œæ–¹ä¾¿å¿«é€Ÿè°ƒè¯•
   ```yaml
   tessdata-path: C:/Program Files/Tesseract-OCR/tessdata
   ```

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¾¿äºä¸åŒæœåŠ¡å™¨éƒ¨ç½²
   ```yaml
   tessdata-path: ${TESSDATA_PREFIX:/opt/tesseract/tessdata}
   ```

3. **æ··åˆè¯­è¨€æ–‡æ¡£**ï¼šä½¿ç”¨å¤šè¯­è¨€é…ç½®
   ```yaml
   language: chi_sim+eng+jpn
   ```

4. **é«˜å‡†ç¡®ç‡è¦æ±‚**ï¼šå¯ç”¨æ··åˆæ¨¡å¼
   ```yaml
   strategy: hybrid
   ```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`logs/app-info.log`
2. æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š`docs/develop/OCR_CONFIGURATION_GUIDE.md`
3. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“

