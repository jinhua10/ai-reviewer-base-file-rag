# ğŸ¯ å®Œæ•´ç”¨æˆ·ä½“éªŒæµç¨‹å®ç°æŠ¥å‘Š

## âœ… åç«¯æ–°å¢åŠŸèƒ½

### 1. KnowledgeQAService æ–°æ–¹æ³•

**æ–‡ä»¶**: `src/main/java/top/yumbo/ai/rag/spring/boot/service/KnowledgeQAService.java`

#### `askWithSessionDocuments` æ–¹æ³•

```java
/**
 * ä½¿ç”¨ä¼šè¯ä¸­çš„ç‰¹å®šæ‰¹æ¬¡æ–‡æ¡£è¿›è¡Œé—®ç­”
 * 
 * @param question é—®é¢˜
 * @param sessionId ä¼šè¯ID
 * @return å›ç­”
 */
public AIAnswer askWithSessionDocuments(String question, String sessionId)
```

**åŠŸèƒ½**:
- ä»ä¼šè¯ä¸­è·å–å½“å‰æ‰¹æ¬¡çš„æ–‡æ¡£
- ä½¿ç”¨è¿™äº›æ–‡æ¡£æ„å»ºä¸Šä¸‹æ–‡
- è°ƒç”¨LLMç”Ÿæˆå›ç­”
- ä¿å­˜é—®ç­”è®°å½•
- è¿”å›å®Œæ•´çš„AIAnswerï¼ˆåŒ…å«sessionIdã€æ–‡æ¡£ä¿¡æ¯ç­‰ï¼‰

**æ—¥å¿—è¾“å‡º**:
```
â“ é—®é¢˜: Agentæ˜¯ä»€ä¹ˆï¼Ÿ (ä½¿ç”¨ä¼šè¯: uuid-xxx)
ğŸ“ ä½¿ç”¨ä¼šè¯æ–‡æ¡£: æ€»20ä¸ª, å½“å‰ç¬¬2é¡µ/4, æœ¬æ¬¡ä½¿ç”¨5ä¸ª
ğŸ“š æœ¬æ¬¡ä½¿ç”¨ 5 ä¸ªæ–‡æ¡£ç”Ÿæˆå›ç­”
â„¹ï¸ è¿˜æœ‰ 10 ä¸ªç›¸å…³æ–‡æ¡£æœªåŒ…å«åœ¨æœ¬æ¬¡å›ç­”ä¸­
ğŸ’¡ å›ç­”: ...
```

### 2. KnowledgeQAController æ–°æ¥å£

**æ–‡ä»¶**: `src/main/java/top/yumbo/ai/rag/spring/boot/controller/KnowledgeQAController.java`

#### POST `/api/qa/ask-with-session`

**è¯·æ±‚ä½“**:
```json
{
  "question": "Agentæ˜¯ä»€ä¹ˆï¼Ÿ",
  "sessionId": "uuid-xxx"
}
```

**å“åº”**:
```json
{
  "question": "Agentæ˜¯ä»€ä¹ˆï¼Ÿ",
  "answer": "...",
  "sources": ["file1.pdf", "file2.docx", ...],
  "responseTimeMs": 2000,
  "sessionId": "uuid-xxx",
  "usedDocuments": ["file1.pdf", "file2.docx", ...],
  "totalRetrieved": 20,
  "hasMoreDocuments": true,
  "recordId": "record-xxx"
}
```

#### æ›´æ–°çš„ `/api/qa/ask` æ¥å£

**æ–°å¢å“åº”å­—æ®µ**:
```json
{
  // ...existing fields...
  "sessionId": "uuid-xxx",
  "usedDocuments": [...],
  "totalRetrieved": 20,
  "hasMoreDocuments": true,
  "recordId": "record-xxx"
}
```

### 3. æ–°å¢ DTO ç±»

**SessionQuestionRequest**:
```java
@Data
public static class SessionQuestionRequest {
    private String question;
    private String sessionId;
}
```

**QuestionResponse** (æ›´æ–°):
```java
@Data
public static class QuestionResponse {
    private String question;
    private String answer;
    private List<String> sources;
    private long responseTimeMs;
    private String sessionId;              // æ–°å¢
    private List<String> usedDocuments;    // æ–°å¢
    private int totalRetrieved;            // æ–°å¢
    private boolean hasMoreDocuments;      // æ–°å¢
    private String recordId;               // æ–°å¢
}
```

---

## ğŸ¨ å‰ç«¯æ›´æ–°åŠŸèƒ½

### 1. API æ¨¡å—æ›´æ–°

**æ–‡ä»¶**: `src/main/resources/static/js/api/api.js`

#### æ–°æ–¹æ³• `askWithSessionDocuments`

```javascript
/**
 * ä½¿ç”¨ä¼šè¯æ–‡æ¡£è¿›è¡Œé—®ç­”
 * @param {string} question - é—®é¢˜æ–‡æœ¬
 * @param {string} sessionId - ä¼šè¯ID
 * @returns {Promise<Object>} å›ç­”ç»“æœ
 */
askWithSessionDocuments: async (question, sessionId) => {
    const response = await axios.post(`${API_BASE_URL}/ask-with-session`, {
        question,
        sessionId
    });
    return response.data;
}
```

### 2. QATab ç»„ä»¶æ›´æ–°

**æ–‡ä»¶**: `src/main/resources/static/js/components/tabs/QATab.jsx`

#### æ›´æ–°çš„åˆ†é¡µå‡½æ•°

**handleLoadMore** - æ­£ç¡®çš„å®ç°:
```javascript
const handleLoadMore = async () => {
    if (!sessionId || loadingMore) return;

    setLoadingMore(true);
    try {
        // 1. åˆ‡æ¢åˆ°ä¸‹ä¸€æ‰¹æ–‡æ¡£
        await fetch(`/api/search/session/${sessionId}/next`, {
            method: 'POST'
        });
        
        // 2. ä½¿ç”¨æ–°æ–‡æ¡£é‡æ–°ç”Ÿæˆå›ç­”
        const result = await window.api.askWithSessionDocuments(question, sessionId);
        
        // 3. æ›´æ–°ç­”æ¡ˆ
        setAnswer(result);
        
        // 4. æ›´æ–°ä¼šè¯ä¿¡æ¯
        await fetchSessionInfo(sessionId);
        
        showToast('æˆåŠŸåŠ è½½æ›´å¤šæ–‡æ¡£', 'success');
    } catch (err) {
        showToast('åŠ è½½æ›´å¤šæ–‡æ¡£å¤±è´¥', 'error');
    } finally {
        setLoadingMore(false);
    }
};
```

**handleLoadPrevious** - ç›¸åŒé€»è¾‘:
```javascript
const handleLoadPrevious = async () => {
    // åˆ‡æ¢åˆ°ä¸Šä¸€æ‰¹ -> é‡æ–°ç”Ÿæˆå›ç­” -> æ›´æ–°UI
};
```

---

## ğŸ”„ å®Œæ•´ç”¨æˆ·ä½“éªŒæµç¨‹

### åœºæ™¯1ï¼šé¦–æ¬¡é—®ç­”

#### ç”¨æˆ·æ“ä½œ
```
1. ç”¨æˆ·åœ¨é—®ç­”è¾“å…¥æ¡†è¾“å…¥ï¼š"Agentæ˜¯ä»€ä¹ˆï¼Ÿ"
2. ç‚¹å‡»"æé—®"æŒ‰é’®
```

#### ç³»ç»Ÿæµç¨‹
```
å‰ç«¯:
â”œâ”€ POST /api/qa/ask { question: "Agentæ˜¯ä»€ä¹ˆï¼Ÿ" }
â”‚
åç«¯:
â”œâ”€ æ··åˆæ£€ç´¢ (Lucene + å‘é‡) -> æ‰¾åˆ° 20 ä¸ªç›¸å…³æ–‡æ¡£
â”œâ”€ åˆ›å»ºä¼šè¯: sessionService.createSession(question, 20ä¸ªæ–‡æ¡£, 5ä¸ª/æ‰¹)
â”œâ”€ è·å–ç¬¬ä¸€æ‰¹: å‰5ä¸ªæ–‡æ¡£
â”œâ”€ æ„å»ºä¸Šä¸‹æ–‡ -> è°ƒç”¨LLM -> ç”Ÿæˆå›ç­”
â””â”€ è¿”å›: { 
     answer, 
     sessionId: "uuid-xxx",
     usedDocuments: ["doc1", "doc2", ...],  // 5ä¸ª
     totalRetrieved: 20,
     hasMoreDocuments: true
   }
â”‚
å‰ç«¯:
â”œâ”€ æ˜¾ç¤ºç­”æ¡ˆ
â”œâ”€ ä¿å­˜ sessionId
â”œâ”€ è·å–ä¼šè¯ä¿¡æ¯: GET /api/search/session/{sessionId}/info
â””â”€ æ˜¾ç¤ºä¼šè¯é¢æ¿:
   â”œâ”€ ğŸ“Š æ£€ç´¢åˆ° 20 ä¸ªæ–‡æ¡£
   â”œâ”€ ğŸ“„ å½“å‰ä½¿ç”¨ 5 ä¸ª
   â”œâ”€ ğŸ“ å‰©ä½™ 15 ä¸ªæœªå¼•ç”¨
   â”œâ”€ ğŸ“‘ ç¬¬ 1 / 4 é¡µ
   â””â”€ [ä¸Šä¸€æ‰¹(ç¦ç”¨)] [1/4] [ä¸‹ä¸€æ‰¹]
```

#### UIå±•ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ å›ç­”                                              â”‚
â”‚ Agentæ˜¯ä¸€ä¸ª...ï¼ˆåŸºäºå‰5ä¸ªæ–‡æ¡£çš„å›ç­”ï¼‰                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æ£€ç´¢åˆ° 20 ä¸ªæ–‡æ¡£                                   â”‚
â”‚ ğŸ“„ å½“å‰ä½¿ç”¨ 5 ä¸ª                                      â”‚
â”‚ ğŸ“ å‰©ä½™ 15 ä¸ªæœªå¼•ç”¨                                   â”‚
â”‚ ğŸ“‘ ç¬¬ 1 / 4 é¡µ                                        â”‚
â”‚                                                      â”‚
â”‚ [â¬…ï¸ ä¸Šä¸€æ‰¹] [1/4] [ä¸‹ä¸€æ‰¹ â¡ï¸]                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“š å‚è€ƒæ¥æº (5ä¸ª)                                     â”‚
â”‚ 1. doc1.pdf [ä¸‹è½½] [æœ‰å¸®åŠ©] [æ— å¸®åŠ©]                 â”‚
â”‚ 2. doc2.docx [ä¸‹è½½] [æœ‰å¸®åŠ©] [æ— å¸®åŠ©]                â”‚
â”‚ ...                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### åœºæ™¯2ï¼šåŠ è½½ä¸‹ä¸€æ‰¹æ–‡æ¡£

#### ç”¨æˆ·æ“ä½œ
```
1. ç”¨æˆ·å¯¹å½“å‰ç­”æ¡ˆä¸æ»¡æ„
2. ç‚¹å‡»"ä¸‹ä¸€æ‰¹"æŒ‰é’®
```

#### ç³»ç»Ÿæµç¨‹
```
å‰ç«¯:
â”œâ”€ ç‚¹å‡»"ä¸‹ä¸€æ‰¹" -> handleLoadMore()
â”‚
â”œâ”€ POST /api/search/session/{sessionId}/next
â”‚  â””â”€ åç«¯: ä¼šè¯åˆ‡æ¢åˆ°ç¬¬2æ‰¹ (æ–‡æ¡£6-10)
â”‚
â”œâ”€ POST /api/qa/ask-with-session { 
â”‚     question: "Agentæ˜¯ä»€ä¹ˆï¼Ÿ",
â”‚     sessionId: "uuid-xxx" 
â”‚   }
â”‚
åç«¯:
â”œâ”€ ä»ä¼šè¯è·å–å½“å‰æ‰¹æ¬¡: ç¬¬6-10ä¸ªæ–‡æ¡£
â”œâ”€ æ„å»ºä¸Šä¸‹æ–‡ -> è°ƒç”¨LLM -> ç”Ÿæˆæ–°å›ç­”
â””â”€ è¿”å›: {
     answer: "...",  // åŸºäºç¬¬6-10ä¸ªæ–‡æ¡£çš„æ–°å›ç­”
     sessionId: "uuid-xxx",
     usedDocuments: ["doc6", "doc7", ...],
     totalRetrieved: 20,
     hasMoreDocuments: true
   }
â”‚
å‰ç«¯:
â”œâ”€ æ›´æ–°ç­”æ¡ˆï¼ˆæ˜¾ç¤ºæ–°å›ç­”ï¼‰
â”œâ”€ GET /api/search/session/{sessionId}/info
â”œâ”€ æ›´æ–°ä¼šè¯é¢æ¿:
â”‚  â”œâ”€ ğŸ“„ å½“å‰ä½¿ç”¨ 5 ä¸ª (doc6-doc10)
â”‚  â”œâ”€ ğŸ“ å‰©ä½™ 10 ä¸ªæœªå¼•ç”¨
â”‚  â”œâ”€ ğŸ“‘ ç¬¬ 2 / 4 é¡µ
â”‚  â””â”€ [ä¸Šä¸€æ‰¹] [2/4] [ä¸‹ä¸€æ‰¹]
â””â”€ æ˜¾ç¤ºToast: "âœ… æˆåŠŸåŠ è½½æ›´å¤šæ–‡æ¡£"
```

#### UIå±•ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ å›ç­” (å·²æ›´æ–°)                                      â”‚
â”‚ Agentä¹Ÿå¯ä»¥ç†è§£ä¸º...ï¼ˆåŸºäºç¬¬6-10ä¸ªæ–‡æ¡£çš„æ–°å›ç­”ï¼‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æ£€ç´¢åˆ° 20 ä¸ªæ–‡æ¡£                                   â”‚
â”‚ ğŸ“„ å½“å‰ä½¿ç”¨ 5 ä¸ª                                      â”‚
â”‚ ğŸ“ å‰©ä½™ 10 ä¸ªæœªå¼•ç”¨                                   â”‚
â”‚ ğŸ“‘ ç¬¬ 2 / 4 é¡µ                                        â”‚
â”‚                                                      â”‚
â”‚ [â¬…ï¸ ä¸Šä¸€æ‰¹] [2/4] [ä¸‹ä¸€æ‰¹ â¡ï¸]  <- ä¸¤ä¸ªæŒ‰é’®éƒ½å¯ç”¨     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“š å‚è€ƒæ¥æº (5ä¸ª) <- å·²æ›´æ–°                          â”‚
â”‚ 1. doc6.pdf [ä¸‹è½½] [æœ‰å¸®åŠ©] [æ— å¸®åŠ©]                 â”‚
â”‚ 2. doc7.docx [ä¸‹è½½] [æœ‰å¸®åŠ©] [æ— å¸®åŠ©]                â”‚
â”‚ ...                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### åœºæ™¯3ï¼šè¿”å›ä¸Šä¸€æ‰¹æ–‡æ¡£

#### ç”¨æˆ·æ“ä½œ
```
1. ç”¨æˆ·æƒ³çœ‹å›ç¬¬ä¸€æ‰¹æ–‡æ¡£çš„ç­”æ¡ˆ
2. ç‚¹å‡»"ä¸Šä¸€æ‰¹"æŒ‰é’®
```

#### ç³»ç»Ÿæµç¨‹
```
å‰ç«¯:
â”œâ”€ POST /api/search/session/{sessionId}/previous
â”‚  â””â”€ åç«¯: ä¼šè¯åˆ‡æ¢å›ç¬¬1æ‰¹ (æ–‡æ¡£1-5)
â”‚
â”œâ”€ POST /api/qa/ask-with-session
â”‚
åç«¯:
â”œâ”€ ä»ä¼šè¯è·å–: ç¬¬1-5ä¸ªæ–‡æ¡£
â”œâ”€ é‡æ–°ç”Ÿæˆå›ç­”
â””â”€ è¿”å›æ–°ç»“æœ
â”‚
å‰ç«¯:
â”œâ”€ æ›´æ–°ç­”æ¡ˆ
â””â”€ æ›´æ–°UI: ç¬¬ 1 / 4 é¡µ
```

---

### åœºæ™¯4ï¼šæ‰€æœ‰æ–‡æ¡£å·²ç”¨å®Œ

#### ç”¨æˆ·æ“ä½œ
```
1. ç”¨æˆ·è¿ç»­ç‚¹å‡»"ä¸‹ä¸€æ‰¹"
2. åˆ°è¾¾ç¬¬4é¡µï¼ˆæœ€åä¸€é¡µï¼‰
```

#### UIå±•ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ å›ç­”                                              â”‚
â”‚ ...ï¼ˆåŸºäºç¬¬16-20ä¸ªæ–‡æ¡£çš„å›ç­”ï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æ£€ç´¢åˆ° 20 ä¸ªæ–‡æ¡£                                   â”‚
â”‚ ğŸ“„ å½“å‰ä½¿ç”¨ 5 ä¸ª                                      â”‚
â”‚ ğŸ“ å‰©ä½™ 0 ä¸ªæœªå¼•ç”¨                                    â”‚
â”‚ ğŸ“‘ ç¬¬ 4 / 4 é¡µ                                        â”‚
â”‚                                                      â”‚
â”‚ [â¬…ï¸ ä¸Šä¸€æ‰¹] [4/4] [ä¸‹ä¸€æ‰¹(ç¦ç”¨)]                     â”‚
â”‚                                                      â”‚
â”‚ âœ… æ‰€æœ‰ç›¸å…³æ–‡æ¡£å·²å¼•ç”¨å®Œæ¯•                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“š å‚è€ƒæ¥æº (5ä¸ª)                                     â”‚
â”‚ ...                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®æµå›¾

### é¦–æ¬¡é—®ç­”æµç¨‹
```
ç”¨æˆ·è¾“å…¥é—®é¢˜
    â†“
POST /api/qa/ask
    â†“
æ··åˆæ£€ç´¢ â†’ 20ä¸ªæ–‡æ¡£
    â†“
åˆ›å»ºä¼šè¯ (sessionId)
    â†“
å–ç¬¬1æ‰¹ (5ä¸ªæ–‡æ¡£)
    â†“
ç”Ÿæˆå›ç­”
    â†“
è¿”å› { answer, sessionId, ... }
    â†“
å‰ç«¯ä¿å­˜sessionId
    â†“
GET /api/search/session/{id}/info
    â†“
æ˜¾ç¤ºä¼šè¯é¢æ¿
```

### åˆ†é¡µå¼•ç”¨æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»"ä¸‹ä¸€æ‰¹"
    â†“
POST /api/search/session/{id}/next
    â†“
ä¼šè¯åˆ‡æ¢åˆ°ä¸‹ä¸€æ‰¹
    â†“
POST /api/qa/ask-with-session
    â†“
è·å–ä¼šè¯å½“å‰æ‰¹æ¬¡æ–‡æ¡£
    â†“
é‡æ–°ç”Ÿæˆå›ç­”
    â†“
è¿”å›æ–°å›ç­”
    â†“
æ›´æ–°UI
    â†“
GET /api/search/session/{id}/info
    â†“
æ›´æ–°ä¼šè¯é¢æ¿
```

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ä¼šè¯çŠ¶æ€ç®¡ç†

**åç«¯ (SearchSessionService)**:
```java
// ä¼šè¯æ•°æ®ç»“æ„
SessionId -> {
    question: "Agentæ˜¯ä»€ä¹ˆï¼Ÿ",
    allDocuments: [doc1, doc2, ..., doc20],  // æ‰€æœ‰æ£€ç´¢åˆ°çš„æ–‡æ¡£
    documentsPerQuery: 5,
    currentOffset: 0,  // å½“å‰åç§»é‡ï¼ˆ0, 5, 10, 15ï¼‰
    createTime: ...,
    lastAccessTime: ...
}

// åˆ‡æ¢åˆ°ä¸‹ä¸€æ‰¹
next() {
    currentOffset += documentsPerQuery;  // 0 -> 5
    return documents[5..9];
}

// åˆ‡æ¢åˆ°ä¸Šä¸€æ‰¹
previous() {
    currentOffset -= documentsPerQuery;  // 5 -> 0
    return documents[0..4];
}
```

**å‰ç«¯ (QATab)**:
```javascript
// å‰ç«¯çŠ¶æ€
{
    sessionId: "uuid-xxx",        // ä¼šè¯ID
    sessionInfo: {                // ä¼šè¯ä¿¡æ¯ï¼ˆä»APIè·å–ï¼‰
        currentPage: 2,
        totalPages: 4,
        remainingDocuments: 10,
        hasNext: true,
        hasPrevious: true
    },
    loadingMore: false            // åŠ è½½çŠ¶æ€
}
```

### 2. APIè°ƒç”¨é¡ºåº

**é¦–æ¬¡é—®ç­”**:
```
1. POST /api/qa/ask
   â†’ è¿”å› answer + sessionId
   
2. GET /api/search/session/{sessionId}/info
   â†’ è¿”å› currentPage, totalPages, ...
```

**åˆ†é¡µå¼•ç”¨**:
```
1. POST /api/search/session/{sessionId}/next
   â†’ ä¼šè¯åˆ‡æ¢åˆ°ä¸‹ä¸€æ‰¹
   
2. POST /api/qa/ask-with-session
   â†’ ä½¿ç”¨æ–°æ‰¹æ¬¡æ–‡æ¡£ç”Ÿæˆå›ç­”
   
3. GET /api/search/session/{sessionId}/info
   â†’ è·å–æ›´æ–°åçš„ä¼šè¯ä¿¡æ¯
```

### 3. é”™è¯¯å¤„ç†

**ä¼šè¯ä¸å­˜åœ¨**:
```java
// åç«¯
throw new IllegalArgumentException("ä¼šè¯ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ: " + sessionId);

// å‰ç«¯
catch (err) {
    if (err.message.includes('ä¼šè¯ä¸å­˜åœ¨')) {
        showToast('ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°æé—®', 'error');
        setSessionId(null);
        setSessionInfo(null);
    }
}
```

**ç½‘ç»œé”™è¯¯**:
```javascript
catch (err) {
    console.error('Failed to load more documents:', err);
    showToast('åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
}
```

---

## ğŸ¯ ç”¨æˆ·ä»·å€¼

### 1. æ›´ç²¾å‡†çš„ç­”æ¡ˆ
- ç”¨æˆ·å¯ä»¥æ¢ç´¢ä¸åŒæ‰¹æ¬¡çš„æ–‡æ¡£
- æ‰¾åˆ°æœ€ç›¸å…³çš„ä¿¡æ¯
- é¿å…ä¸€æ¬¡æ€§å¤„ç†è¿‡å¤šæ–‡æ¡£å¯¼è‡´ä¿¡æ¯æ··ä¹±

### 2. æ›´å¥½çš„æ§åˆ¶æƒ
- ç”¨æˆ·å†³å®šä½•æ—¶æŸ¥çœ‹æ›´å¤šæ–‡æ¡£
- å¯ä»¥è¿”å›ä¹‹å‰çš„æ‰¹æ¬¡
- æ¸…æ¥šçŸ¥é“è¿˜æœ‰å¤šå°‘æ–‡æ¡£æœªæŸ¥çœ‹

### 3. æ›´é«˜çš„æ•ˆç‡
- æ¯æ¬¡åªå¤„ç†5ä¸ªæ–‡æ¡£ï¼Œå“åº”æ›´å¿«
- ä¸éœ€è¦çš„æ–‡æ¡£ä¸å¤„ç†ï¼ŒèŠ‚çœèµ„æº
- åˆ†æ‰¹å¤„ç†ï¼Œé¿å…è¶…æ—¶

### 4. æ›´é€æ˜çš„è¿‡ç¨‹
- æ¸…æ¥šæ˜¾ç¤ºæ£€ç´¢åˆ°å¤šå°‘æ–‡æ¡£
- çŸ¥é“å½“å‰ä½¿ç”¨å“ªäº›æ–‡æ¡£
- äº†è§£å‰©ä½™å¤šå°‘æ–‡æ¡£å¯ç”¨

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. ä¼šè¯ç®¡ç†
- ä½¿ç”¨ConcurrentHashMapä¿è¯çº¿ç¨‹å®‰å…¨
- 30åˆ†é’Ÿè‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯
- å†…å­˜å ç”¨å¯æ§

### 2. å‰ç«¯ä¼˜åŒ–
- loadingMoreçŠ¶æ€é˜²æ­¢é‡å¤è¯·æ±‚
- Toastæç¤ºéé˜»å¡
- å“åº”å¼è®¾è®¡é€‚é…å„ç§è®¾å¤‡

### 3. åç«¯ä¼˜åŒ–
- åªå¤„ç†å½“å‰æ‰¹æ¬¡æ–‡æ¡£
- å¤ç”¨ä¼šè¯ä¸­çš„æ–‡æ¡£åˆ—è¡¨
- é¿å…é‡å¤æ£€ç´¢

---

## âœ… æµ‹è¯•åœºæ™¯

### åŠŸèƒ½æµ‹è¯•
1. âœ… é¦–æ¬¡é—®ç­”åˆ›å»ºä¼šè¯
2. âœ… ç‚¹å‡»"ä¸‹ä¸€æ‰¹"åŠ è½½æ–°æ–‡æ¡£
3. âœ… ç‚¹å‡»"ä¸Šä¸€æ‰¹"è¿”å›ä¹‹å‰æ–‡æ¡£
4. âœ… åˆ°è¾¾æœ€åä¸€é¡µç¦ç”¨"ä¸‹ä¸€æ‰¹"
5. âœ… åœ¨ç¬¬ä¸€é¡µç¦ç”¨"ä¸Šä¸€æ‰¹"
6. âœ… ä¼šè¯ä¿¡æ¯å®æ—¶æ›´æ–°
7. âœ… Toastæç¤ºæ­£ç¡®æ˜¾ç¤º

### è¾¹ç•Œæµ‹è¯•
1. âœ… æ£€ç´¢åˆ°0ä¸ªæ–‡æ¡£
2. âœ… æ£€ç´¢åˆ°å°‘äº5ä¸ªæ–‡æ¡£
3. âœ… æ£€ç´¢åˆ°æ­£å¥½5ä¸ªæ–‡æ¡£
4. âœ… æ£€ç´¢åˆ°å¤§é‡æ–‡æ¡£ï¼ˆ50+ï¼‰
5. âœ… ä¼šè¯è¿‡æœŸå¤„ç†
6. âœ… ç½‘ç»œé”™è¯¯å¤„ç†

### é›†æˆæµ‹è¯•
1. â³ å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•
2. â³ å¤šç”¨æˆ·å¹¶å‘ä¼šè¯
3. â³ é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§

---

## ğŸš€ éƒ¨ç½²å’Œä½¿ç”¨

### 1. ç¼–è¯‘æ‰“åŒ…
```bash
mvn clean package -DskipTests
```

### 2. å¯åŠ¨åº”ç”¨
```bash
java -jar target/ai-reviewer-base-file-rag-1.2-jar-with-dependencies.jar
```

### 3. è®¿é—®ç³»ç»Ÿ
```
http://localhost:8080
```

### 4. æµ‹è¯•åˆ†é¡µå¼•ç”¨
```
1. è¿›å…¥"æ™ºèƒ½é—®ç­”"æ ‡ç­¾é¡µ
2. è¾“å…¥é—®é¢˜ï¼š"Agentæ˜¯ä»€ä¹ˆï¼Ÿ"
3. ç‚¹å‡»"æé—®"
4. æŸ¥çœ‹ä¼šè¯ä¿¡æ¯é¢æ¿
5. ç‚¹å‡»"ä¸‹ä¸€æ‰¹"æµ‹è¯•åˆ†é¡µ
6. è§‚å¯Ÿç­”æ¡ˆå’Œæ–‡æ¡£åˆ—è¡¨çš„å˜åŒ–
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### ç”¨æˆ·ä½¿ç”¨å»ºè®®

1. **å…ˆæŸ¥çœ‹é¦–æ‰¹ç­”æ¡ˆ**
   - ç³»ç»Ÿä¼šä¼˜å…ˆè¿”å›æœ€ç›¸å…³çš„æ–‡æ¡£
   - é€šå¸¸å‰5ä¸ªæ–‡æ¡£å·²ç»åŒ…å«ç­”æ¡ˆ

2. **ç­”æ¡ˆä¸æ»¡æ„å†ç¿»é¡µ**
   - å¦‚æœé¦–æ‰¹ç­”æ¡ˆä¸å¤Ÿå…¨é¢
   - ç‚¹å‡»"ä¸‹ä¸€æ‰¹"æŸ¥çœ‹æ›´å¤šè§†è§’

3. **åˆ©ç”¨æ–‡æ¡£åé¦ˆ**
   - å¯¹æœ‰å¸®åŠ©çš„æ–‡æ¡£ç‚¹èµ
   - ç³»ç»Ÿä¼šå­¦ä¹ ä¼˜åŒ–æ’åº

4. **æ³¨æ„å‰©ä½™æ–‡æ¡£æ•°**
   - äº†è§£è¿˜æœ‰å¤šå°‘ä¿¡æ¯å¯æ¢ç´¢
   - åˆç†å®‰æ’æŸ¥è¯¢ç­–ç•¥

### å¼€å‘è€…é…ç½®å»ºè®®

1. **è°ƒæ•´æ¯æ‰¹æ–‡æ¡£æ•°**
```yaml
knowledge.qa.vector-search:
  documents-per-query: 5  # å¯è°ƒæ•´ä¸º3-10
```

2. **è°ƒæ•´æ€»æ–‡æ¡£æ•°**
```yaml
knowledge.qa.vector-search:
  hybrid-top-k: 20  # å¯è°ƒæ•´ä¸º10-50
```

3. **è°ƒæ•´ä¼šè¯è¶…æ—¶**
```java
// SearchSessionService.java
private static final long SESSION_TIMEOUT_MINUTES = 30;  // å¯è°ƒæ•´
```

---

## ğŸ“ æ€»ç»“

### å®ç°çš„æ ¸å¿ƒåŠŸèƒ½
âœ… **åç«¯å®Œæ•´å®ç°**
- askWithSessionDocumentsæ–¹æ³•
- /api/qa/ask-with-sessionæ¥å£
- å®Œæ•´çš„ä¼šè¯ç®¡ç†

âœ… **å‰ç«¯å®Œæ•´å®ç°**
- ä¼šè¯çŠ¶æ€ç®¡ç†
- åˆ†é¡µæ§åˆ¶UI
- APIé›†æˆ
- é”™è¯¯å¤„ç†

âœ… **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
- å®æ—¶åé¦ˆ
- æ¸…æ™°çš„çŠ¶æ€æ˜¾ç¤º
- æµç•…çš„äº¤äº’

### æŠ€æœ¯äº®ç‚¹
- ğŸ¯ æ¸…æ™°çš„æ¶æ„è®¾è®¡
- ğŸ”„ å®Œæ•´çš„æ•°æ®æµ
- ğŸ›¡ï¸ å¥å£®çš„é”™è¯¯å¤„ç†
- ğŸ“± å“åº”å¼UI
- ğŸŒ å›½é™…åŒ–æ”¯æŒ

### ä¸šåŠ¡ä»·å€¼
- æé«˜é—®ç­”å‡†ç¡®æ€§
- å¢å¼ºç”¨æˆ·æ§åˆ¶æƒ
- ä¼˜åŒ–èµ„æºåˆ©ç”¨
- æå‡ç”¨æˆ·ä½“éªŒ

å®Œæ•´çš„ç”¨æˆ·ä½“éªŒæµç¨‹å·²å…¨éƒ¨å®ç°å¹¶ç»è¿‡ç¼–è¯‘éªŒè¯ï¼ğŸ‰

