# âš™ï¸ å†…å­˜å’Œæ€§èƒ½é…ç½®ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ ä¼˜åŒ–å†…å®¹

**ä¼˜åŒ–æ—¶é—´**: 2025-11-27  
**ä¼˜åŒ–ç±»å‹**: å°†ç¡¬ç¼–ç å¸¸é‡é…ç½®åŒ–  
**ç›®æ ‡**: è®©ç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼Œæä¾›æ›´å¥½çš„çµæ´»æ€§

---

## ğŸ¯ ä¼˜åŒ–çš„å¸¸é‡

### ä¼˜åŒ–å‰ï¼ˆç¡¬ç¼–ç ï¼‰

```java
// KnowledgeBaseService.java
final int MAX_CONTENT_LENGTH = 50000; // âŒ ç¡¬ç¼–ç 

// SimpleDocumentChunker.java  
final int MAX_CONTENT_LENGTH = 100000; // âŒ ç¡¬ç¼–ç 
final int MAX_CHUNKS = 50; // âŒ ç¡¬ç¼–ç 
```

**é—®é¢˜**ï¼š
- âŒ ç”¨æˆ·æ— æ³•è°ƒæ•´
- âŒ ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒå€¼
- âŒ ä¿®æ”¹éœ€è¦é‡æ–°ç¼–è¯‘

### ä¼˜åŒ–åï¼ˆé…ç½®åŒ–ï¼‰

```yaml
# application.yml
knowledge:
  qa:
    document:
      # ç´¢å¼•æ—¶å•ä¸ªæ–‡æ¡£æœ€å¤§å†…å®¹é•¿åº¦
      max-index-content-length: 50000
      
      # é—®ç­”æ—¶æ–‡æ¡£åˆ‡åˆ†æœ€å¤§å†…å®¹é•¿åº¦
      max-chunk-content-length: 100000
      
      # é—®ç­”æ—¶å•æ¬¡åˆ‡åˆ†æœ€å¤§å—æ•°
      max-chunks-per-document: 50
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç”¨æˆ·å¯ä»¥è‡ªè¡Œè°ƒæ•´
- âœ… ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
- âœ… æ— éœ€é‡æ–°ç¼–è¯‘

---

## ğŸ”§ é…ç½®é¡¹è¯¦ç»†è¯´æ˜

### 1. max-index-content-length

**ä½œç”¨**: ç´¢å¼•æ—¶å•ä¸ªæ–‡æ¡£æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰

**å½±å“**:
- **è¿‡å¤§**: å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€ç´¢å¼•é€Ÿåº¦æ…¢
- **è¿‡å°**: å¯èƒ½ä¸¢å¤±æ–‡æ¡£å°¾éƒ¨å†…å®¹ã€é™ä½æ£€ç´¢å‡†ç¡®æ€§

**å»ºè®®å€¼**:
```yaml
# å†…å­˜å……è¶³ï¼ˆ8GB+ï¼‰
max-index-content-length: 100000  # çº¦ 200KB

# å†…å­˜ä¸€èˆ¬ï¼ˆ4GBï¼‰- é»˜è®¤
max-index-content-length: 50000   # çº¦ 100KB

# å†…å­˜æœ‰é™ï¼ˆ2GBï¼‰
max-index-content-length: 30000   # çº¦ 60KB
```

**ä½¿ç”¨åœºæ™¯**:
- å¤§é‡å°æ–‡æ¡£ï¼ˆ< 10KBï¼‰ï¼šå¯ä»¥è®¾ç½®è¾ƒå¤§å€¼ï¼ˆ100000ï¼‰
- å°‘é‡å¤§æ–‡æ¡£ï¼ˆ> 100KBï¼‰ï¼šå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ï¼ˆ50000ï¼‰
- å†…å­˜ç´§å¼ ï¼šé™ä½åˆ° 30000

---

### 2. max-chunk-content-length

**ä½œç”¨**: é—®ç­”æ—¶æ–‡æ¡£åˆ‡åˆ†æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰

**å½±å“**:
- **è¿‡å¤§**: é—®ç­”æ—¶å¯èƒ½å†…å­˜æº¢å‡º
- **è¿‡å°**: å¯èƒ½ä¸¢å¤±é‡è¦ä¿¡æ¯

**å»ºè®®å€¼**:
```yaml
# é€šå¸¸è®¾ç½®ä¸º max-index-content-length çš„ 2 å€
# å› ä¸ºé—®ç­”æ—¶åªå¤„ç†å°‘é‡æ–‡æ¡£ï¼ˆ5-10ä¸ªï¼‰

max-chunk-content-length: 100000  # é»˜è®¤ï¼ˆ2x 50000ï¼‰
```

**ä½¿ç”¨åœºæ™¯**:
- å¦‚æœè°ƒæ•´äº† `max-index-content-length`ï¼Œè¿™ä¸ªå€¼ä¹Ÿåº”è¯¥ç›¸åº”è°ƒæ•´
- å»ºè®®ä¿æŒ 2:1 çš„æ¯”ä¾‹

---

### 3. max-chunks-per-document

**ä½œç”¨**: é—®ç­”æ—¶å•æ¬¡åˆ‡åˆ†æœ€å¤§å—æ•°

**å½±å“**:
- **è¿‡å¤§**: å¯èƒ½ç”Ÿæˆè¿‡å¤šå—ï¼Œå†…å­˜æº¢å‡º
- **è¿‡å°**: å¯èƒ½ä¸¢å¤±æ–‡æ¡£å†…å®¹

**å»ºè®®å€¼**:
```yaml
# é«˜æ€§èƒ½æ¨¡å¼
max-chunks-per-document: 100

# å¹³è¡¡æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
max-chunks-per-document: 50

# ä½å†…å­˜æ¨¡å¼
max-chunks-per-document: 30
```

**è®¡ç®—å…¬å¼**:
```
å—æ•° = å†…å®¹é•¿åº¦ / (chunk-size - chunk-overlap)

ä¾‹å¦‚ï¼š
å†…å®¹: 100000 å­—ç¬¦
chunk-size: 4000
chunk-overlap: 400
å—æ•° â‰ˆ 100000 / (4000 - 400) = 28 å—
```

---

## ğŸ“Š é…ç½®åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1: é«˜æ€§èƒ½æœåŠ¡å™¨ï¼ˆ8GB+ å†…å­˜ï¼‰

```yaml
knowledge:
  qa:
    document:
      max-index-content-length: 100000      # å¤§æ–‡æ¡£æ”¯æŒ
      max-chunk-content-length: 200000      # é—®ç­”æ—¶å¤„ç†æ›´å¤šå†…å®¹
      max-chunks-per-document: 100          # æ›´å¤šåˆ†å—
      
    llm:
      max-documents-per-query: 15           # å¤„ç†æ›´å¤šæ–‡æ¡£
```

**ç‰¹ç‚¹**:
- âœ… æ”¯æŒå¤§æ–‡æ¡£
- âœ… æ›´å®Œæ•´çš„å†…å®¹
- âœ… æ›´å¥½çš„æ£€ç´¢æ•ˆæœ
- â— éœ€è¦å……è¶³å†…å­˜

---

### åœºæ™¯ 2: æ ‡å‡†æœåŠ¡å™¨ï¼ˆ4GB å†…å­˜ï¼‰- **é»˜è®¤é…ç½®**

```yaml
knowledge:
  qa:
    document:
      max-index-content-length: 50000       # æ ‡å‡†å¤§å°
      max-chunk-content-length: 100000      # å¹³è¡¡æ¨¡å¼
      max-chunks-per-document: 50           # æ ‡å‡†å—æ•°
      
    llm:
      max-documents-per-query: 10           # æ ‡å‡†æ–‡æ¡£æ•°
```

**ç‰¹ç‚¹**:
- âœ… å¹³è¡¡æ€§èƒ½å’Œæ•ˆæœ
- âœ… é€‚åˆå¤§å¤šæ•°åœºæ™¯
- âœ… å†…å­˜å ç”¨å¯æ§

---

### åœºæ™¯ 3: ä½é…æœåŠ¡å™¨ï¼ˆ2GB å†…å­˜ï¼‰

```yaml
knowledge:
  qa:
    document:
      max-index-content-length: 30000       # å°æ–‡æ¡£
      max-chunk-content-length: 60000       # å‡å°‘å¤„ç†é‡
      max-chunks-per-document: 30           # å°‘é‡åˆ†å—
      
    llm:
      max-documents-per-query: 5            # å°‘é‡æ–‡æ¡£
      max-context-length: 10000             # å‡å°‘ä¸Šä¸‹æ–‡
```

**ç‰¹ç‚¹**:
- âœ… ä½å†…å­˜å ç”¨
- âœ… ç¨³å®šè¿è¡Œ
- â— å¯èƒ½ä¸¢å¤±éƒ¨åˆ†å†…å®¹
- â— æ£€ç´¢æ•ˆæœç•¥é™ä½

---

### åœºæ™¯ 4: å¤§æ–‡æ¡£å¤„ç†ï¼ˆè®ºæ–‡ã€æŠ¥å‘Šï¼‰

```yaml
knowledge:
  qa:
    document:
      max-index-content-length: 80000       # æ”¯æŒé•¿æ–‡æ¡£
      max-chunk-content-length: 150000
      max-chunks-per-document: 80
      chunk-size: 5000                      # å¢å¤§å—å¤§å°
      chunk-overlap: 500
```

**ç‰¹ç‚¹**:
- âœ… æ”¯æŒé•¿æ–‡æ¡£
- âœ… ä¿ç•™æ›´å¤šä¸Šä¸‹æ–‡
- â— éœ€è¦æ›´å¤šå†…å­˜

---

### åœºæ™¯ 5: å¿«é€Ÿæ£€ç´¢ï¼ˆå¤§é‡å°æ–‡æ¡£ï¼‰

```yaml
knowledge:
  qa:
    document:
      max-index-content-length: 30000       # é™åˆ¶å¤§å°
      max-chunk-content-length: 50000
      max-chunks-per-document: 20           # å‡å°‘åˆ†å—
      chunk-size: 2000                      # å°å—
      chunk-overlap: 200
```

**ç‰¹ç‚¹**:
- âœ… å¿«é€Ÿç´¢å¼•
- âœ… å¿«é€Ÿæ£€ç´¢
- âœ… ä½å†…å­˜å ç”¨

---

## ğŸ¯ é…ç½®å»ºè®®

### åŸºæœ¬åŸåˆ™

1. **å†…å­˜ä¼˜å…ˆ**
   - æ ¹æ®å¯ç”¨å†…å­˜è®¾ç½®é…ç½®
   - å®å¯ä¿å®ˆï¼Œé¿å…å†…å­˜æº¢å‡º

2. **æ¯”ä¾‹å…³ç³»**
   - `max-chunk-content-length` = `max-index-content-length` Ã— 2
   - `chunk-overlap` = `chunk-size` Ã— 10-20%

3. **é€æ­¥è°ƒæ•´**
   - ä»é»˜è®¤å€¼å¼€å§‹
   - è§‚å¯Ÿå†…å­˜å ç”¨
   - é€æ­¥è°ƒå¤§æˆ–è°ƒå°

### ç›‘æ§æŒ‡æ ‡

**ç´¢å¼•é˜¶æ®µ**ï¼š
```
æ—¥å¿—: "âœ‚ï¸ å·²æˆªæ–­ XXX å­—ç¬¦"
â†’ å¦‚æœé¢‘ç¹å‡ºç°ï¼Œè€ƒè™‘å¢å¤§ max-index-content-length
```

**é—®ç­”é˜¶æ®µ**ï¼š
```
æ—¥å¿—: "Content too large, truncating to XXX chars"
â†’ å¯ä»¥å¢å¤§ max-chunk-content-length

æ—¥å¿—: "Reached maximum chunk limit"
â†’ å¯ä»¥å¢å¤§ max-chunks-per-document
```

**å†…å­˜ç›‘æ§**ï¼š
```bash
# Windows
ä»»åŠ¡ç®¡ç†å™¨ â†’ æŸ¥çœ‹ Java è¿›ç¨‹å†…å­˜

# Linux
top -p <pid>
```

---

## ğŸ“ å®Œæ•´é…ç½®æ–‡ä»¶

### application.yml

```yaml
knowledge:
  qa:
    # æ–‡æ¡£å¤„ç†é…ç½®
    document:
      # ============================================================
      # åŸºç¡€é…ç½®
      # ============================================================
      max-file-size-mb: 200
      chunk-size: 4000
      chunk-overlap: 400
      
      # ============================================================
      # å†…å®¹é•¿åº¦é™åˆ¶é…ç½®ï¼ˆå½±å“å†…å­˜å ç”¨å’Œæ€§èƒ½ï¼‰
      # ============================================================
      
      # ç´¢å¼•æ—¶å•ä¸ªæ–‡æ¡£æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # å»ºè®®å€¼ï¼š
      #   - å†…å­˜å……è¶³ï¼ˆ8GB+ï¼‰: 100000 (çº¦ 200KB)
      #   - å†…å­˜ä¸€èˆ¬ï¼ˆ4GBï¼‰: 50000 (çº¦ 100KBï¼Œé»˜è®¤)
      #   - å†…å­˜æœ‰é™ï¼ˆ2GBï¼‰: 30000 (çº¦ 60KB)
      max-index-content-length: 50000
      
      # é—®ç­”æ—¶æ–‡æ¡£åˆ‡åˆ†æœ€å¤§å†…å®¹é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
      # é€šå¸¸è®¾ç½®ä¸º max-index-content-length çš„ 2 å€
      max-chunk-content-length: 100000
      
      # é—®ç­”æ—¶å•æ¬¡åˆ‡åˆ†æœ€å¤§å—æ•°
      # å»ºè®®å€¼ï¼š30-100
      max-chunks-per-document: 50
      
    # LLM é…ç½®
    llm:
      max-context-length: 20000
      max-doc-length: 5000
      max-documents-per-query: 10
      
    # å‘é‡æ£€ç´¢é…ç½®
    vector-search:
      similarity-threshold: 0.5
      min-score-threshold: 0.15
      top-k: 20
```

---

## âœ… éªŒè¯æ¸…å•

### é…ç½®éªŒè¯
- [x] é…ç½®ç±»æ·»åŠ æ–°å±æ€§ âœ…
- [x] application.yml æ·»åŠ é…ç½®é¡¹ âœ…
- [x] é…ç½®é¡¹æœ‰è¯¦ç»†æ³¨é‡Š âœ…
- [x] æä¾›åˆç†çš„é»˜è®¤å€¼ âœ…

### ä»£ç éªŒè¯
- [x] KnowledgeBaseService ä½¿ç”¨é…ç½® âœ…
- [x] SimpleDocumentChunker ä½¿ç”¨é…ç½® âœ…
- [x] DocumentChunker æ”¯æŒé…ç½® âœ…
- [x] ç¼–è¯‘é€šè¿‡ âœ…

### æ—¥å¿—éªŒè¯
- [x] æˆªæ–­æ—¶æ˜¾ç¤ºé…ç½®é¡¹åç§° âœ…
- [x] åˆå§‹åŒ–æ—¶æ˜¾ç¤ºé…ç½®å€¼ âœ…

---

## ğŸ‰ ä¼˜åŒ–æ•ˆæœ

### ä¼˜åŒ–å‰

```java
// ç¡¬ç¼–ç ï¼Œæ— æ³•è°ƒæ•´
final int MAX_CONTENT_LENGTH = 50000;
```

**é—®é¢˜**ï¼š
- âŒ 4GB å†…å­˜æœåŠ¡å™¨ï¼šå¯èƒ½ä¸å¤Ÿç”¨
- âŒ 8GB å†…å­˜æœåŠ¡å™¨ï¼šæµªè´¹èµ„æº
- âŒ ä¿®æ”¹éœ€è¦é‡æ–°ç¼–è¯‘

### ä¼˜åŒ–å

```yaml
# å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
max-index-content-length: 50000
```

**ä¼˜åŠ¿**ï¼š
- âœ… 2GB å†…å­˜ï¼šè®¾ç½® 30000
- âœ… 4GB å†…å­˜ï¼šè®¾ç½® 50000ï¼ˆé»˜è®¤ï¼‰
- âœ… 8GB å†…å­˜ï¼šè®¾ç½® 100000
- âœ… æ— éœ€é‡æ–°ç¼–è¯‘

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- `application.yml` - é…ç½®æ–‡ä»¶
- `KnowledgeQAProperties.java` - é…ç½®ç±»
- `202511270045-CONFIG_GUIDE.md` - é…ç½®æŒ‡å—

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. æŸ¥çœ‹å½“å‰é…ç½®

```bash
# æŸ¥çœ‹é…ç½®æ–‡ä»¶
cat src/main/resources/application.yml | grep max-
```

### 2. ä¿®æ”¹é…ç½®

ç¼–è¾‘ `src/main/resources/application.yml`:
```yaml
max-index-content-length: 80000  # ä¿®æ”¹ä¸º 80000
```

### 3. é‡å¯åº”ç”¨

```bash
# åœæ­¢
stop.bat

# é‡æ–°ç¼–è¯‘æ‰“åŒ…
mvn clean package -DskipTests

# å¯åŠ¨
start.bat
```

### 4. è§‚å¯Ÿæ•ˆæœ

æŸ¥çœ‹æ—¥å¿—ï¼Œè§‚å¯Ÿæ˜¯å¦è¿˜æœ‰æˆªæ–­è­¦å‘Šï¼š
```
æ—¥å¿—: "âœ‚ï¸ å·²æˆªæ–­ XXX å­—ç¬¦ï¼Œå¯é€šè¿‡é…ç½® max-index-content-length è°ƒæ•´"
```

---

**ä¼˜åŒ–æ—¶é—´**: 2025-11-27  
**ç¼–è¯‘çŠ¶æ€**: âœ… SUCCESS  
**é…ç½®é¡¹æ•°**: 3 ä¸ª  
**é»˜è®¤å€¼**: åˆç†ä¸”ç»è¿‡æµ‹è¯•  
**çµæ´»æ€§**: âœ… å®Œå…¨å¯é…ç½®  
**å›¢é˜Ÿ**: AI Reviewer Team

ğŸŠ **æ‰€æœ‰ç¡¬ç¼–ç å¸¸é‡å·²é…ç½®åŒ–ï¼ç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…æƒ…å†µçµæ´»è°ƒæ•´ï¼** ğŸŠ

