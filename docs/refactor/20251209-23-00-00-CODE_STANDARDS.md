# RAG 2.0 ä»£ç è§„èŒƒä¸æ–‡æ¡£ç®¡ç†è§„èŒƒ
# RAG 2.0 Code Standards and Document Management

> **æ–‡æ¡£ç¼–å·**: 20251209-23-00-00-CODE_STANDARDS  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-09 23:00:00  
> **ç±»å‹**: ä»£ç è§„èŒƒ  
> **çŠ¶æ€**: âœ… ç”Ÿæ•ˆä¸­  
> **ä¼˜å…ˆçº§**: ğŸ”¥ å¿…é¡»éµå®ˆ

---

## âš ï¸ é‡è¦ï¼šæ¯ä¸ªæ–° Session å¿…è¯»

**åœ¨ä»»ä½•æ–°çš„ Copilot Session ä¸­å¼€å§‹ç¼–ç å‰ï¼Œè¯·å‘Šè¯‰ Copilot**ï¼š
```
"éµå®ˆ 20251209-23-00-00-CODE_STANDARDS.md ä¸­çš„æ‰€æœ‰ä»£ç è§„èŒƒ"
```

æˆ–è€…ï¼š
```
"æŒ‰ç…§ RAG 2.0 ä»£ç è§„èŒƒå¼€å‘"
```

**Copilot ä¼šè‡ªåŠ¨**ï¼š
1. âœ… è¯»å–æœ¬æ–‡æ¡£
2. âœ… åº”ç”¨æ‰€æœ‰ä»£ç è§„èŒƒ
3. âœ… ç”Ÿæˆç¬¦åˆè§„èŒƒçš„ä»£ç 

---

## ğŸ“‚ æ–‡æ¡£ç®¡ç†è§„èŒƒ

### 1. ç›®å½•ç»“æ„

```
docs/refactor/
â”œâ”€â”€ 20251209-23-00-00-CODE_STANDARDS.md          (æœ¬æ–‡æ¡£ - ä»£ç è§„èŒƒ)
â”œâ”€â”€ 20251209-22-29-00-IMPLEMENTATION_PLAN.md     (ä¸»å®æ–½è®¡åˆ’ - æŒç»­æ›´æ–°)
â”œâ”€â”€ SESSION_RECOVERY_GUIDE.md                     (ä¼šè¯æ¢å¤æŒ‡å—)
â”œâ”€â”€ README.md                                     (ç›®å½•è¯´æ˜)
â”‚
â”œâ”€â”€ phase-1/
â”‚   â””â”€â”€ 20251210-xx-xx-Phase1-Progress.md         (Phase 1 è¿›åº¦ - æŒç»­æ›´æ–°)
â”‚
â”œâ”€â”€ phase-2/
â”‚   â””â”€â”€ 20251211-xx-xx-Phase2-Progress.md         (Phase 2 è¿›åº¦ - æŒç»­æ›´æ–°)
â”‚
â”œâ”€â”€ ...
â”‚
â””â”€â”€ done/                                         (å·²å®Œæˆçš„é˜¶æ®µæ€§æŠ¥å‘Š)
    â”œâ”€â”€ 20251215-xx-xx-Phase1-Complete.md         (Phase 1 å®ŒæˆæŠ¥å‘Š)
    â”œâ”€â”€ 20251220-xx-xx-Phase2-Complete.md         (Phase 2 å®ŒæˆæŠ¥å‘Š)
    â””â”€â”€ ...
```

### 2. æ–‡æ¡£æ›´æ–°ç­–ç•¥

#### è§„åˆ™ A: è¿›åº¦å§‹ç»ˆåœ¨åŒä¸€ä¸ªæ–‡æ¡£æ›´æ–°
```yaml
âŒ é”™è¯¯åšæ³•:
  - Phase1-Progress-Day1.md
  - Phase1-Progress-Day2.md
  - Phase1-Progress-Day3.md
  # è¿›åº¦åˆ†æ•£ï¼Œéš¾ä»¥è¿½è¸ª

âœ… æ­£ç¡®åšæ³•:
  - phase-1/20251210-10-00-00-Phase1-Progress.md
    â”œâ”€ 2025-12-10 10:00 - å¼€å§‹ Phase 1
    â”œâ”€ 2025-12-10 14:30 - å®Œæˆä»»åŠ¡ 1.1
    â”œâ”€ 2025-12-11 09:00 - å®Œæˆä»»åŠ¡ 1.2
    â””â”€ 2025-12-12 16:00 - Phase 1 å®Œæˆ
  # æ‰€æœ‰è¿›åº¦åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼Œæ¸…æ™°å¯è¿½æº¯
```

#### è§„åˆ™ B: é˜¶æ®µå®Œæˆæ—¶ç”ŸæˆæŠ¥å‘Š
```yaml
è§¦å‘æ¡ä»¶:
  - Phase X çš„æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆ
  - éªŒæ”¶æ ‡å‡†å…¨éƒ¨é€šè¿‡
  
ç”ŸæˆæŠ¥å‘Š:
  æ–‡ä»¶: done/yyyyMMdd-HH-mm-ss-PhaseX-Complete.md
  å†…å®¹:
    - å®Œæˆçš„åŠŸèƒ½åˆ—è¡¨
    - ä»£ç ç»Ÿè®¡
    - æµ‹è¯•ç»“æœ
    - é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
    - ç»éªŒæ•™è®­
    - ä¸‹ä¸€æ­¥å»ºè®®
```

#### è§„åˆ™ C: æ–‡æ¡£å‘½åè§„èŒƒ
```yaml
æŒç»­æ›´æ–°çš„æ–‡æ¡£:
  æ ¼å¼: phase-{N}/yyyyMMdd-HH-mm-ss-Phase{N}-Progress.md
  ç¤ºä¾‹: phase-1/20251210-10-00-00-Phase1-Progress.md
  
å®ŒæˆæŠ¥å‘Š:
  æ ¼å¼: done/yyyyMMdd-HH-mm-ss-Phase{N}-Complete.md
  ç¤ºä¾‹: done/20251215-16-30-00-Phase1-Complete.md
  
å…¶ä»–æ–‡æ¡£:
  æ ¼å¼: yyyyMMdd-HH-mm-ss-{æè¿°}.md
  ç¤ºä¾‹: 20251209-23-00-00-CODE_STANDARDS.md
```

---

## ğŸ’» ä»£ç è§„èŒƒ

### 1. æ³¨é‡Šæ ¼å¼è§„èŒƒ

#### è§„åˆ™ 1.1: ç±»æ³¨é‡Š
```java
/**
 * è§’è‰²æ£€æµ‹å™¨ (Role Detector)
 * 
 * è´Ÿè´£åˆ†æç”¨æˆ·é—®é¢˜ï¼Œè¯†åˆ«æ‰€å±è§’è‰²
 * (Responsible for analyzing user questions and identifying roles)
 * 
 * @author AI Reviewer Team
 * @since 2.0.0
 */
public class RoleDetector {
    // ...
}
```

#### è§„åˆ™ 1.2: æ–¹æ³•æ³¨é‡Š
```java
/**
 * æ£€æµ‹é—®é¢˜æ‰€å±çš„è§’è‰² (Detect roles for the question)
 * 
 * @param question ç”¨æˆ·é—®é¢˜ (User question)
 * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯ (Context information)
 * @return è§’è‰²è¯„åˆ†åˆ—è¡¨ (List of role scores)
 */
public List<RoleScore> detect(String question, String context) {
    // å®ç°é€»è¾‘...
}
```

#### è§„åˆ™ 1.3: è¡Œå†…æ³¨é‡Š
```java
// 1. æå–å…³é”®è¯ (Extract keywords)
List<String> keywords = extractKeywords(question);

// 2. è®¡ç®—ç›¸ä¼¼åº¦ (Calculate similarity)
double similarity = calculateSimilarity(keywords, roleKeywords);

// 3. è¿”å›è¯„åˆ† (Return score)
return new RoleScore(roleId, similarity);
```

#### è§„åˆ™ 1.4: å¤æ‚é€»è¾‘æ³¨é‡Š
```java
/**
 * èåˆå¤šä¸ªè§’è‰²çš„æ£€ç´¢ç»“æœ
 * (Fuse search results from multiple roles)
 * 
 * ç®—æ³•è¯´æ˜ (Algorithm description):
 * 1. æ”¶é›†æ‰€æœ‰è§’è‰²çš„æ£€ç´¢ç»“æœ
 * 2. å¯¹ç›¸åŒæ–‡æ¡£çš„åˆ†æ•°è¿›è¡ŒåŠ æƒç´¯åŠ 
 * 3. æŒ‰æœ€ç»ˆåˆ†æ•°æ’åº
 * 4. è¿”å› Top K ç»“æœ
 */
private List<Document> fuseResults(List<RoleSearchResult> results, int topK) {
    // ...
}
```

---

### 2. æ—¥å¿—è§„èŒƒ

#### è§„åˆ™ 2.1: æ—¥å¿—çº§åˆ«
```java
// DEBUG - è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ (Detailed debugging information)
log.debug("è§’è‰²æ£€æµ‹: å…³é”®è¯={}, åŒ¹é…æ•°={}", keywords, matchCount);

// INFO - é‡è¦çš„ä¸šåŠ¡æµç¨‹ (Important business process)
log.info("å¼€å§‹è§’è‰²æ£€æµ‹: question={}", question);

// WARN - è­¦å‘Šä¿¡æ¯ï¼Œä½†ä¸å½±å“æ­£å¸¸æµç¨‹ (Warning, but not affect normal process)
log.warn("è§’è‰²æ£€æµ‹ç½®ä¿¡åº¦è¾ƒä½: score={}", score);

// ERROR - é”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦å…³æ³¨ (Error, need attention)
log.error("è§’è‰²æ£€æµ‹å¤±è´¥: question={}, error={}", question, e.getMessage(), e);
```

#### è§„åˆ™ 2.2: æ—¥å¿—å›½é™…åŒ–
```java
// âŒ é”™è¯¯åšæ³• - æ—¥å¿—ç¡¬ç¼–ç 
log.info("å¼€å§‹å¤„ç†ç”¨æˆ·è¯·æ±‚");

// âœ… æ­£ç¡®åšæ³• - ä½¿ç”¨å›½é™…åŒ–
log.info(I18n.get("role.detector.start"), question);
```

#### è§„åˆ™ 2.3: å›½é™…åŒ–æ£€æŸ¥ä¸å…¼å®¹æ€§
```yaml
å›½é™…åŒ–æ£€æŸ¥æ¸…å•:
  1. æ–°å¢å›½é™…åŒ–é”®å€¼æ—¶:
     - å¿…é¡»åœ¨æ‰€æœ‰è¯­è¨€æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”é”®å€¼
     - ä¿æŒé”®å€¼åç§°å’Œå‚æ•°ä¸ªæ•°å®Œå…¨ä¸€è‡´
     - ä½¿ç”¨è¯­ä¹‰åŒ–çš„é”®åï¼Œå¦‚: module.action.description
  
  2. æ›´æ–°å›½é™…åŒ–æ–‡ä»¶æ—¶:
     - æ£€æŸ¥æ˜¯å¦å½±å“åˆ°ç°æœ‰åŠŸèƒ½çš„ç¿»è¯‘
     - ç¡®ä¿æ²¡æœ‰é—æ¼çš„è¯­è¨€æ–‡ä»¶
     - éªŒè¯å‚æ•°å ä½ç¬¦ {0}, {1} çš„ä¸€è‡´æ€§
  
  3. ä»£ç ä¸­ä½¿ç”¨å›½é™…åŒ–:
     - é¿å…ç›´æ¥æ‹¼æ¥å›½é™…åŒ–ç»“æœ
     - ä¼ é€’å‚æ•°æ—¶ä¿æŒç±»å‹åŒ¹é…
     - å¤æ‚é€»è¾‘åº”è€ƒè™‘åœ¨å›½é™…åŒ–æ–‡ä»¶ä¸­å¤„ç†

å›½é™…åŒ–æ–‡ä»¶ç»“æ„:
  è·¯å¾„: src/main/resources/i18n/{è¯­è¨€}/
  æ–‡ä»¶å‘½å: {è¯­è¨€}-{æ¨¡å—}.yml
  ç¤ºä¾‹:
    - en-hope.yml (HOPEæ¨¡å—è‹±æ–‡æœ¬åœ°åŒ–)
    - zh-hope.yml (HOPEæ¨¡å—ä¸­æ–‡æœ¬åœ°åŒ–)
```

---

### 3. å¸¸é‡å­—ç¬¦ä¸²å›½é™…åŒ–

#### è§„åˆ™ 3.1: å¸¸é‡å®šä¹‰
```java
// âŒ é”™è¯¯åšæ³• - ç¡¬ç¼–ç å­—ç¬¦ä¸²
public class RoleDetector {
    private static final String ERROR_MSG = "è§’è‰²æ£€æµ‹å¤±è´¥";
    
    public void detect() {
        throw new RuntimeException(ERROR_MSG);
    }
}

// âœ… æ­£ç¡®åšæ³• - ä½¿ç”¨å›½é™…åŒ–é”®
public class RoleDetector {
    public void detect() {
        throw new RuntimeException(I18n.get("role.detector.error"));
    }
}
```

#### è§„åˆ™ 3.2: YAML æ–‡ä»¶ç»“æ„
```yaml
æ–‡ä»¶ä½ç½®: src/main/resources/i18n/

ç›®å½•ç»“æ„ï¼ˆæŒ‰è¯­è¨€åˆ†ç›®å½•ï¼‰:
  src/main/resources/i18n/
    â”œâ”€â”€ zh/                          (ä¸­æ–‡ç›®å½•)
    â”‚   â”œâ”€â”€ zh_messages.yml          (è€ä»£ç å…¼å®¹ - messages_zh.yml)
    â”‚   â”œâ”€â”€ zh-common.yml            (é€šç”¨æ¶ˆæ¯)
    â”‚   â”œâ”€â”€ zh-role-detector.yml     (è§’è‰²æ£€æµ‹æ¨¡å—)
    â”‚   â”œâ”€â”€ zh-vector-index.yml      (å‘é‡ç´¢å¼•æ¨¡å—)
    â”‚   â”œâ”€â”€ zh-concept-evolution.yml (æ¦‚å¿µæ¼”åŒ–æ¨¡å—)
    â”‚   â”œâ”€â”€ zh-feedback.yml          (åé¦ˆæ¨¡å—)
    â”‚   â””â”€â”€ zh-error.yml             (é”™è¯¯æ¶ˆæ¯)
    â”‚
    â””â”€â”€ en/                          (è‹±æ–‡ç›®å½•)
        â”œâ”€â”€ en_messages.yml          (è€ä»£ç å…¼å®¹ - messages_en.yml)
        â”œâ”€â”€ en-common.yml            (é€šç”¨æ¶ˆæ¯)
        â”œâ”€â”€ en-role-detector.yml     (è§’è‰²æ£€æµ‹æ¨¡å—)
        â”œâ”€â”€ en-vector-index.yml      (å‘é‡ç´¢å¼•æ¨¡å—)
        â”œâ”€â”€ en-concept-evolution.yml (æ¦‚å¿µæ¼”åŒ–æ¨¡å—)
        â”œâ”€â”€ en-feedback.yml          (åé¦ˆæ¨¡å—)
        â””â”€â”€ en-error.yml             (é”™è¯¯æ¶ˆæ¯)

å‘½åè§„èŒƒ:
  - æ–‡ä»¶æŒ‰è¯­è¨€åˆ†ç›®å½•å­˜æ”¾ï¼Œä¾¿äºç®¡ç†
  - æ–‡ä»¶åä¿ç•™è¯­è¨€å‰ç¼€ï¼ˆzh-/en-ï¼‰ï¼Œä¾¿äºè¯†åˆ«
  - ç‰¹æ®Šæ–‡ä»¶ï¼šzh_messages.yml å’Œ en_messages.yml ç”¨äºå…¼å®¹è€ä»£ç 
```

#### è§„åˆ™ 3.3: YAML å†…å®¹æ ¼å¼

**ä¸­æ–‡æ–‡ä»¶ç¤ºä¾‹** (`zh/zh-role-detector.yml`):
```yaml
# ä¸­æ–‡è§’è‰²æ£€æµ‹æ¶ˆæ¯
# æ–‡ä»¶: src/main/resources/i18n/zh/zh-role-detector.yml

role:
  detector:
    start: "ğŸš€ å¼€å§‹è§’è‰²æ£€æµ‹: question={0}"
    success: "âœ… è§’è‰²æ£€æµ‹æˆåŠŸ: role={0}, confidence={1}"
    failed: "âŒ è§’è‰²æ£€æµ‹å¤±è´¥: {0}"
    keyword-match: "ğŸ” å…³é”®è¯åŒ¹é…: keywords={0}, matchCount={1}"
    ai-analysis: "ğŸ¤– AI æ™ºèƒ½åˆ†æä¸­..."
```

**è‹±æ–‡æ–‡ä»¶ç¤ºä¾‹** (`en/en-role-detector.yml`):
```yaml
# English Role Detector Messages
# File: src/main/resources/i18n/en/en-role-detector.yml

role:
  detector:
    start: "ğŸš€ Starting role detection: question={0}"
    success: "âœ… Role detection succeeded: role={0}, confidence={1}"
    failed: "âŒ Role detection failed: {0}"
    keyword-match: "ğŸ” Keyword matching: keywords={0}, matchCount={1}"
    ai-analysis: "ğŸ¤– AI analyzing..."
```

**å…³é”®ç‰¹æ€§**:
- âœ… ä¸­è‹±æ–‡å®Œå…¨åˆ†å¼€ï¼Œä¾¿äºç®¡ç†
- âœ… æ–‡ä»¶åç”¨ `zh-` å’Œ `en-` å‰ç¼€åŒºåˆ†
- âœ… ä½¿ç”¨ `{0}`, `{1}` ä½œä¸ºå‚æ•°å ä½ç¬¦ï¼ˆMessageFormat æ ¼å¼ï¼‰
- âœ… æ”¯æŒ Emojiï¼Œæå‡æ—¥å¿—å¯è¯»æ€§

---

### 4. ä»£ç ç»„ç»‡è§„èŒƒ

#### è§„åˆ™ 4.1: åŒ…ç»“æ„
```
top.yumbo.ai.rag
â”œâ”€â”€ role/                      (è§’è‰²ç›¸å…³)
â”‚   â”œâ”€â”€ Role.java
â”‚   â”œâ”€â”€ RoleConfig.java
â”‚   â”œâ”€â”€ RoleDetector.java
â”‚   â””â”€â”€ RoleManager.java
â”‚
â”œâ”€â”€ concept/                   (æ¦‚å¿µç›¸å…³)
â”‚   â”œâ”€â”€ ConceptUnit.java
â”‚   â”œâ”€â”€ ConceptVersion.java
â”‚   â”œâ”€â”€ ConceptUpdater.java
â”‚   â””â”€â”€ VersionManager.java
â”‚
â”œâ”€â”€ index/                     (ç´¢å¼•ç›¸å…³)
â”‚   â”œâ”€â”€ RoleVectorIndex.java
â”‚   â”œâ”€â”€ DocumentClassifier.java
â”‚   â””â”€â”€ IndexBuilder.java
â”‚
â”œâ”€â”€ retriever/                 (æ£€ç´¢ç›¸å…³)
â”‚   â”œâ”€â”€ MultiRoleRetriever.java
â”‚   â”œâ”€â”€ ResultFusion.java
â”‚   â””â”€â”€ WeightCalculator.java
â”‚
â””â”€â”€ i18n/                      (å›½é™…åŒ–)
    â”œâ”€â”€ I18n.java
    â””â”€â”€ MessageLoader.java
```

#### è§„åˆ™ 4.2: ç±»å‘½å
```java
// æœåŠ¡ç±» (Service classes)
RoleDetectorService
ConceptEvolutionService

// ç®¡ç†ç±» (Manager classes)
RoleManager
VersionManager

// ä»“å‚¨ç±» (Repository classes)
ConceptRepository
RoleRepository

// å·¥å…·ç±» (Utility classes)
RoleUtils
ConceptUtils

// é…ç½®ç±» (Configuration classes)
RoleConfig
IndexConfig
```

---

### 5. å›½é™…åŒ–å·¥å…·ç±»

#### è§„åˆ™ 5.1: I18n å·¥å…·ç±»å®ç°

**å·²å®ç°**: `src/main/java/top/yumbo/ai/rag/i18n/I18N.java`

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… é™æ€è‡ªåŠ¨åŠ è½½ï¼šåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ `i18n/zh/` å’Œ `i18n/en/` ç›®å½•ä¸‹çš„æ‰€æœ‰ YAML æ–‡ä»¶
- âœ… ç›®å½•åˆ†ç¦»ï¼šä¸­æ–‡æ–‡ä»¶æ”¾åœ¨ `zh/` ç›®å½•ï¼Œè‹±æ–‡æ–‡ä»¶æ”¾åœ¨ `en/` ç›®å½•
- âœ… ä¸­è‹±æ–‡åˆ†ç¦»ï¼šåˆ†åˆ«åŠ è½½åˆ° `messagesZh` å’Œ `messagesEn` ä¸¤ä¸ª Map
- âœ… è€ä»£ç å…¼å®¹ï¼šè‡ªåŠ¨åŠ è½½ `messages` æ¨¡å—ï¼ˆå¯¹åº” `zh_messages.yml` å’Œ `en_messages.yml`ï¼‰
- âœ… æ™ºèƒ½è¯­è¨€æ£€æµ‹ï¼šæ ¹æ®ç³»ç»Ÿå±æ€§/ç¯å¢ƒå˜é‡/é»˜è®¤è¯­è¨€è‡ªåŠ¨é€‰æ‹©
- âœ… å‚æ•°æ ¼å¼åŒ–ï¼šä½¿ç”¨ `MessageFormat` æ”¯æŒ `{0}`, `{1}` å ä½ç¬¦
- âœ… é™çº§å¤„ç†ï¼šæ‰¾ä¸åˆ° key æ—¶è¿”å› `[key]` è€Œä¸æ˜¯æŠ›å¼‚å¸¸

**åŠ è½½é€»è¾‘**:
```java
static {
    // åŠ è½½ä¸­æ–‡æ¶ˆæ¯ (Load Chinese messages)
    // æ‰«æ i18n/zh/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ (Scan all files in i18n/zh/)
    loadMessagesWithPrefix("i18n/zh/zh-", messagesZh, "Chinese");
    
    // åŠ è½½è‹±æ–‡æ¶ˆæ¯ (Load English messages)
    // æ‰«æ i18n/en/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ (Scan all files in i18n/en/)
    loadMessagesWithPrefix("i18n/en/en-", messagesEn, "English");
}
```

**ä½¿ç”¨æ–¹æ³•**:
```java
// è‡ªåŠ¨æ ¹æ®ç³»ç»Ÿè¯­è¨€é€‰æ‹©ä¸­è‹±æ–‡ (Auto select language)
log.info(I18N.get("role.detector.start", question));

// æŒ‡å®šè¯­è¨€ï¼ˆç”¨äº API å“åº”ï¼‰ (Specify language for API)
String msg = I18N.getLang("error.file.not-found", "en", filename);
```

**é¢„å®šä¹‰æ¨¡å—**:
ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½ä»¥ä¸‹æ¨¡å—çš„å›½é™…åŒ–æ–‡ä»¶ï¼š
- `messages` - è€ä»£ç å…¼å®¹ï¼ˆzh_messages.yml / en_messages.ymlï¼‰
- `common` - é€šç”¨æ¶ˆæ¯
- `role-detector` - è§’è‰²æ£€æµ‹
- `vector-index` - å‘é‡ç´¢å¼•
- `concept-evolution` - æ¦‚å¿µæ¼”åŒ–
- `feedback` - åé¦ˆç³»ç»Ÿ
- `retriever` - æ£€ç´¢å™¨
- `streaming` - æµå¼å“åº”
- `error` - é”™è¯¯æ¶ˆæ¯


---

### 6. ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹ 6.1: åˆ›å»º YAML æ–‡ä»¶

**ä¸­æ–‡æ–‡ä»¶** (`zh/zh-role-detector.yml`):
```yaml
# ä¸­æ–‡è§’è‰²æ£€æµ‹æ¶ˆæ¯
# æ–‡ä»¶: src/main/resources/i18n/zh/zh-role-detector.yml

role:
  detector:
    start: "ğŸš€ å¼€å§‹è§’è‰²æ£€æµ‹: question={0}"
    success: "âœ… è§’è‰²æ£€æµ‹æˆåŠŸ: role={0}, confidence={1}"
    failed: "âŒ è§’è‰²æ£€æµ‹å¤±è´¥: {0}"
    keyword-match: "ğŸ” å…³é”®è¯åŒ¹é…: keywords={0}, count={1}"
    ai-analysis: "ğŸ¤– AI æ™ºèƒ½åˆ†æä¸­..."
    low-confidence: "âš ï¸ ç½®ä¿¡åº¦è¾ƒä½: score={0}"
```

**è‹±æ–‡æ–‡ä»¶** (`en/en-role-detector.yml`):
```yaml
# English Role Detector Messages
# File: src/main/resources/i18n/en/en-role-detector.yml

role:
  detector:
    start: "ğŸš€ Starting role detection: question={0}"
    success: "âœ… Role detection succeeded: role={0}, confidence={1}"
    failed: "âŒ Role detection failed: {0}"
    keyword-match: "ğŸ” Keyword matching: keywords={0}, count={1}"
    ai-analysis: "ğŸ¤– AI analyzing..."
    low-confidence: "âš ï¸ Low confidence: score={0}"
```

#### ç¤ºä¾‹ 6.2: åœ¨ä»£ç ä¸­ä½¿ç”¨
```java
package top.yumbo.ai.rag.role;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import top.yumbo.ai.rag.i18n.I18N;

import java.util.List;

/**
 * è§’è‰²æ£€æµ‹å™¨ (Role Detector)
 * 
 * è´Ÿè´£åˆ†æç”¨æˆ·é—®é¢˜ï¼Œè¯†åˆ«æ‰€å±è§’è‰²
 * (Responsible for analyzing user questions and identifying roles)
 * 
 * @author AI Reviewer Team
 * @since 2.0.0
 */
@Slf4j
@Service
public class RoleDetector {
    
    /**
     * æ£€æµ‹è§’è‰² (Detect role)
     * 
     * @param question ç”¨æˆ·é—®é¢˜ (User question)
     * @return è§’è‰²è¯„åˆ† (Role score)
     */
    public RoleScore detect(String question) {
        // å¼€å§‹æ£€æµ‹ (Start detection)
        log.info(I18N.get("role.detector.start", question));
        
        try {
            // 1. å…³é”®è¯åŒ¹é… (Keyword matching)
            List<String> keywords = extractKeywords(question);
            int matchCount = countMatches(keywords);
            log.debug(I18N.get("role.detector.keyword-match", keywords, matchCount));
            
            // 2. è®¡ç®—è¯„åˆ† (Calculate score)
            double score = (double) matchCount / keywords.size();
            
            // 3. æ£€æŸ¥ç½®ä¿¡åº¦ (Check confidence)
            if (score < 0.5) {
                log.warn(I18N.get("role.detector.low-confidence", score));
            }
            
            // 4. è¿”å›ç»“æœ (Return result)
            RoleScore result = new RoleScore("developer", score);
            log.info(I18N.get("role.detector.success", result.getRoleId(), score));
            
            return result;
            
        } catch (Exception e) {
            log.error(I18N.get("role.detector.failed", e.getMessage()), e);
            throw new RuntimeException(I18N.get("role.detector.failed", e.getMessage()), e);
        }
    }
    
    // ...å…¶ä»–æ–¹æ³•...
}
```

**å…³é”®ç‚¹**:
- âœ… æ— éœ€æ‰‹åŠ¨åŠ è½½æ–‡ä»¶ï¼Œ`I18N` ç±»åœ¨é™æ€åˆå§‹åŒ–æ—¶å·²è‡ªåŠ¨åŠ è½½æ‰€æœ‰ `zh-*.yml` å’Œ `en-*.yml` æ–‡ä»¶
- âœ… ä½¿ç”¨ `I18N.get(key, args...)` è·å–æ¶ˆæ¯ï¼Œç³»ç»Ÿè‡ªåŠ¨æ ¹æ®è¯­è¨€ç¯å¢ƒé€‰æ‹©ä¸­è‹±æ–‡
- âœ… å‚æ•°ä½¿ç”¨ `{0}`, `{1}` å ä½ç¬¦ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–

---

## ğŸ¨ å‰ç«¯ä»£ç è§„èŒƒ

### 7. æ ·å¼ç®¡ç†è§„èŒƒ

#### è§„åˆ™ 7.1: æ ·å¼æ–‡ä»¶ç»„ç»‡

**åŸåˆ™**: æ‰€æœ‰æ ·å¼å¿…é¡»æå–åˆ°ç‹¬ç«‹çš„ CSS æ–‡ä»¶ä¸­ï¼Œç¦æ­¢ä½¿ç”¨å†…è”æ ·å¼ï¼ˆç‰¹æ®Šæƒ…å†µé™¤å¤–ï¼‰

```yaml
æ ·å¼æ–‡ä»¶ä½ç½®: src/main/resources/static/assets/css/

ç›®å½•ç»“æ„:
  src/main/resources/static/assets/css/
    â”œâ”€â”€ reset.css              (é‡ç½®æ ·å¼)
    â”œâ”€â”€ main.css               (å…¨å±€æ ·å¼)
    â”œâ”€â”€ qa-tab.css             (é—®ç­” Tab)
    â”œâ”€â”€ documents-tab.css      (æ–‡æ¡£ç®¡ç† Tab)
    â”œâ”€â”€ statistics-tab.css     (ç»Ÿè®¡ Tab)
    â”œâ”€â”€ ai-analysis.css        (AI åˆ†æé¢æ¿)
    â”œâ”€â”€ hope-dashboard.css     (HOPE ä»ªè¡¨ç›˜)
    â”œâ”€â”€ welcome-guide.css      (å¼•å¯¼é¡µé¢)
    â””â”€â”€ ...                    (å…¶ä»–æ¨¡å—æ ·å¼)

å‘½åè§„èŒƒ:
  - æ–‡ä»¶åç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦ (kebab-case)
  - ä¸€ä¸ªæ¨¡å—ä¸€ä¸ª CSS æ–‡ä»¶
  - æ–‡ä»¶åä¸ç»„ä»¶åå¯¹ï¿½ï¿½ï¿½
```

#### è§„åˆ™ 7.2: ç¦æ­¢å†…è”æ ·å¼

**âŒ é”™è¯¯åšæ³•** - ä½¿ç”¨å†…è”æ ·å¼:
```jsx
// ä¸æ¨èï¼šå†…è”æ ·å¼éš¾ä»¥ç»´æŠ¤å’Œå¤ç”¨
<div style={{
    padding: '10px 15px',
    margin: '10px 0',
    background: 'linear-gradient(135deg, #667eea15 0%, #764ba215 100%)',
    border: '1px solid #667eea40',
    borderRadius: '8px',
    fontSize: '14px',
    color: '#667eea'
}}>
    æç¤ºä¿¡æ¯
</div>
```

**âœ… æ­£ç¡®åšæ³•** - ä½¿ç”¨ CSS ç±»:
```jsx
// æ¨èï¼šä½¿ç”¨ CSS ç±»ï¼Œæ˜“äºç»´æŠ¤å’Œå¤ç”¨
<div className="filter-hint">
    æç¤ºä¿¡æ¯
</div>
```

**CSS æ–‡ä»¶** (`documents-tab.css`):
```css
/* å®æ—¶è¿‡æ»¤æç¤ºæ ·å¼ (Real-time Filter Hint) */
.filter-hint {
    padding: 10px 15px;
    margin: 10px 0;
    background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
    border: 1px solid #667eea40;
    border-radius: 8px;
    font-size: 14px;
    color: #667eea;
}
```

#### è§„åˆ™ 7.3: å…è®¸å†…è”æ ·å¼çš„ç‰¹æ®Šæƒ…å†µ

**ä»…åœ¨ä»¥ä¸‹æƒ…å†µå…è®¸ä½¿ç”¨å†…è”æ ·å¼**:

1. **åŠ¨æ€è®¡ç®—çš„å€¼** (éœ€è¦æ ¹æ® props æˆ– state åŠ¨æ€æ”¹å˜)
   ```jsx
   <div style={{ width: `${progress}%` }}>è¿›åº¦æ¡</div>
   <div style={{ left: `${position}px` }}>æ‹–æ‹½å…ƒç´ </div>
   ```

2. **ä¸€æ¬¡æ€§ä½¿ç”¨çš„ä¸´æ—¶æ ·å¼** (è°ƒè¯•æˆ– POC é˜¶æ®µ)
   ```jsx
   // âš ï¸ ä»…ç”¨äºå¿«é€ŸåŸå‹ï¼Œæœ€ç»ˆå¿…é¡»æå–åˆ° CSS
   <div style={{ border: '1px solid red' }}>è°ƒè¯•è¾¹æ¡†</div>
   ```

3. **ç¬¬ä¸‰æ–¹åº“è¦æ±‚çš„æ ·å¼** (æŸäº›åº“å¿…é¡»é€šè¿‡ style prop ä¼ é€’)
   ```jsx
   <ThirdPartyComponent style={requiredStyles} />
   ```

**æ³¨æ„**: å³ä½¿ä½¿ç”¨å†…è”æ ·å¼ï¼Œä¹Ÿåº”åœ¨ä»£ç å®¡æŸ¥æ—¶è¯„ä¼°æ˜¯å¦å¯ä»¥æå–åˆ° CSSã€‚

#### è§„åˆ™ 7.4: CSS ç±»å‘½åè§„èŒƒ

**ä½¿ç”¨ BEM å‘½åæ³•** (Block-Element-Modifier):

```css
/* Block (å—) */
.documents-filter-hint { }

/* Element (å…ƒç´ ) */
.documents-filter-hint__icon { }
.documents-filter-hint__message { }

/* Modifier (ä¿®é¥°ç¬¦) */
.documents-filter-hint--warning { }
.documents-filter-hint--error { }
.documents-filter-hint--success { }
```

**å‘½åè§„åˆ™**:
- ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦ (kebab-case)
- ç±»ååº”å…·æœ‰è¯­ä¹‰åŒ–ï¼Œæè¿°ç”¨é€”è€Œéæ ·å¼
- é¿å…ä½¿ç”¨ç¼©å†™ï¼ˆé™¤éæ˜¯é€šç”¨ç¼©å†™å¦‚ btnã€navï¼‰
- æ¨¡å—å‰ç¼€ + åŠŸèƒ½æè¿°

**ç¤ºä¾‹**:
```css
/* âœ… å¥½çš„å‘½å */
.documents-upload-area { }
.search-filter-container { }
.ai-analysis-panel { }

/* âŒ ä¸å¥½çš„å‘½å */
.blue-box { }          /* æè¿°æ ·å¼è€Œéç”¨é€” */
.div1 { }              /* æ— æ„ä¹‰ */
.temp { }              /* è¿‡äºç¬¼ç»Ÿ */
```

#### è§„åˆ™ 7.5: CSS æ–‡ä»¶ç»“æ„

**æ¯ä¸ª CSS æ–‡ä»¶åº”éµå¾ªç»Ÿä¸€çš„ç»“æ„**:

```css
/**
 * æ¨¡å—åç§°æ ·å¼æ–‡ä»¶ (Module Name Styles)
 * 
 * @author AI Reviewer Team
 * @since 2025-12-10
 */

/* ============================================================================
   å…¨å±€æ ·å¼ (Global Styles)
   ============================================================================ */
.module-container {
    /* ... */
}

/* ============================================================================
   å¤´éƒ¨æ ·å¼ (Header Styles)
   ============================================================================ */
.module-header {
    /* ... */
}

/* ============================================================================
   å†…å®¹åŒºåŸŸæ ·å¼ (Content Area Styles)
   ============================================================================ */
.module-content {
    /* ... */
}

/* ============================================================================
   åº•éƒ¨æ ·å¼ (Footer Styles)
   ============================================================================ */
.module-footer {
    /* ... */
}

/* ============================================================================
   å“åº”å¼æ ·å¼ (Responsive Styles)
   ============================================================================ */
@media (max-width: 768px) {
    .module-container {
        /* ç§»åŠ¨ç«¯æ ·å¼ */
    }
}
```

**ç»“æ„è§„èŒƒ**:
- âœ… æ–‡ä»¶å¤´éƒ¨åŒ…å«æ³¨é‡Šè¯´æ˜
- âœ… ä½¿ç”¨åˆ†éš”çº¿å°†ä¸åŒåŠŸèƒ½åŒºåŸŸåˆ†ç»„
- âœ… æ¯ç»„æ ·å¼æœ‰ä¸­è‹±æ–‡æ³¨é‡Š
- âœ… å“åº”å¼æ ·å¼æ”¾åœ¨æ–‡ä»¶æœ«å°¾

#### è§„åˆ™ 7.6: æ ·å¼å¤ç”¨ä¸å˜é‡

**ä½¿ç”¨ CSS å˜é‡ç®¡ç†ä¸»é¢˜è‰²**:

```css
/* åœ¨ main.css æˆ– root ä¸­å®šä¹‰å…¨å±€å˜é‡ */
:root {
    /* ä¸»é¢˜è‰² (Theme Colors) */
    --primary-color: #667eea;
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    
    /* é—´è· (Spacing) */
    --spacing-xs: 5px;
    --spacing-sm: 10px;
    --spacing-md: 15px;
    --spacing-lg: 20px;
    
    /* åœ†è§’ (Border Radius) */
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
}

/* åœ¨å…·ä½“æ ·å¼ä¸­ä½¿ç”¨å˜é‡ */
.filter-hint {
    padding: var(--spacing-sm) var(--spacing-md);
    margin: var(--spacing-sm) 0;
    background: var(--primary-gradient);
    border-radius: var(--radius-md);
    color: var(--primary-color);
}
```

#### è§„åˆ™ 7.7: åŠ¨ç”»è§„èŒƒ

**åŠ¨ç”»åº”å®šä¹‰åœ¨ CSS ä¸­ï¼Œä½¿ç”¨ @keyframes**:

```css
/* âœ… æ­£ç¡®ï¼šåœ¨ CSS ä¸­å®šä¹‰åŠ¨ç”» */
.filter-hint {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
```

**é¿å…åœ¨ JS ä¸­æ“ä½œæ ·å¼**:
```javascript
// âŒ é”™è¯¯ï¼šåœ¨ JS ä¸­ç›´æ¥æ“ä½œæ ·å¼
element.style.opacity = '0';
element.style.transform = 'translateY(-5px)';

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ CSS ç±»åˆ‡æ¢
element.classList.add('fade-in');
```

---

## ğŸ“‹ ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•

### æ¯æ¬¡æäº¤ä»£ç å‰å¿…é¡»æ£€æŸ¥

#### åç«¯ä»£ç  (Backend Code)
- [ ] **æ³¨é‡Šæ ¼å¼**ï¼šæ‰€æœ‰ç±»ã€æ–¹æ³•ã€å¤æ‚é€»è¾‘éƒ½æœ‰ `ä¸­æ–‡(è‹±æ–‡)` æ³¨é‡Š
- [ ] **æ—¥å¿—å›½é™…åŒ–**ï¼šæ‰€æœ‰æ—¥å¿—ä½¿ç”¨ `I18n.get()` è€Œä¸æ˜¯ç¡¬ç¼–ç 
- [ ] **å¸¸é‡æå–**ï¼šæ‰€æœ‰å­—ç¬¦ä¸²å¸¸é‡æå–åˆ° YAML æ–‡ä»¶
- [ ] **YAML æ–‡ä»¶**ï¼šå·²åˆ›å»ºå¯¹åº”çš„ `{æ¨¡å—å}.yml` æ–‡ä»¶
- [ ] **ä¸­è‹±æ–‡ç‰ˆæœ¬**ï¼šYAML æ–‡ä»¶åŒ…å«ä¸­è‹±æ–‡ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç”¨ `---` åˆ†éš”
- [ ] **ç¼–è¯‘é€šè¿‡**ï¼š`mvn compile` æ— é”™è¯¯
- [ ] **æµ‹è¯•é€šè¿‡**ï¼šç›¸å…³å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] **ä»£ç æ ¼å¼**ï¼šç¬¦åˆ Java ä»£ç è§„èŒƒ

#### å‰ç«¯ä»£ç  (Frontend Code)
- [ ] **æ ·å¼æå–**ï¼šæ‰€æœ‰æ ·å¼æå–åˆ° CSS æ–‡ä»¶ï¼Œé¿å…å†…è”æ ·å¼
- [ ] **CSS æ–‡ä»¶**ï¼šå·²åˆ›å»ºæˆ–æ›´æ–°å¯¹åº”çš„ CSS æ–‡ä»¶
- [ ] **ç±»åè§„èŒƒ**ï¼šCSS ç±»åä½¿ç”¨ BEM å‘½åæ³•ï¼Œè¯­ä¹‰åŒ–å‘½å
- [ ] **æ³¨é‡Šå®Œæ•´**ï¼šCSS æ–‡ä»¶æœ‰æ–‡ä»¶å¤´æ³¨é‡Šå’Œåˆ†åŒºæ³¨é‡Š
- [ ] **å›½é™…åŒ–**ï¼šå‰ç«¯æ–‡æœ¬ä½¿ç”¨ `t()` å‡½æ•°ï¼Œé¿å…ç¡¬ç¼–ç 
- [ ] **åŠ¨ç”»å®šä¹‰**ï¼šåŠ¨ç”»åœ¨ CSS ä¸­å®šä¹‰ï¼Œä½¿ç”¨ @keyframes
- [ ] **å˜é‡ä½¿ç”¨**ï¼šä½¿ç”¨ CSS å˜é‡ç®¡ç†ä¸»é¢˜è‰²å’Œå¸¸ç”¨å€¼
- [ ] **å“åº”å¼**ï¼šè€ƒè™‘ç§»åŠ¨ç«¯é€‚é…ï¼Œæ·»åŠ åª’ä½“æŸ¥è¯¢

---

## ğŸ”„ æ–° Session å¯åŠ¨æ£€æŸ¥æ¸…å•

### æ¯æ¬¡æ‰“å¼€æ–° Session æ—¶

1. **å‘Šè¯‰ Copilot éµå®ˆè§„èŒƒ**ï¼š
   ```
   "éµå®ˆ 20251209-23-00-00-CODE_STANDARDS.md ä¸­çš„æ‰€æœ‰ä»£ç è§„èŒƒ"
   ```

2. **éªŒè¯ Copilot ç†è§£**ï¼š
   ```
   "ç”Ÿæˆä¸€ä¸ªç¤ºä¾‹ç±»ï¼Œå±•ç¤ºæ­£ç¡®çš„æ³¨é‡Šæ ¼å¼å’Œå›½é™…åŒ–ç”¨æ³•"
   ```

3. **ç¡®è®¤è§„èŒƒå·²åº”ç”¨**ï¼š
   - âœ… æ³¨é‡Šæ ¼å¼æ­£ç¡®
   - âœ… æ—¥å¿—ä½¿ç”¨ I18n
   - âœ… å­—ç¬¦ä¸²å·²å›½é™…åŒ–

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å®æ–½è®¡åˆ’**ï¼š`20251209-22-29-00-IMPLEMENTATION_PLAN.md`
- **ä¼šè¯æ¢å¤**ï¼š`SESSION_RECOVERY_GUIDE.md`
- **ç›®å½•è¯´æ˜**ï¼š`README.md`

---

## âœ… è§„èŒƒç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|------|------|----------|
| v1.2 | 2025-12-10 21:15 | æ–°å¢å‰ç«¯æ ·å¼ç®¡ç†è§„èŒƒï¼ˆè§„åˆ™ 7.1-7.7ï¼‰ï¼Œç¦æ­¢å†…è”æ ·å¼ï¼Œç»Ÿä¸€ CSS ç®¡ç† |
| v1.1 | 2025-12-09 23:30 | ä¼˜åŒ–æ–‡ä»¶ç»„ç»‡ï¼šæŒ‰è¯­è¨€åˆ†ç›®å½•ï¼ˆzh/å’Œen/ï¼‰ï¼Œæ·»åŠ è€ä»£ç å…¼å®¹ |
| v1.0 | 2025-12-09 23:00 | åˆå§‹ç‰ˆæœ¬ï¼Œå»ºç«‹ä»£ç è§„èŒƒ |

---

**è¿™æ˜¯ RAG 2.0 é¡¹ç›®çš„æ ¸å¿ƒè§„èŒƒï¼Œæ‰€æœ‰å¼€å‘äººå‘˜å¿…é¡»éµå®ˆï¼** ğŸ¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.2  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-09 23:00:00  
**æœ€åæ›´æ–°**: 2025-12-10 21:15:00  
**çŠ¶æ€**: âœ… ç”Ÿæ•ˆä¸­  
**ç»´æŠ¤è€…**: AI Reviewer Team

