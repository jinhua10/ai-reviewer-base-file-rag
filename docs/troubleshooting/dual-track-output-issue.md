# ğŸ” åŒè½¨è¾“å‡ºé—®é¢˜æ’æŸ¥æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025-12-13  
> **é—®é¢˜**: UI ä¸Šæ²¡æœ‰çœ‹åˆ°åŒè½¨è¾“å‡ºå†…å®¹

---

## ğŸ“‹ é—®é¢˜åˆ†æ

### 1. ç›¸ä¼¼é—®é¢˜è¿”å›ç©º

```json
{"success":true,"similarQuestions":[],"count":0}
```

**åŸå› **: æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰å†å²é—®ç­”è®°å½•  
**è§£å†³**: âœ… æ­£å¸¸ï¼Œæé—®åä¼šè‡ªåŠ¨è®°å½•

---

### 2. UI ä¸Šçœ‹ä¸åˆ°åŒè½¨è¾“å‡º

**å¯èƒ½åŸå› **:
1. å‰ç«¯æ²¡æœ‰è¿æ¥åˆ°æ­£ç¡®çš„æ¥å£
2. HOPE ç­”æ¡ˆä¸ºç©ºï¼ˆ`answer: null`ï¼‰
3. SSE è¿æ¥å¤±è´¥
4. æ•°æ®æ ¼å¼ä¸åŒ¹é…

---

## ğŸ”§ æ’æŸ¥æ­¥éª¤

### Step 1: æµ‹è¯•åç«¯æ¥å£

ä½¿ç”¨æµ‹è¯•é¡µé¢éªŒè¯åç«¯æ¥å£æ˜¯å¦æ­£å¸¸ï¼š

```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
file:///D:/Jetbrains/hackathon/ai-reviewer-base-file-rag/test-dual-track.html
```

**é¢„æœŸç»“æœ**:
- ğŸ’¡ HOPE å¿«é€Ÿç­”æ¡ˆå‡ºç°
- ğŸ¤– LLM è¯¦ç»†ç­”æ¡ˆé€å­—æ˜¾ç¤º
- âœ… å®Œæˆæç¤º

---

### Step 2: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

æ‰“å¼€å‰ç«¯é¡µé¢ï¼ˆhttp://localhost:3000ï¼‰ï¼Œåœ¨æµè§ˆå™¨ F12 æ§åˆ¶å°æŸ¥çœ‹ï¼š

**åº”è¯¥çœ‹åˆ°çš„æ—¥å¿—**:
```
ğŸš€ Starting dual-track streaming Q&A: ä½ å¥½
ğŸ“¡ Connecting to dual-track SSE: http://localhost:3000/api/qa/stream/dual-track?question=...
ğŸ“¨ Received data: hope {...}
ğŸ’¡ HOPE answer: xxx
ğŸ“¨ Received data: llm {...}
ğŸ“¦ LLM chunk: xxx
âœ… Dual-track streaming completed
```

**å¦‚æœçœ‹ä¸åˆ°è¿™äº›æ—¥å¿—**: å‰ç«¯è¿æ¥æœ‰é—®é¢˜

---

### Step 3: æ£€æŸ¥ç½‘ç»œè¯·æ±‚

åœ¨æµè§ˆå™¨ F12 -> Network æ ‡ç­¾é¡µ:

1. **æŸ¥æ‰¾ `dual-track` è¯·æ±‚**
   - åº”è¯¥æ˜¯ `EventStream` ç±»å‹
   - Status åº”è¯¥æ˜¯ `200`
   - Type åº”è¯¥æ˜¯ `text/event-stream`

2. **å¦‚æœè¯·æ±‚å¤±è´¥**:
   - æ£€æŸ¥ URL æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨
   - æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®

---

### Step 4: æ£€æŸ¥åç«¯æ—¥å¿—

åç«¯åº”è¯¥è¾“å‡ºï¼š

```
INFO: ğŸš€ åŒè½¨æµå¼é—®ç­”ï¼ˆå•ç«¯ç‚¹ï¼‰: question=ä½ å¥½
INFO: ğŸ’¡ HOPE ç­”æ¡ˆå·²å‘é€: 280ms
INFO: âœ… LLM æµå¼å®Œæˆ: 50 chunks, 3000ms
INFO: ğŸ‰ åŒè½¨æµå¼é—®ç­”å®Œæˆ
```

**å¦‚æœçœ‹ä¸åˆ°è¿™äº›æ—¥å¿—**: è¯·æ±‚æ²¡æœ‰åˆ°è¾¾åç«¯

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: HOPE ç­”æ¡ˆä¸ºç©º

**ç°è±¡**:
```json
{
  "hopeAnswer": {
    "answer": null,
    "confidence": 0.0,
    "source": "NONE"
  }
}
```

**åŸå› **: 
- çŸ¥è¯†åº“æ¨¡å¼æ˜¯ `none`ï¼ˆä¸ä½¿ç”¨ RAGï¼‰
- HOPE æœåŠ¡æœªå¯åŠ¨æˆ–æœªé…ç½®

**è§£å†³**:
1. é€‰æ‹©"ä½¿ç”¨ RAG"æˆ–"è§’è‰²çŸ¥è¯†åº“"æ¨¡å¼
2. æ£€æŸ¥ HOPE æœåŠ¡é…ç½®

---

### é—®é¢˜ 2: SSE è¿æ¥å¤±è´¥

**ç°è±¡**: æ§åˆ¶å°æ˜¾ç¤º `âŒ SSE connection error`

**åŸå› **:
- åç«¯æ¥å£ä¸å­˜åœ¨
- åç«¯æŠ¥é”™
- ç½‘ç»œé—®é¢˜

**è§£å†³**:
1. ç¡®è®¤åç«¯å·²å¯åŠ¨
2. æ£€æŸ¥åç«¯æ—¥å¿—é”™è¯¯
3. ä½¿ç”¨æµ‹è¯•é¡µé¢éªŒè¯

---

### é—®é¢˜ 3: åªçœ‹åˆ° HOPE æˆ–åªçœ‹åˆ° LLM

**ç°è±¡**: 
- åªæ˜¾ç¤ºä¸€ä¸ªç­”æ¡ˆ
- ä¸¤ä¸ªç­”æ¡ˆæ²¡æœ‰åˆå¹¶æ˜¾ç¤º

**åŸå› **: 
- å‰ç«¯é€»è¾‘é—®é¢˜
- æ•°æ®ç±»å‹åˆ¤æ–­é”™è¯¯

**è§£å†³**:
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
2. ç¡®è®¤æ”¶åˆ°äº† `hope` å’Œ `llm` ä¸¤ç§äº‹ä»¶
3. æ£€æŸ¥ QAPanel çš„ `data.type` åˆ¤æ–­é€»è¾‘

---

### é—®é¢˜ 4: å‰ç«¯æ˜¾ç¤ºä¸ºç©º

**ç°è±¡**: 
- æ§åˆ¶å°æœ‰æ—¥å¿—
- ä½† UI ä¸Šä¸æ˜¾ç¤º

**åŸå› **:
- React çŠ¶æ€æ›´æ–°é—®é¢˜
- CSS éšè—äº†å†…å®¹

**è§£å†³**:
1. æ£€æŸ¥ `lastMessage.content` æ˜¯å¦æœ‰å€¼
2. æ£€æŸ¥ `AnswerCard` æ˜¯å¦æ­£å¸¸æ¸²æŸ“
3. æ£€æŸ¥ CSS æ ·å¼

---

## âœ… å¿«é€ŸéªŒè¯

### ä½¿ç”¨æµ‹è¯•é¡µé¢

1. **æ‰“å¼€æµ‹è¯•é¡µé¢**:
   ```
   file:///D:/Jetbrains/hackathon/ai-reviewer-base-file-rag/test-dual-track.html
   ```

2. **è¾“å…¥é—®é¢˜**: `ä½ å¥½`

3. **ç‚¹å‡»"å¼€å§‹åŒè½¨æµå¼"**

4. **è§‚å¯Ÿè¾“å‡º**:
   - åº”è¯¥çœ‹åˆ°è“è‰²çš„ HOPE ç­”æ¡ˆæ¡†
   - åº”è¯¥çœ‹åˆ°ç»¿è‰²çš„ LLM ç­”æ¡ˆæ¡†ï¼ˆé€å­—å‡ºç°ï¼‰

5. **å¦‚æœæµ‹è¯•é¡µé¢æ­£å¸¸**:
   - è¯´æ˜åç«¯æ¥å£æ²¡é—®é¢˜
   - é—®é¢˜åœ¨å‰ç«¯ä»£ç 

6. **å¦‚æœæµ‹è¯•é¡µé¢å¤±è´¥**:
   - è¯´æ˜åç«¯æ¥å£æœ‰é—®é¢˜
   - æ£€æŸ¥åç«¯æ—¥å¿—

---

## ğŸ”¨ ä¿®å¤å»ºè®®

### ä¿®å¤ 1: ç¡®ä¿å‰ç«¯ä½¿ç”¨æ­£ç¡®æ¥å£

æ£€æŸ¥ `UI/src/api/modules/qa.js`:

```javascript
// åº”è¯¥æ˜¯è¿™ä¸ª URL
const eventSourceUrl = `/api/qa/stream/dual-track?question=${encodeURIComponent(question)}`
```

---

### ä¿®å¤ 2: ç¡®ä¿ç›‘å¬æ­£ç¡®çš„äº‹ä»¶

```javascript
// ç›‘å¬ HOPE
eventSource.addEventListener('hope', (event) => {
  const data = JSON.parse(event.data)
  // å¤„ç† HOPE ç­”æ¡ˆ
})

// ç›‘å¬ LLM
eventSource.addEventListener('llm', (event) => {
  const data = JSON.parse(event.data)
  // å¤„ç† LLM å—
})

// ç›‘å¬å®Œæˆ
eventSource.addEventListener('complete', (event) => {
  // å®Œæˆå¤„ç†
})
```

---

### ä¿®å¤ 3: ç¡®ä¿ UI æ­£ç¡®æ˜¾ç¤º

æ£€æŸ¥ `QAPanel.jsx` ä¸­çš„å›è°ƒå‡½æ•°:

```javascript
case 'hope':
  console.log('ğŸ’¡ HOPE:', data.content)  // æ·»åŠ æ—¥å¿—
  lastMessage.content = data.content
  lastMessage.hopeAnswer = data.content
  break

case 'llm':
  console.log('ğŸ“¦ LLM:', data.content)  // æ·»åŠ æ—¥å¿—
  // åˆå¹¶æ˜¾ç¤º
  if (lastMessage.hopeAnswer) {
    lastMessage.content = hopeAnswer + '\n\n--- LLM ---\n' + llmChunks
  }
  break
```

---

## ğŸ“ è°ƒè¯•æ£€æŸ¥æ¸…å•

- [ ] åç«¯å·²å¯åŠ¨ (`mvn spring-boot:run`)
- [ ] å‰ç«¯å·²å¯åŠ¨ (`npm run dev`)
- [ ] æµ‹è¯•é¡µé¢èƒ½çœ‹åˆ°åŒè½¨è¾“å‡º
- [ ] æµè§ˆå™¨æ§åˆ¶å°æœ‰ `ğŸš€ Starting dual-track` æ—¥å¿—
- [ ] æµè§ˆå™¨æ§åˆ¶å°æœ‰ `ğŸ“¡ Connecting to` æ—¥å¿—
- [ ] æµè§ˆå™¨æ§åˆ¶å°æœ‰ `ğŸ’¡ HOPE answer` æ—¥å¿—
- [ ] æµè§ˆå™¨æ§åˆ¶å°æœ‰ `ğŸ“¦ LLM chunk` æ—¥å¿—
- [ ] Network æ ‡ç­¾æœ‰ `dual-track` è¯·æ±‚
- [ ] åç«¯æ—¥å¿—æœ‰ `ğŸš€ åŒè½¨æµå¼é—®ç­”` æ—¥å¿—
- [ ] åç«¯æ—¥å¿—æœ‰ `ğŸ’¡ HOPE ç­”æ¡ˆå·²å‘é€` æ—¥å¿—
- [ ] åç«¯æ—¥å¿—æœ‰ `âœ… LLM æµå¼å®Œæˆ` æ—¥å¿—

---

## ğŸš€ ä¸‹ä¸€æ­¥

### å¦‚æœæµ‹è¯•é¡µé¢æ­£å¸¸

é—®é¢˜åœ¨å‰ç«¯ä»£ç ï¼Œæ£€æŸ¥ï¼š
1. `qa.js` ä¸­çš„ URL æ„å»º
2. `QAPanel.jsx` ä¸­çš„äº‹ä»¶ç›‘å¬
3. `AnswerCard.jsx` ä¸­çš„æ¸²æŸ“é€»è¾‘

### å¦‚æœæµ‹è¯•é¡µé¢ä¹Ÿå¤±è´¥

é—®é¢˜åœ¨åç«¯ï¼Œæ£€æŸ¥ï¼š
1. åç«¯æ—¥å¿—é”™è¯¯
2. `HybridStreamingService` æ˜¯å¦æ­£å¸¸
3. LLM å®¢æˆ·ç«¯æ˜¯å¦é…ç½®æ­£ç¡®

---

**åˆ›å»ºäºº**: AI Assistant  
**æ—¥æœŸ**: 2025-12-13

ğŸ¯ **æŒ‰ç…§è¿™ä¸ªæŒ‡å—é€æ­¥æ’æŸ¥ï¼Œåº”è¯¥èƒ½å®šä½é—®é¢˜ï¼**

