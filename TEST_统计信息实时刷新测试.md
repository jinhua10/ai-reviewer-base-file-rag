# 🧪 统计信息实时刷新 - 快速测试指南

## 启动应用

```bash
cd D:\Jetbrains\hackathon\ai-reviewer-base-file-rag
mvn spring-boot:run
```

等待启动完成后，访问：http://localhost:8080

## 测试步骤

### ✅ 测试 1：查看初始统计信息

**操作**：
1. 打开浏览器，访问 http://localhost:8080
2. 点击"📊 统计信息"标签页
3. 观察显示的内容

**预期结果**：
- ✅ 显示三个统计卡片
- ✅ 文档总数：显示文件系统中的实际文件数量
- ✅ 已索引文档：显示已建立索引的数量
- ✅ 索引完成度：显示百分比（如 85%）
- ✅ 每个卡片下方有灰色小字说明
- ✅ 如果有未索引文档，显示黄色警告框
- ✅ 如果所有文档已索引，显示绿色成功提示

### ✅ 测试 2：上传文档并刷新统计

**操作**：
1. 切换到"🔍📁 文档搜索"标签页
2. 选择并上传 1-2 个测试文档（PDF、Word、Excel等）
3. 等待上传完成
4. 切换回"📊 统计信息"标签页
5. 点击"🔄 刷新统计"按钮

**预期结果**：
- ✅ 文档总数增加（+1 或 +2）
- ✅ 已索引文档数量不变
- ✅ 索引完成度百分比下降
- ✅ 显示黄色警告框
- ✅ 警告内容类似："检测到 X 个未索引的文档。建议执行增量索引以更新知识库。"
- ✅ 显示"⚡ 立即执行增量索引"按钮

**浏览器控制台日志**（可选检查）：
```
📊 获取统计信息（增强版）
📂 扫描文件系统完成，找到 X 个支持的文档
📊 统计信息 - 文档总数: X, 已索引: Y, 未索引: Z, 完成度: N%
```

### ✅ 测试 3：执行增量索引

**操作**：
1. 在黄色警告框中，点击"⚡ 立即执行增量索引"按钮
2. 在确认对话框中点击"确定"
3. 等待索引完成（观察加载动画）
4. 查看操作结果

**预期结果**：
- ✅ 显示"正在执行增量索引..."加载动画
- ✅ 显示"只处理新增和修改的文档，速度较快"提示
- ✅ 索引完成后显示"✅ 操作成功"
- ✅ 显示处理的文件数量和耗时
- ✅ 黄色警告框自动消失
- ✅ 显示绿色成功提示："所有文档均已索引，知识库状态良好！"
- ✅ 索引完成度变为 100%

### ✅ 测试 4：验证新文档可搜索

**操作**：
1. 切换到"💬 智能问答"标签页
2. 输入与新上传文档相关的问题
3. 点击"提问"按钮

**预期结果**：
- ✅ 能够搜索到新上传的文档
- ✅ 答案中引用新文档的内容
- ✅ 来源列表中包含新文档

### ✅ 测试 5：删除文档并刷新

**操作**：
1. 切换到"🔍📁 文档搜索"标签页
2. 选择一个文档，点击"🗑️ 删除"
3. 确认删除
4. 切换回"📊 统计信息"标签页
5. 点击"🔄 刷新统计"按钮

**预期结果**：
- ✅ 文档总数减少 1
- ✅ 如果删除的是已索引文档，索引数量也减少
- ✅ 百分比相应更新

### ✅ 测试 6：批量上传测试

**操作**：
1. 切换到"🔍📁 文档搜索"标签页
2. 一次选择 5-10 个文档上传（按住 Ctrl 多选）
3. 等待上传完成
4. 切换回"📊 统计信息"标签页
5. 点击"🔄 刷新统计"

**预期结果**：
- ✅ 文档总数正确增加
- ✅ 警告框显示正确的未索引数量
- ✅ 百分比计算正确

### ✅ 测试 7：中英文切换

**操作**：
1. 在统计信息页面
2. 点击右上角"English"按钮切换语言
3. 观察内容变化

**预期结果**：
- ✅ 所有文本正确翻译为英文
- ✅ 统计卡片标签翻译正确
- ✅ 警告框内容翻译正确
- ✅ 按钮文字翻译正确
- ✅ 动态数字正常显示

### ✅ 测试 8：API直接测试

**使用 curl 或 Postman 测试**：

```bash
curl http://localhost:8080/api/qa/statistics
```

**预期 JSON 响应**：
```json
{
  "documentCount": 25,
  "indexedDocumentCount": 20,
  "unindexedCount": 5,
  "indexProgress": 80,
  "message": "检测到 5 个未索引的文档。建议执行增量索引以更新知识库。",
  "needsIndexing": true
}
```

或者（所有文档已索引）：
```json
{
  "documentCount": 25,
  "indexedDocumentCount": 25,
  "unindexedCount": 0,
  "indexProgress": 100,
  "message": "所有文档均已索引，知识库状态良好。",
  "needsIndexing": false
}
```

## 📊 测试结果记录表

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 测试1: 初始统计信息 | ⬜ |  |
| 测试2: 上传并刷新 | ⬜ |  |
| 测试3: 执行增量索引 | ⬜ |  |
| 测试4: 新文档可搜索 | ⬜ |  |
| 测试5: 删除并刷新 | ⬜ |  |
| 测试6: 批量上传 | ⬜ |  |
| 测试7: 中英文切换 | ⬜ |  |
| 测试8: API直接测试 | ⬜ |  |

## 🐛 常见问题排查

### 问题1：统计数字不变

**可能原因**：
- 文档不在正确的目录
- 文件格式不支持
- 缓存问题

**解决方法**：
1. 检查文档目录配置
2. 验证文件扩展名
3. 清除浏览器缓存
4. 重启应用

### 问题2：刷新没有反应

**检查**：
- 浏览器控制台是否有错误
- 网络请求是否成功（F12 -> Network）
- 后端日志是否有异常

### 问题3：数字显示为NaN或undefined

**可能原因**：
- API返回数据格式问题
- 前端解析错误

**检查**：
- API响应的JSON格式
- 前端代码中的字段名是否匹配

### 问题4：索引完成但数字不一致

**操作**：
1. 多次点击刷新统计
2. 检查后端日志
3. 查看文档目录是否有隐藏文件

## 📝 测试注意事项

1. **测试文档准备**
   - 准备多种格式的测试文档
   - 确保文档内容有意义（便于后续问答测试）
   - 准备不同大小的文件

2. **测试环境**
   - 清空浏览器缓存
   - 使用无痕模式避免缓存干扰
   - 测试不同浏览器（Chrome、Edge、Firefox）

3. **性能测试**
   - 准备大量文档（100+）
   - 测试刷新响应速度
   - 观察CPU和内存占用

4. **日志查看**
   - 打开 `logs/app.log` 查看详细日志
   - 关注扫描和统计相关的日志信息

## ✅ 成功标准

所有测试项都应该：
- ✅ 显示正确的数字
- ✅ 提示信息准确
- ✅ 操作响应及时
- ✅ 无JavaScript错误
- ✅ 无后端异常
- ✅ 中英文翻译正确

## 📞 问题反馈

如果测试中发现问题：
1. 记录具体步骤
2. 截图错误信息
3. 复制浏览器控制台日志
4. 复制后端日志相关部分
5. 记录测试环境信息

---

**测试人员**：__________
**测试日期**：__________
**测试环境**：__________
**测试结果**：✅ 通过 / ❌ 失败

