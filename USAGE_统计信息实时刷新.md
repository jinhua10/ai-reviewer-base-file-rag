# 📊 统计信息实时刷新 - 快速使用指南

## 功能说明

统计信息页面现已支持**实时文档数量统计**，通过扫描文件系统获取准确的文档数量，并智能提示是否需要执行索引。

## 主要特性

### 1. 实时统计数据

点击"🔄 刷新统计"按钮时，系统会：
- ✅ 扫描文件系统获取实际文档数量
- ✅ 查询索引引擎获取已索引数量
- ✅ 计算未索引文档数量
- ✅ 显示索引完成度百分比

### 2. 智能提示

#### 未索引文档警告
当检测到有文档未建立索引时，显示**黄色警告框**：

```
⚠️ 检测到未索引的文档
检测到 X 个未索引的文档。建议执行增量索引以更新知识库。
[⚡ 立即执行增量索引]
```

#### 索引完成提示
当所有文档都已索引时，显示**绿色成功提示**：

```
✅ 所有文档均已索引，知识库状态良好！
```

### 3. 统计卡片说明

**📄 文档总数**
- 显示：文件系统中的实际文档数量
- 说明：包括所有上传的文档，无论是否已索引

**✅ 已索引文档**
- 显示：已建立搜索索引的文档数量
- 说明：只有这些文档可以被搜索和问答

**✅ 索引完成度**
- 显示：已索引文档占总文档的百分比
- 说明：100% 表示所有文档都已索引

## 使用流程

### 场景1：上传新文档后

```
1. 上传文档
   └→ 切换到"🔍📁 文档搜索"标签页
   └→ 选择并上传文件

2. 查看统计
   └→ 切换到"📊 统计信息"标签页
   └→ 点击"🔄 刷新统计"

3. 执行索引
   └→ 看到黄色警告框
   └→ 点击"⚡ 立即执行增量索引"
   └→ 等待索引完成

4. 验证结果
   └→ 再次点击"🔄 刷新统计"
   └→ 确认索引完成度为 100%
   └→ 看到绿色成功提示
```

### 场景2：日常维护

```
定期检查
   └→ 打开"📊 统计信息"页面
   └→ 点击"🔄 刷新统计"
   └→ 查看索引完成度
   └→ 如有需要执行增量索引
```

## API 信息

### 端点
```
GET /api/qa/statistics
```

### 响应格式
```json
{
  "documentCount": 25,           // 文件系统中的文档总数
  "indexedDocumentCount": 20,    // 已索引的文档数量
  "unindexedCount": 5,           // 未索引的文档数量
  "indexProgress": 80,           // 索引完成度百分比
  "message": "检测到 5 个未索引的文档...",
  "needsIndexing": true          // 是否需要执行索引
}
```

## 常见问题

### Q: 刷新统计后数字没有变化？
**A:** 可能原因：
- 上传的文件格式不支持
- 文件不在配置的文档目录中
- 缓存问题，尝试清除浏览器缓存

### Q: 文档总数和已索引数量不一致怎么办？
**A:** 这是正常的！按照提示执行增量索引即可。

### Q: 增量索引和重建索引有什么区别？
**A:** 
- **增量索引**：只处理新增和修改的文档，速度快
- **重建索引**：完全重建所有索引，耗时长，适用于大规模变更

### Q: 多久需要执行一次索引？
**A:** 
- 推荐：每次上传或删除文档后执行增量索引
- 或者：每天定时执行一次

## 支持的文件格式

- 📊 Excel: `.xlsx`, `.xls`
- 📝 Word: `.docx`, `.doc`
- 📑 PowerPoint: `.pptx`, `.ppt`
- 📄 PDF: `.pdf`
- 📃 文本: `.txt`, `.md`
- 🌐 网页: `.html`, `.xml`

## 注意事项

1. **刷新频率**
   - 不建议频繁点击刷新（建议间隔 > 5秒）
   - 大量文档时扫描需要时间

2. **文档目录**
   - 只统计配置的文档目录中的文件
   - 子目录中的文件不会被统计

3. **性能考虑**
   - 文档数量很大时（10000+），扫描可能较慢
   - 首次扫描后会有缓存机制

## 技术细节

### 统计来源

- **文档总数**：实时扫描文件系统目录
- **已索引数量**：查询索引引擎数据库
- **计算方式**：后端Java服务实时计算

### 刷新机制

```
用户点击刷新
    ↓
前端发起API请求
    ↓
后端扫描文件系统
    ↓
计算统计数据
    ↓
返回JSON响应
    ↓
前端更新显示
```

## 更新日志

### v1.1.0 (2025-11-28)
- ✅ 新增文件系统实时扫描功能
- ✅ 显示未索引文档数量
- ✅ 智能提示索引建议
- ✅ 优化统计卡片显示
- ✅ 添加成功状态提示
- ✅ 完善中英文翻译

---

**需要帮助？** 查看详细文档：`FEATURE_统计信息实时刷新功能.md`

